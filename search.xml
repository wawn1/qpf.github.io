<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>å‡‘æ•°</title>
    <url>/posts/9b49a010.html</url>
    <content><![CDATA[<h2 id="å‡‘æ•°"><a href="#å‡‘æ•°" class="headerlink" title="å‡‘æ•°"></a>å‡‘æ•°</h2><h3 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h3><p>è¾“å…¥intå‹æ•°ç»„ï¼Œè¯¢é—®è¯¥æ•°ç»„èƒ½å¦åˆ†æˆä¸¤ç»„ï¼Œä½¿å¾—ä¸¤ç»„ä¸­å„å…ƒç´ åŠ èµ·æ¥çš„å’Œç›¸ç­‰ï¼Œå¹¶ä¸”ï¼Œæ‰€æœ‰5çš„å€æ•°å¿…é¡»åœ¨å…¶ä¸­ä¸€ä¸ªç»„ä¸­ï¼Œæ‰€æœ‰3çš„å€æ•°åœ¨å¦ä¸€ä¸ªç»„ä¸­ï¼ˆä¸åŒ…æ‹¬5çš„å€æ•°ï¼‰ï¼Œä¸æ˜¯5çš„å€æ•°ä¹Ÿä¸æ˜¯3çš„å€æ•°èƒ½æ”¾åœ¨ä»»æ„ä¸€ç»„ï¼Œå¯ä»¥å°†æ•°ç»„åˆ†ä¸ºç©ºæ•°ç»„ï¼Œèƒ½æ»¡è¶³ä»¥ä¸Šæ¡ä»¶ï¼Œè¾“å‡ºtrueï¼›ä¸æ»¡è¶³æ—¶è¾“å‡ºfalseã€‚</p>
<p>æ•°æ®èŒƒå›´ï¼šæ¯ä¸ªæ•°ç»„å¤§å°æ»¡è¶³ 1â‰¤ğ‘›â‰¤50ï¼Œè¾“å…¥çš„æ•°æ®å¤§å°æ»¡è¶³âˆ£valâˆ£â‰¤500 </p>
<h3 id="è¾“å…¥æè¿°ï¼š"><a href="#è¾“å…¥æè¿°ï¼š" class="headerlink" title="è¾“å…¥æè¿°ï¼š"></a>è¾“å…¥æè¿°ï¼š</h3><p>ç¬¬ä¸€è¡Œæ˜¯æ•°æ®ä¸ªæ•°ï¼Œç¬¬äºŒè¡Œæ˜¯è¾“å…¥çš„æ•°æ®</p>
<h3 id="è¾“å‡ºæè¿°ï¼š"><a href="#è¾“å‡ºæè¿°ï¼š" class="headerlink" title="è¾“å‡ºæè¿°ï¼š"></a>è¾“å‡ºæè¿°ï¼š</h3><p>è¿”å›trueæˆ–è€…false</p>
<h3 id="ç¤ºä¾‹1"><a href="#ç¤ºä¾‹1" class="headerlink" title="ç¤ºä¾‹1"></a>ç¤ºä¾‹1</h3><p>è¾“å…¥ï¼š<br>4<br>1 5 -5 1</p>
<p>è¾“å‡ºï¼š<br>true</p>
<p>è¯´æ˜ï¼š<br>ç¬¬ä¸€ç»„ï¼š5 -5 1<br>ç¬¬äºŒç»„ï¼š1   </p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> rl = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;readline&quot;</span>).<span class="hljs-title function_">createInterface</span>(&#123; <span class="hljs-attr">input</span>: process.<span class="hljs-property">stdin</span> &#125;);<br><span class="hljs-keyword">var</span> iter = rl[<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">asyncIterator</span>]();<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">readline</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; (<span class="hljs-keyword">await</span> iter.<span class="hljs-title function_">next</span>()).<span class="hljs-property">value</span>;<br><br><span class="hljs-keyword">void</span> (<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">// Write your code here</span><br>    <span class="hljs-keyword">let</span> lines = [];<br>    <span class="hljs-keyword">while</span> ((line = <span class="hljs-keyword">await</span> <span class="hljs-title function_">readline</span>())) &#123;<br>        lines.<span class="hljs-title function_">push</span>(line);<br>    &#125;<br><br>    <span class="hljs-keyword">let</span> arr = lines[<span class="hljs-number">1</span>].<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot; &quot;</span>).<span class="hljs-title function_">map</span>(<span class="hljs-title class_">Number</span>);<br><br>    <span class="hljs-keyword">let</span> sum = <span class="hljs-number">0</span>,<br>        sum3 = <span class="hljs-number">0</span>,<br>        sum5 = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">let</span> rest = [];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> num <span class="hljs-keyword">of</span> arr) &#123;<br>        <span class="hljs-keyword">if</span> (num % <span class="hljs-number">3</span> === <span class="hljs-number">0</span>) &#123;<br>            sum3 += num;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (num % <span class="hljs-number">5</span> === <span class="hljs-number">0</span>) &#123;<br>            sum5 += num;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            rest.<span class="hljs-title function_">push</span>(num);<br>        &#125;<br>        sum += num;<br>    &#125;<br><br>    <span class="hljs-keyword">let</span> part = sum / <span class="hljs-number">2</span>;<br><br>    <span class="hljs-keyword">let</span> target = part - sum3;<br>    <span class="hljs-comment">// é¢˜ç›®ï¼šç»™å‡ºä¸€ä¸ªlistï¼Œä¸€ä¸ªtargetï¼Œä»»å–æ•°ï¼Œç»„æˆtarget</span><br>    <span class="hljs-comment">// åŠ¨æ€è§„åˆ’ï¼Œä½†æ˜¯æœ‰è´Ÿæ•°ï¼Œ1.æ•°æ®èŒƒå›´ä»min~max, 2.æ•°ç»„ç”¨map</span><br>    <span class="hljs-keyword">let</span> min = <span class="hljs-number">0</span>,<br>        max = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> v <span class="hljs-keyword">of</span> rest) &#123;<br>        <span class="hljs-keyword">if</span> (v &lt; <span class="hljs-number">0</span>) &#123;<br>            min += v;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            max += v;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// æ•°å­—å¯èƒ½æ˜¯è´Ÿæ•°ï¼Œä¸èƒ½ç”¨æ•°ç»„è¦ç”¨map</span><br>    <span class="hljs-comment">// dp[i][j] è¡¨ç¤ºç»™çœ‹å‰iä¸ªæ•°ï¼Œæ˜¯å¦èƒ½ç»„æˆjï¼Œ 01èƒŒåŒ…</span><br>    <span class="hljs-comment">// dp[i][j] = dp[i-1][j-rest[i]] || dp[i-1][j]</span><br>    <span class="hljs-comment">// dp[0][0] = true</span><br>    <span class="hljs-keyword">let</span> dp = &#123;&#125;;<br>    dp[<span class="hljs-number">0</span>] = <span class="hljs-literal">true</span>;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt;= rest.<span class="hljs-property">length</span>; i++) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = min; j &lt;= max; j++) &#123;<br>            dp[j] = (dp[j - rest[i - <span class="hljs-number">1</span>]] || <span class="hljs-literal">false</span>) || (dp[j] || <span class="hljs-literal">false</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dp[target] || <span class="hljs-literal">false</span>);<br>&#125;)();<br><br></code></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>è£…é¥°å™¨æ¨¡å¼</title>
    <url>/posts/86aeeda8.html</url>
    <content><![CDATA[<h2 id="ã€è¯‘ã€‘è£…é¥°å™¨æ¨¡å¼decorator-pattern"><a href="#ã€è¯‘ã€‘è£…é¥°å™¨æ¨¡å¼decorator-pattern" class="headerlink" title="ã€è¯‘ã€‘è£…é¥°å™¨æ¨¡å¼decorator pattern"></a>ã€è¯‘ã€‘è£…é¥°å™¨æ¨¡å¼<a href="https://medium.com/qualyteam-engineering/decorator-design-pattern-in-functional-and-object-oriented-programming-e0a2be3c5679">decorator pattern</a></h2><p>æ•æ·è½¯ä»¶å¼€å‘ä¾èµ–äºå¿«é€Ÿå˜åŒ–çš„èƒ½åŠ›ã€‚æ–°çš„ç”¨æˆ·éœ€æ±‚å’Œå¯¹ç°æœ‰å®ç°çš„å¢å¼ºå°†ä¼šå‘ç”Ÿã€‚å› æ­¤ï¼Œä½ çš„ä»£ç å°†ä¼šæ”¹å˜ã€‚</p>
<p>ä½†æ˜¯ï¼ŒS.O.L.I.Dçš„å¼€é—­åŸåˆ™åˆå¦‚ä½•å‘¢ï¼Ÿ</p>
<blockquote>
<p>è½¯ä»¶å®ä½“ï¼ˆç±»ã€æ¨¡å—ã€å‡½æ•°ç­‰ï¼‰åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œä½†å¯¹ä¿®æ”¹å…³é—­ã€‚</p>
</blockquote>
<p>å¼€é—­åŸåˆ™å¼ºè°ƒä¸€æ—¦ä¸€ä¸ªå®ä½“å®Œæˆï¼Œå°±åº”è¯¥æ˜¯å®Œæˆçš„ã€‚ä½ åº”è¯¥ä¸ºå®ƒä»¬æä¾›ä¸€ç§è¢«å¢å¼º&#x2F;æ‰©å±•çš„æ–¹å¼ã€‚</p>
<p>åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼Œå¯ä»¥é€šè¿‡è®¾è®¡æ¨¡å¼ï¼ˆå¦‚ç­–ç•¥æ¨¡å¼ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼‰ã€ç»§æ‰¿æˆ–è‰¯å¥½çš„å»ºæ¨¡æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p>
<p>è€Œåœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ç»„åˆã€éƒ¨åˆ†åº”ç”¨ã€æŸ¯é‡ŒåŒ–ã€é«˜é˜¶å‡½æ•°ç­‰æ¦‚å¿µæ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p>
<p>ä»Šå¤©æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ä¸€ç§è¢«ä¸¤ç§èŒƒå¼æ”¯æŒçš„æ¨¡å¼ï¼Œç§°ä¸ºè£…é¥°å™¨ã€‚</p>
<h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>è£…é¥°å™¨æ˜¯ä¸€ç§åŒ…è£…å‡½æ•°ï¼Œç”¨äºå¢å¼ºè¢«åŒ…è£…å‡½æ•°çš„åŠŸèƒ½ã€‚ä½ ä¸ä¼šæ”¹å˜åŸå§‹å‡½æ•°çš„è¡Œä¸ºï¼Œè€Œæ˜¯ç”¨æ–°çš„è¡Œä¸ºæ¥è£…é¥°å®ƒï¼Œä»è€Œå®ç°å¯æ‰©å±•æ€§å’Œç»„åˆæ€§ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">fn</span> = (<span class="hljs-params"></span>) =&gt; &#123;&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">decorator</span> = fn =&gt; <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">//do some enhancement</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">fn</span>();<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">anotherDecorator</span> = fn =&gt; <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">//do another enhancement</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">fn</span>();<br>&#125;<br><br><span class="hljs-comment">//compose decorated functions</span><br><span class="hljs-keyword">const</span> f1 = <span class="hljs-title function_">anotherDecorator</span>(fn);<br><span class="hljs-comment">// f1();</span><br><span class="hljs-keyword">const</span> f2 = <span class="hljs-title function_">anotherDecorator</span>(<span class="hljs-title function_">decorator</span>(fn));<br><span class="hljs-comment">//f2();</span><br></code></pre></td></tr></table></figure>

<h3 id="å‡½æ•°å¼è£…é¥°å™¨"><a href="#å‡½æ•°å¼è£…é¥°å™¨" class="headerlink" title="å‡½æ•°å¼è£…é¥°å™¨"></a>å‡½æ•°å¼è£…é¥°å™¨</h3><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªé€šè¿‡äº¤äº’ç•Œé¢è¿è¡Œshellå‘½ä»¤çš„JavaScriptåº”ç”¨ç¨‹åºã€‚ç”¨æˆ·é€šè¿‡æŒ‰ä¸‹æŒ‰é’®æ¥è¿è¡Œå‘½ä»¤ï¼Œå¹¶é€šè¿‡é¢æ¿æŸ¥çœ‹è¾“å‡ºã€‚</p>
<p>ä½ åˆ›å»ºäº†ä¸€ä¸ªå‡½æ•°æ¥æŠ½è±¡æœ‰æ—¶å¤æ‚çš„spawn&#x2F;exec Node APIã€‚è¿™äº›æŠ½è±¡è¢«ç§°ä¸ºå¤–è§‚ï¼ˆfacadesï¼‰ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">runCommand</span> = (<span class="hljs-params">command, options</span>) =&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> cmd = <span class="hljs-title function_">spawn</span>(command, &#123;<br>      <span class="hljs-attr">shell</span>: <span class="hljs-literal">true</span>,<br>      ...options<br>    &#125;);<br><br>    cmd.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> print.<span class="hljs-title function_">info</span>(data.<span class="hljs-title function_">toString</span>()));<br>    cmd.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;end&#x27;</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(command));<br>    <br>    cmd.<span class="hljs-property">stderr</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> print.<span class="hljs-title function_">info</span>(data.<span class="hljs-title function_">toString</span>()));    <br><br>    cmd.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>        print.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Command could not be run: <span class="hljs-subst">$&#123;error&#125;</span>`</span>)<br>        <span class="hljs-title function_">reject</span>(error)<br>    &#125;);<br>  &#125;)<br></code></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä¸€ä¸ªä¸ºå¤æ‚çš„NodeJS spawn APIè¿›è¡Œäº†å°è£…çš„PromiseåŒ–å¤–è§‚ã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªè¦è¿è¡Œçš„shellå‘½ä»¤å­—ç¬¦ä¸²ï¼Œä»¥åŠä¸€äº›ä¼ é€’ç»™spawnåŸç”Ÿå‡½æ•°çš„é€‰é¡¹ã€‚å®ƒè¿è¡Œå‘½ä»¤ï¼Œå°†è¾“å‡ºæ‰“å°åˆ°stdoutï¼Œå¹¶è§£ææˆ–æ‹’ç»Promiseã€‚</p>
<h3 id="é¦–ä¸ªåŠŸèƒ½éœ€æ±‚ï¼šæ‰“å°æ­£åœ¨è¿è¡Œçš„å‘½ä»¤"><a href="#é¦–ä¸ªåŠŸèƒ½éœ€æ±‚ï¼šæ‰“å°æ­£åœ¨è¿è¡Œçš„å‘½ä»¤" class="headerlink" title="é¦–ä¸ªåŠŸèƒ½éœ€æ±‚ï¼šæ‰“å°æ­£åœ¨è¿è¡Œçš„å‘½ä»¤"></a>é¦–ä¸ªåŠŸèƒ½éœ€æ±‚ï¼šæ‰“å°æ­£åœ¨è¿è¡Œçš„å‘½ä»¤</h3><p>ç”¨æˆ·ä»¬å–œæ¬¢è¿™ä¸ªäº§å“ï¼Œä½†ä»–ä»¬å¸Œæœ›èƒ½å¤Ÿçœ‹åˆ°ä»–ä»¬å‘å‡ºçš„å‘½ä»¤ï¼Œè€Œä¸ä»…ä»…æ˜¯å®ƒçš„è¾“å‡ºã€‚</p>
<p>ä½ å¯ä»¥åœ¨ç¬¬ä¸€è¡Œä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„print.info(command)ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">runCommand</span> = (<span class="hljs-params">command, options</span>) =&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> &#123; shouldPrint, ...rest &#125; = options;<br>    <br>    <span class="hljs-comment">//prints</span><br>    <span class="hljs-keyword">if</span>(shouldPrint) <br>        print.<span class="hljs-title function_">info</span>(command);<br>    <br>    <span class="hljs-comment">//and runs</span><br>    <span class="hljs-keyword">const</span> cmd = <span class="hljs-title function_">spawn</span>(command, &#123;<br>      <span class="hljs-attr">shell</span>: <span class="hljs-literal">true</span>,<br>      ...rest<br>    &#125;);<br><br>    cmd.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> print.<span class="hljs-title function_">info</span>(data.<span class="hljs-title function_">toString</span>()));<br>    cmd.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;end&#x27;</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(command))<br>    <br>    cmd.<span class="hljs-property">stderr</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> print.<span class="hljs-title function_">info</span>(data.<span class="hljs-title function_">toString</span>()));    <br><br>    cmd.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>        print.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Command could not be run: <span class="hljs-subst">$&#123;error&#125;</span>`</span>)<br>        <span class="hljs-title function_">reject</span>(error)<br>    &#125;);<br>&#125;)<br></code></pre></td></tr></table></figure>
<p>ä½†æ˜¯ç°åœ¨å‡½æ•°åå­—ä¸å†è¡¨è¾¾å®ƒçš„åŠŸèƒ½ã€‚å®ƒæ—¢è¿è¡Œå‘½ä»¤åˆæ‰“å°å‘½ä»¤ã€‚</p>
<h3 id="ç¬¬äºŒä¸ªåŠŸèƒ½éœ€æ±‚ï¼šè®°å¿†æœ€åä¸€æ¡å‘½ä»¤"><a href="#ç¬¬äºŒä¸ªåŠŸèƒ½éœ€æ±‚ï¼šè®°å¿†æœ€åä¸€æ¡å‘½ä»¤" class="headerlink" title="ç¬¬äºŒä¸ªåŠŸèƒ½éœ€æ±‚ï¼šè®°å¿†æœ€åä¸€æ¡å‘½ä»¤"></a>ç¬¬äºŒä¸ªåŠŸèƒ½éœ€æ±‚ï¼šè®°å¿†æœ€åä¸€æ¡å‘½ä»¤</h3><p>ç”¨æˆ·å¸Œæœ›æœ‰ä¸€ä¸ªé€‰é¡¹æ¥è¿è¡Œæœ€åä¸€æ¡å‘½ä»¤ã€‚</p>
<p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸ºmemoize(command)çš„å‡½æ•°ï¼Œä½¿ç”¨æŒä¹…åŒ–æœºåˆ¶å­˜å‚¨æœ€åä¸€æ¡è¿è¡Œçš„å‘½ä»¤ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨æ¯æ¬¡å‘½ä»¤è°ƒç”¨ä¹‹å‰è°ƒç”¨memoizeï¼Œä½†è¿™æ ·ä¼šç»™éœ€è¦è¢«è®°å¿†çš„å‘½ä»¤æ·»åŠ æ—¶é—´è€¦åˆï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å°†è¿™ä¸ªè¡Œä¸ºæ·»åŠ åˆ°runCommandä¸­ã€‚</p>
<p>è¿™æ˜¯æœ€ç»ˆç»“æœï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">runCommand</span> = (<span class="hljs-params">command, options</span>) =&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> &#123; shouldPrint, shouldMemoize, ...rest &#125; = options;<br>    <br>    <span class="hljs-comment">//prints</span><br>    <span class="hljs-keyword">if</span>(shouldPrint) <br>        print.<span class="hljs-title function_">info</span>(command);<br>        <br>    <span class="hljs-keyword">if</span>(shouldMemoize)<br>        <span class="hljs-title function_">memoize</span>(command);<br>    <br>    <span class="hljs-comment">//and runs</span><br>    <span class="hljs-keyword">const</span> cmd = <span class="hljs-title function_">spawn</span>(command, &#123;<br>      <span class="hljs-attr">shell</span>: <span class="hljs-literal">true</span>,<br>      ...rest<br>    &#125;);<br><br>    cmd.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> print.<span class="hljs-title function_">info</span>(data.<span class="hljs-title function_">toString</span>()));<br>    cmd.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;end&#x27;</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(command))<br>    <br>    cmd.<span class="hljs-property">stderr</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> print.<span class="hljs-title function_">info</span>(data.<span class="hljs-title function_">toString</span>()));    <br><br>    cmd.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>        print.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Command could not be run: <span class="hljs-subst">$&#123;error&#125;</span>`</span>)<br>        <span class="hljs-title function_">reject</span>(error)<br>    &#125;);<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‡½æ•°åšäº†å¤ªå¤šçš„äº‹æƒ…ï¼Œè€Œä¸”è¶Šæ¥è¶Šåºå¤§ã€‚æˆ‘ä»¬å°†ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ä¸ä¿®æ”¹åŸå§‹å‡½æ•°çš„æƒ…å†µä¸‹ç»„åˆè¿™äº›è¡Œä¸ºã€‚</p>
<h3 id="é‡è§è£…é¥°å™¨æ¨¡å¼"><a href="#é‡è§è£…é¥°å™¨æ¨¡å¼" class="headerlink" title="é‡è§è£…é¥°å™¨æ¨¡å¼"></a>é‡è§è£…é¥°å™¨æ¨¡å¼</h3><p>è£…é¥°å™¨æ˜¯å¢å¼ºè¢«åŒ…è£…å‡½æ•°çš„åŒ…è£…å‡½æ•°ã€‚æœ‰ä¸€ä¸ªTC39ææ¡ˆå°†å…¶è½¬åŒ–ä¸ºECMA Scriptè§„èŒƒã€‚å¦‚æœè¯¥ææ¡ˆæˆä¸ºæ ‡å‡†ï¼Œæˆ‘ä»¬å°†æ”¯æŒè£…é¥°å™¨ä½œä¸ºECMA Scriptçš„ä¸€çº§è¯­è¨€æ„é€ ã€‚ä½†ç”±äºç›®å‰å®ƒåªå¤„äºç¬¬2é˜¶æ®µï¼Œå³è‰æ¡ˆé˜¶æ®µï¼Œæˆ‘ä»¬å°†ä½¿ç”¨é«˜é˜¶å‡½æ•°åˆ›å»ºè‡ªå·±çš„è£…é¥°å™¨ã€‚</p>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬å°†æˆ‘ä»¬çš„runCommandå‡½æ•°æ”¹å›åŸå§‹ç‰ˆæœ¬ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">runCommand</span> = (<span class="hljs-params">command, options</span>) =&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> cmd = <span class="hljs-title function_">spawn</span>(command, &#123;<br>      <span class="hljs-attr">shell</span>: <span class="hljs-literal">true</span>,<br>      ...options<br>    &#125;);<br><br>    cmd.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> print.<span class="hljs-title function_">info</span>(data.<span class="hljs-title function_">toString</span>()));<br>    cmd.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;end&#x27;</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(command));<br>    <br>    cmd.<span class="hljs-property">stderr</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> print.<span class="hljs-title function_">info</span>(data.<span class="hljs-title function_">toString</span>()));    <br><br>    cmd.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>        print.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Command could not be run: <span class="hljs-subst">$&#123;error&#125;</span>`</span>)<br>        <span class="hljs-title function_">reject</span>(error)<br>    &#125;);<br>  &#125;)<br></code></pre></td></tr></table></figure>

<p>è®©æˆ‘ä»¬ç”¨æ‰“å°è¡Œä¸ºæ¥è£…é¥°è¿™ä¸ªå‡½æ•°ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå‡½æ•°å¹¶æ‰“å°ç¬¬ä¸€ä¸ªå‚æ•°ã€‚ç„¶åï¼Œæˆ‘ä»¬è¿”å›è£…é¥°åçš„å‡½æ•°æœ¬èº«ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">withCommandLogger</span> = func =&gt; <span class="hljs-function">(<span class="hljs-params">command, options</span>) =&gt;</span> &#123;<br>    print.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Running command: <span class="hljs-subst">$&#123;command&#125;</span>`</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">func</span>(command, options)<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">withCommandLogger</span>(runCommand);<br></code></pre></td></tr></table></figure>

<p>withCommandLoggerè£…é¥°å™¨è¿”å›ä¸€ä¸ªè£…é¥°åçš„å‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥æ— ç¼åœ°ä½¿ç”¨å®ƒï¼Œå°±å¥½åƒæˆ‘ä»¬ä¸çŸ¥é“å®ƒå·²ç»è¢«è£…é¥°äº†ä¸€æ ·ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬æ²¡æœ‰ä¿®æ”¹åŸå§‹çš„runCommandå‡½æ•°ï¼Œè¿™å¾ˆå¥½ï¼Œå¦‚æœä½ æƒ³åœ¨ä¸æ‰“å°æ­£åœ¨è¿è¡Œçš„å‘½ä»¤çš„æƒ…å†µä¸‹ä½¿ç”¨å®ƒã€‚</p>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬å†æ¬¡è£…é¥°å‘½ä»¤ï¼Œæ·»åŠ memoizeåŠŸèƒ½ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">withMemoize</span> = func =&gt; <span class="hljs-function">(<span class="hljs-params">command, options</span>) =&gt;</span> &#123;<br>  <span class="hljs-title function_">memoize</span>(command);<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">func</span>(comand, options);<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">withMemoize</span>(<span class="hljs-title function_">withLogger</span>(runCommand));<br></code></pre></td></tr></table></figure>

<h3 id="ç¬¬ä¸‰ä¸ªåŠŸèƒ½éœ€æ±‚ï¼šæµ‹é‡å‘½ä»¤æ‰§è¡Œæ—¶é—´"><a href="#ç¬¬ä¸‰ä¸ªåŠŸèƒ½éœ€æ±‚ï¼šæµ‹é‡å‘½ä»¤æ‰§è¡Œæ—¶é—´" class="headerlink" title="ç¬¬ä¸‰ä¸ªåŠŸèƒ½éœ€æ±‚ï¼šæµ‹é‡å‘½ä»¤æ‰§è¡Œæ—¶é—´"></a>ç¬¬ä¸‰ä¸ªåŠŸèƒ½éœ€æ±‚ï¼šæµ‹é‡å‘½ä»¤æ‰§è¡Œæ—¶é—´</h3><p>ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†è£…é¥°å™¨æ¨¡å¼ï¼Œå¾ˆå®¹æ˜“åœ¨ä¸ä¿®æ”¹åŸå§‹å‡½æ•°çš„æƒ…å†µä¸‹å¢å¼ºå®ƒã€‚è®©æˆ‘ä»¬æ¥å®ç°ç¬¬ä¸‰ä¸ªåŠŸèƒ½è¯·æ±‚ï¼šæµ‹é‡å‘½ä»¤æ‰§è¡Œæ—¶é—´ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸ºwithTimeTrackerçš„è£…é¥°å™¨ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">withTimeTracker</span> = func =&gt; <span class="hljs-function">(<span class="hljs-params">command, options</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> start = process.<span class="hljs-title function_">hrtime</span>();<br>    <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">func</span>(command, options);<br>    <span class="hljs-keyword">const</span> [ seconds, nanoseconds ] = process.<span class="hljs-title function_">hrtime</span>(start);<br>    print.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Time ellapsed <span class="hljs-subst">$&#123;seconds&#125;</span>s <span class="hljs-subst">$&#123;(nanoseconds/<span class="hljs-number">1000000</span>)&#125;</span>ms`</span>);<br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä½¿ç”¨process.hrtime Node APIæ¥è®°å½•é«˜åˆ†è¾¨ç‡çš„ç»è¿‡æ—¶é—´ï¼Œé¿å…äº†ä¸€äº›Date APIçš„ç²¾åº¦é—®é¢˜ã€‚è¯·æ³¨æ„ï¼Œè¿™ä¸ªè£…é¥°å™¨å®é™…ä¸Šä¼šæ‰§è¡Œè¢«è£…é¥°çš„å‡½æ•°ï¼Œæ‰€ä»¥å®ƒåº”è¯¥æ˜¯æœ€åä¸€ä¸ªè¢«è°ƒç”¨çš„ã€‚</p>
<h3 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><p>è£…é¥°å™¨æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå¯ä»¥åœ¨ä¸ä¿®æ”¹åŸå§‹å‡½æ•°çš„æƒ…å†µä¸‹å®ç°é«˜åº¦çš„å¯æ‰©å±•æ€§ã€‚å®ƒé€šè¿‡ç»„åˆçš„æ–¹å¼ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§åŠ¨æ€å¢å¼ºå‡½æ•°çš„æ–¹å¼ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> run = <span class="hljs-title function_">withTimeTracker</span>(<span class="hljs-title function_">withMemoize</span>(<span class="hljs-title function_">withCommandLogger</span>(runCommand)));<br><br><span class="hljs-title function_">run</span>(<span class="hljs-string">&#x27;ls&#x27;</span>, &#123; <span class="hljs-attr">cwd</span>: <span class="hljs-string">&#x27;/home/user&#x27;</span> &#125;);<br></code></pre></td></tr></table></figure>

<h3 id="å‰©ä½™å‚æ•°-æ›´é€šç”¨çš„è£…é¥°å™¨"><a href="#å‰©ä½™å‚æ•°-æ›´é€šç”¨çš„è£…é¥°å™¨" class="headerlink" title="å‰©ä½™å‚æ•°, æ›´é€šç”¨çš„è£…é¥°å™¨"></a>å‰©ä½™å‚æ•°, æ›´é€šç”¨çš„è£…é¥°å™¨</h3><p>ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°æˆ‘ä»¬çš„è£…é¥°å™¨ä¸åŸå§‹çš„runCommandå‡½æ•°ç­¾åè€¦åˆåœ¨ä¸€èµ·ï¼Œå®ƒæœŸæœ›ä¸¤ä¸ªå‚æ•°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨å‰©ä½™å‚æ•°æ¥ä½¿æˆ‘ä»¬çš„è£…é¥°å™¨å¢å¼ºä»»ä½•å‡½æ•°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">withCache</span> = func =&gt; <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">getOrWriteToCache</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">func</span>(...args));<br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">withEventSourcing</span> = func =&gt; <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> &#123;<br>    eventStore.<span class="hljs-title function_">publish</span>(func, &#123; ...args &#125;);<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">func</span>(...args);<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">withLoggly</span> = func =&gt; <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> &#123;<br>    logglyClient.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;func.name&#125;</span> called with args <span class="hljs-subst">$&#123;args.reduce((acc, curr) =&gt; acc + <span class="hljs-string">&#x27;,&#x27;</span> + curr) &#125;</span>`</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">func</span>(...args);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>é€šè¿‡ä½¿ç”¨å‰©ä½™å‚æ•°è¯­æ³•â€¦ï¼Œè£…é¥°å™¨ä¸éœ€è¦çŸ¥é“è¢«è£…é¥°å‡½æ•°çš„å‚æ•°ã€‚å®ƒä»¬åªæ˜¯æ¥æ”¶ä»»æ„æ•°é‡çš„å‚æ•°ï¼Œå¹¶å°†å®ƒä»¬ä¼ é€’ç»™è¢«è£…é¥°çš„å‡½æ•°ã€‚</p>
]]></content>
      <categories>
        <category>Patterns</category>
      </categories>
  </entry>
  <entry>
    <title>äº«å…ƒæ¨¡å¼</title>
    <url>/posts/90c5a5f7.html</url>
    <content><![CDATA[<h2 id="ã€è¯‘ã€‘äº«å…ƒæ¨¡å¼Flyweight-Pattern"><a href="#ã€è¯‘ã€‘äº«å…ƒæ¨¡å¼Flyweight-Pattern" class="headerlink" title="ã€è¯‘ã€‘äº«å…ƒæ¨¡å¼Flyweight Pattern "></a>ã€è¯‘ã€‘äº«å…ƒæ¨¡å¼<a href="https://www.patterns.dev/vanilla/flyweight-pattern">Flyweight Pattern </a></h2><p>äº«å…ƒæ¨¡å¼æ˜¯åœ¨åˆ›å»ºå¤§é‡ç›¸ä¼¼å¯¹è±¡æ—¶èŠ‚çœå†…å­˜çš„ä¸€ç§æœ‰ç”¨æ–¹å¼ã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›ç”¨æˆ·èƒ½å¤Ÿæ·»åŠ å›¾ä¹¦ã€‚æ‰€æœ‰å›¾ä¹¦éƒ½æœ‰ä¸€ä¸ªæ ‡é¢˜ã€ä¸€ä¸ªä½œè€…å’Œä¸€ä¸ªISBNå·ï¼ç„¶è€Œï¼Œå›¾ä¹¦é¦†é€šå¸¸ä¸åªæœ‰ä¸€æœ¬ä¹¦çš„å‰¯æœ¬ï¼šé€šå¸¸ä¼šæœ‰å¤šæœ¬ç›¸åŒçš„ä¹¦ã€‚</p>
<p>å¦‚æœæœ‰å¤šæœ¬å®Œå…¨ç›¸åŒçš„ä¹¦ï¼Œæ¯æ¬¡éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„ä¹¦å®ä¾‹å°±æ²¡æœ‰å¤ªå¤§æ„ä¹‰äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Book</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">title, author, isbn</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span> = title;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">author</span> = author;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isbn</span> = isbn;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>è®©æˆ‘ä»¬åˆ›å»ºå°†æ–°ä¹¦æ·»åŠ åˆ°åˆ—è¡¨çš„åŠŸèƒ½ã€‚å¦‚æœä¸€æœ¬ä¹¦å…·æœ‰ç›¸åŒçš„ISBNå·ï¼Œå³å®Œå…¨ç›¸åŒçš„ä¹¦ç±ç±»å‹ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„Bookå®ä¾‹ã€‚ç›¸åï¼Œæˆ‘ä»¬åº”è¯¥é¦–å…ˆæ£€æŸ¥è¿™æœ¬ä¹¦æ˜¯å¦å·²ç»å­˜åœ¨ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> books = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">createBook</span> = (<span class="hljs-params">title, author, isbn</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> existingBook = books.<span class="hljs-title function_">has</span>(isbn);<br><br>  <span class="hljs-keyword">if</span> (existingBook) &#123;<br>    <span class="hljs-keyword">return</span> books.<span class="hljs-title function_">get</span>(isbn);<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>å¦‚æœå®ƒè¿˜ä¸åŒ…å«è¯¥ä¹¦çš„ISBNå·ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€æœ¬æ–°ä¹¦ï¼Œå¹¶å°†å…¶ISBNå·æ·»åŠ åˆ°isbnNumbersé›†åˆä¸­ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">createBook</span> = (<span class="hljs-params">title, author, isbn</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> existingBook = books.<span class="hljs-title function_">has</span>(isbn);<br><br>  <span class="hljs-keyword">if</span> (existingBook) &#123;<br>    <span class="hljs-keyword">return</span> books.<span class="hljs-title function_">get</span>(isbn);<br>  &#125;<br><br>  <span class="hljs-keyword">const</span> book = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(title, author, isbn);<br>  books.<span class="hljs-title function_">set</span>(isbn, book);<br><br>  <span class="hljs-keyword">return</span> book;<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>createBookå‡½æ•°å¸®åŠ©æˆ‘ä»¬åˆ›å»ºåŒä¸€ç±»å‹çš„æ–°ä¹¦å®ä¾‹ã€‚ç„¶è€Œï¼Œå›¾ä¹¦é¦†é€šå¸¸åŒ…å«å¤šæœ¬ç›¸åŒçš„ä¹¦ï¼è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªaddProductå‡½æ•°ï¼Œå®ƒå…è®¸æˆ‘ä»¬æ·»åŠ å¤šæœ¬ç›¸åŒçš„ä¹¦ã€‚å®ƒåº”è¯¥è°ƒç”¨createBookå‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›ä¸€ä¸ªæ–°åˆ›å»ºçš„Bookå®ä¾‹ï¼Œæˆ–è€…è¿”å›å·²ç»å­˜åœ¨çš„å®ä¾‹ã€‚</p>
<p>ä¸ºäº†è·Ÿè¸ªæ€»çš„å‰¯æœ¬æ•°é‡ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªproductListæ•°ç»„ï¼Œå…¶ä¸­åŒ…å«å›¾ä¹¦é¦†ä¸­çš„æ€»ä¹¦é‡ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> productList = [];<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">addProduct</span> = (<span class="hljs-params">title, author, isbn, availibility, sales</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> product = &#123;<br>    <span class="hljs-attr">book</span>: <span class="hljs-title function_">createBook</span>(title, author, isbn),<br>    sales,<br>    availibility,<br>    isbn<br>  &#125;;<br><br>  productList.<span class="hljs-title function_">push</span>(product);<br><br>  <span class="hljs-keyword">return</span> product;<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>å¤ªæ£’äº†ï¼åœ¨æ¯æ¬¡æ·»åŠ å‰¯æœ¬æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰æ•ˆåœ°ä½¿ç”¨å·²ç»å­˜åœ¨çš„Bookå®ä¾‹æ¥è¡¨ç¤ºè¯¥ç‰¹å®šå‰¯æœ¬ã€‚è®©æˆ‘ä»¬åˆ›å»º3æœ¬ä¹¦çš„5ä¸ªå‰¯æœ¬ï¼šã€Šå“ˆåˆ©Â·æ³¢ç‰¹ã€‹ã€ã€Šæ€æ­»ä¸€åªçŸ¥æ›´é¸Ÿã€‹å’Œã€Šäº†ä¸èµ·çš„ç›–èŒ¨æ¯”ã€‹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">addProduct</span>(<span class="hljs-string">&quot;Harry Potter&quot;</span>, <span class="hljs-string">&quot;JK Rowling&quot;</span>, <span class="hljs-string">&quot;AB123&quot;</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">100</span>);<br><span class="hljs-title function_">addProduct</span>(<span class="hljs-string">&quot;Harry Potter&quot;</span>, <span class="hljs-string">&quot;JK Rowling&quot;</span>, <span class="hljs-string">&quot;AB123&quot;</span>, <span class="hljs-literal">true</span>, <span class="hljs-number">50</span>);<br><span class="hljs-title function_">addProduct</span>(<span class="hljs-string">&quot;To Kill a Mockingbird&quot;</span>, <span class="hljs-string">&quot;Harper Lee&quot;</span>, <span class="hljs-string">&quot;CD345&quot;</span>, <span class="hljs-literal">true</span>, <span class="hljs-number">10</span>);<br><span class="hljs-title function_">addProduct</span>(<span class="hljs-string">&quot;To Kill a Mockingbird&quot;</span>, <span class="hljs-string">&quot;Harper Lee&quot;</span>, <span class="hljs-string">&quot;CD345&quot;</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">20</span>);<br><span class="hljs-title function_">addProduct</span>(<span class="hljs-string">&quot;The Great Gatsby&quot;</span>, <span class="hljs-string">&quot;F. Scott Fitzgerald&quot;</span>, <span class="hljs-string">&quot;EF567&quot;</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">20</span>);<br><br></code></pre></td></tr></table></figure>
<p>å°½ç®¡æœ‰5ä¸ªå‰¯æœ¬ï¼Œä½†æˆ‘ä»¬åªæœ‰3ä¸ªBookå®ä¾‹ï¼</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Book</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">title, author, isbn</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span> = title;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">author</span> = author;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isbn</span> = isbn;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> isbnNumbers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();<br><span class="hljs-keyword">const</span> productList = [];<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">createBook</span> = (<span class="hljs-params">title, author, isbn</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> book = isbnNumbers.<span class="hljs-title function_">has</span>(isbn);<br>  <span class="hljs-keyword">if</span> (book) &#123;<br>    <span class="hljs-keyword">return</span> book;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">const</span> book = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(title, author, isbn);<br>    isbnNumbers.<span class="hljs-title function_">add</span>(isbn);<br>    <span class="hljs-keyword">return</span> book;<br>  &#125;<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">addProduct</span> = (<span class="hljs-params">title, author, isbn, availibility, sales</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> product = &#123;<br>    <span class="hljs-attr">book</span>: <span class="hljs-title function_">createBook</span>(title, author, isbn),<br>    sales,<br>    availibility,<br>    isbn<br>  &#125;;<br><br>  productList.<span class="hljs-title function_">push</span>(product);<br><br>  <span class="hljs-keyword">return</span> product;<br>&#125;;<br><br><span class="hljs-title function_">addProduct</span>(<span class="hljs-string">&quot;Harry Potter&quot;</span>, <span class="hljs-string">&quot;JK Rowling&quot;</span>, <span class="hljs-string">&quot;AB123&quot;</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">100</span>);<br><span class="hljs-title function_">addProduct</span>(<span class="hljs-string">&quot;Harry Potter&quot;</span>, <span class="hljs-string">&quot;JK Rowling&quot;</span>, <span class="hljs-string">&quot;AB123&quot;</span>, <span class="hljs-literal">true</span>, <span class="hljs-number">50</span>);<br><span class="hljs-title function_">addProduct</span>(<span class="hljs-string">&quot;To Kill a Mockingbird&quot;</span>, <span class="hljs-string">&quot;Harper Lee&quot;</span>, <span class="hljs-string">&quot;CD345&quot;</span>, <span class="hljs-literal">true</span>, <span class="hljs-number">10</span>);<br><span class="hljs-title function_">addProduct</span>(<span class="hljs-string">&quot;To Kill a Mockingbird&quot;</span>, <span class="hljs-string">&quot;Harper Lee&quot;</span>, <span class="hljs-string">&quot;CD345&quot;</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">20</span>);<br><span class="hljs-title function_">addProduct</span>(<span class="hljs-string">&quot;The Great Gatsby&quot;</span>, <span class="hljs-string">&quot;F. Scott Fitzgerald&quot;</span>, <span class="hljs-string">&quot;EF567&quot;</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">20</span>);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Total amount of copies: &quot;</span>, productList.<span class="hljs-property">length</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Total amount of books: &quot;</span>, isbnNumbers.<span class="hljs-property">size</span>);<br></code></pre></td></tr></table></figure>

<p>å½“æ‚¨åˆ›å»ºå¤§é‡å¯¹è±¡æ—¶ï¼Œä½¿ç”¨äº«å…ƒæ¨¡å¼éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šè€—å°½æ‰€æœ‰å¯ç”¨çš„å†…å­˜ã€‚å®ƒå…è®¸æˆ‘ä»¬æœ€å°åŒ–å†…å­˜çš„æ¶ˆè€—ã€‚</p>
<p>åœ¨JavaScriptä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åŸå‹ç»§æ‰¿è½»æ¾è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å¦‚ä»Šï¼Œç¡¬ä»¶æ‹¥æœ‰GBçº§çš„å†…å­˜ï¼Œè¿™ä½¿å¾—äº«å…ƒæ¨¡å¼å˜å¾—ä¸é‚£ä¹ˆé‡è¦ã€‚</p>
]]></content>
      <categories>
        <category>Patterns</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode10</title>
    <url>/posts/3157d16d.html</url>
    <content><![CDATA[<h3 id="10-æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…"><a href="#10-æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…" class="headerlink" title="10. æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…"></a><a href="https://leetcode.cn/problems/regular-expression-matching/">10. æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</a></h3><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² s å’Œä¸€ä¸ªå­—ç¬¦è§„å¾‹ pï¼Œè¯·ä½ æ¥å®ç°ä¸€ä¸ªæ”¯æŒ â€˜.â€™ å’Œ â€˜*â€™ çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚</p>
<p>â€˜.â€™ åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦<br>â€˜*â€™ åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå‰é¢çš„é‚£ä¸€ä¸ªå…ƒç´ <br>æ‰€è°“åŒ¹é…ï¼Œæ˜¯è¦æ¶µç›– æ•´ä¸ª å­—ç¬¦ä¸² sçš„ï¼Œè€Œä¸æ˜¯éƒ¨åˆ†å­—ç¬¦ä¸²ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<figure class="highlight nix"><table><tr><td class="code"><pre><code class="hljs nix">è¾“å…¥ï¼š<span class="hljs-attr">s</span> = <span class="hljs-string">&quot;aa&quot;</span>, <span class="hljs-attr">p</span> = <span class="hljs-string">&quot;a&quot;</span><br>è¾“å‡ºï¼š<span class="hljs-literal">false</span><br>è§£é‡Šï¼š<span class="hljs-string">&quot;a&quot;</span> æ— æ³•åŒ¹é… <span class="hljs-string">&quot;aa&quot;</span> æ•´ä¸ªå­—ç¬¦ä¸²ã€‚<br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 2:</p>
<figure class="highlight actionscript"><table><tr><td class="code"><pre><code class="hljs actionscript">è¾“å…¥ï¼šs = <span class="hljs-string">&quot;aa&quot;</span>, p = <span class="hljs-string">&quot;a*&quot;</span><br>è¾“å‡ºï¼š<span class="hljs-literal">true</span><br>è§£é‡Šï¼šå› ä¸º <span class="hljs-string">&#x27;*&#x27;</span> ä»£è¡¨å¯ä»¥åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå‰é¢çš„é‚£ä¸€ä¸ªå…ƒç´ , åœ¨è¿™é‡Œå‰é¢çš„å…ƒç´ å°±æ˜¯ <span class="hljs-string">&#x27;a&#x27;</span>ã€‚å› æ­¤ï¼Œå­—ç¬¦ä¸² <span class="hljs-string">&quot;aa&quot;</span> å¯è¢«è§†ä¸º <span class="hljs-string">&#x27;a&#x27;</span> é‡å¤äº†ä¸€æ¬¡ã€‚<br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 3ï¼š</p>
<figure class="highlight actionscript"><table><tr><td class="code"><pre><code class="hljs actionscript">è¾“å…¥ï¼šs = <span class="hljs-string">&quot;ab&quot;</span>, p = <span class="hljs-string">&quot;.*&quot;</span><br>è¾“å‡ºï¼š<span class="hljs-literal">true</span><br>è§£é‡Šï¼š<span class="hljs-string">&quot;.*&quot;</span> è¡¨ç¤ºå¯åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªï¼ˆ<span class="hljs-string">&#x27;*&#x27;</span>ï¼‰ä»»æ„å­—ç¬¦ï¼ˆ<span class="hljs-string">&#x27;.&#x27;</span>ï¼‰ã€‚<br></code></pre></td></tr></table></figure>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/regular-expression-matching">https://leetcode.cn/problems/regular-expression-matching</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><figure class="highlight prolog"><table><tr><td class="code"><pre><code class="hljs prolog">dp[i][j] è¡¨ç¤ºç»™å­—ç¬¦ä¸²å‰iä¸ªå­—ç¬¦ï¼Œç»™çœ‹æ­£åˆ™ä¸²çš„å‰jä¸ªå­—ç¬¦ï¼Œèƒ½å¦åŒ¹é…<br><br>i jå­—ç¬¦åŒ¹é…ï¼Œåˆ†ç±»è®¨è®º<br>å¦‚æœi jåŒ¹é…, s[i]===p[j]æˆ–p[j]===<span class="hljs-string">&#x27;.&#x27;</span>,  dp[i<span class="hljs-number">-1</span>][j<span class="hljs-number">-1</span>]<br>å¦‚æœi jä¸åŒ¹é…, <br>    å¦‚æœp[j]æ˜¯*<br>       å¦‚æœi j<span class="hljs-number">-1</span>åŒ¹é…  <br>       	  å¦‚æœåŒ¹é…<span class="hljs-number">0</span>æ¬¡, dp[i][j<span class="hljs-number">-2</span>]<br>       	  å¦‚æœåŒ¹é…å¤šæ¬¡ï¼Œdp[i<span class="hljs-number">-1</span>][j]<br>       å¦‚æœi j<span class="hljs-number">-1</span>ä¸åŒ¹é…ï¼Œdp[i][j<span class="hljs-number">-2</span>]<br>    å¦‚æœp[j]æ˜¯æ­£å¸¸å­—ç¬¦ï¼Œfalse <br>    <br>åˆå§‹åŒ–<br>dp[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]=true<br>dp[i][<span class="hljs-number">0</span>]=false<br>dp[<span class="hljs-number">0</span>][j] ä¸ä¸€å®š  s: <span class="hljs-string">&#x27;&#x27;</span>, p: <span class="hljs-string">&#x27;a*&#x27;</span><br></code></pre></td></tr></table></figure>



<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">isEqual</span>(<span class="hljs-params">s: <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>, p: <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span></span>): <span class="hljs-built_in">boolean</span> &#123;<br>  <span class="hljs-keyword">if</span> (!s || !p) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>  <span class="hljs-keyword">return</span> s === p || p === <span class="hljs-string">&quot;.&quot;</span>;<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">isMatch</span>(<span class="hljs-params">s: <span class="hljs-built_in">string</span>, p: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">boolean</span> &#123;<br>  <span class="hljs-keyword">let</span> n = s.<span class="hljs-property">length</span>,<br>    m = p.<span class="hljs-property">length</span>;<br>  <span class="hljs-keyword">let</span> dp = <span class="hljs-title class_">Array</span>(n + <span class="hljs-number">1</span>)<br>    .<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>)<br>    .<span class="hljs-title function_">map</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Array</span>(m + <span class="hljs-number">1</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-literal">false</span>));<br><br>  dp[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = <span class="hljs-literal">true</span>;<br><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= n; i++) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">1</span>; j &lt;= m; j++) &#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isEqual</span>(s[i - <span class="hljs-number">1</span>], p[j - <span class="hljs-number">1</span>])) &#123;<br>        dp[i][j] = dp[i - <span class="hljs-number">1</span>][j - <span class="hljs-number">1</span>];<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (p[j - <span class="hljs-number">1</span>] === <span class="hljs-string">&quot;*&quot;</span>) &#123;<br>        dp[i][j] = dp[i][j - <span class="hljs-number">2</span>];<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isEqual</span>(s[i - <span class="hljs-number">1</span>], p[j - <span class="hljs-number">2</span>])) &#123;<br>          dp[i][j] = dp[i][j] || dp[i - <span class="hljs-number">1</span>][j];<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> dp[n][m];<br>&#125;<br><br></code></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode141</title>
    <url>/posts/d4826087.html</url>
    <content><![CDATA[<h3 id="141-ç¯å½¢é“¾è¡¨"><a href="#141-ç¯å½¢é“¾è¡¨" class="headerlink" title="141. ç¯å½¢é“¾è¡¨"></a><a href="https://leetcode.cn/problems/linked-list-cycle/">141. ç¯å½¢é“¾è¡¨</a></h3><p>ç»™ä½ ä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ head ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ã€‚</p>
<p>å¦‚æœé“¾è¡¨ä¸­æœ‰æŸä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡è¿ç»­è·Ÿè¸ª next æŒ‡é’ˆå†æ¬¡åˆ°è¾¾ï¼Œåˆ™é“¾è¡¨ä¸­å­˜åœ¨ç¯ã€‚ ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œè¯„æµ‹ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨æ•´æ•° pos æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚æ³¨æ„ï¼špos ä¸ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ ã€‚ä»…ä»…æ˜¯ä¸ºäº†æ ‡è¯†é“¾è¡¨çš„å®é™…æƒ…å†µã€‚</p>
<p>å¦‚æœé“¾è¡¨ä¸­å­˜åœ¨ç¯ ï¼Œåˆ™è¿”å› true ã€‚ å¦åˆ™ï¼Œè¿”å› false ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">è¾“å…¥ï¼š<span class="hljs-built_in">head</span> = [3,2,0,-4], pos = 1<br>è¾“å‡ºï¼š<span class="hljs-literal">true</span><br>è§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬äºŒä¸ªèŠ‚ç‚¹ã€‚<br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 2ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">è¾“å…¥ï¼š<span class="hljs-built_in">head</span> = [1,2], pos = 0<br>è¾“å‡ºï¼š<span class="hljs-literal">true</span><br>è§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚<br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 3ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">è¾“å…¥ï¼š<span class="hljs-built_in">head</span> = [1], pos = -1<br>è¾“å‡ºï¼š<span class="hljs-literal">false</span><br>è§£é‡Šï¼šé“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚<br></code></pre></td></tr></table></figure>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/linked-list-cycle">https://leetcode.cn/problems/linked-list-cycle</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><figure class="highlight"><table><tr><td class="code"><pre><code class="hljs">å¿«æ…¢æŒ‡é’ˆï¼Œ1ä¸ªé€Ÿåº¦ä¸º1,1ä¸ªé€Ÿåº¦ä¸º2ï¼Œåªè¦åœ¨ç¯ä¸Šï¼Œå¿«æŒ‡é’ˆä»¥ç›¸å¯¹é€Ÿåº¦1è¿½èµ¶æ…¢æŒ‡é’ˆï¼Œä¸€å®šèƒ½è¿½ä¸Š<br></code></pre></td></tr></table></figure>



<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">hasCycle</span>(<span class="hljs-params">head: ListNode | <span class="hljs-literal">null</span></span>): <span class="hljs-built_in">boolean</span> &#123;<br>  <span class="hljs-keyword">if</span> (!head || !head.<span class="hljs-property">next</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>  <span class="hljs-keyword">let</span> fast = head,<br>    slow = head;<br>  <span class="hljs-keyword">while</span> (fast !== <span class="hljs-literal">null</span> &amp;&amp; fast.<span class="hljs-property">next</span> !== <span class="hljs-literal">null</span>) &#123;<br>    slow = slow.<span class="hljs-property">next</span>;<br>    fast = fast.<span class="hljs-property">next</span>.<span class="hljs-property">next</span>;<br>    <span class="hljs-keyword">if</span> (slow === fast) <span class="hljs-keyword">break</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span> (fast != slow) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode142</title>
    <url>/posts/4d8b313d.html</url>
    <content><![CDATA[<h3 id="142-ç¯å½¢é“¾è¡¨-II"><a href="#142-ç¯å½¢é“¾è¡¨-II" class="headerlink" title="142. ç¯å½¢é“¾è¡¨ II"></a><a href="https://leetcode.cn/problems/linked-list-cycle-ii/">142. ç¯å½¢é“¾è¡¨ II</a></h3><p>ç»™ä½ ä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ head ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ã€‚</p>
<p>å¦‚æœé“¾è¡¨ä¸­æœ‰æŸä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡è¿ç»­è·Ÿè¸ª next æŒ‡é’ˆå†æ¬¡åˆ°è¾¾ï¼Œåˆ™é“¾è¡¨ä¸­å­˜åœ¨ç¯ã€‚ ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œè¯„æµ‹ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨æ•´æ•° pos æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚æ³¨æ„ï¼špos ä¸ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ ã€‚ä»…ä»…æ˜¯ä¸ºäº†æ ‡è¯†é“¾è¡¨çš„å®é™…æƒ…å†µã€‚</p>
<p>å¦‚æœé“¾è¡¨ä¸­å­˜åœ¨ç¯ ï¼Œåˆ™è¿”å› true ã€‚ å¦åˆ™ï¼Œè¿”å› false ã€‚</p>
<p>ç»™å®šä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ Â headÂ ï¼Œè¿”å›é“¾è¡¨å¼€å§‹å…¥ç¯çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚Â å¦‚æœé“¾è¡¨æ— ç¯ï¼Œåˆ™è¿”å›Â nullã€‚</p>
<p>å¦‚æœé“¾è¡¨ä¸­æœ‰æŸä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡è¿ç»­è·Ÿè¸ª next æŒ‡é’ˆå†æ¬¡åˆ°è¾¾ï¼Œåˆ™é“¾è¡¨ä¸­å­˜åœ¨ç¯ã€‚ ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œè¯„æµ‹ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨æ•´æ•° pos æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚å¦‚æœ pos æ˜¯ -1ï¼Œåˆ™åœ¨è¯¥é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚æ³¨æ„ï¼špos ä¸ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ï¼Œä»…ä»…æ˜¯ä¸ºäº†æ ‡è¯†é“¾è¡¨çš„å®é™…æƒ…å†µã€‚</p>
<p>ä¸å…è®¸ä¿®æ”¹ é“¾è¡¨ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">è¾“å…¥ï¼š<span class="hljs-built_in">head</span> = [3,2,0,-4], pos = 1<br>è¾“å‡ºï¼šè¿”å›ç´¢å¼•ä¸º 1 çš„é“¾è¡¨èŠ‚ç‚¹<br>è§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬äºŒä¸ªèŠ‚ç‚¹ã€‚<br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹Â 2ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">è¾“å…¥ï¼š<span class="hljs-built_in">head</span> = [1,2], pos = 0<br>è¾“å‡ºï¼šè¿”å›ç´¢å¼•ä¸º 0 çš„é“¾è¡¨èŠ‚ç‚¹<br>è§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚<br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 3ï¼š</p>
<figure class="highlight nix"><table><tr><td class="code"><pre><code class="hljs nix">è¾“å…¥ï¼š<span class="hljs-attr">head</span> = [<span class="hljs-number">1</span>], <span class="hljs-attr">pos</span> = -<span class="hljs-number">1</span><br>è¾“å‡ºï¼šè¿”å› <span class="hljs-literal">null</span><br>è§£é‡Šï¼šé“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚<br></code></pre></td></tr></table></figure>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/linked-list-cycle-ii">https://leetcode.cn/problems/linked-list-cycle-ii</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><img src="/pic/loop.png" width="600">

<figure class="highlight less"><table><tr><td class="code"><pre><code class="hljs less"><span class="hljs-number">4</span>ä¸ªç‚¹ï¼Œ<br><span class="hljs-selector-tag">a</span>: <span class="hljs-number">0</span>ç‚¹ï¼ˆ<span class="hljs-number">0</span>ä½ç½®èµ·ç‚¹ï¼‰<br><span class="hljs-selector-tag">b</span>: ç¯èµ·ç‚¹<br><span class="hljs-selector-tag">c</span>: æ…¢æŒ‡é’ˆåœ¨ç¯èµ·ç‚¹æ—¶ï¼Œå¿«æŒ‡é’ˆçš„ä½ç½®<br><span class="hljs-selector-tag">d</span>: ç›¸é‡ç‚¹<br><br><span class="hljs-selector-tag">c</span>ä½ç½®çš„ç‰¹æ®Šæ€§, ä»<span class="hljs-selector-tag">b</span>ç‚¹å…ˆèµ°äº†<span class="hljs-selector-tag">x</span>ï¼Œå†èµ°<span class="hljs-selector-tag">y</span>å°±å›åˆ°<span class="hljs-selector-tag">b</span>ç‚¹<br>æ‰€ä»¥ï¼Œä»<span class="hljs-selector-tag">b</span>ç‚¹èµ°<span class="hljs-selector-tag">x</span>+<span class="hljs-selector-tag">y</span>å¯ä»¥å›åˆ°<span class="hljs-selector-tag">b</span>ç‚¹<br>å¿«æŒ‡é’ˆä»¥ç›¸å¯¹é€Ÿåº¦<span class="hljs-number">1</span>è¿½èµ¶æ…¢æŒ‡é’ˆï¼Œç»è¿‡<span class="hljs-selector-tag">y</span>è¿½ä¸Šï¼Œ<span class="hljs-number">2</span>ä¸ªæŒ‡é’ˆéƒ½ä»<span class="hljs-selector-tag">b</span>ç‚¹èµ°äº†<span class="hljs-selector-tag">y</span>ï¼Œåªè¦å†èµ°<span class="hljs-selector-tag">x</span>å°±å›åˆ°<span class="hljs-selector-tag">b</span><br><br></code></pre></td></tr></table></figure>


<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">detectCycle</span>(<span class="hljs-params">head: ListNode | <span class="hljs-literal">null</span></span>): <span class="hljs-title class_">ListNode</span> | <span class="hljs-literal">null</span> &#123;<br>  <span class="hljs-keyword">if</span> (!head || !head.<span class="hljs-property">next</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br><br>  <span class="hljs-keyword">let</span> fast = head,<br>    slow = head;<br>  <span class="hljs-keyword">while</span> (fast !== <span class="hljs-literal">null</span> &amp;&amp; fast.<span class="hljs-property">next</span> !== <span class="hljs-literal">null</span>) &#123;<br>    slow = slow.<span class="hljs-property">next</span>;<br>    fast = fast.<span class="hljs-property">next</span>.<span class="hljs-property">next</span>;<br>    <span class="hljs-keyword">if</span> (slow === fast) <span class="hljs-keyword">break</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span> (fast !== slow) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br><br>  fast = head;<br>  <span class="hljs-keyword">while</span> (fast !== slow) &#123;<br>    fast = fast.<span class="hljs-property">next</span>;<br>    slow = slow.<span class="hljs-property">next</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> fast;<br>&#125;<br><br></code></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode148</title>
    <url>/posts/ad5ed823.html</url>
    <content><![CDATA[<h3 id="148-æ’åºé“¾è¡¨"><a href="#148-æ’åºé“¾è¡¨" class="headerlink" title="148. æ’åºé“¾è¡¨"></a><a href="https://leetcode.cn/problems/sort-list/description/">148. æ’åºé“¾è¡¨</a></h3><p>ç»™ä½ é“¾è¡¨çš„å¤´ç»“ç‚¹ head ï¼Œè¯·å°†å…¶æŒ‰ å‡åº æ’åˆ—å¹¶è¿”å› æ’åºåçš„é“¾è¡¨ ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<p>è¾“å…¥ï¼šhead &#x3D; [4,2,1,3]<br>è¾“å‡ºï¼š[1,2,3,4]<br>ç¤ºä¾‹ 2ï¼š</p>
<p>è¾“å…¥ï¼šhead &#x3D; [-1,5,3,4,0]<br>è¾“å‡ºï¼š[-1,0,3,4,5]<br>ç¤ºä¾‹ 3ï¼š</p>
<p>è¾“å…¥ï¼šhead &#x3D; []<br>è¾“å‡ºï¼š[]</p>
<p>æç¤ºï¼š</p>
<p>é“¾è¡¨ä¸­èŠ‚ç‚¹çš„æ•°ç›®åœ¨èŒƒå›´ [0, 5 * 104] å†…<br>-105 &lt;&#x3D; Node.val &lt;&#x3D; 105</p>
<p>è¿›é˜¶ï¼šä½ å¯ä»¥åœ¨ O(n log n) æ—¶é—´å¤æ‚åº¦å’Œå¸¸æ•°çº§ç©ºé—´å¤æ‚åº¦ä¸‹ï¼Œå¯¹é“¾è¡¨è¿›è¡Œæ’åºå—ï¼Ÿ</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><p>2ä¸ªæ’åºçš„é“¾è¡¨å½’å¹¶æ’åºï¼šæ—¶é—´å¤æ‚åº¦O(n+m), ç©ºé—´å¤æ‚åº¦O(1)</p>
<p>å•ä¸ªå…ƒç´ å·²ç»æ˜¯æœ‰åºçš„ï¼Œé‚£ä¹ˆå¾€å‰2ä¸ªå…ƒç´ å°±æ˜¯2ä¸ªæœ‰åºé“¾è¡¨å¯ä»¥å½’å¹¶<br>å½’å¹¶ä¸€è¶Ÿåï¼Œ2ä¸ªå…ƒç´ ä¸ºé•¿åº¦çš„ä¸ºæœ‰åºï¼Œä¸‹æ¬¡å¯ä»¥å½’å¹¶çš„é“¾è¡¨é•¿åº¦æ˜¯2*i<br>[4] [3] [2] [1] [5]<br>[3, 4] [1, 2] [5]<br>[1, 2, 3, 4] [5]<br>[1, 2, 3, 4, 5]</p>
<p>æ¯æ¬¡çš„æ—¶é—´å¤æ‚åº¦ï¼šO(n)</p>
<p>æ¬¡æ•°ï¼šlogn</p>
<p>æ€»æ—¶é—´å¤æ‚åº¦ï¼šO(nlogn)</p>
<p>ç©ºé—´å¤æ‚åº¦ï¼šO(1)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> sortList = <span class="hljs-keyword">function</span> (<span class="hljs-params">head</span>) &#123;<br><br>    <span class="hljs-keyword">let</span> total = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">let</span> p = head<br>    <span class="hljs-keyword">while</span> (p) &#123;<br>        total++<br>        p = p.<span class="hljs-property">next</span><br>    &#125;<br><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">mergeSortedList</span>(<span class="hljs-params">head1, head2</span>) &#123;<br>        <span class="hljs-keyword">let</span> dummyHead = &#123; <span class="hljs-attr">next</span>: <span class="hljs-literal">null</span> &#125;<br>        <span class="hljs-keyword">let</span> p = dummyHead<br>        <span class="hljs-keyword">let</span> i = head1, j = head2<br>        <span class="hljs-keyword">while</span> (i !== <span class="hljs-literal">null</span> &amp;&amp; j !== <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">if</span> (i.<span class="hljs-property">val</span> &lt;= j.<span class="hljs-property">val</span>) &#123;<br>                p.<span class="hljs-property">next</span> = i<br>                p = p.<span class="hljs-property">next</span><br>                i = i.<span class="hljs-property">next</span><br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                p.<span class="hljs-property">next</span> = j<br>                p = p.<span class="hljs-property">next</span><br>                j = j.<span class="hljs-property">next</span><br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (i !== <span class="hljs-literal">null</span>) &#123;<br>            p.<span class="hljs-property">next</span> = i<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (j !== <span class="hljs-literal">null</span>) &#123;<br>            p.<span class="hljs-property">next</span> = j<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> dummyHead.<span class="hljs-property">next</span><br>    &#125;<br><br>    <span class="hljs-keyword">let</span> dummyHead = &#123; <span class="hljs-attr">next</span>: head &#125;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> len = <span class="hljs-number">1</span>; len &lt; total; len *= <span class="hljs-number">2</span>) &#123; <span class="hljs-comment">// O(logn)</span><br>        <span class="hljs-keyword">let</span> restHead = dummyHead.<span class="hljs-property">next</span> <span class="hljs-comment">// å‰©ä½™çš„éƒ¨åˆ†å¼€å¤´èŠ‚ç‚¹</span><br>        <span class="hljs-keyword">let</span> p = dummyHead <span class="hljs-comment">// å·²å½’å¹¶çš„é“¾è¡¨å°¾éƒ¨</span><br>        <span class="hljs-keyword">while</span> (restHead) &#123;<br>            <span class="hljs-keyword">let</span> lhead = restHead<br>            <span class="hljs-keyword">let</span> ltail = lhead<br><br>            <span class="hljs-comment">// æ‰¾åˆ°å·¦é“¾è¡¨å¤´ï¼Œå°¾ï¼Œå°†å°¾éƒ¨æ–­å¼€ï¼Œæ›´æ–°æœªå¤„ç†çš„å¼€å¤´èŠ‚ç‚¹</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; len &amp;&amp; ltail !== <span class="hljs-literal">null</span>; i++) &#123;<br>                ltail = ltail.<span class="hljs-property">next</span><br>            &#125;<br><br>            <span class="hljs-keyword">let</span> rhead = ltail ? ltail.<span class="hljs-property">next</span> : <span class="hljs-literal">null</span><br>            <span class="hljs-keyword">if</span> (ltail &amp;&amp; ltail.<span class="hljs-property">next</span>) ltail.<span class="hljs-property">next</span> = <span class="hljs-literal">null</span><br><br>            <span class="hljs-comment">// æ‰¾åˆ°å³é“¾è¡¨å¤´ï¼Œå°¾ï¼Œå°†å°¾éƒ¨æ–­å¼€ï¼Œæ›´æ–°æœªå¤„ç†çš„å¼€å¤´èŠ‚ç‚¹</span><br>            <span class="hljs-keyword">let</span> rtail = rhead<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; len &amp;&amp; rtail !== <span class="hljs-literal">null</span>; i++) &#123;<br>                rtail = rtail.<span class="hljs-property">next</span><br>            &#125;<br><br>            restHead = rtail ? rtail.<span class="hljs-property">next</span> : <span class="hljs-literal">null</span><br>            <span class="hljs-keyword">if</span> (rtail &amp;&amp; rtail.<span class="hljs-property">next</span>) rtail.<span class="hljs-property">next</span> = <span class="hljs-literal">null</span><br><br>            <span class="hljs-comment">// åˆå¹¶å·¦å³é“¾è¡¨ï¼Œå°†åˆå¹¶åé“¾è¡¨ç»“ç‚¹ï¼ŒæŠŠå°¾éƒ¨æ¥ä¸Š</span><br>            p.<span class="hljs-property">next</span> = <span class="hljs-title function_">mergeSortedList</span>(lhead, rhead) <span class="hljs-comment">// O(n)</span><br><br>            <span class="hljs-keyword">while</span> (p.<span class="hljs-property">next</span>) &#123;<br>                p = p.<span class="hljs-property">next</span><br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">let</span> p1 = dummyHead.<span class="hljs-property">next</span><br>    <span class="hljs-keyword">while</span> (p1) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(p1.<span class="hljs-property">val</span>)<br>        p1 = p1.<span class="hljs-property">next</span><br>    &#125;<br><br>    <span class="hljs-keyword">return</span> dummyHead.<span class="hljs-property">next</span><br>&#125;;<br></code></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode153</title>
    <url>/posts/239730ea.html</url>
    <content><![CDATA[<h3 id="153-å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼"><a href="#153-å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼" class="headerlink" title="153. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼"></a><a href="https://leetcode.cn/problems/find-minimum-in-rotated-sorted-array/">153. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼</a></h3><p>å·²çŸ¥ä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•°ç»„ï¼Œé¢„å…ˆæŒ‰ç…§å‡åºæ’åˆ—ï¼Œç»ç”± 1 åˆ° n æ¬¡ æ—‹è½¬ åï¼Œå¾—åˆ°è¾“å…¥æ•°ç»„ã€‚ä¾‹å¦‚ï¼ŒåŸæ•°ç»„ nums &#x3D; [0,1,2,4,5,6,7] åœ¨å˜åŒ–åå¯èƒ½å¾—åˆ°ï¼š<br>è‹¥æ—‹è½¬ 4 æ¬¡ï¼Œåˆ™å¯ä»¥å¾—åˆ° [4,5,6,7,0,1,2]<br>è‹¥æ—‹è½¬ 7 æ¬¡ï¼Œåˆ™å¯ä»¥å¾—åˆ° [0,1,2,4,5,6,7]<br>æ³¨æ„ï¼Œæ•°ç»„ [a[0], a[1], a[2], â€¦, a[n-1]] æ—‹è½¬ä¸€æ¬¡ çš„ç»“æœä¸ºæ•°ç»„ [a[n-1], a[0], a[1], a[2], â€¦, a[n-2]] ã€‚</p>
<p>ç»™ä½ ä¸€ä¸ªå…ƒç´ å€¼ äº’ä¸ç›¸åŒ çš„æ•°ç»„ nums ï¼Œå®ƒåŸæ¥æ˜¯ä¸€ä¸ªå‡åºæ’åˆ—çš„æ•°ç»„ï¼Œå¹¶æŒ‰ä¸Šè¿°æƒ…å½¢è¿›è¡Œäº†å¤šæ¬¡æ—‹è½¬ã€‚è¯·ä½ æ‰¾å‡ºå¹¶è¿”å›æ•°ç»„ä¸­çš„ æœ€å°å…ƒç´  ã€‚</p>
<p>ä½ å¿…é¡»è®¾è®¡ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦ä¸º O(log n) çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><code class="hljs accesslog">è¾“å…¥ï¼šnums = <span class="hljs-string">[3,4,5,1,2]</span><br>è¾“å‡ºï¼š<span class="hljs-number">1</span><br>è§£é‡Šï¼šåŸæ•°ç»„ä¸º <span class="hljs-string">[1,2,3,4,5]</span> ï¼Œæ—‹è½¬ <span class="hljs-number">3</span> æ¬¡å¾—åˆ°è¾“å…¥æ•°ç»„ã€‚<br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 2ï¼š</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><code class="hljs accesslog">è¾“å…¥ï¼šnums = <span class="hljs-string">[4,5,6,7,0,1,2]</span><br>è¾“å‡ºï¼š<span class="hljs-number">0</span><br>è§£é‡Šï¼šåŸæ•°ç»„ä¸º <span class="hljs-string">[0,1,2,4,5,6,7]</span> ï¼Œæ—‹è½¬ <span class="hljs-number">4</span> æ¬¡å¾—åˆ°è¾“å…¥æ•°ç»„ã€‚<br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 3ï¼š</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><code class="hljs accesslog">è¾“å…¥ï¼šnums = <span class="hljs-string">[11,13,15,17]</span><br>è¾“å‡ºï¼š<span class="hljs-number">11</span><br>è§£é‡Šï¼šåŸæ•°ç»„ä¸º <span class="hljs-string">[11,13,15,17]</span> ï¼Œæ—‹è½¬ <span class="hljs-number">4</span> æ¬¡å¾—åˆ°è¾“å…¥æ•°ç»„ã€‚<br></code></pre></td></tr></table></figure>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/find-minimum-in-rotated-sorted-array">https://leetcode.cn/problems/find-minimum-in-rotated-sorted-array</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><figure class="highlight arcade"><table><tr><td class="code"><pre><code class="hljs arcade">å¦‚æœnums[<span class="hljs-built_in">mid</span>]&gt;nums[r]ï¼Œ<span class="hljs-built_in">mid</span>å’Œ<span class="hljs-built_in">mid</span>å·¦ä¾§éƒ½å¯ä»¥å»æ‰<br>å¦‚æœnums[<span class="hljs-built_in">mid</span>]&lt;=nums[r]ï¼Œ<span class="hljs-built_in">mid</span>å¯èƒ½æ˜¯è§£ï¼Œ<span class="hljs-built_in">mid</span>çš„å³ä¾§å¯ä»¥å»æ‰<br></code></pre></td></tr></table></figure>



<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">findMin</span>(<span class="hljs-params">nums: <span class="hljs-built_in">number</span>[]</span>): <span class="hljs-built_in">number</span> &#123;<br>    <span class="hljs-keyword">let</span> n = nums.<span class="hljs-property">length</span><br><br>    <span class="hljs-keyword">let</span> l=<span class="hljs-number">0</span>, r=n-<span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">while</span>(l&lt;r)&#123;<br>        <span class="hljs-keyword">let</span> mid= (l+r)&gt;&gt;&gt;<span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span>(nums[mid]&gt;nums[r]) &#123;<br>            l=mid+<span class="hljs-number">1</span><br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            r=mid<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> nums[l]<br>&#125;;<br><br></code></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode154</title>
    <url>/posts/bdf3a549.html</url>
    <content><![CDATA[<h3 id="154-å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼-II"><a href="#154-å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼-II" class="headerlink" title="154. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼ II"></a><a href="https://leetcode.cn/problems/find-minimum-in-rotated-sorted-array-ii/">154. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼ II</a></h3><p>å·²çŸ¥ä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•°ç»„ï¼Œé¢„å…ˆæŒ‰ç…§å‡åºæ’åˆ—ï¼Œç»ç”± 1 åˆ° n æ¬¡ æ—‹è½¬ åï¼Œå¾—åˆ°è¾“å…¥æ•°ç»„ã€‚ä¾‹å¦‚ï¼ŒåŸæ•°ç»„ nums &#x3D; [0,1,4,4,5,6,7] åœ¨å˜åŒ–åå¯èƒ½å¾—åˆ°ï¼š<br>è‹¥æ—‹è½¬ 4 æ¬¡ï¼Œåˆ™å¯ä»¥å¾—åˆ° [4,5,6,7,0,1,4]<br>è‹¥æ—‹è½¬ 7 æ¬¡ï¼Œåˆ™å¯ä»¥å¾—åˆ° [0,1,4,4,5,6,7]<br>æ³¨æ„ï¼Œæ•°ç»„ [a[0], a[1], a[2], â€¦, a[n-1]] æ—‹è½¬ä¸€æ¬¡ çš„ç»“æœä¸ºæ•°ç»„ [a[n-1], a[0], a[1], a[2], â€¦, a[n-2]] ã€‚</p>
<p>ç»™ä½ ä¸€ä¸ªå¯èƒ½å­˜åœ¨ é‡å¤ å…ƒç´ å€¼çš„æ•°ç»„ nums ï¼Œå®ƒåŸæ¥æ˜¯ä¸€ä¸ªå‡åºæ’åˆ—çš„æ•°ç»„ï¼Œå¹¶æŒ‰ä¸Šè¿°æƒ…å½¢è¿›è¡Œäº†å¤šæ¬¡æ—‹è½¬ã€‚è¯·ä½ æ‰¾å‡ºå¹¶è¿”å›æ•°ç»„ä¸­çš„ æœ€å°å…ƒç´  ã€‚</p>
<p>ä½ å¿…é¡»å°½å¯èƒ½å‡å°‘æ•´ä¸ªè¿‡ç¨‹çš„æ“ä½œæ­¥éª¤ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<figure class="highlight fix"><table><tr><td class="code"><pre><code class="hljs fix"><span class="hljs-attr">è¾“å…¥ï¼šnums </span>=<span class="hljs-string"> [1,3,5]</span><br><span class="hljs-string">è¾“å‡ºï¼š1</span><br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 2ï¼š</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><code class="hljs accesslog">è¾“å…¥ï¼šnums = <span class="hljs-string">[2,2,2,0,1]</span><br>è¾“å‡ºï¼š<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/find-minimum-in-rotated-sorted-array-ii">https://leetcode.cn/problems/find-minimum-in-rotated-sorted-array-ii</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><img src="/pic/lc154.png" width="600">
<figure class="highlight arcade"><table><tr><td class="code"><pre><code class="hljs arcade">å¦‚æœnums[<span class="hljs-built_in">mid</span>]&gt;nums[r]ï¼Œ<span class="hljs-built_in">mid</span>å’Œ<span class="hljs-built_in">mid</span>å·¦ä¾§éƒ½å¯ä»¥å»æ‰<br>å¦‚æœnums[<span class="hljs-built_in">mid</span>]&lt;nums[r]ï¼Œ<span class="hljs-built_in">mid</span>å¯èƒ½æ˜¯è§£ï¼Œ<span class="hljs-built_in">mid</span>å³ä¾§éƒ½å¯ä»¥å»æ‰<br>å¦‚æœnums[<span class="hljs-built_in">mid</span>]=nums[r]ï¼Œ<span class="hljs-built_in">mid</span>å¯èƒ½æ˜¯è§£<br>    <span class="hljs-built_in">mid</span>å¯èƒ½åœ¨ååŠéƒ¨çš„æ°´å¹³çº¿ï¼Œå¯èƒ½åœ¨å‰åŠéƒ¨çš„æ°´å¹³çº¿ï¼Œä¸èƒ½ç›´æ¥å»æ‰å³ä¾§<br>    ä½†æ˜¯å¿…é¡»è‡³å°‘æ”¶ç¼©<span class="hljs-number">1</span>ä¸ªï¼Œä¸ç„¶æ­»å¾ªç¯<br>    rå¯ä»¥å»æ‰ï¼Œä¸æ¼è§£<br>    <br></code></pre></td></tr></table></figure>



<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">findMin</span>(<span class="hljs-params">nums: <span class="hljs-built_in">number</span>[]</span>): <span class="hljs-built_in">number</span> &#123;<br>  <span class="hljs-keyword">let</span> n = nums.<span class="hljs-property">length</span>;<br>  <span class="hljs-keyword">let</span> l = <span class="hljs-number">0</span>,<br>    r = n - <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">while</span> (l &lt; r) &#123;<br>    <span class="hljs-keyword">let</span> mid = (l + r) &gt;&gt;&gt; <span class="hljs-number">1</span>;<br><br>    <span class="hljs-keyword">if</span> (nums[mid] &lt; nums[r]) &#123;<br>      r = mid;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (nums[mid] &gt; nums[r]) &#123;<br>      l = mid + <span class="hljs-number">1</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      r = r - <span class="hljs-number">1</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> nums[l];<br>&#125;<br><br></code></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode165</title>
    <url>/posts/e1d9c61c.html</url>
    <content><![CDATA[<h3 id="165-æ¯”è¾ƒç‰ˆæœ¬å·"><a href="#165-æ¯”è¾ƒç‰ˆæœ¬å·" class="headerlink" title="165. æ¯”è¾ƒç‰ˆæœ¬å·"></a><a href="https://leetcode.cn/problems/compare-version-numbers/description/">165. æ¯”è¾ƒç‰ˆæœ¬å·</a></h3><p>ç»™ä½ ä¸¤ä¸ª ç‰ˆæœ¬å·å­—ç¬¦ä¸² version1 å’Œ version2 ï¼Œè¯·ä½ æ¯”è¾ƒå®ƒä»¬ã€‚ç‰ˆæœ¬å·ç”±è¢«ç‚¹ â€˜.â€™ åˆ†å¼€çš„ä¿®è®¢å·ç»„æˆã€‚ä¿®è®¢å·çš„å€¼ æ˜¯å®ƒ è½¬æ¢ä¸ºæ•´æ•° å¹¶å¿½ç•¥å‰å¯¼é›¶ã€‚</p>
<p>æ¯”è¾ƒç‰ˆæœ¬å·æ—¶ï¼Œè¯·æŒ‰ ä»å·¦åˆ°å³çš„é¡ºåº ä¾æ¬¡æ¯”è¾ƒå®ƒä»¬çš„ä¿®è®¢å·ã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ªç‰ˆæœ¬å­—ç¬¦ä¸²çš„ä¿®è®¢å·è¾ƒå°‘ï¼Œåˆ™å°†ç¼ºå¤±çš„ä¿®è®¢å·è§†ä¸º 0ã€‚</p>
<p>è¿”å›è§„åˆ™å¦‚ä¸‹ï¼š</p>
<p>å¦‚æœ version1 &lt; version2 è¿”å› -1ï¼Œ<br>å¦‚æœ version1 &gt; version2 è¿”å› 1ï¼Œ<br>é™¤æ­¤ä¹‹å¤–è¿”å› 0ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥ï¼šversion1 &#x3D; â€œ1.2â€, version2 &#x3D; â€œ1.10â€<br>è¾“å‡ºï¼š-1<br>è§£é‡Šï¼š<br>version1 çš„ç¬¬äºŒä¸ªä¿®è®¢å·ä¸º â€œ2â€ï¼Œversion2 çš„ç¬¬äºŒä¸ªä¿®è®¢å·ä¸º â€œ10â€ï¼š2 &lt; 10ï¼Œæ‰€ä»¥ version1 &lt; version2ã€‚</p>
<p>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥ï¼šversion1 &#x3D; â€œ1.01â€, version2 &#x3D; â€œ1.001â€<br>è¾“å‡ºï¼š0<br>è§£é‡Šï¼š<br>å¿½ç•¥å‰å¯¼é›¶ï¼Œâ€01â€ å’Œ â€œ001â€ éƒ½ä»£è¡¨ç›¸åŒçš„æ•´æ•° â€œ1â€ã€‚</p>
<p>ç¤ºä¾‹ 3ï¼š<br>è¾“å…¥ï¼šversion1 &#x3D; â€œ1.0â€, version2 &#x3D; â€œ1.0.0.0â€<br>è¾“å‡ºï¼š0<br>è§£é‡Šï¼š<br>version1 æœ‰æ›´å°‘çš„ä¿®è®¢å·ï¼Œæ¯ä¸ªç¼ºå¤±çš„ä¿®è®¢å·æŒ‰ â€œ0â€ å¤„ç†ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">string</span>&#125; <span class="hljs-variable">version1</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">string</span>&#125; <span class="hljs-variable">version2</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> &#123;<span class="hljs-type">number</span>&#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">var</span> compareVersion = <span class="hljs-keyword">function</span> (<span class="hljs-params">version1, version2</span>) &#123;<br>    <span class="hljs-keyword">let</span> arr1 = version1.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;.&#x27;</span>).<span class="hljs-title function_">map</span>(<span class="hljs-title class_">Number</span>)<br>    <span class="hljs-keyword">let</span> arr2 = version2.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;.&#x27;</span>).<span class="hljs-title function_">map</span>(<span class="hljs-title class_">Number</span>)<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>, j = <span class="hljs-number">0</span>; i &lt; arr1.<span class="hljs-property">length</span> || j &lt; arr2.<span class="hljs-property">length</span>; i++, j++) &#123;<br>        <span class="hljs-keyword">let</span> a = arr1[i] || <span class="hljs-number">0</span><br>        <span class="hljs-keyword">let</span> b = arr2[j] || <span class="hljs-number">0</span><br><br>        <span class="hljs-keyword">if</span> (a &gt; b) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (a &lt; b) &#123;<br>            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>&#125;;<br></code></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>å·¥å‚æ¨¡å¼</title>
    <url>/posts/383e610.html</url>
    <content><![CDATA[<h2 id="ã€è¯‘ã€‘å·¥å‚æ¨¡å¼Factory-Pattern"><a href="#ã€è¯‘ã€‘å·¥å‚æ¨¡å¼Factory-Pattern" class="headerlink" title="ã€è¯‘ã€‘å·¥å‚æ¨¡å¼Factory Pattern"></a>ã€è¯‘ã€‘å·¥å‚æ¨¡å¼<a href="https://www.patterns.dev/vanilla/factory-pattern">Factory Pattern</a></h2><p>ä½¿ç”¨å·¥å‚æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å·¥å‚å‡½æ•°æ¥åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚å½“ä¸€ä¸ªå‡½æ•°åœ¨ä¸ä½¿ç”¨newå…³é”®å­—çš„æƒ…å†µä¸‹è¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡æ—¶ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå·¥å‚å‡½æ•°ï¼</p>
<p>å‡è®¾æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºéœ€è¦è®¸å¤šç”¨æˆ·ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>firstName</code>ã€<code>lastName</code>å’Œ<code>email</code>å±æ€§åˆ›å»ºæ–°ç”¨æˆ·ã€‚å·¥å‚å‡½æ•°è¿˜ä¼šä¸ºæ–°åˆ›å»ºçš„å¯¹è±¡æ·»åŠ ä¸€ä¸ª<code>fullName</code>å±æ€§ï¼Œè¯¥å±æ€§è¿”å›<code>firstName+lastName</code>ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">createUser</span> = (<span class="hljs-params">&#123; firstName, lastName, email &#125;</span>) =&gt; (&#123;<br>  firstName,<br>  lastName,<br>  email,<br>  <span class="hljs-title function_">fullName</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.firstName&#125;</span> <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.lastName&#125;</span>`</span>;<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>å¤ªæ£’äº†ï¼ç°åœ¨æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨createUserå‡½æ•°è½»æ¾åœ°åˆ›å»ºå¤šä¸ªç”¨æˆ·äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">createUser</span> = (<span class="hljs-params">&#123; firstName, lastName, email &#125;</span>) =&gt; (&#123;<br>  firstName,<br>  lastName,<br>  email,<br>  <span class="hljs-title function_">fullName</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.firstName&#125;</span> <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.lastName&#125;</span>`</span>;<br>  &#125;<br>&#125;);<br><br><br><span class="hljs-keyword">const</span> user1 = <span class="hljs-title function_">createUser</span>(&#123;<br>  <span class="hljs-attr">firstName</span>: <span class="hljs-string">&quot;John&quot;</span>,<br>  <span class="hljs-attr">lastName</span>: <span class="hljs-string">&quot;Doe&quot;</span>,<br>  <span class="hljs-attr">email</span>: <span class="hljs-string">&quot;john@doe.com&quot;</span><br>&#125;);<br><br><br><span class="hljs-keyword">const</span> user2 = <span class="hljs-title function_">createUser</span>(&#123;<br>  <span class="hljs-attr">firstName</span>: <span class="hljs-string">&quot;Jane&quot;</span>,<br>  <span class="hljs-attr">lastName</span>: <span class="hljs-string">&quot;Doe&quot;</span>,<br>  <span class="hljs-attr">email</span>: <span class="hljs-string">&quot;jane@doe.com&quot;</span><br>&#125;);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user1);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user2);<br></code></pre></td></tr></table></figure>

<p>å¦‚æœæˆ‘ä»¬æ­£åœ¨åˆ›å»ºç›¸å¯¹å¤æ‚å’Œå¯é…ç½®çš„å¯¹è±¡ï¼Œå·¥å‚æ¨¡å¼ä¼šéå¸¸æœ‰ç”¨ã€‚åœ¨é”®å’Œå€¼å–å†³äºç‰¹å®šç¯å¢ƒæˆ–é…ç½®çš„æƒ…å†µå¾ˆæœ‰ç”¨ã€‚ä½¿ç”¨å·¥å‚æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°åˆ›å»ºåŒ…å«è‡ªå®šä¹‰é”®å’Œå€¼çš„æ–°å¯¹è±¡ï¼</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">createObjectFromArray</span> = (<span class="hljs-params">[key, value]</span>) =&gt; (&#123;<br>  [key]: value,<br>&#125;);<br><br><span class="hljs-title function_">createObjectFromArray</span>([<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;John&quot;</span>]); <span class="hljs-comment">// &#123; name: &quot;John&quot; &#125;</span><br></code></pre></td></tr></table></figure>

<h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><p>å½“æˆ‘ä»¬éœ€è¦åˆ›å»ºéå¸¸å¤šç›¸åŒå±æ€§çš„å¯¹è±¡æ—¶ï¼Œå·¥å‚æ¨¡å¼éå¸¸æœ‰ç”¨ã€‚æ ¹æ®å½“å‰ç¯å¢ƒæˆ–ç”¨æˆ·ç‰¹å®šé…ç½®ï¼Œå·¥å‚å‡½æ•°å¯ä»¥è½»æ¾è¿”å›è‡ªå®šä¹‰å¯¹è±¡ã€‚</p>
<h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><p>åœ¨JavaScriptä¸­ï¼Œå·¥å‚æ¨¡å¼ä¸è¿‡æ˜¯ä¸€ä¸ªåœ¨ä¸ä½¿ç”¨newå…³é”®å­—çš„æƒ…å†µä¸‹è¿”å›å¯¹è±¡çš„å‡½æ•°ã€‚ES6ç®­å¤´å‡½æ•°å…è®¸æˆ‘ä»¬åˆ›å»ºå°å‹å·¥å‚å‡½æ•°ï¼Œæ¯æ¬¡éƒ½ä¼šéšå¼è¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚</p>
<p>ç„¶è€Œï¼Œåœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæ¯æ¬¡åˆ›å»ºclasså¯¹è±¡æ›´èŠ‚çœå†…å­˜ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">firstName, lastName, email</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">firstName</span> = firstName;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastName</span> = lastName;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">email</span> = email;<br>  &#125;<br><br>  <span class="hljs-title function_">fullName</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.firstName&#125;</span> <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.lastName&#125;</span>`</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> user1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(&#123;<br>  <span class="hljs-attr">firstName</span>: <span class="hljs-string">&quot;John&quot;</span>,<br>  <span class="hljs-attr">lastName</span>: <span class="hljs-string">&quot;Doe&quot;</span>,<br>  <span class="hljs-attr">email</span>: <span class="hljs-string">&quot;john@doe.com&quot;</span>,<br>&#125;);<br><br><span class="hljs-keyword">const</span> user2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(&#123;<br>  <span class="hljs-attr">firstName</span>: <span class="hljs-string">&quot;Jane&quot;</span>,<br>  <span class="hljs-attr">lastName</span>: <span class="hljs-string">&quot;Doe&quot;</span>,<br>  <span class="hljs-attr">email</span>: <span class="hljs-string">&quot;jane@doe.com&quot;</span>,<br>&#125;);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user1.<span class="hljs-property">fullName</span> === <span class="hljs-title class_">User</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">fullName</span>) <span class="hljs-comment">// true</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user2.<span class="hljs-property">fullName</span> === user1.<span class="hljs-property">fullName</span>) <span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Patterns</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode19</title>
    <url>/posts/488b69c9.html</url>
    <content><![CDATA[<h3 id="19-åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬-N-ä¸ªç»“ç‚¹"><a href="#19-åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬-N-ä¸ªç»“ç‚¹" class="headerlink" title="19. åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ N ä¸ªç»“ç‚¹"></a><a href="https://leetcode.cn/problems/remove-nth-node-from-end-of-list/">19. åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ N ä¸ªç»“ç‚¹</a></h3><p>ç»™ä½ ä¸€ä¸ªé“¾è¡¨ï¼Œåˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ n ä¸ªç»“ç‚¹ï¼Œå¹¶ä¸”è¿”å›é“¾è¡¨çš„å¤´ç»“ç‚¹ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥ï¼šhead &#x3D; [1,2,3,4,5], n &#x3D; 2<br>è¾“å‡ºï¼š[1,2,3,5]</p>
<p>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥ï¼šhead &#x3D; [1], n &#x3D; 1<br>è¾“å‡ºï¼š[]</p>
<p>ç¤ºä¾‹ 3ï¼š<br>è¾“å…¥ï¼šhead &#x3D; [1,2], n &#x3D; 1<br>è¾“å‡ºï¼š[1]</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Definition for singly-linked list.</span><br><span class="hljs-comment"> * function ListNode(val, next) &#123;</span><br><span class="hljs-comment"> *     this.val = (val===undefined ? 0 : val)</span><br><span class="hljs-comment"> *     this.next = (next===undefined ? null : next)</span><br><span class="hljs-comment"> * &#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">ListNode</span>&#125; <span class="hljs-variable">head</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">number</span>&#125; <span class="hljs-variable">n</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> &#123;<span class="hljs-type">ListNode</span>&#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">var</span> removeNthFromEnd = <span class="hljs-keyword">function</span>(<span class="hljs-params">head, n</span>) &#123;<br>    <span class="hljs-keyword">let</span> dummyHead = &#123;<span class="hljs-attr">next</span>: head&#125; <span class="hljs-comment">// æ³¨æ„åˆ é™¤å°±æœ‰å¯èƒ½ï¼Œlist=[1],å…¨åˆ æ‰,è¦æœ‰è™šæ‹Ÿå¤´ç»“ç‚¹</span><br>    <span class="hljs-keyword">let</span> fast = dummyHead<br>    <span class="hljs-keyword">while</span>(n--) &#123;<br>        fast = fast.<span class="hljs-property">next</span><br>    &#125;<br>    <span class="hljs-keyword">let</span> slow = dummyHead<br><br>    <span class="hljs-comment">// åªè¦ä¸‹ä¸€ä¸ªæœ‰å°±å¾€ä¸‹èµ°</span><br>    <span class="hljs-keyword">while</span>(fast?.<span class="hljs-property">next</span>) &#123;<br>        slow = slow.<span class="hljs-property">next</span><br>        fast = fast.<span class="hljs-property">next</span><br>    &#125;<br><br>    slow.<span class="hljs-property">next</span> = slow.<span class="hljs-property">next</span>?.<span class="hljs-property">next</span> ?? <span class="hljs-literal">null</span><br>    <span class="hljs-keyword">return</span> dummyHead.<span class="hljs-property">next</span><br>&#125;;<br><br></code></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode206</title>
    <url>/posts/2ccc8e79.html</url>
    <content><![CDATA[<h3 id="206-åè½¬é“¾è¡¨"><a href="#206-åè½¬é“¾è¡¨" class="headerlink" title="206. åè½¬é“¾è¡¨"></a><a href="https://leetcode.cn/problems/reverse-linked-list/description/">206. åè½¬é“¾è¡¨</a></h3><p>ç»™ä½ å•é“¾è¡¨çš„å¤´èŠ‚ç‚¹ head ï¼Œè¯·ä½ åè½¬é“¾è¡¨ï¼Œå¹¶è¿”å›åè½¬åçš„é“¾è¡¨ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥ï¼šhead &#x3D; [1,2,3,4,5]<br>è¾“å‡ºï¼š[5,4,3,2,1]</p>
<p>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥ï¼šhead &#x3D; [1,2]<br>è¾“å‡ºï¼š[2,1]</p>
<p>ç¤ºä¾‹ 3ï¼š<br>è¾“å…¥ï¼šhead &#x3D; []<br>è¾“å‡ºï¼š[]</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Definition for singly-linked list.</span><br><span class="hljs-comment"> * function ListNode(val, next) &#123;</span><br><span class="hljs-comment"> *     this.val = (val===undefined ? 0 : val)</span><br><span class="hljs-comment"> *     this.next = (next===undefined ? null : next)</span><br><span class="hljs-comment"> * &#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">ListNode</span>&#125; <span class="hljs-variable">head</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> &#123;<span class="hljs-type">ListNode</span>&#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">var</span> reverseList = <span class="hljs-keyword">function</span> (<span class="hljs-params">head</span>) &#123;<br>    <span class="hljs-keyword">if</span> (!head) &#123;<br>        <span class="hljs-keyword">return</span> head<br>    &#125;<br><br>    <span class="hljs-keyword">let</span> a = <span class="hljs-literal">null</span> <span class="hljs-comment">// å½“å‰èŠ‚ç‚¹å‰ä¸€ä¸ªèŠ‚ç‚¹</span><br>    <span class="hljs-keyword">let</span> b = head <span class="hljs-comment">// å½“å‰èŠ‚ç‚¹</span><br><br>    <span class="hljs-keyword">while</span> (b) &#123;<br>        <span class="hljs-keyword">let</span> c = b.<span class="hljs-property">next</span> <span class="hljs-comment">// ç¼“å­˜ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span><br><br>        b.<span class="hljs-property">next</span> = a<br>        a = b<br>        b = c<br>    &#125;<br><br>    <span class="hljs-comment">// bèµ°åˆ°nulläº†ï¼Œaæ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹</span><br>    <span class="hljs-keyword">return</span> a<br>&#125;;<br></code></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode213</title>
    <url>/posts/45bd4bb7.html</url>
    <content><![CDATA[<h3 id="213-æ‰“å®¶åŠ«èˆ-II"><a href="#213-æ‰“å®¶åŠ«èˆ-II" class="headerlink" title="213. æ‰“å®¶åŠ«èˆ II"></a><a href="https://leetcode.cn/problems/house-robber-ii/">213. æ‰“å®¶åŠ«èˆ II</a></h3><p>ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å°å·ï¼Œè®¡åˆ’å·çªƒæ²¿è¡—çš„æˆ¿å±‹ï¼Œæ¯é—´æˆ¿å†…éƒ½è—æœ‰ä¸€å®šçš„ç°é‡‘ã€‚è¿™ä¸ªåœ°æ–¹æ‰€æœ‰çš„æˆ¿å±‹éƒ½ å›´æˆä¸€åœˆ ï¼Œè¿™æ„å‘³ç€ç¬¬ä¸€ä¸ªæˆ¿å±‹å’Œæœ€åä¸€ä¸ªæˆ¿å±‹æ˜¯ç´§æŒ¨ç€çš„ã€‚åŒæ—¶ï¼Œç›¸é‚»çš„æˆ¿å±‹è£…æœ‰ç›¸äº’è¿é€šçš„é˜²ç›—ç³»ç»Ÿï¼Œå¦‚æœä¸¤é—´ç›¸é‚»çš„æˆ¿å±‹åœ¨åŒä¸€æ™šä¸Šè¢«å°å·é—¯å…¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŠ¥è­¦ ã€‚</p>
<p>ç»™å®šä¸€ä¸ªä»£è¡¨æ¯ä¸ªæˆ¿å±‹å­˜æ”¾é‡‘é¢çš„éè´Ÿæ•´æ•°æ•°ç»„ï¼Œè®¡ç®—ä½  åœ¨ä¸è§¦åŠ¨è­¦æŠ¥è£…ç½®çš„æƒ…å†µä¸‹ ï¼Œä»Šæ™šèƒ½å¤Ÿå·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<figure class="highlight tap"><table><tr><td class="code"><pre><code class="hljs tap">è¾“å…¥ï¼šnums = [2,3,2]<br>è¾“å‡ºï¼š3<br>è§£é‡Šï¼šä½ ä¸èƒ½å…ˆå·çªƒ<span class="hljs-number"> 1 </span>å·æˆ¿å±‹ï¼ˆé‡‘é¢ = 2ï¼‰ï¼Œç„¶åå·çªƒ<span class="hljs-number"> 3 </span>å·æˆ¿å±‹ï¼ˆé‡‘é¢ = 2ï¼‰, å› ä¸ºä»–ä»¬æ˜¯ç›¸é‚»çš„ã€‚<br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 2ï¼š</p>
<figure class="highlight tap"><table><tr><td class="code"><pre><code class="hljs tap">è¾“å…¥ï¼šnums = [1,2,3,1]<br>è¾“å‡ºï¼š4<br>è§£é‡Šï¼šä½ å¯ä»¥å…ˆå·çªƒ<span class="hljs-number"> 1 </span>å·æˆ¿å±‹ï¼ˆé‡‘é¢ = 1ï¼‰ï¼Œç„¶åå·çªƒ<span class="hljs-number"> 3 </span>å·æˆ¿å±‹ï¼ˆé‡‘é¢ = 3ï¼‰ã€‚<br>â€‹     å·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ =<span class="hljs-number"> 1 </span>+<span class="hljs-number"> 3 </span>=<span class="hljs-number"> 4 </span>ã€‚<br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 3ï¼š</p>
<figure class="highlight fix"><table><tr><td class="code"><pre><code class="hljs fix"><span class="hljs-attr">è¾“å…¥ï¼šnums </span>=<span class="hljs-string"> [1,2,3]</span><br><span class="hljs-string">è¾“å‡ºï¼š3</span><br></code></pre></td></tr></table></figure>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/house-robber-ii">https://leetcode.cn/problems/house-robber-ii</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><p><img src="/pic/lc213.png"></p>
<figure class="highlight excel"><table><tr><td class="code"><pre><code class="hljs excel">å¦‚æœç¬¬ä¸€å®¶å·äº†ï¼Œæœ€åä¸€å®¶å°±æ²¡å·ï¼Œ<span class="hljs-built_in">max</span>(<span class="hljs-built_in">T</span>[<span class="hljs-built_in">len</span>-<span class="hljs-number">2</span>], <span class="hljs-built_in">N</span>[<span class="hljs-built_in">len</span>-<span class="hljs-number">2</span>])å±€éƒ¨æœ€ä¼˜è§£<br>å¦‚æœç¬¬ä¸€å®¶æ²¡å·ï¼Œæœ€åä¸€å®¶éšä¾¿ï¼Œ<span class="hljs-built_in">max</span>(<span class="hljs-built_in">T</span>[<span class="hljs-built_in">len</span>-<span class="hljs-number">1</span>], <span class="hljs-built_in">N</span>[<span class="hljs-built_in">len</span>-<span class="hljs-number">1</span>]) å±€éƒ¨æœ€ä¼˜è§£<br></code></pre></td></tr></table></figure>



<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">rob</span>(<span class="hljs-params">nums: <span class="hljs-built_in">number</span>[]</span>): <span class="hljs-built_in">number</span> &#123;<br>  <span class="hljs-keyword">if</span> (nums.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span> (nums.<span class="hljs-property">length</span> &lt; <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...nums);<br><br>  <span class="hljs-keyword">let</span> t = [nums[<span class="hljs-number">0</span>], <span class="hljs-number">0</span>],<br>    nt = [<span class="hljs-number">0</span>, nums[<span class="hljs-number">0</span>]];<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">2</span>; i &lt; nums.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i++) &#123;<br>    t.<span class="hljs-title function_">push</span>(nt[i - <span class="hljs-number">1</span>] + nums[i]);<br>    nt.<span class="hljs-title function_">push</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(nt[i - <span class="hljs-number">1</span>], t[i - <span class="hljs-number">1</span>]));<br>  &#125;<br>  <span class="hljs-keyword">let</span> res = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(t.<span class="hljs-title function_">pop</span>(), nt.<span class="hljs-title function_">pop</span>());<br><br>  t = [<span class="hljs-number">0</span>, nums[<span class="hljs-number">1</span>]];<br>  nt = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>];<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">2</span>; i &lt; nums.<span class="hljs-property">length</span>; i++) &#123;<br>    t.<span class="hljs-title function_">push</span>(nt[i - <span class="hljs-number">1</span>] + nums[i]);<br>    nt.<span class="hljs-title function_">push</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(nt[i - <span class="hljs-number">1</span>], t[i - <span class="hljs-number">1</span>]));<br>  &#125;<br>  res = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(t.<span class="hljs-title function_">pop</span>(), nt.<span class="hljs-title function_">pop</span>(), res);<br>  <span class="hljs-keyword">return</span> res;<br>&#125;<br><br></code></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>å‘½ä»¤æ¨¡å¼</title>
    <url>/posts/a2a33980.html</url>
    <content><![CDATA[<h2 id="ã€è¯‘ã€‘å‘½ä»¤æ¨¡å¼command-pattern"><a href="#ã€è¯‘ã€‘å‘½ä»¤æ¨¡å¼command-pattern" class="headerlink" title="ã€è¯‘ã€‘å‘½ä»¤æ¨¡å¼command-pattern"></a>ã€è¯‘ã€‘å‘½ä»¤æ¨¡å¼<a href="https://www.patterns.dev/vanilla/command-pattern">command-pattern</a></h2><h3 id="å‘½ä»¤æ¨¡å¼"><a href="#å‘½ä»¤æ¨¡å¼" class="headerlink" title="å‘½ä»¤æ¨¡å¼"></a>å‘½ä»¤æ¨¡å¼</h3><p>ä½¿ç”¨å‘½ä»¤æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ‰§è¡Œç‰¹å®šä»»åŠ¡çš„å¯¹è±¡ä¸è°ƒç”¨æ–¹æ³•çš„å¯¹è±¡è§£è€¦ã€‚</p>
<p>æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªåœ¨çº¿é£Ÿå“é…é€å¹³å°ã€‚ç”¨æˆ·å¯ä»¥ä¸‹å•ã€è¿½è¸ªå’Œå–æ¶ˆè®¢å•ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderManager</span>() &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">orders</span> = []<br>  &#125;<br><br>  <span class="hljs-title function_">placeOrder</span>(<span class="hljs-params">order, id</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">orders</span>.<span class="hljs-title function_">push</span>(id)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">`You have successfully ordered <span class="hljs-subst">$&#123;order&#125;</span> (<span class="hljs-subst">$&#123;id&#125;</span>)`</span>;<br>  &#125;<br><br>  <span class="hljs-title function_">trackOrder</span>(<span class="hljs-params">id</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">`Your order <span class="hljs-subst">$&#123;id&#125;</span> will arrive in 20 minutes.`</span><br>  &#125;<br><br>  <span class="hljs-title function_">cancelOrder</span>(<span class="hljs-params">id</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">orders</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">orders</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span> order.<span class="hljs-property">id</span> !== id)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">`You have canceled your order <span class="hljs-subst">$&#123;id&#125;</span>`</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>åœ¨<code>OrderManager</code>ç±»ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—®<code>placeOrder</code>ã€<code>trackOrder</code>å’Œ<code>cancelOrder</code>æ–¹æ³•ã€‚ç›´æ¥ä½¿ç”¨è¿™äº›æ–¹æ³•åœ¨JavaScriptä¸­æ˜¯å®Œå…¨æœ‰æ•ˆçš„ï¼</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> manager = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderManager</span>();<br><br>manager.<span class="hljs-title function_">placeOrder</span>(<span class="hljs-string">&quot;Pad Thai&quot;</span>, <span class="hljs-string">&quot;1234&quot;</span>);<br>manager.<span class="hljs-title function_">trackOrder</span>(<span class="hljs-string">&quot;1234&quot;</span>);<br>manager.<span class="hljs-title function_">cancelOrder</span>(<span class="hljs-string">&quot;1234&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>ç„¶è€Œï¼Œç›´æ¥åœ¨ç®¡ç†å™¨å®ä¾‹ä¸Šè°ƒç”¨æ–¹æ³•ä¹Ÿæœ‰ä¸åˆ©ä¹‹å¤„ã€‚å¯èƒ½ä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µï¼šæˆ‘ä»¬å†³å®šç¨åé‡å‘½åæŸäº›æ–¹æ³•ï¼Œæˆ–è€…æ–¹æ³•çš„åŠŸèƒ½å‘ç”Ÿå˜åŒ–ã€‚</p>
<p>æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬ä¸å†ç§°ä¹‹ä¸º<code>placeOrder</code>ï¼Œè€Œæ˜¯å°†å…¶é‡å‘½åä¸º<code>addOrder</code>ï¼è¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»ç¡®ä¿åœ¨æˆ‘ä»¬çš„ä»£ç åº“ä¸­ä»»ä½•åœ°æ–¹éƒ½ä¸è°ƒç”¨<code>placeOrder</code>æ–¹æ³•ï¼Œè¿™åœ¨è¾ƒå¤§çš„åº”ç”¨ç¨‹åºä¸­å¯èƒ½ä¼šéå¸¸æ£˜æ‰‹ã€‚ç›¸åï¼Œæˆ‘ä»¬å¸Œæœ›å°†æ–¹æ³•ä¸ç®¡ç†å™¨å¯¹è±¡è§£è€¦ï¼Œå¹¶ä¸ºæ¯ä¸ªå‘½ä»¤åˆ›å»ºå•ç‹¬çš„å‘½ä»¤å‡½æ•°ï¼</p>
<p>è®©æˆ‘ä»¬é‡æ„<code>OrderManager</code>ç±»ï¼šå®ƒå°†ä¸å†å…·æœ‰<code>placeOrder</code>ã€<code>cancelOrder</code>å’Œ<code>trackOrder</code>æ–¹æ³•ï¼Œè€Œæ˜¯åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼š<code>execute</code>ã€‚è¿™ä¸ªæ–¹æ³•å°†æ‰§è¡Œä»»ä½•ç»™å®ƒçš„å‘½ä»¤ã€‚</p>
<p>æ¯ä¸ªå‘½ä»¤éƒ½åº”è¯¥å¯ä»¥è®¿é—®ç®¡ç†å™¨çš„è®¢å•ï¼Œæˆ‘ä»¬å°†è®¢å•ä½œä¸ºå…¶ç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ç»™å®ƒã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderManager</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">orders</span> = [];<br>  &#125;<br><br>  <span class="hljs-title function_">execute</span>(<span class="hljs-params">command, ...args</span>) &#123;<br>    <span class="hljs-keyword">return</span> command.<span class="hljs-title function_">execute</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">orders</span>, ...args);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æˆ‘ä»¬éœ€è¦ä¸ºè®¢å•ç®¡ç†å™¨åˆ›å»ºä¸‰ä¸ªå‘½ä»¤ï¼š</p>
<ul>
<li><code>PlaceOrderCommand</code></li>
<li><code>CancelOrderCommand</code></li>
<li><code>TrackOrderCommand</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Command</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">execute</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">execute</span> = execute;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">PlaceOrderCommand</span>(<span class="hljs-params">order, id</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Command</span>(<span class="hljs-function">(<span class="hljs-params">orders</span>) =&gt;</span> &#123;<br>    orders.<span class="hljs-title function_">push</span>(id);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">`You have successfully ordered <span class="hljs-subst">$&#123;order&#125;</span> (<span class="hljs-subst">$&#123;id&#125;</span>)`</span>;<br>  &#125;);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">CancelOrderCommand</span>(<span class="hljs-params">id</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Command</span>(<span class="hljs-function">(<span class="hljs-params">orders</span>) =&gt;</span> &#123;<br>    orders = orders.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">order</span>) =&gt;</span> order.<span class="hljs-property">id</span> !== id);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">`You have canceled your order <span class="hljs-subst">$&#123;id&#125;</span>`</span>;<br>  &#125;);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">TrackOrderCommand</span>(<span class="hljs-params">id</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Command</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-string">`Your order <span class="hljs-subst">$&#123;id&#125;</span> will arrive in 20 minutes.`</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å¤ªå¥½äº†ï¼ç°åœ¨çš„æ–¹æ³•ä¸å†ç›´æ¥ä¸<code>OrderManager</code>å®ä¾‹è€¦åˆï¼Œè€Œæ˜¯å˜æˆäº†ç‹¬ç«‹çš„ã€è§£è€¦çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>OrderManager</code>ä¸Šçš„<code>execute</code>æ–¹æ³•æ¥è°ƒç”¨å®ƒä»¬ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderManager</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">orders</span> = [];<br>  &#125;<br><br>  <span class="hljs-title function_">execute</span>(<span class="hljs-params">command, ...args</span>) &#123;<br>    <span class="hljs-keyword">return</span> command.<span class="hljs-title function_">execute</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">orders</span>, ...args);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Command</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">execute</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">execute</span> = execute;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">PlaceOrderCommand</span>(<span class="hljs-params">order, id</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Command</span>(<span class="hljs-function"><span class="hljs-params">orders</span> =&gt;</span> &#123;<br>    orders.<span class="hljs-title function_">push</span>(id);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`You have successfully ordered <span class="hljs-subst">$&#123;order&#125;</span> (<span class="hljs-subst">$&#123;id&#125;</span>)`</span>);<br>  &#125;);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">CancelOrderCommand</span>(<span class="hljs-params">id</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Command</span>(<span class="hljs-function"><span class="hljs-params">orders</span> =&gt;</span> &#123;<br>    orders = orders.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span> order.<span class="hljs-property">id</span> !== id);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`You have canceled your order <span class="hljs-subst">$&#123;id&#125;</span>`</span>);<br>  &#125;);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">TrackOrderCommand</span>(<span class="hljs-params">id</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Command</span>(<span class="hljs-function">() =&gt;</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Your order <span class="hljs-subst">$&#123;id&#125;</span> will arrive in 20 minutes.`</span>)<br>  );<br>&#125;<br><br><span class="hljs-keyword">const</span> manager = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderManager</span>();<br><br>manager.<span class="hljs-title function_">execute</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PlaceOrderCommand</span>(<span class="hljs-string">&quot;Pad Thai&quot;</span>, <span class="hljs-string">&quot;1234&quot;</span>));<br>manager.<span class="hljs-title function_">execute</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TrackOrderCommand</span>(<span class="hljs-string">&quot;1234&quot;</span>));<br>manager.<span class="hljs-title function_">execute</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CancelOrderCommand</span>(<span class="hljs-string">&quot;1234&quot;</span>));<br></code></pre></td></tr></table></figure>

<h4 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h4><p>å‘½ä»¤æ¨¡å¼å…è®¸æˆ‘ä»¬å°†æ‰§è¡Œæ“ä½œçš„æ–¹æ³•ä¸æ‰§è¡Œå¯¹è±¡è§£è€¦ã€‚å¦‚æœä½ æ­£åœ¨å¤„ç†å…·æœ‰ä¸€å®šç”Ÿå‘½å‘¨æœŸçš„å‘½ä»¤ï¼Œæˆ–è€…æ’é˜Ÿå¹¶ä¸”åœ¨ç‰¹å®šæ—¶é—´æ‰§è¡Œçš„å‘½ä»¤ï¼Œå®ƒå¯ä»¥è®©ä½ æ›´å¥½çš„æ§åˆ¶ã€‚</p>
<h4 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h4><p>å‘½ä»¤æ¨¡å¼çš„ä½¿ç”¨åœºæ™¯ç›¸å½“æœ‰é™ï¼Œè€Œä¸”é€šå¸¸ä¼šç»™åº”ç”¨ç¨‹åºå¢åŠ ä¸å¿…è¦çš„æ ·æ¿ä»£ç ã€‚</p>
]]></content>
      <categories>
        <category>Patterns</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode215</title>
    <url>/posts/acdeee82.html</url>
    <content><![CDATA[<h3 id="215-æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ "><a href="#215-æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ " class="headerlink" title="215. æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ "></a><a href="https://leetcode.cn/problems/kth-largest-element-in-an-array/">215. æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ </a></h3><p>ç»™å®šæ•´æ•°æ•°ç»„ nums å’Œæ•´æ•° kï¼Œè¯·è¿”å›æ•°ç»„ä¸­ç¬¬ k ä¸ªæœ€å¤§çš„å…ƒç´ ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œä½ éœ€è¦æ‰¾çš„æ˜¯æ•°ç»„æ’åºåçš„ç¬¬ k ä¸ªæœ€å¤§çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯ç¬¬ k ä¸ªä¸åŒçš„å…ƒç´ ã€‚</p>
<p>ä½ å¿…é¡»è®¾è®¡å¹¶å®ç°æ—¶é—´å¤æ‚åº¦ä¸º O(n) çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜ã€‚</p>
<p>ç¤ºä¾‹ 1:</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">è¾“å…¥: [3,2,1,5,6,4], k = 2</span><br><span class="hljs-section">è¾“å‡º: 5</span><br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 2:</p>
<figure class="highlight dns"><table><tr><td class="code"><pre><code class="hljs dns">è¾“å…¥: [<span class="hljs-number">3,2,3,1</span>,<span class="hljs-number">2,4,5,5</span>,<span class="hljs-number">6</span>], k = <span class="hljs-number">4</span><br>è¾“å‡º: <span class="hljs-number">4</span><br></code></pre></td></tr></table></figure>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/kth-largest-element-in-an-array">https://leetcode.cn/problems/kth-largest-element-in-an-array</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><figure class="highlight"><table><tr><td class="code"><pre><code class="hljs">å¿«é€Ÿæ’åºæ¯æ¬¡å¯ä»¥å°†ä¸€ä¸ªæ•°å½’ä½ï¼Œå¹¶ä¸”æ‹†æˆ2åŠï¼Œå·¦è¾¹éƒ½å°äºå³è¾¹<br>å¦‚æœä½ç½®å¤§äºk,åœ¨å·¦ä¾§ç»§ç»­å¿«æ’<br>å¦‚æœä½ç½®å°äºk,åœ¨å³ä¾§ç»§ç»­å¿«æ’<br>å¦‚æœä½ç½®ç­‰äºk,è¿”å›<br></code></pre></td></tr></table></figure>



<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">partition</span>(<span class="hljs-params">arr: <span class="hljs-built_in">number</span>[], l: <span class="hljs-built_in">number</span>, r: <span class="hljs-built_in">number</span></span>) &#123;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">swap</span>(<span class="hljs-params">i: <span class="hljs-built_in">number</span>, j: <span class="hljs-built_in">number</span></span>) &#123;<br>    <span class="hljs-keyword">let</span> temp = arr[i];<br>    arr[i] = arr[j];<br>    arr[j] = temp;<br>  &#125;<br><br>  <span class="hljs-keyword">let</span> pivot = arr[r];<br>  <span class="hljs-keyword">let</span> i = l; <span class="hljs-comment">// åŒæŒ‡é’ˆ(éš”æ¿) içš„å·¦ä¾§éƒ½å¤§äºpivot</span><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = l; j &lt;= r; j++) &#123;<br>    <span class="hljs-keyword">if</span> (arr[j] &gt; pivot) &#123;<br>      <span class="hljs-title function_">swap</span>(i, j);<br>      i++;<br>    &#125;<br>  &#125;<br>  <span class="hljs-title function_">swap</span>(r, i);<br>  <span class="hljs-keyword">return</span> i;<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">findKthLargest</span>(<span class="hljs-params">nums: <span class="hljs-built_in">number</span>[], k: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> &#123;<br>  <span class="hljs-keyword">let</span> kIdx = k - <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">recur</span>(<span class="hljs-params">l: <span class="hljs-built_in">number</span>, r: <span class="hljs-built_in">number</span></span>) &#123;<br>    <span class="hljs-keyword">let</span> pidx = <span class="hljs-title function_">partition</span>(nums, l, r);<br><br>    <span class="hljs-keyword">if</span> (pidx === kIdx) <span class="hljs-keyword">return</span> nums[pidx];<br>    <span class="hljs-keyword">if</span> (pidx &lt; kIdx) <span class="hljs-keyword">return</span> <span class="hljs-title function_">recur</span>(pidx + <span class="hljs-number">1</span>, r);<br>    <span class="hljs-keyword">if</span> (pidx &gt; kIdx) <span class="hljs-keyword">return</span> <span class="hljs-title function_">recur</span>(l, pidx - <span class="hljs-number">1</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">recur</span>(<span class="hljs-number">0</span>, nums.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode234</title>
    <url>/posts/e9efbc96.html</url>
    <content><![CDATA[<h3 id="234-å›æ–‡é“¾è¡¨"><a href="#234-å›æ–‡é“¾è¡¨" class="headerlink" title="234. å›æ–‡é“¾è¡¨"></a><a href="https://leetcode.cn/problems/palindrome-linked-list/description/">234. å›æ–‡é“¾è¡¨</a></h3><p>ç»™ä½ ä¸€ä¸ªå•é“¾è¡¨çš„å¤´èŠ‚ç‚¹ head ï¼Œè¯·ä½ åˆ¤æ–­è¯¥é“¾è¡¨æ˜¯å¦ä¸º<br>å›æ–‡é“¾è¡¨<br>ã€‚å¦‚æœæ˜¯ï¼Œè¿”å› true ï¼›å¦åˆ™ï¼Œè¿”å› false ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥ï¼šhead &#x3D; [1,2,2,1]<br>è¾“å‡ºï¼štrue</p>
<p>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥ï¼šhead &#x3D; [1,2]<br>è¾“å‡ºï¼šfalse</p>
<p>æç¤ºï¼š<br>é“¾è¡¨ä¸­èŠ‚ç‚¹æ•°ç›®åœ¨èŒƒå›´[1, 105] å†…0 &lt;&#x3D; Node.val &lt;&#x3D; 9<br>è¿›é˜¶ï¼šä½ èƒ½å¦ç”¨ O(n) æ—¶é—´å¤æ‚åº¦å’Œ O(1) ç©ºé—´å¤æ‚åº¦è§£å†³æ­¤é¢˜ï¼Ÿ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Definition for singly-linked list.</span><br><span class="hljs-comment"> * function ListNode(val, next) &#123;</span><br><span class="hljs-comment"> *     this.val = (val===undefined ? 0 : val)</span><br><span class="hljs-comment"> *     this.next = (next===undefined ? null : next)</span><br><span class="hljs-comment"> * &#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">ListNode</span>&#125; <span class="hljs-variable">head</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> &#123;<span class="hljs-type">boolean</span>&#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">var</span> isPalindrome = <span class="hljs-keyword">function</span> (<span class="hljs-params">head</span>) &#123;<br>    <span class="hljs-keyword">let</span> slow = head<br>    <span class="hljs-keyword">let</span> fast = head<br>    <span class="hljs-keyword">let</span> pre = <span class="hljs-literal">null</span><br>    <span class="hljs-keyword">while</span> (fast?.<span class="hljs-property">next</span>) &#123;<br>        fast = fast.<span class="hljs-property">next</span>.<span class="hljs-property">next</span><br><br>        <span class="hljs-comment">// å‰åŠéƒ¨è¾¹èµ°è¾¹é€†åº</span><br>        <span class="hljs-keyword">let</span> slowNext = slow.<span class="hljs-property">next</span><br><br>        slow.<span class="hljs-property">next</span> = pre<br>        pre = slow<br>        slow = slowNext<br>    &#125;<br><br>    <span class="hljs-comment">// å¦‚æœé•¿åº¦ä¸ºå¥‡æ•°ï¼Œfast å­˜åœ¨åœç•™åœ¨æœ€åèŠ‚ç‚¹ï¼Œå¦‚æœä¸ºå¶æ•°ï¼Œfast nullåœç•™åœ¨æœ€åèŠ‚ç‚¹åä¸€ä¸ª</span><br>    <span class="hljs-comment">// èµ°è¿‡æ¬¡æ•°æ˜¯ é•¿åº¦/2 ä¸‹å–æ•´</span><br>    <span class="hljs-comment">// é•¿åº¦å¶æ•°ï¼šslowåœç•™åœ¨ä¸­é—´ï¼Œslow.nextæ˜¯å³è¾¹è¿˜æ²¡ç¿»è½¬</span><br>    <span class="hljs-comment">// é•¿åº¦å¥‡æ•°ï¼šslowåœç•™åœ¨å³è¾¹å¼€å¤´</span><br>    <span class="hljs-keyword">let</span> lhead = pre<br>    <span class="hljs-keyword">let</span> rhead = fast ? slow.<span class="hljs-property">next</span> : slow<br><br>    <span class="hljs-keyword">while</span> (lhead || rhead) &#123;<br>        <span class="hljs-keyword">if</span> (lhead?.<span class="hljs-property">val</span> !== rhead?.<span class="hljs-property">val</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>        &#125;<br>        <span class="hljs-keyword">if</span> (lhead) lhead = lhead.<span class="hljs-property">next</span><br>        <span class="hljs-keyword">if</span> (rhead) rhead = rhead.<span class="hljs-property">next</span><br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>&#125;;<br><br></code></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode239</title>
    <url>/posts/975ec02b.html</url>
    <content><![CDATA[<h3 id="239-æ»‘åŠ¨çª—å£æœ€å¤§å€¼"><a href="#239-æ»‘åŠ¨çª—å£æœ€å¤§å€¼" class="headerlink" title="239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼"></a><a href="https://leetcode.cn/problems/sliding-window-maximum/">239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼</a></h3><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ numsï¼Œæœ‰ä¸€ä¸ªå¤§å°ä¸º k çš„æ»‘åŠ¨çª—å£ä»æ•°ç»„çš„æœ€å·¦ä¾§ç§»åŠ¨åˆ°æ•°ç»„çš„æœ€å³ä¾§ã€‚ä½ åªå¯ä»¥çœ‹åˆ°åœ¨æ»‘åŠ¨çª—å£å†…çš„ k ä¸ªæ•°å­—ã€‚æ»‘åŠ¨çª—å£æ¯æ¬¡åªå‘å³ç§»åŠ¨ä¸€ä½ã€‚</p>
<p>è¿”å› æ»‘åŠ¨çª—å£ä¸­çš„æœ€å¤§å€¼ ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><code class="hljs subunit">è¾“å…¥ï¼šnums = [1,3,<span class="hljs-string">-1</span>,<span class="hljs-string">-3</span>,5,3,6,7], k = 3<br>è¾“å‡ºï¼š[3,3,5,5,6,7]<br>è§£é‡Šï¼š<br>æ»‘åŠ¨çª—å£çš„ä½ç½®                æœ€å¤§å€¼<br>---------------               -----<br>[1  3  <span class="hljs-string">-1</span>] <span class="hljs-string">-3</span>  5  3  6  7       3<br> 1 [3  <span class="hljs-string">-1</span>  <span class="hljs-string">-3</span>] 5  3  6  7       3<br> 1  3 [<span class="hljs-string">-1</span>  <span class="hljs-string">-3</span>  5] 3  6  7       5<br> 1  3  <span class="hljs-string">-1</span> [<span class="hljs-string">-3</span>  5  3] 6  7       5<br> 1  3  <span class="hljs-string">-1</span>  <span class="hljs-string">-3</span> [5  3  6] 7       6<br> 1  3  <span class="hljs-string">-1</span>  <span class="hljs-string">-3</span>  5 [3  6  7]      7<br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 2ï¼š</p>
<figure class="highlight inform7"><table><tr><td class="code"><pre><code class="hljs inform7">è¾“å…¥ï¼šnums = <span class="hljs-comment">[1]</span>, k = 1<br>è¾“å‡ºï¼š<span class="hljs-comment">[1]</span><br></code></pre></td></tr></table></figure>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/sliding-window-maximum">https://leetcode.cn/problems/sliding-window-maximum</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><figure class="highlight"><table><tr><td class="code"><pre><code class="hljs">å•è°ƒæ ˆï¼Œæ ˆä¸­å­˜å‚¨å…ƒç´ ä¸‹æ ‡ï¼Œå¦‚æœæ ˆåº•å…ƒç´ ä¸åœ¨çª—å£å†…åˆ æ‰<br>å•è°ƒæ ˆç‰¹æ€§ï¼Œæ ˆåº•æ˜¯æœ€å¤§å€¼ï¼Œæ ˆé¡¶æ˜¯å·¦ä¾§ç¬¬ä¸€ä¸ªæ›´å¤§å€¼<br></code></pre></td></tr></table></figure>



<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">maxSlidingWindow</span>(<span class="hljs-params">nums: <span class="hljs-built_in">number</span>[], k: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span>[] &#123;<br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">stack</span>: <span class="hljs-built_in">number</span>[] = []; <span class="hljs-comment">// ä¸‹æ ‡å•è°ƒæ ˆ</span><br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">res</span>: <span class="hljs-built_in">number</span>[] = [];<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> r = <span class="hljs-number">0</span>; r &lt; nums.<span class="hljs-property">length</span>; r++) &#123;<br>    <span class="hljs-keyword">let</span> l = r - k + <span class="hljs-number">1</span>; <span class="hljs-comment">// [l, r] é—­åŒºé—´çª—å£é•¿åº¦kï¼Œr-l+1=k</span><br>    <span class="hljs-keyword">if</span> (stack[<span class="hljs-number">0</span>] &lt; l) stack.<span class="hljs-title function_">shift</span>();<br>    <span class="hljs-keyword">while</span> (stack.<span class="hljs-property">length</span> &amp;&amp; nums[stack[stack.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>]] &lt;= nums[r]) &#123;<br>      stack.<span class="hljs-title function_">pop</span>();<br>    &#125;<br>    stack.<span class="hljs-title function_">push</span>(r);<br>    <span class="hljs-keyword">if</span> (l &gt;= <span class="hljs-number">0</span>) &#123;<br>      res.<span class="hljs-title function_">push</span>(nums[stack[<span class="hljs-number">0</span>]]);<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> res;<br>&#125;<br><br></code></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode28</title>
    <url>/posts/14a10a9c.html</url>
    <content><![CDATA[<h3 id="28-æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡"><a href="#28-æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡" class="headerlink" title="28. æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡"></a><a href="https://leetcode.cn/problems/find-the-index-of-the-first-occurrence-in-a-string/">28. æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡</a></h3><p>ç»™ä½ ä¸¤ä¸ªå­—ç¬¦ä¸² haystack å’Œ needle ï¼Œè¯·ä½ åœ¨ haystack å­—ç¬¦ä¸²ä¸­æ‰¾å‡º needle å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡ï¼ˆä¸‹æ ‡ä» 0 å¼€å§‹ï¼‰ã€‚å¦‚æœ needle ä¸æ˜¯ haystack çš„ä¸€éƒ¨åˆ†ï¼Œåˆ™è¿”å›  -1 ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<figure class="highlight tap"><table><tr><td class="code"><pre><code class="hljs tap">è¾“å…¥ï¼šhaystack = &quot;sadbutsad&quot;, needle = &quot;sad&quot;<br>è¾“å‡ºï¼š0<br>è§£é‡Šï¼š&quot;sad&quot; åœ¨ä¸‹æ ‡<span class="hljs-number"> 0 </span>å’Œ<span class="hljs-number"> 6 </span>å¤„åŒ¹é…ã€‚<br>ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡æ˜¯<span class="hljs-number"> 0 </span>ï¼Œæ‰€ä»¥è¿”å›<span class="hljs-number"> 0 </span>ã€‚<br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 2ï¼š</p>
<figure class="highlight nix"><table><tr><td class="code"><pre><code class="hljs nix">è¾“å…¥ï¼š<span class="hljs-attr">haystack</span> = <span class="hljs-string">&quot;leetcode&quot;</span>, <span class="hljs-attr">needle</span> = <span class="hljs-string">&quot;leeto&quot;</span><br>è¾“å‡ºï¼š-<span class="hljs-number">1</span><br>è§£é‡Šï¼š<span class="hljs-string">&quot;leeto&quot;</span> æ²¡æœ‰åœ¨ <span class="hljs-string">&quot;leetcode&quot;</span> ä¸­å‡ºç°ï¼Œæ‰€ä»¥è¿”å› -<span class="hljs-number">1</span> ã€‚<br></code></pre></td></tr></table></figure>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/find-the-index-of-the-first-occurrence-in-a-string">https://leetcode.cn/problems/find-the-index-of-the-first-occurrence-in-a-string</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><img src="/pic/no-match.png">
<img src="/pic/fast-skip.png">

<figure class="highlight asciidoc"><table><tr><td class="code"><pre><code class="hljs asciidoc">f åœ¨unshift -1ä¹‹å‰çš„å«ä¹‰ï¼Œf[i]è¡¨ç¤ºåŒ…æ‹¬iå…ƒç´ åœ¨å†…çš„s[0, i]æœ€é•¿å‰åç¼€é•¿åº¦<br>f åœ¨unshift -1ä¹‹åçš„å«ä¹‰ï¼Œf[i]è¡¨ç¤ºä¸åŒ…å«iå…ƒç´ åœ¨å†…çš„s[0, i-1]æœ€é•¿å‰åç¼€é•¿åº¦, <br><span class="hljs-code">     i=0,0ä¹‹å‰æ²¡æœ‰å­—ç¬¦ï¼Œæ²¡æœ‰å‰åç¼€ï¼Œç”¨-1ç‰¹æ®Šæ ‡è¯†</span><br><span class="hljs-code">     i=1,1ä¹‹å‰æœ‰1ä¸ªå­—ç¬¦ï¼Œæœ€é•¿å‰åç¼€æ˜¯0  abcè¿™ç§ä¸é‡å¤çš„åºåˆ—åŒºé—´ï¼Œæœ€é•¿å‰åç¼€ä¹Ÿæ˜¯0</span><br>å¦‚æœç¬¬iä½ä¸åŒ¹é…æ—¶ï¼Œ<br><span class="hljs-code">	å¦‚æœf[i]&gt;=0ï¼Œå°†æ¨¡å¼ä¸²å‘å‰æ»‘åŠ¨è·³è·ƒ =&gt; æ¨¡å¼ä¸²ç›´æ¥å›é€€åˆ°f[i]ä½ç½®ï¼Œç›®æ ‡ä¸²æŒ‡é’ˆä¸åŠ¨ï¼Œç»§ç»­åŒ¹é…</span><br><span class="hljs-code">	å¦‚æœf[i]=-1, å°†æ¨¡å¼ä¸²å‘å‰æ»‘åŠ¨1 =&gt; ç›®æ ‡ä¸²æŒ‡é’ˆå³èµ°1ï¼Œæ¨¡å¼ä¸²æŒ‡é’ˆä¸åŠ¨</span><br><span class="hljs-code">      i    </span><br>a b c d e f<br>a b c e<br><span class="hljs-section">      j</span><br><span class="hljs-section">-------</span><br><span class="hljs-code">      i</span><br>a b c d e f<br><span class="hljs-code">      a b c e</span><br><span class="hljs-code">      j</span><br><span class="hljs-section">æ¨¡å¼ä¸²æŒ‡é’ˆå›é€€åˆ°0</span><br><span class="hljs-section">-------</span><br><span class="hljs-code">        i</span><br>a b c d e f<br><span class="hljs-code">        a b c e</span><br><span class="hljs-code">        j</span><br><span class="hljs-section">ç›®æ ‡ä¸²æŒ‡é’ˆå‘å³èµ°1</span><br><span class="hljs-section">-------</span><br></code></pre></td></tr></table></figure>
<img src="/pic/next-array.png">
<figure class="highlight vim"><table><tr><td class="code"><pre><code class="hljs vim">æ±‚æœ€é•¿å‰åç¼€<br><span class="hljs-keyword">ab</span>...<span class="hljs-keyword">ab</span> --- <span class="hljs-keyword">ab</span>...<span class="hljs-keyword">ab</span> <br><span class="hljs-keyword">abc</span>..abe --- <span class="hljs-keyword">ab</span>...<span class="hljs-keyword">abc</span> <br><br>å¦‚æœå‰åç¼€æœ€åå­—ç¬¦ä¸åŒ¹é…ï¼Œå†æ¬¡å¯»æ‰¾å­ä¸²çš„å‰åç¼€ï¼Œ<br>æ ¹æ®å‰åç›¸åŒçš„è§„å¾‹ï¼Œè™½ç„¶æ‰¾äº†å¥½å‡ æ¬¡å‰åç¼€ï¼Œæœ€å‰é¢çš„ä¼šç­‰äºæœ€åé¢<br></code></pre></td></tr></table></figure>

<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">prefix</span>(<span class="hljs-params">s: <span class="hljs-built_in">string</span></span>) &#123;<br>  <span class="hljs-keyword">let</span> n = s.<span class="hljs-property">length</span>;<br>  <span class="hljs-keyword">if</span> (n === <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> [-<span class="hljs-number">1</span>];<br><br>  <span class="hljs-keyword">let</span> f = [<span class="hljs-number">0</span>];<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; n; i++) &#123;<br>    <span class="hljs-keyword">let</span> t = f[i - <span class="hljs-number">1</span>];<br>    <span class="hljs-comment">// ä¸æ–­ç¼©çŸ­æœ€é•¿å‰åç¼€ï¼Œè®©æœ«å°¾ç›¸ç­‰ï¼Œæœ«å°¾æ˜¯s[i]çš„æœ€é•¿å‰åç¼€</span><br>    <span class="hljs-keyword">while</span> (t &gt; <span class="hljs-number">0</span> &amp;&amp; s[i] !== s[t]) &#123;<br>      t = f[t - <span class="hljs-number">1</span>];<br>    &#125;<br>    <span class="hljs-keyword">if</span> (s[i] === s[t]) &#123;<br>      t++;<br>    &#125;<br>    f[i] = t;<br>  &#125;<br>  f.<span class="hljs-title function_">unshift</span>(-<span class="hljs-number">1</span>);<br>  <span class="hljs-keyword">return</span> f;<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">strStr</span>(<span class="hljs-params">s: <span class="hljs-built_in">string</span>, m: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">number</span> &#123;<br>  <span class="hljs-keyword">if</span> (!s || !m) <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br><br>  <span class="hljs-keyword">let</span> next = <span class="hljs-title function_">prefix</span>(m);<br>  <span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>,<br>    j = <span class="hljs-number">0</span>;<br><br>  <span class="hljs-keyword">while</span> (i &lt; s.<span class="hljs-property">length</span> &amp;&amp; j &lt; m.<span class="hljs-property">length</span>) &#123;<br>    <span class="hljs-keyword">if</span> (s[i] === m[j]) &#123;<br>      i++;<br>      j++;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (next[j] === -<span class="hljs-number">1</span>) &#123;<br>      i++;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      j = next[j];<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> j === m.<span class="hljs-property">length</span> ? i - j : -<span class="hljs-number">1</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode3</title>
    <url>/posts/d83b9394.html</url>
    <content><![CDATA[<h3 id="3-æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²"><a href="#3-æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²" class="headerlink" title="3. æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²"></a><a href="https://leetcode.cn/problems/longest-substring-without-repeating-characters/">3. æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²</a></h3><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² s ï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­ä¸å«æœ‰é‡å¤å­—ç¬¦çš„ æœ€é•¿å­ä¸² çš„é•¿åº¦ã€‚</p>
<p>ç¤ºä¾‹ 1:</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">è¾“å…¥: s = &quot;abcabcbb&quot;</span><br><span class="hljs-section">è¾“å‡º: 3 </span><br><span class="hljs-section">è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ &quot;abc&quot;ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚</span><br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 2:</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">è¾“å…¥: s = &quot;bbbbb&quot;</span><br><span class="hljs-section">è¾“å‡º: 1</span><br><span class="hljs-section">è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ &quot;b&quot;ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 1ã€‚</span><br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 3:</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">è¾“å…¥: s = &quot;pwwkew&quot;</span><br><span class="hljs-section">è¾“å‡º: 3</span><br><span class="hljs-section">è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ &quot;wke&quot;ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚</span><br>     è¯·æ³¨æ„ï¼Œä½ çš„ç­”æ¡ˆå¿…é¡»æ˜¯ å­ä¸² çš„é•¿åº¦ï¼Œ<span class="hljs-string">&quot;pwke&quot;</span> æ˜¯ä¸€ä¸ªå­åºåˆ—ï¼Œä¸æ˜¯å­ä¸²ã€‚<br></code></pre></td></tr></table></figure>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/longest-substring-without-repeating-characters">https://leetcode.cn/problems/longest-substring-without-repeating-characters</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><figure class="highlight mipsasm"><table><tr><td class="code"><pre><code class="hljs mipsasm">ç»´æŠ¤ä¸€ä¸ªæ— é‡å¤çš„çª—å£<br>å¦‚æœé‡å¤å°±å°†å·¦è¾¹çš„å…¨è£æ‰ ä¹Ÿå»æ‰ä¸è‡ªå·±ç›¸ç­‰çš„<br><br>æ³¨æ„<br><span class="hljs-string">&quot;abba&quot;</span><br><span class="hljs-keyword">bba </span> æŠŠåˆ«äººçš„é‡å¤åŒ…è¿›å»äº†ï¼Œ l å¿…é¡»åªèƒ½å¾€å‰<br><br></code></pre></td></tr></table></figure>



<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">lengthOfLongestSubstring</span>(<span class="hljs-params">s: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">number</span> &#123;<br>  <span class="hljs-keyword">let</span> hash = &#123;&#125;; <span class="hljs-comment">// å­—ç¬¦: æœ€è¿‘å‡ºç°çš„ä½ç½®</span><br>  <span class="hljs-keyword">let</span> res = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> l = <span class="hljs-number">0</span>, r = <span class="hljs-number">0</span>; r &lt; s.<span class="hljs-property">length</span>; r++) &#123;<br>    <span class="hljs-keyword">if</span> (s[r] <span class="hljs-keyword">in</span> hash) &#123;<br>      <span class="hljs-comment">// æ³¨æ„max, lå¾€å‰</span><br>      l = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(l, hash[s[r]] + <span class="hljs-number">1</span>);<br>    &#125;<br><br>    hash[s[r]] = r;<br>    res = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(res, r - l + <span class="hljs-number">1</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> res;<br>&#125;<br><br></code></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode322</title>
    <url>/posts/b0f96b84.html</url>
    <content><![CDATA[<h3 id="322-é›¶é’±å…‘æ¢"><a href="#322-é›¶é’±å…‘æ¢" class="headerlink" title="322. é›¶é’±å…‘æ¢"></a><a href="https://leetcode.cn/problems/coin-change/">322. é›¶é’±å…‘æ¢</a></h3><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ coins ï¼Œè¡¨ç¤ºä¸åŒé¢é¢çš„ç¡¬å¸ï¼›ä»¥åŠä¸€ä¸ªæ•´æ•° amount ï¼Œè¡¨ç¤ºæ€»é‡‘é¢ã€‚</p>
<p>è®¡ç®—å¹¶è¿”å›å¯ä»¥å‡‘æˆæ€»é‡‘é¢æ‰€éœ€çš„ æœ€å°‘çš„ç¡¬å¸ä¸ªæ•° ã€‚å¦‚æœæ²¡æœ‰ä»»ä½•ä¸€ç§ç¡¬å¸ç»„åˆèƒ½ç»„æˆæ€»é‡‘é¢ï¼Œè¿”å› -1 ã€‚</p>
<p>ä½ å¯ä»¥è®¤ä¸ºæ¯ç§ç¡¬å¸çš„æ•°é‡æ˜¯æ— é™çš„ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<figure class="highlight tap"><table><tr><td class="code"><pre><code class="hljs tap">è¾“å…¥ï¼šcoins = [1, 2, 5], amount = 11<br>è¾“å‡ºï¼š3 <br>è§£é‡Šï¼š11 =<span class="hljs-number"> 5 </span>+<span class="hljs-number"> 5 </span>+ 1<br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 2ï¼š</p>
<figure class="highlight fix"><table><tr><td class="code"><pre><code class="hljs fix"><span class="hljs-attr">è¾“å…¥ï¼šcoins </span>=<span class="hljs-string"> [2], amount = 3</span><br><span class="hljs-string">è¾“å‡ºï¼š-1</span><br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 3ï¼š</p>
<figure class="highlight fix"><table><tr><td class="code"><pre><code class="hljs fix"><span class="hljs-attr">è¾“å…¥ï¼šcoins </span>=<span class="hljs-string"> [1], amount = 0</span><br><span class="hljs-string">è¾“å‡ºï¼š0</span><br></code></pre></td></tr></table></figure>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/coin-change">https://leetcode.cn/problems/coin-change</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><figure class="highlight inform7"><table><tr><td class="code"><pre><code class="hljs inform7">dp<span class="hljs-comment">[i]</span> è¡¨ç¤ºéšä¾¿æ‹¿ç¡¬å¸ç»„æˆiï¼Œæœ€å°‘å¤šå°‘ä¸ª<br>å‡è®¾æœ€åæ‹¿åˆ°ä¸€ä¸ªcoin, dp<span class="hljs-comment">[i-coin]</span>å·²çŸ¥ï¼Œdp<span class="hljs-comment">[i]</span>çš„ä¸€ä¸ªå±€éƒ¨æœ€ä¼˜è§£ dp<span class="hljs-comment">[i-coin]</span>+1<br>dp<span class="hljs-comment">[i]</span> = min (dp<span class="hljs-comment">[i-coins<span class="hljs-comment">[j]</span>]</span>+1)<br></code></pre></td></tr></table></figure>



<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">coinChange</span>(<span class="hljs-params">coins: <span class="hljs-built_in">number</span>[], amount: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> &#123;<br>  <span class="hljs-keyword">let</span> dp = <span class="hljs-title class_">Array</span>(amount + <span class="hljs-number">1</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-title class_">Number</span>.<span class="hljs-property">MAX_VALUE</span>);<br>  dp[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;<br><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= amount; i++) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; coins.<span class="hljs-property">length</span>; j++) &#123;<br>      <span class="hljs-keyword">if</span> (i &gt;= coins[j]) dp[i] = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(dp[i], dp[i - coins[j]] + <span class="hljs-number">1</span>);<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-keyword">if</span> (dp[amount] === <span class="hljs-title class_">Number</span>.<span class="hljs-property">MAX_VALUE</span>) <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">return</span> dp[amount];<br>&#125;<br><br></code></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode34</title>
    <url>/posts/40c77f6.html</url>
    <content><![CDATA[<h3 id="34-åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®"><a href="#34-åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®" class="headerlink" title="34. åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®"></a><a href="https://leetcode.cn/problems/find-first-and-last-position-of-element-in-sorted-array/">34. åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®</a></h3><p>ç»™ä½ ä¸€ä¸ªæŒ‰ç…§éé€’å‡é¡ºåºæ’åˆ—çš„æ•´æ•°æ•°ç»„ numsï¼Œå’Œä¸€ä¸ªç›®æ ‡å€¼ targetã€‚è¯·ä½ æ‰¾å‡ºç»™å®šç›®æ ‡å€¼åœ¨æ•°ç»„ä¸­çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚</p>
<p>å¦‚æœæ•°ç»„ä¸­ä¸å­˜åœ¨ç›®æ ‡å€¼ targetï¼Œè¿”å› [-1, -1]ã€‚</p>
<p>ä½ å¿…é¡»è®¾è®¡å¹¶å®ç°æ—¶é—´å¤æ‚åº¦ä¸º O(log n) çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<figure class="highlight inform7"><table><tr><td class="code"><pre><code class="hljs inform7">è¾“å…¥ï¼šnums = <span class="hljs-comment">[5,7,7,8,8,10]</span>, target = 8<br>è¾“å‡ºï¼š<span class="hljs-comment">[3,4]</span><br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 2ï¼š</p>
<figure class="highlight inform7"><table><tr><td class="code"><pre><code class="hljs inform7">è¾“å…¥ï¼šnums = <span class="hljs-comment">[5,7,7,8,8,10]</span>, target = 6<br>è¾“å‡ºï¼š<span class="hljs-comment">[-1,-1]</span><br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 3ï¼š</p>
<figure class="highlight inform7"><table><tr><td class="code"><pre><code class="hljs inform7">è¾“å…¥ï¼šnums = <span class="hljs-comment">[]</span>, target = 0<br>è¾“å‡ºï¼š<span class="hljs-comment">[-1,-1]</span><br></code></pre></td></tr></table></figure>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/find-first-and-last-position-of-element-in-sorted-array">https://leetcode.cn/problems/find-first-and-last-position-of-element-in-sorted-array</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><figure class="highlight arcade"><table><tr><td class="code"><pre><code class="hljs arcade">nums[<span class="hljs-built_in">mid</span>]&gt;=target æˆ–è€… nums[<span class="hljs-built_in">mid</span>]&gt;=nums[r]æ˜¯è§£ï¼Œæ±‚å·¦è¾¹ç•Œ<br>nums[<span class="hljs-built_in">mid</span>]&lt;=target æˆ–è€… nums[<span class="hljs-built_in">mid</span>]&lt;=nums[r]æ˜¯è§£ï¼Œæ±‚å³è¾¹ç•Œ<br>æ˜¯è§£çš„æ—¶å€™ï¼Œæ”¶ç¼©è¾¹ç•Œä¸èƒ½+<span class="hljs-number">1</span>ï¼Œ<span class="hljs-number">-1</span>ä¸¢è§£<br><br>lbound  lè¿›å…¥ç›®æ ‡åŒºåŸŸåä¸åŠ¨äº†ï¼Œrè¿˜èƒ½åŠ¨ï¼Œrä¼šç»§ç»­æ”¶ç¼©ï¼Œç›´åˆ°l===r<br>lbound =&gt; l=<span class="hljs-built_in">mid</span>+<span class="hljs-number">1</span><br>rbound  rè¿›å…¥ç›®æ ‡åŒºåŸŸåä¸åŠ¨äº†ï¼Œlè¿˜èƒ½åŠ¨ï¼Œlä¼šç»§ç»­æ”¶ç¼©ï¼Œç›´åˆ°l===r<br>rbound =&gt; r=<span class="hljs-built_in">mid</span><span class="hljs-number">-1</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">lbound</span>(<span class="hljs-params">l, r</span>) &#123;<br>	<span class="hljs-keyword">while</span>(l &lt; r)&#123;<br>		let <span class="hljs-built_in">mid</span> = (l + r) &gt;&gt;&gt;<span class="hljs-number">1</span><br>		<span class="hljs-keyword">if</span>() r = <span class="hljs-built_in">mid</span><br>		<span class="hljs-keyword">else</span> l = <span class="hljs-built_in">mid</span> + <span class="hljs-number">1</span><br>	&#125;<br>	<span class="hljs-keyword">return</span> l<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">rbound</span>(<span class="hljs-params">l, r</span>) &#123;<br>	<span class="hljs-keyword">while</span>(l &lt; r)&#123;<br>		let <span class="hljs-built_in">mid</span> = (l + r + <span class="hljs-number">1</span>) &gt;&gt;&gt; <span class="hljs-number">1</span> <span class="hljs-comment">// å› ä¸ºå‡1</span><br>		<span class="hljs-keyword">if</span>() l = <span class="hljs-built_in">mid</span><br>		<span class="hljs-keyword">else</span> r = <span class="hljs-built_in">mid</span><span class="hljs-number">-1</span>  <br>	&#125;<br>	<span class="hljs-keyword">return</span> l<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">searchRange</span>(<span class="hljs-params">nums: <span class="hljs-built_in">number</span>[], target: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span>[] &#123;<br>  <span class="hljs-keyword">let</span> n = nums.<span class="hljs-property">length</span>;<br>  <span class="hljs-keyword">if</span> (n === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> [-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>];<br><br>  <span class="hljs-keyword">let</span> l = <span class="hljs-number">0</span>,<br>    r = n - <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">while</span> (l &lt; r) &#123;<br>    <span class="hljs-keyword">let</span> mid = (l + r) &gt;&gt;&gt; <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> (nums[mid] &gt;= target) r = mid;<br>    <span class="hljs-keyword">else</span> l = mid + <span class="hljs-number">1</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">let</span> lbound = l;<br>  <span class="hljs-keyword">if</span> (nums[lbound] !== target) <span class="hljs-keyword">return</span> [-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>];<br><br>  (l = <span class="hljs-number">0</span>), (r = n - <span class="hljs-number">1</span>);<br>  <span class="hljs-keyword">while</span> (l &lt; r) &#123;<br>    <span class="hljs-keyword">let</span> mid = (l + r + <span class="hljs-number">1</span>) &gt;&gt;&gt; <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> (nums[mid] &lt;= target) l = mid;<br>    <span class="hljs-keyword">else</span> r = mid - <span class="hljs-number">1</span>;<br>  &#125;<br>  <span class="hljs-keyword">let</span> rbound = l;<br><br>  <span class="hljs-keyword">return</span> [lbound, rbound];<br>&#125;<br><br></code></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode300</title>
    <url>/posts/c46d417b.html</url>
    <content><![CDATA[<h3 id="300-æœ€é•¿é€’å¢å­åºåˆ—"><a href="#300-æœ€é•¿é€’å¢å­åºåˆ—" class="headerlink" title="300. æœ€é•¿é€’å¢å­åºåˆ—"></a><a href="https://leetcode.cn/problems/longest-increasing-subsequence/">300. æœ€é•¿é€’å¢å­åºåˆ—</a></h3><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾åˆ°å…¶ä¸­æœ€é•¿ä¸¥æ ¼é€’å¢å­åºåˆ—çš„é•¿åº¦ã€‚</p>
<p>å­åºåˆ— æ˜¯ç”±æ•°ç»„æ´¾ç”Ÿè€Œæ¥çš„åºåˆ—ï¼Œåˆ é™¤ï¼ˆæˆ–ä¸åˆ é™¤ï¼‰æ•°ç»„ä¸­çš„å…ƒç´ è€Œä¸æ”¹å˜å…¶ä½™å…ƒç´ çš„é¡ºåºã€‚ä¾‹å¦‚ï¼Œ[3,6,2,7] æ˜¯æ•°ç»„ [0,3,1,6,2,2,7] çš„å­åºåˆ—ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<figure class="highlight dns"><table><tr><td class="code"><pre><code class="hljs dns">è¾“å…¥ï¼šnums = [<span class="hljs-number">10,9,2,5</span>,<span class="hljs-number">3,7,101,18</span>]<br>è¾“å‡ºï¼š<span class="hljs-number">4</span><br>è§£é‡Šï¼šæœ€é•¿é€’å¢å­åºåˆ—æ˜¯ [<span class="hljs-number">2,3,7,101</span>]ï¼Œå› æ­¤é•¿åº¦ä¸º <span class="hljs-number">4</span> ã€‚<br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 2ï¼š</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><code class="hljs accesslog">è¾“å…¥ï¼šnums = <span class="hljs-string">[0,1,0,3,2,3]</span><br>è¾“å‡ºï¼š<span class="hljs-number">4</span><br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 3ï¼š</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><code class="hljs accesslog">è¾“å…¥ï¼šnums = <span class="hljs-string">[7,7,7,7,7,7,7]</span><br>è¾“å‡ºï¼š<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/longest-increasing-subsequence">https://leetcode.cn/problems/longest-increasing-subsequence</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><figure class="highlight stylus"><table><tr><td class="code"><pre><code class="hljs stylus">dp<span class="hljs-selector-attr">[i]</span> è¡¨ç¤ºä»¥iä½ç½®ä¸ºç»“å°¾ï¼Œæœ€é•¿å­åºåˆ—é•¿åº¦<br><span class="hljs-number">0</span>åˆ°i-<span class="hljs-number">1</span>ä¸­æ¯”nums<span class="hljs-selector-attr">[i]</span>å°çš„ï¼Œå’Œiç»„æˆå­åºåˆ—ï¼Œé•¿åº¦dp<span class="hljs-selector-attr">[j]</span>+<span class="hljs-number">1</span>ï¼Œæ»¡è¶³é€’å¢æ¡ä»¶<br>dp<span class="hljs-selector-attr">[i]</span> = <span class="hljs-built_in">max</span>(dp<span class="hljs-selector-attr">[j]</span>+<span class="hljs-number">1</span>)<br><br>æ‰€æœ‰dp<span class="hljs-selector-attr">[i]</span>çš„æœ€å¤§å€¼æ˜¯è§£<br><br>dp<span class="hljs-selector-attr">[i]</span>=<span class="hljs-number">1</span>  è‡ªå·±é•¿åº¦ä¸º<span class="hljs-number">1</span>çš„åºåˆ—<br></code></pre></td></tr></table></figure>



<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">lengthOfLIS</span>(<span class="hljs-params">nums: <span class="hljs-built_in">number</span>[]</span>): <span class="hljs-built_in">number</span> &#123;<br>  <span class="hljs-keyword">let</span> n = nums.<span class="hljs-property">length</span>;<br>  <span class="hljs-keyword">let</span> dp = <span class="hljs-title class_">Array</span>(n).<span class="hljs-title function_">fill</span>(<span class="hljs-number">1</span>);<br><br>  <span class="hljs-keyword">let</span> res = <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; n; i++) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; i; j++) &#123;<br>      <span class="hljs-keyword">if</span> (nums[i] &gt; nums[j]) &#123;<br>        dp[i] = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(dp[i], dp[j] + <span class="hljs-number">1</span>);<br>      &#125;<br>    &#125;<br>    res = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(res, dp[i]);<br>  &#125;<br>  <span class="hljs-keyword">return</span> res;<br>&#125;<br> <br></code></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode347</title>
    <url>/posts/3e6511dc.html</url>
    <content><![CDATA[<h3 id="347-å‰-K-ä¸ªé«˜é¢‘å…ƒç´ "><a href="#347-å‰-K-ä¸ªé«˜é¢‘å…ƒç´ " class="headerlink" title="347. å‰ K ä¸ªé«˜é¢‘å…ƒç´ "></a><a href="https://leetcode.cn/problems/top-k-frequent-elements/">347. å‰ K ä¸ªé«˜é¢‘å…ƒç´ </a></h3><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•° k ï¼Œè¯·ä½ è¿”å›å…¶ä¸­å‡ºç°é¢‘ç‡å‰ k é«˜çš„å…ƒç´ ã€‚ä½ å¯ä»¥æŒ‰ ä»»æ„é¡ºåº è¿”å›ç­”æ¡ˆã€‚</p>
<p>ç¤ºä¾‹ 1:</p>
<figure class="highlight inform7"><table><tr><td class="code"><pre><code class="hljs inform7">è¾“å…¥: nums = <span class="hljs-comment">[1,1,1,2,2,3]</span>, k = 2<br>è¾“å‡º: <span class="hljs-comment">[1,2]</span><br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 2:</p>
<figure class="highlight inform7"><table><tr><td class="code"><pre><code class="hljs inform7">è¾“å…¥: nums = <span class="hljs-comment">[1]</span>, k = 1<br>è¾“å‡º: <span class="hljs-comment">[1]</span><br></code></pre></td></tr></table></figure>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/top-k-frequent-elements">https://leetcode.cn/problems/top-k-frequent-elements</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><figure class="highlight stylus"><table><tr><td class="code"><pre><code class="hljs stylus">å…ˆæ±‚ç¬¬kä¸ªé¢‘ç‡æ˜¯å¤šå°‘<br>ç„¶åæ‰¾åˆ°å¤§äºç­‰äºé¢‘ç‡kçš„æ‰€æœ‰å…ƒç´ <br><br>å…ˆé¢„å¤„ç†é¢‘ç‡ hashè¡¨<br>å¯¹é¢‘ç‡è¿›è¡Œæ’åºï¼Œæ‰¾åˆ°ç¬¬kå¤§<br><span class="hljs-function"><span class="hljs-title">O</span><span class="hljs-params">(n)</span></span>çš„æ’åº=&gt;æ¡¶æ’åº<br></code></pre></td></tr></table></figure>



<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">topKFrequent</span>(<span class="hljs-params">nums: <span class="hljs-built_in">number</span>[], k: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span>[] &#123;<br>  <span class="hljs-keyword">let</span> n = nums.<span class="hljs-property">length</span>;<br><br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">hash</span>: &#123; [<span class="hljs-attr">k</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">number</span> &#125; = &#123;&#125;;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) &#123;<br>    hash[nums[i]] = (hash[nums[i]] || <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// æ±‚ç¬¬kå¤§é¢‘ç‡ï¼Œæ¡¶æ’åºã€‚é¢‘ç‡æœ€å°0ï¼Œæœ€å¤§n</span><br>  <span class="hljs-keyword">let</span> buckets = <span class="hljs-title class_">Array</span>(n + <span class="hljs-number">1</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> freq <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(hash)) &#123;<br>    buckets[freq]++;<br>  &#125;<br><br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">kthFreq</span>: <span class="hljs-built_in">number</span> = -<span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = n; i &gt;= <span class="hljs-number">0</span>; i--) &#123;<br>    k -= buckets[i];<br>    <span class="hljs-keyword">if</span> (k === <span class="hljs-number">0</span>) &#123;<br>      kthFreq = i;<br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-comment">// é¢‘ç‡ä¸ºkçš„å…ƒç´ ç»“æœ</span><br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">res</span>: <span class="hljs-built_in">number</span>[] = [];<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i <span class="hljs-keyword">in</span> hash) &#123;<br>    <span class="hljs-keyword">if</span> (hash[i] &gt;= kthFreq) &#123;<br>      res.<span class="hljs-title function_">push</span>(<span class="hljs-title class_">Number</span>(i));<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> res;<br>&#125;<br><br></code></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode35</title>
    <url>/posts/730b4760.html</url>
    <content><![CDATA[<h3 id="35-æœç´¢æ’å…¥ä½ç½®"><a href="#35-æœç´¢æ’å…¥ä½ç½®" class="headerlink" title="35. æœç´¢æ’å…¥ä½ç½®"></a><a href="https://leetcode.cn/problems/search-insert-position/">35. æœç´¢æ’å…¥ä½ç½®</a></h3><p>ç»™å®šä¸€ä¸ªæ’åºæ•°ç»„å’Œä¸€ä¸ªç›®æ ‡å€¼ï¼Œåœ¨æ•°ç»„ä¸­æ‰¾åˆ°ç›®æ ‡å€¼ï¼Œå¹¶è¿”å›å…¶ç´¢å¼•ã€‚å¦‚æœç›®æ ‡å€¼ä¸å­˜åœ¨äºæ•°ç»„ä¸­ï¼Œè¿”å›å®ƒå°†ä¼šè¢«æŒ‰é¡ºåºæ’å…¥çš„ä½ç½®ã€‚</p>
<p>è¯·å¿…é¡»ä½¿ç”¨æ—¶é—´å¤æ‚åº¦ä¸º O(log n) çš„ç®—æ³•ã€‚</p>
<p>ç¤ºä¾‹ 1:</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">è¾“å…¥: nums = [1,3,5,6], target = 5</span><br><span class="hljs-section">è¾“å‡º: 2</span><br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 2:</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">è¾“å…¥: nums = [1,3,5,6], target = 2</span><br><span class="hljs-section">è¾“å‡º: 1</span><br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 3:</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">è¾“å…¥: nums = [1,3,5,6], target = 7</span><br><span class="hljs-section">è¾“å‡º: 4</span><br></code></pre></td></tr></table></figure>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/search-insert-position">https://leetcode.cn/problems/search-insert-position</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><figure class="highlight inform7"><table><tr><td class="code"><pre><code class="hljs inform7">nums<span class="hljs-comment">[mid]</span>&gt;=targetå¯èƒ½æ˜¯è§£ï¼Œæ‰€æœ‰è§£çš„å·¦è¾¹ç•Œ<br>äºŒåˆ†æœç´¢æ˜¯é—­åŒºé—´<span class="hljs-comment">[l,r]</span>ï¼ŒåŒºé—´å¤–çš„è§£è¦ç‰¹åˆ¤<br>ç©ºæ•°ç»„ï¼Œæ’å…¥åˆ°æœ€åä½ç½®çš„æƒ…å†µ<br></code></pre></td></tr></table></figure>



<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">searchInsert</span>(<span class="hljs-params">nums: <span class="hljs-built_in">number</span>[], target: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> &#123;<br>  <span class="hljs-keyword">let</span> n = nums.<span class="hljs-property">length</span>;<br><br>  <span class="hljs-comment">// []</span><br>  <span class="hljs-keyword">if</span> (n === <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// [1,2,3] 4</span><br>  <span class="hljs-keyword">if</span> (nums[n - <span class="hljs-number">1</span>] &lt; target) &#123;<br>    <span class="hljs-keyword">return</span> n;<br>  &#125;<br><br>  <span class="hljs-keyword">let</span> l = <span class="hljs-number">0</span>,<br>    r = n - <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">while</span> (l &lt; r) &#123;<br>    <span class="hljs-keyword">let</span> mid = (l + r) &gt;&gt;&gt; <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> (nums[mid] &gt;= target) r = mid;<br>    <span class="hljs-keyword">else</span> l = mid + <span class="hljs-number">1</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> l;<br>&#125;<br><br></code></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode395</title>
    <url>/posts/65c50ebd.html</url>
    <content><![CDATA[<h3 id="395-è‡³å°‘æœ‰-K-ä¸ªé‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²"><a href="#395-è‡³å°‘æœ‰-K-ä¸ªé‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²" class="headerlink" title="395. è‡³å°‘æœ‰ K ä¸ªé‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²"></a><a href="https://leetcode.cn/problems/longest-substring-with-at-least-k-repeating-characters/">395. è‡³å°‘æœ‰ K ä¸ªé‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²</a></h3><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² s å’Œä¸€ä¸ªæ•´æ•° k ï¼Œè¯·ä½ æ‰¾å‡º s ä¸­çš„æœ€é•¿å­ä¸²ï¼Œ è¦æ±‚è¯¥å­ä¸²ä¸­çš„æ¯ä¸€å­—ç¬¦å‡ºç°æ¬¡æ•°éƒ½ä¸å°‘äº k ã€‚è¿”å›è¿™ä¸€å­ä¸²çš„é•¿åº¦ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><code class="hljs 1c">è¾“å…¥ï¼šs = <span class="hljs-string">&quot;aaabb&quot;</span>, k = <span class="hljs-number">3</span><br>è¾“å‡ºï¼š<span class="hljs-number">3</span><br>è§£é‡Šï¼šæœ€é•¿å­ä¸²ä¸º <span class="hljs-string">&quot;aaa&quot;</span> ï¼Œå…¶ä¸­ &#x27;a&#x27; é‡å¤äº† <span class="hljs-number">3</span> æ¬¡ã€‚<br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 2ï¼š</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><code class="hljs 1c">è¾“å…¥ï¼šs = <span class="hljs-string">&quot;ababbc&quot;</span>, k = <span class="hljs-number">2</span><br>è¾“å‡ºï¼š<span class="hljs-number">5</span><br>è§£é‡Šï¼šæœ€é•¿å­ä¸²ä¸º <span class="hljs-string">&quot;ababb&quot;</span> ï¼Œå…¶ä¸­ &#x27;a&#x27; é‡å¤äº† <span class="hljs-number">2</span> æ¬¡ï¼Œ &#x27;b&#x27; é‡å¤äº† <span class="hljs-number">3</span> æ¬¡ã€‚<br></code></pre></td></tr></table></figure>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/longest-substring-with-at-least-k-repeating-characters">https://leetcode.cn/problems/longest-substring-with-at-least-k-repeating-characters</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><figure class="highlight gcode"><table><tr><td class="code"><pre><code class="hljs gcode">é¢„å¤„ç† å­—ç¬¦:æ¬¡æ•° map<br>    ____<span class="hljs-comment">(s1)</span>                  _<span class="hljs-comment">(æ¬¡æ•°å°äºk)</span>  ____<span class="hljs-comment">(s2)</span>                     _<span class="hljs-comment">(æ¬¡æ•°å°äºk)</span><br>s<span class="hljs-number">1</span>  __<span class="hljs-comment">(res)</span><span class="hljs-comment">(æ¬¡æ•°å°äºk)</span>__<span class="hljs-comment">(res)</span>               s<span class="hljs-number">2</span>  __<span class="hljs-comment">(res)</span><span class="hljs-comment">(æ¬¡æ•°å°äºk)</span>__<span class="hljs-comment">(res)</span><br>                                           <br><br>åˆ†æ²»ï¼Œé€’å½’çš„æƒ³æ³•<br>æ‰¾åˆ°<span class="hljs-number">1</span>ä¸ªæ¬¡æ•°å°äºkï¼Œå°†å­—ç¬¦ä¸²åˆ‡æˆå¤šä¸ªéƒ¨åˆ†<br>å‡è®¾æ¯ä¸ªéƒ¨åˆ†å­—ç¬¦ä¸²æ±‚è§£å‡ºç»“æœ, å½“å‰å­—ç¬¦ä¸²çš„è§£å°±æ˜¯æ‰€æœ‰éƒ¨åˆ†è§£çš„max<br></code></pre></td></tr></table></figure>


<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">longestSubstring</span>(<span class="hljs-params">s: <span class="hljs-built_in">string</span>, k: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> &#123;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">recur</span>(<span class="hljs-params">s: <span class="hljs-built_in">string</span></span>) &#123;<br>    <span class="hljs-keyword">let</span> hash = &#123;&#125;;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> c <span class="hljs-keyword">of</span> s) &#123;<br>      hash[c] = (hash[c] || <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">let</span> sep = <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> c <span class="hljs-keyword">in</span> hash) &#123;<br>      <span class="hljs-keyword">if</span> (hash[c] &lt; k) &#123;<br>        sep = c;<br>        <span class="hljs-keyword">break</span>;<br>      &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// å¦‚æœæ‰€æœ‰å­—ç¬¦æ¬¡æ•°éƒ½å¤§äºk</span><br>    <span class="hljs-keyword">if</span> (!sep) <span class="hljs-keyword">return</span> s.<span class="hljs-property">length</span>;<br><br>    <span class="hljs-keyword">let</span> res = -<span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">let</span> parts = s.<span class="hljs-title function_">split</span>(sep);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> part <span class="hljs-keyword">of</span> parts) &#123;<br>      res = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(res, <span class="hljs-title function_">recur</span>(part));<br>    &#125;<br>    <span class="hljs-keyword">return</span> res;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">recur</span>(s);<br>&#125;<br><br></code></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode40</title>
    <url>/posts/4c202528.html</url>
    <content><![CDATA[<h3 id="40-ç»„åˆæ€»å’Œ-II"><a href="#40-ç»„åˆæ€»å’Œ-II" class="headerlink" title="40. ç»„åˆæ€»å’Œ II"></a><a href="https://leetcode.cn/problems/combination-sum-ii/">40. ç»„åˆæ€»å’Œ II</a></h3><p>ç»™å®šä¸€ä¸ªå€™é€‰äººç¼–å·çš„é›†åˆ candidates å’Œä¸€ä¸ªç›®æ ‡æ•° target ï¼Œæ‰¾å‡º candidates ä¸­æ‰€æœ‰å¯ä»¥ä½¿æ•°å­—å’Œä¸º target çš„ç»„åˆã€‚</p>
<p>candidates ä¸­çš„æ¯ä¸ªæ•°å­—åœ¨æ¯ä¸ªç»„åˆä¸­åªèƒ½ä½¿ç”¨ ä¸€æ¬¡ ã€‚</p>
<p>æ³¨æ„ï¼šè§£é›†ä¸èƒ½åŒ…å«é‡å¤çš„ç»„åˆã€‚ </p>
<p>ç¤ºä¾‹ 1:</p>
<figure class="highlight inform7"><table><tr><td class="code"><pre><code class="hljs inform7">è¾“å…¥: candidates = <span class="hljs-comment">[10,1,2,7,6,1,5]</span>, target = 8,<br>è¾“å‡º:<br><span class="hljs-comment">[</span><br><span class="hljs-comment"><span class="hljs-comment">[1,1,6]</span>,</span><br><span class="hljs-comment"><span class="hljs-comment">[1,2,5]</span>,</span><br><span class="hljs-comment"><span class="hljs-comment">[1,7]</span>,</span><br><span class="hljs-comment"><span class="hljs-comment">[2,6]</span></span><br><span class="hljs-comment">]</span><br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 2:</p>
<figure class="highlight inform7"><table><tr><td class="code"><pre><code class="hljs inform7">è¾“å…¥: candidates = <span class="hljs-comment">[2,5,2,1,2]</span>, target = 5,<br>è¾“å‡º:<br><span class="hljs-comment">[</span><br><span class="hljs-comment"><span class="hljs-comment">[1,2,2]</span>,</span><br><span class="hljs-comment"><span class="hljs-comment">[5]</span></span><br><span class="hljs-comment">]</span><br></code></pre></td></tr></table></figure>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/combination-sum-ii">https://leetcode.cn/problems/combination-sum-ii</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><img src="/pic/select-repeat.png"/>

<figure class="highlight inform7"><table><tr><td class="code"><pre><code class="hljs inform7">ç»„åˆï¼Œæ¯æ¬¡å°†ä½ç½®æ›´å¤§çš„åˆ†å‰å‡ºæ¥<br>12*é€‰äº†ï¼Œ12&#x27;å°±å¯ä»¥å‰ªæ<br>è®©ç›¸åŒçš„å…ƒç´ é åœ¨ä¸€èµ·ï¼Œå¦‚æœå‘ç° nums<span class="hljs-comment">[i]</span> == nums<span class="hljs-comment">[i-1]</span>ï¼Œåˆ™è·³è¿‡<br></code></pre></td></tr></table></figure>



<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">combinationSum2</span>(<span class="hljs-params">nums: <span class="hljs-built_in">number</span>[], target: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span>[][] &#123;<br>  <span class="hljs-keyword">let</span> n = nums.<span class="hljs-property">length</span>;<br>  <span class="hljs-comment">// æ’åº</span><br>  nums.<span class="hljs-title function_">sort</span>();<br><br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">path</span>: <span class="hljs-built_in">number</span>[] = [];<br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">res</span>: <span class="hljs-built_in">number</span>[][] = [];<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">start, pathsum</span>) &#123;<br>    <span class="hljs-keyword">if</span> (pathsum &gt;= target) &#123;<br>      <span class="hljs-keyword">if</span> (pathsum === target) &#123;<br>        res.<span class="hljs-title function_">push</span>([...path]);<br>      &#125;<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = start; i &lt; n; i++) &#123;<br>      <span class="hljs-keyword">if</span> (i &gt; start &amp;&amp; nums[i] === nums[i - <span class="hljs-number">1</span>]) &#123;<br>        <span class="hljs-keyword">continue</span>;<br>      &#125;<br><br>      path.<span class="hljs-title function_">push</span>(nums[i]);<br>      <span class="hljs-title function_">dfs</span>(i + <span class="hljs-number">1</span>, pathsum + nums[i]);<br>      path.<span class="hljs-title function_">pop</span>();<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-title function_">dfs</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">return</span> res;<br>&#125;<br><br></code></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode42</title>
    <url>/posts/a22e4404.html</url>
    <content><![CDATA[<h3 id="42-æ¥é›¨æ°´"><a href="#42-æ¥é›¨æ°´" class="headerlink" title="42. æ¥é›¨æ°´"></a><a href="https://leetcode.cn/problems/trapping-rain-water/">42. æ¥é›¨æ°´</a></h3><p>ç»™å®š n ä¸ªéè´Ÿæ•´æ•°è¡¨ç¤ºæ¯ä¸ªå®½åº¦ä¸º 1 çš„æŸ±å­çš„é«˜åº¦å›¾ï¼Œè®¡ç®—æŒ‰æ­¤æ’åˆ—çš„æŸ±å­ï¼Œä¸‹é›¨ä¹‹åèƒ½æ¥å¤šå°‘é›¨æ°´ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š<br><img src="/pic/rainwatertrap.png" /></p>
<figure class="highlight dns"><table><tr><td class="code"><pre><code class="hljs dns">è¾“å…¥ï¼šheight = [<span class="hljs-number">0,1,0,2</span>,<span class="hljs-number">1,0,1,3</span>,<span class="hljs-number">2,1,2,1</span>]<br>è¾“å‡ºï¼š<span class="hljs-number">6</span><br>è§£é‡Šï¼šä¸Šé¢æ˜¯ç”±æ•°ç»„ [<span class="hljs-number">0,1,0,2</span>,<span class="hljs-number">1,0,1,3</span>,<span class="hljs-number">2,1,2,1</span>] è¡¨ç¤ºçš„é«˜åº¦å›¾ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥æ¥ <span class="hljs-number">6</span> ä¸ªå•ä½çš„é›¨æ°´ï¼ˆè“è‰²éƒ¨åˆ†è¡¨ç¤ºé›¨æ°´ï¼‰ã€‚ <br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 2ï¼š</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><code class="hljs accesslog">è¾“å…¥ï¼šheight = <span class="hljs-string">[4,2,0,3,2,5]</span><br>è¾“å‡ºï¼š<span class="hljs-number">9</span><br></code></pre></td></tr></table></figure>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/trapping-rain-water">https://leetcode.cn/problems/trapping-rain-water</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><figure class="highlight maxima"><table><tr><td class="code"><pre><code class="hljs maxima">èƒ½å­˜å¤šå°‘æ°´=&gt;æ¯ä¸ªä½ç½®èƒ½å­˜å¤šå°‘æ°´çš„å’Œ<br>ä¸€ä¸ªä½ç½®èƒ½å­˜å¤šå°‘æ°´=&gt;<span class="hljs-built_in">min</span>(å·¦è¾¹æœ€é«˜ï¼Œå³è¾¹æœ€é«˜)-è‡ªå·±é«˜åº¦<br>å¦‚æœä»å³å¾€å·¦ï¼Œå·¦è¾¹æœ€é«˜çŸ¥é“ï¼Œå³è¾¹æœ€é«˜æ€ä¹ˆåŠï¼Ÿ<br>å¦‚æœå³è¾¹æœ‰é«˜åº¦å¤§äºå·¦è¾¹æœ€é«˜ï¼Œä¸€ä¸ªä½ç½®èƒ½å­˜å¤šå°‘æ°´=&gt;å·¦è¾¹æœ€é«˜-è‡ªå·±é«˜åº¦<br><br>lä»å·¦å¾€å³ï¼Œrä»å³å¾€å·¦<br><span class="hljs-built_in">lmax</span>è®°å½•lçš„å·¦è¾¹æœ€é«˜ï¼Œrmaxè®°å½•rçš„å³è¾¹æœ€é«˜<br><br>å¦‚æœå³è¾¹æœ‰é«˜åº¦å¤§äºå·¦è¾¹æœ€é«˜å’Œlï¼Œlä½ç½®å¯ä»¥è®¡ç®—è§£ rä¸åŠ¨<br>	å¦‚æœ<span class="hljs-built_in">height</span>[l]&gt;=<span class="hljs-built_in">lmax</span> res+=<span class="hljs-number">0</span> l++ æ›´æ–°<span class="hljs-built_in">lmax</span><br>	å¦‚æœ<span class="hljs-built_in">height</span>[l]&lt;<span class="hljs-built_in">lmax</span>  res+=å·¦è¾¹æœ€é«˜-è‡ªå·±é«˜åº¦ l++<br>        <br>å¦‚æœå·¦è¾¹æœ‰é«˜åº¦å¤§äºå³è¾¹æœ€é«˜å’Œr, rä½ç½®å¯ä»¥è®¡ç®—è§£ lä¸åŠ¨<br>	å¦‚æœ<span class="hljs-built_in">height</span>[r]&gt;=rmax res+=<span class="hljs-number">0</span> r-- æ›´æ–°rmax<br>	å¦‚æœ<span class="hljs-built_in">height</span>[r]&lt;rmax  res+=å³è¾¹æœ€é«˜-è‡ªå·±é«˜åº¦ r--<br><br><span class="hljs-keyword">if</span>(rmax &gt;= <span class="hljs-built_in">lmax</span>)&#123;<br>    èµ°å‡ºè¿™ä¸ªåˆ†æ”¯è·¯å¾„è¯´æ˜ï¼Œ<span class="hljs-built_in">height</span>[l]æˆä¸ºæ–°<span class="hljs-built_in">lmax</span>ï¼Œ<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    èµ°å‡ºè¿™ä¸ªåˆ†æ”¯è·¯å¾„è¯´æ˜ï¼Œ<span class="hljs-built_in">height</span>[r]æˆä¸ºæ–°rmax<br>&#125;<br><br><br><br></code></pre></td></tr></table></figure>



<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">trap</span>(<span class="hljs-params">height: <span class="hljs-built_in">number</span>[]</span>): <span class="hljs-built_in">number</span> &#123;<br>  <span class="hljs-keyword">let</span> n = height.<span class="hljs-property">length</span>;<br>  <span class="hljs-keyword">let</span> l = <span class="hljs-number">0</span>,<br>    r = n - <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">let</span> res = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">let</span> lmax = height[l],<br>    rmax = height[r];<br>    <span class="hljs-comment">// æ³¨æ„l===rä¹Ÿè¦èµ°ï¼Œå› ä¸ºæ¯æ¬¡è®¡ç®—å½“å‰ä½ç½®å­˜æ°´é‡åèµ°åˆ°ä¸‹ä¸€ä¸ªä½ç½®ï¼Œä¸‹ä¸€ä¸ªä½ç½®æ²¡è®¡ç®—å‘¢</span><br>  <span class="hljs-keyword">while</span> (l &lt;= r) &#123;<br>    <span class="hljs-keyword">if</span> (rmax &gt;= lmax) &#123;<br>      <span class="hljs-keyword">if</span> (height[l] &gt;= lmax) &#123;<br>        lmax = height[l];<br>        res += <span class="hljs-number">0</span>;<br>        l++;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        res += lmax - height[l];<br>        l++;<br>      &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">if</span> (height[r] &gt;= rmax) &#123;<br>        rmax = height[r];<br>        res += <span class="hljs-number">0</span>;<br>        r--;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        res += rmax - height[r];<br>        r--;<br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> res;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode430</title>
    <url>/posts/ea0f043d.html</url>
    <content><![CDATA[<h3 id="430-æ‰å¹³åŒ–å¤šçº§åŒå‘é“¾è¡¨"><a href="#430-æ‰å¹³åŒ–å¤šçº§åŒå‘é“¾è¡¨" class="headerlink" title="430. æ‰å¹³åŒ–å¤šçº§åŒå‘é“¾è¡¨"></a><a href="https://leetcode.cn/problems/flatten-a-multilevel-doubly-linked-list/description/">430. æ‰å¹³åŒ–å¤šçº§åŒå‘é“¾è¡¨</a></h3><p>ä½ ä¼šå¾—åˆ°ä¸€ä¸ªåŒé“¾è¡¨ï¼Œå…¶ä¸­åŒ…å«çš„èŠ‚ç‚¹æœ‰ä¸€ä¸ªä¸‹ä¸€ä¸ªæŒ‡é’ˆã€ä¸€ä¸ªå‰ä¸€ä¸ªæŒ‡é’ˆå’Œä¸€ä¸ªé¢å¤–çš„ å­æŒ‡é’ˆ ã€‚è¿™ä¸ªå­æŒ‡é’ˆå¯èƒ½æŒ‡å‘ä¸€ä¸ªå•ç‹¬çš„åŒå‘é“¾è¡¨ï¼Œä¹ŸåŒ…å«è¿™äº›ç‰¹æ®Šçš„èŠ‚ç‚¹ã€‚è¿™äº›å­åˆ—è¡¨å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè‡ªå·±çš„å­åˆ—è¡¨ï¼Œä»¥æ­¤ç±»æ¨ï¼Œä»¥ç”Ÿæˆå¦‚ä¸‹é¢çš„ç¤ºä¾‹æ‰€ç¤ºçš„ å¤šå±‚æ•°æ®ç»“æ„ ã€‚</p>
<p>ç»™å®šé“¾è¡¨çš„å¤´èŠ‚ç‚¹ head ï¼Œå°†é“¾è¡¨ æ‰å¹³åŒ– ï¼Œä»¥ä¾¿æ‰€æœ‰èŠ‚ç‚¹éƒ½å‡ºç°åœ¨å•å±‚åŒé“¾è¡¨ä¸­ã€‚è®© curr æ˜¯ä¸€ä¸ªå¸¦æœ‰å­åˆ—è¡¨çš„èŠ‚ç‚¹ã€‚å­åˆ—è¡¨ä¸­çš„èŠ‚ç‚¹åº”è¯¥å‡ºç°åœ¨æ‰å¹³åŒ–åˆ—è¡¨ä¸­çš„ curr ä¹‹å å’Œ curr.next ä¹‹å‰ ã€‚</p>
<p>è¿”å› æ‰å¹³åˆ—è¡¨çš„ head ã€‚åˆ—è¡¨ä¸­çš„èŠ‚ç‚¹å¿…é¡»å°†å…¶ æ‰€æœ‰ å­æŒ‡é’ˆè®¾ç½®ä¸º null ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥ï¼šhead &#x3D; [1,2,3,4,5,6,null,null,null,7,8,9,10,null,null,11,12]<br>è¾“å‡ºï¼š[1,2,3,7,8,11,12,9,10,4,5,6]<br>è§£é‡Šï¼šè¾“å…¥çš„å¤šçº§åˆ—è¡¨å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚<br>æ‰å¹³åŒ–åçš„é“¾è¡¨å¦‚ä¸‹å›¾ï¼š</p>
<p>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥ï¼šhead &#x3D; [1,2,null,3]<br>è¾“å‡ºï¼š[1,3,2]<br>è§£é‡Šï¼šè¾“å…¥çš„å¤šçº§åˆ—è¡¨å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚<br>æ‰å¹³åŒ–åçš„é“¾è¡¨å¦‚ä¸‹å›¾ï¼š</p>
<p>ç¤ºä¾‹ 3ï¼š<br>è¾“å…¥ï¼šhead &#x3D; []<br>è¾“å‡ºï¼š[]<br>è¯´æ˜ï¼šè¾“å…¥ä¸­å¯èƒ½å­˜åœ¨ç©ºåˆ—è¡¨ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * // Definition for a _Node.</span><br><span class="hljs-comment"> * function _Node(val,prev,next,child) &#123;</span><br><span class="hljs-comment"> *    this.val = val;</span><br><span class="hljs-comment"> *    this.prev = prev;</span><br><span class="hljs-comment"> *    this.next = next;</span><br><span class="hljs-comment"> *    this.child = child;</span><br><span class="hljs-comment"> * &#125;;</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">_Node</span>&#125; <span class="hljs-variable">head</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> &#123;<span class="hljs-type">_Node</span>&#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">var</span> flatten = <span class="hljs-keyword">function</span> (<span class="hljs-params">head</span>) &#123;<br>    <span class="hljs-keyword">let</span> p = head<br>    <span class="hljs-keyword">while</span> (p) &#123;<br>        <span class="hljs-keyword">if</span> (p.<span class="hljs-property">child</span>) &#123;<br>            <span class="hljs-comment">// å…ˆé€’å½’å¤„ç†å®Œå­é“¾è¡¨</span><br>            <span class="hljs-keyword">let</span> child = <span class="hljs-title function_">flatten</span>(p.<span class="hljs-property">child</span>)<br>            <span class="hljs-keyword">let</span> next = p.<span class="hljs-property">next</span><br><br>            <span class="hljs-comment">// å‰åŠéƒ¨è¿æ¥</span><br>            p.<span class="hljs-property">next</span> = child<br>            child.<span class="hljs-property">prev</span> = p<br>            p.<span class="hljs-property">child</span> = <span class="hljs-literal">null</span><br><br>            <span class="hljs-comment">// ååŠéƒ¨è¿æ¥</span><br>            <span class="hljs-keyword">if</span> (next) &#123;<br>                <span class="hljs-keyword">while</span> (child.<span class="hljs-property">next</span>) &#123;<br>                    child = child.<span class="hljs-property">next</span><br>                &#125;<br>                child.<span class="hljs-property">next</span> = next<br>                next.<span class="hljs-property">prev</span> = child<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            p = p.<span class="hljs-property">next</span><br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> head<br>&#125;;<br></code></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode433</title>
    <url>/posts/73065587.html</url>
    <content><![CDATA[<h3 id="433-æœ€å°åŸºå› å˜åŒ–"><a href="#433-æœ€å°åŸºå› å˜åŒ–" class="headerlink" title="433. æœ€å°åŸºå› å˜åŒ–"></a><a href="https://leetcode.cn/problems/minimum-genetic-mutation/description/">433. æœ€å°åŸºå› å˜åŒ–</a></h3><p>åŸºå› åºåˆ—å¯ä»¥è¡¨ç¤ºä¸ºä¸€æ¡ç”± 8 ä¸ªå­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œå…¶ä¸­æ¯ä¸ªå­—ç¬¦éƒ½æ˜¯ â€˜Aâ€™ã€â€™Câ€™ã€â€™Gâ€™ å’Œ â€˜Tâ€™ ä¹‹ä¸€ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬éœ€è¦è°ƒæŸ¥ä»åŸºå› åºåˆ— start å˜ä¸º end æ‰€å‘ç”Ÿçš„åŸºå› å˜åŒ–ã€‚ä¸€æ¬¡åŸºå› å˜åŒ–å°±æ„å‘³ç€è¿™ä¸ªåŸºå› åºåˆ—ä¸­çš„ä¸€ä¸ªå­—ç¬¦å‘ç”Ÿäº†å˜åŒ–ã€‚</p>
<p>ä¾‹å¦‚ï¼Œâ€AACCGGTTâ€ â€“&gt; â€œAACCGGTAâ€ å°±æ˜¯ä¸€æ¬¡åŸºå› å˜åŒ–ã€‚<br>å¦æœ‰ä¸€ä¸ªåŸºå› åº“ bank è®°å½•äº†æ‰€æœ‰æœ‰æ•ˆçš„åŸºå› å˜åŒ–ï¼Œåªæœ‰åŸºå› åº“ä¸­çš„åŸºå› æ‰æ˜¯æœ‰æ•ˆçš„åŸºå› åºåˆ—ã€‚ï¼ˆå˜åŒ–åçš„åŸºå› å¿…é¡»ä½äºåŸºå› åº“ bank ä¸­ï¼‰</p>
<p>ç»™ä½ ä¸¤ä¸ªåŸºå› åºåˆ— start å’Œ end ï¼Œä»¥åŠä¸€ä¸ªåŸºå› åº“ bank ï¼Œè¯·ä½ æ‰¾å‡ºå¹¶è¿”å›èƒ½å¤Ÿä½¿ start å˜åŒ–ä¸º end æ‰€éœ€çš„æœ€å°‘å˜åŒ–æ¬¡æ•°ã€‚å¦‚æœæ— æ³•å®Œæˆæ­¤åŸºå› å˜åŒ–ï¼Œè¿”å› -1 ã€‚</p>
<p>æ³¨æ„ï¼šèµ·å§‹åŸºå› åºåˆ— start é»˜è®¤æ˜¯æœ‰æ•ˆçš„ï¼Œä½†æ˜¯å®ƒå¹¶ä¸ä¸€å®šä¼šå‡ºç°åœ¨åŸºå› åº“ä¸­ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥ï¼šstart &#x3D; â€œAACCGGTTâ€, end &#x3D; â€œAACCGGTAâ€, bank &#x3D; [â€œAACCGGTAâ€]<br>è¾“å‡ºï¼š1</p>
<p>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥ï¼šstart &#x3D; â€œAACCGGTTâ€, end &#x3D; â€œAAACGGTAâ€, bank &#x3D; [â€œAACCGGTAâ€,â€AACCGCTAâ€,â€AAACGGTAâ€]<br>è¾“å‡ºï¼š2</p>
<p>ç¤ºä¾‹ 3ï¼š<br>è¾“å…¥ï¼šstart &#x3D; â€œAAAAACCCâ€, end &#x3D; â€œAACCCCCCâ€, bank &#x3D; [â€œAAAACCCCâ€,â€AAACCCCCâ€,â€AACCCCCCâ€]<br>è¾“å‡ºï¼š3</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">string</span>&#125; <span class="hljs-variable">startGene</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">string</span>&#125; <span class="hljs-variable">endGene</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">string[]</span>&#125; <span class="hljs-variable">bank</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> &#123;<span class="hljs-type">number</span>&#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">var</span> minMutation = <span class="hljs-keyword">function</span> (<span class="hljs-params">startGene, endGene, bank</span>) &#123;<br>    <span class="hljs-keyword">let</span> queue = [startGene]<br>    <span class="hljs-keyword">let</span> used = <span class="hljs-title class_">Array</span>(bank.<span class="hljs-property">length</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-literal">false</span>)<br>    used[startGene] = <span class="hljs-literal">true</span><br><br>    <span class="hljs-keyword">let</span> step = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> (queue.<span class="hljs-property">length</span>) &#123;<br>        step++ <span class="hljs-comment">// ä¸€æ¬¡ä¸€å±‚ï¼Œnä¸ª</span><br><br>        <span class="hljs-keyword">let</span> n = queue.<span class="hljs-property">length</span><br>        <span class="hljs-keyword">while</span> (n--) &#123;<br>            <span class="hljs-keyword">let</span> cur = queue.<span class="hljs-title function_">shift</span>()<br><br>            <span class="hljs-comment">// æ‰¾1è·³å¯è¾¾ï¼Œé˜²æ­¢æ­»å¾ªç¯ï¼Œç”¨è¿‡çš„ä¸èƒ½å†ç”¨</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> g <span class="hljs-keyword">of</span> bank) &#123;<br>                <span class="hljs-keyword">if</span>(used[g])&#123;<br>                    <span class="hljs-comment">// ç”¨è¿‡çš„å‰ªæ‰</span><br>                    <span class="hljs-keyword">continue</span><br>                &#125;<br><br>                <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span><br>                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; g.<span class="hljs-property">length</span>; i++) &#123;<br>                    <span class="hljs-keyword">if</span> (cur[i] !== g[i]) &#123;<br>                        count++<br>                    &#125;<br>                &#125;<br><br>                <span class="hljs-keyword">if</span> (count === <span class="hljs-number">1</span>) &#123;<br>                    <span class="hljs-keyword">if</span> (g === endGene) &#123;<br>                        <span class="hljs-keyword">return</span> step<br>                    &#125;<br>                    used[g] = <span class="hljs-literal">true</span><br>                    queue.<span class="hljs-title function_">push</span>(g)<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br>&#125;;<br></code></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode445</title>
    <url>/posts/d5246675.html</url>
    <content><![CDATA[<h3 id="445-ä¸¤æ•°ç›¸åŠ -II"><a href="#445-ä¸¤æ•°ç›¸åŠ -II" class="headerlink" title="445. ä¸¤æ•°ç›¸åŠ  II"></a><a href="https://leetcode.cn/problems/add-two-numbers-ii/description/">445. ä¸¤æ•°ç›¸åŠ  II</a></h3><p>ç»™ä½ ä¸¤ä¸ª éç©º é“¾è¡¨æ¥ä»£è¡¨ä¸¤ä¸ªéè´Ÿæ•´æ•°ã€‚æ•°å­—æœ€é«˜ä½ä½äºé“¾è¡¨å¼€å§‹ä½ç½®ã€‚å®ƒä»¬çš„æ¯ä¸ªèŠ‚ç‚¹åªå­˜å‚¨ä¸€ä½æ•°å­—ã€‚å°†è¿™ä¸¤æ•°ç›¸åŠ ä¼šè¿”å›ä¸€ä¸ªæ–°çš„é“¾è¡¨ã€‚</p>
<p>ä½ å¯ä»¥å‡è®¾é™¤äº†æ•°å­— 0 ä¹‹å¤–ï¼Œè¿™ä¸¤ä¸ªæ•°å­—éƒ½ä¸ä¼šä»¥é›¶å¼€å¤´ã€‚</p>
<p>ç¤ºä¾‹1ï¼š<br>è¾“å…¥ï¼šl1 &#x3D; [7,2,4,3], l2 &#x3D; [5,6,4]<br>è¾“å‡ºï¼š[7,8,0,7]</p>
<p>ç¤ºä¾‹2ï¼š<br>è¾“å…¥ï¼šl1 &#x3D; [2,4,3], l2 &#x3D; [5,6,4]<br>è¾“å‡ºï¼š[8,0,7]</p>
<p>ç¤ºä¾‹3ï¼š<br>è¾“å…¥ï¼šl1 &#x3D; [0], l2 &#x3D; [0]<br>è¾“å‡ºï¼š[0]</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Definition for singly-linked list.</span><br><span class="hljs-comment"> * function ListNode(val, next) &#123;</span><br><span class="hljs-comment"> *     this.val = (val===undefined ? 0 : val)</span><br><span class="hljs-comment"> *     this.next = (next===undefined ? null : next)</span><br><span class="hljs-comment"> * &#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">ListNode</span>&#125; <span class="hljs-variable">l1</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">ListNode</span>&#125; <span class="hljs-variable">l2</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> &#123;<span class="hljs-type">ListNode</span>&#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">var</span> addTwoNumbers = <span class="hljs-keyword">function</span> (<span class="hljs-params">l1, l2</span>) &#123;<br>    <span class="hljs-keyword">let</span> len1 = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">let</span> len2 = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">let</span> p1 = l1<br>    <span class="hljs-keyword">while</span> (p1) &#123;<br>        len1++<br>        p1 = p1.<span class="hljs-property">next</span><br>    &#125;<br><br>    <span class="hljs-keyword">let</span> p2 = l2<br>    <span class="hljs-keyword">while</span> (p2) &#123;<br>        len2++<br>        p2 = p2.<span class="hljs-property">next</span><br>    &#125;<br><br>    <span class="hljs-keyword">let</span> dummyHead = &#123; <span class="hljs-attr">next</span>: <span class="hljs-literal">null</span> &#125;<br><br>    <span class="hljs-comment">// è¿”å›åŠ å®Œåçš„è¿›ä½</span><br>    <span class="hljs-comment">// ä»åº•éƒ¨æ„å»ºæ–°é“¾è¡¨</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">recur</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-comment">// é€’å½’å‡ºå£</span><br>        <span class="hljs-keyword">if</span> (!len1 &amp;&amp; !len2) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>        &#125;<br>        <span class="hljs-comment">// æœ€åé¢çš„å…ˆç®—å®Œï¼Œå†è®¡ç®—å½“å‰ï¼Œé€’å½’</span><br>        <span class="hljs-keyword">let</span> cur = <span class="hljs-number">0</span><br>        <span class="hljs-comment">// å½“å‰æ˜¯0è¿˜æ˜¯å€¼ï¼Œçœ‹2ä¸ªé•¿åº¦æ˜¯å¦ç›¸ç­‰ï¼ŒçŸ­çš„æ˜¯0</span><br>        <span class="hljs-keyword">if</span> (len1 &lt; len2) &#123;<br>            cur += l2.<span class="hljs-property">val</span><br><br>            l2 = l2.<span class="hljs-property">next</span><br>            len2--<br>            <span class="hljs-keyword">let</span> over = <span class="hljs-title function_">recur</span>()<br>            cur += over<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (len1 &gt; len2) &#123;<br>            cur += l1.<span class="hljs-property">val</span><br><br>            l1 = l1.<span class="hljs-property">next</span><br>            len1--<br>            <span class="hljs-keyword">let</span> over = <span class="hljs-title function_">recur</span>()<br>            cur += over<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            cur += l1.<span class="hljs-property">val</span><br>            cur += l2.<span class="hljs-property">val</span><br><br>            l1 = l1.<span class="hljs-property">next</span><br>            l2 = l2.<span class="hljs-property">next</span><br>            len1--<br>            len2--<br>            <span class="hljs-keyword">let</span> over = <span class="hljs-title function_">recur</span>()<br>            cur += over<br>        &#125;<br><br>        <span class="hljs-keyword">let</span> nextOver = ~~(cur / <span class="hljs-number">10</span>)<br>        cur = cur % <span class="hljs-number">10</span><br><br>        <span class="hljs-comment">// æŒ‚è½½å½“å‰èŠ‚ç‚¹åˆ°æ–°é“¾è¡¨ å¤´éƒ¨</span><br>        <span class="hljs-keyword">let</span> curNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(cur)<br>        curNode.<span class="hljs-property">next</span> = dummyHead.<span class="hljs-property">next</span><br>        dummyHead.<span class="hljs-property">next</span> = curNode<br><br>        <span class="hljs-keyword">return</span> nextOver<br>    &#125;<br><br>    <span class="hljs-keyword">let</span> lastOver = <span class="hljs-title function_">recur</span>()<br>    <span class="hljs-comment">// æ³¨æ„æœ€åä¸€ä¸ªè¿›ä½</span><br>    <span class="hljs-keyword">if</span>(lastOver!==<span class="hljs-number">0</span>)&#123;<br>         <span class="hljs-keyword">let</span> curNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(lastOver)<br>        curNode.<span class="hljs-property">next</span> = dummyHead.<span class="hljs-property">next</span><br>        dummyHead.<span class="hljs-property">next</span> = curNode<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> dummyHead.<span class="hljs-property">next</span><br>&#125;;<br></code></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode46</title>
    <url>/posts/a543801d.html</url>
    <content><![CDATA[<h3 id="46-å…¨æ’åˆ—"><a href="#46-å…¨æ’åˆ—" class="headerlink" title="46. å…¨æ’åˆ—"></a><a href="https://leetcode.cn/problems/permutations/">46. å…¨æ’åˆ—</a></h3><p>ç»™å®šä¸€ä¸ªä¸å«é‡å¤æ•°å­—çš„æ•°ç»„ nums ï¼Œè¿”å›å…¶ æ‰€æœ‰å¯èƒ½çš„å…¨æ’åˆ— ã€‚ä½ å¯ä»¥ æŒ‰ä»»æ„é¡ºåº è¿”å›ç­”æ¡ˆã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<figure class="highlight inform7"><table><tr><td class="code"><pre><code class="hljs inform7">è¾“å…¥ï¼šnums = <span class="hljs-comment">[1,2,3]</span><br>è¾“å‡ºï¼š<span class="hljs-comment">[<span class="hljs-comment">[1,2,3]</span>,<span class="hljs-comment">[1,3,2]</span>,<span class="hljs-comment">[2,1,3]</span>,<span class="hljs-comment">[2,3,1]</span>,<span class="hljs-comment">[3,1,2]</span>,<span class="hljs-comment">[3,2,1]</span>]</span><br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 2ï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><code class="hljs lua">è¾“å…¥ï¼šnums = [<span class="hljs-number">0</span>,<span class="hljs-number">1</span>]<br>è¾“å‡ºï¼š<span class="hljs-string">[[0,1],[1,0]]</span><br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 3ï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><code class="hljs lua">è¾“å…¥ï¼šnums = [<span class="hljs-number">1</span>]<br>è¾“å‡ºï¼š<span class="hljs-string">[[1]]</span><br></code></pre></td></tr></table></figure>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/permutations">https://leetcode.cn/problems/permutations</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><img src="/pic/permute.png" />

<figure class="highlight"><table><tr><td class="code"><pre><code class="hljs">æ¯æ¬¡åˆ†å‰å‡ºæ¥çš„ï¼Œé™¤äº†å½“å‰è·¯å¾„é€‰è¿‡çš„ï¼Œå…¶ä»–éƒ½å¯ä»¥é€‰<br>used è®°å½•é€‰è¿‡çš„ï¼Œä¸èƒ½å†é€‰<br></code></pre></td></tr></table></figure>



<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">permute</span>(<span class="hljs-params">nums: <span class="hljs-built_in">number</span>[]</span>): <span class="hljs-built_in">number</span>[][] &#123;<br>  <span class="hljs-keyword">if</span> (!nums.<span class="hljs-property">length</span>) <span class="hljs-keyword">return</span> [];<br><br>  <span class="hljs-keyword">let</span> n = nums.<span class="hljs-property">length</span>;<br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">res</span>: <span class="hljs-built_in">number</span>[][] = [];<br><br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">path</span>: <span class="hljs-built_in">number</span>[] = [];<br>  <span class="hljs-keyword">let</span> used = <span class="hljs-title class_">Array</span>(n).<span class="hljs-title function_">fill</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">i: <span class="hljs-built_in">number</span></span>) &#123;<br>    <span class="hljs-keyword">if</span> (i === n) &#123;<br>      res.<span class="hljs-title function_">push</span>([...path]);<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; n; j++) &#123;<br>      <span class="hljs-keyword">if</span> (!used[j]) &#123;<br>        path.<span class="hljs-title function_">push</span>(nums[j]);<br>        used[j] = <span class="hljs-literal">true</span>;<br>        <span class="hljs-title function_">dfs</span>(i + <span class="hljs-number">1</span>);<br>        path.<span class="hljs-title function_">pop</span>();<br>        used[j] = <span class="hljs-literal">false</span>;<br>      &#125;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-title function_">dfs</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">return</span> res;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode47</title>
    <url>/posts/d244b08b.html</url>
    <content><![CDATA[<h3 id="47-å…¨æ’åˆ—-II"><a href="#47-å…¨æ’åˆ—-II" class="headerlink" title="47. å…¨æ’åˆ— II"></a><a href="https://leetcode.cn/problems/permutations-ii/">47. å…¨æ’åˆ— II</a></h3><p>ç»™å®šä¸€ä¸ªå¯åŒ…å«é‡å¤æ•°å­—çš„åºåˆ— nums ï¼ŒæŒ‰ä»»æ„é¡ºåº è¿”å›æ‰€æœ‰ä¸é‡å¤çš„å…¨æ’åˆ—ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<figure class="highlight inform7"><table><tr><td class="code"><pre><code class="hljs inform7">è¾“å…¥ï¼šnums = <span class="hljs-comment">[1,1,2]</span><br>è¾“å‡ºï¼š<br><span class="hljs-comment">[<span class="hljs-comment">[1,1,2]</span>,</span><br><span class="hljs-comment"> <span class="hljs-comment">[1,2,1]</span>,</span><br><span class="hljs-comment"> <span class="hljs-comment">[2,1,1]</span>]</span><br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 2ï¼š</p>
<figure class="highlight inform7"><table><tr><td class="code"><pre><code class="hljs inform7">è¾“å…¥ï¼šnums = <span class="hljs-comment">[1,2,3]</span><br>è¾“å‡ºï¼š<span class="hljs-comment">[<span class="hljs-comment">[1,2,3]</span>,<span class="hljs-comment">[1,3,2]</span>,<span class="hljs-comment">[2,1,3]</span>,<span class="hljs-comment">[2,3,1]</span>,<span class="hljs-comment">[3,1,2]</span>,<span class="hljs-comment">[3,2,1]</span>]</span><br></code></pre></td></tr></table></figure>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/permutations-ii">https://leetcode.cn/problems/permutations-ii</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><img src="/pic/permute-repeat.png"/>

<figure class="highlight matlab"><table><tr><td class="code"><pre><code class="hljs matlab">å›ºå®šç›¸åŒçš„å…ƒç´ åœ¨æ’åˆ—ä¸­çš„ç›¸å¯¹ä½ç½®ï¼Œæ’åº<br>åªä¿ç•™ä½æ¬¡é€’å¢çš„åºåˆ—ï¼Œå…¶ä½™åºåˆ—éƒ½å¯ä»¥å‰ªæ<br><span class="hljs-number">122</span>&#x27;<span class="hljs-number">2</span>&#x27;&#x27;  å¯ä»¥åˆ æ‰<span class="hljs-number">12</span>&#x27;<span class="hljs-number">22</span>&#x27;&#x27; <span class="hljs-number">12</span>&#x27;&#x27;<span class="hljs-number">2</span>&#x27;<span class="hljs-number">2</span>  <span class="hljs-number">12</span>&#x27;<span class="hljs-number">2</span>&#x27;&#x27;<span class="hljs-number">2</span> <span class="hljs-number">12</span>&#x27;&#x27;<span class="hljs-number">22</span>&#x27;ç­‰<br>å¦‚ä½•åˆ¤æ–­é‡å¤å…ƒç´ é‡Œæœ‰éƒ¨åˆ†é€†åºï¼Ÿ<br>å½“å‰ä½ç½®<span class="hljs-built_in">i</span>, å¦‚æœ<span class="hljs-built_in">i</span><span class="hljs-number">-1</span>æ²¡æœ‰ä½¿ç”¨è¿‡, è¯´æ˜<span class="hljs-built_in">i</span><span class="hljs-number">-1</span>åé¢æ‰ç”¨ï¼Œæœ‰é€†åº<br></code></pre></td></tr></table></figure>



<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">permuteUnique</span>(<span class="hljs-params">nums: <span class="hljs-built_in">number</span>[]</span>): <span class="hljs-built_in">number</span>[][] &#123;<br>  <span class="hljs-keyword">if</span> (!nums.<span class="hljs-property">length</span>) <span class="hljs-keyword">return</span> [];<br><br>  <span class="hljs-comment">// æ’åº</span><br>  nums.<span class="hljs-title function_">sort</span>();<br><br>  <span class="hljs-keyword">let</span> n = nums.<span class="hljs-property">length</span>;<br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">res</span>: <span class="hljs-built_in">number</span>[][] = [];<br><br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">path</span>: <span class="hljs-built_in">number</span>[] = [];<br>  <span class="hljs-keyword">let</span> used = <span class="hljs-title class_">Array</span>(n).<span class="hljs-title function_">fill</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">i: <span class="hljs-built_in">number</span></span>) &#123;<br>    <span class="hljs-keyword">if</span> (i === n) &#123;<br>      res.<span class="hljs-title function_">push</span>([...path]);<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; n; j++) &#123;<br>      <span class="hljs-comment">// åªä¿ç•™ç¬¬ä¸€ä¸ªä½æ¬¡é€’å¢åºåˆ—ï¼Œå…¶ä½™å‰ªæ</span><br>      <span class="hljs-comment">// é€’å¢åºåˆ—ç‰¹ç‚¹ï¼Œå‰ä¸€ä¸ªusedä¸ºtrue</span><br>      <span class="hljs-comment">// å¦‚æœi-1æ²¡æœ‰ä½¿ç”¨è¿‡è¯´æ˜æœ‰é€†åº</span><br>      <span class="hljs-keyword">if</span> (j &gt; <span class="hljs-number">0</span> &amp;&amp; nums[j] === nums[j - <span class="hljs-number">1</span>] &amp;&amp; !used[j - <span class="hljs-number">1</span>]) &#123;<br>        <span class="hljs-keyword">continue</span>;<br>      &#125;<br>      <span class="hljs-comment">// å‰ªæ</span><br>      <span class="hljs-keyword">if</span> (used[j]) &#123;<br>        <span class="hljs-keyword">continue</span>;<br>      &#125;<br><br>      path.<span class="hljs-title function_">push</span>(nums[j]);<br>      used[j] = <span class="hljs-literal">true</span>;<br>      <span class="hljs-title function_">dfs</span>(i + <span class="hljs-number">1</span>);<br>      path.<span class="hljs-title function_">pop</span>();<br>      used[j] = <span class="hljs-literal">false</span>;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-title function_">dfs</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">return</span> res;<br>&#125;<br></code></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode503</title>
    <url>/posts/59e96c73.html</url>
    <content><![CDATA[<h3 id="503-ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ -II"><a href="#503-ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ -II" class="headerlink" title="503. ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  II"></a><a href="https://leetcode.cn/problems/next-greater-element-ii/">503. ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  II</a></h3><p>ç»™å®šä¸€ä¸ªå¾ªç¯æ•°ç»„ nums ï¼ˆ nums[nums.length - 1] çš„ä¸‹ä¸€ä¸ªå…ƒç´ æ˜¯ nums[0] ï¼‰ï¼Œè¿”å› nums ä¸­æ¯ä¸ªå…ƒç´ çš„ ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  ã€‚</p>
<p>æ•°å­— x çš„ ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´  æ˜¯æŒ‰æ•°ç»„éå†é¡ºåºï¼Œè¿™ä¸ªæ•°å­—ä¹‹åçš„ç¬¬ä¸€ä¸ªæ¯”å®ƒæ›´å¤§çš„æ•°ï¼Œè¿™æ„å‘³ç€ä½ åº”è¯¥å¾ªç¯åœ°æœç´¢å®ƒçš„ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¾“å‡º -1 ã€‚</p>
<p>ç¤ºä¾‹ 1:</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">è¾“å…¥: nums = [1,2,1]</span><br><span class="hljs-section">è¾“å‡º: [2,-1,2]</span><br><span class="hljs-section">è§£é‡Š: ç¬¬ä¸€ä¸ª 1 çš„ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°æ˜¯ 2ï¼›</span><br>æ•°å­— 2 æ‰¾ä¸åˆ°ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°ï¼› <br>ç¬¬äºŒä¸ª 1 çš„ä¸‹ä¸€ä¸ªæœ€å¤§çš„æ•°éœ€è¦å¾ªç¯æœç´¢ï¼Œç»“æœä¹Ÿæ˜¯ 2ã€‚<br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 2:</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><code class="hljs accesslog">è¾“å…¥: nums = <span class="hljs-string">[1,2,3,4,3]</span><br>è¾“å‡º: <span class="hljs-string">[2,3,4,-1,4]</span><br></code></pre></td></tr></table></figure>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/next-greater-element-ii">https://leetcode.cn/problems/next-greater-element-ii</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><figure class="highlight"><table><tr><td class="code"><pre><code class="hljs">å¾ªç¯æ•°ç»„å±•å¼€ä¸ºä¸¤ä¸ªæ•°ç»„ï¼Œä»å·¦åˆ°å³ç»´æŠ¤ä¸€ä¸ªå•è°ƒæ ˆï¼Œæ ˆé¡¶å°±æ˜¯ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´ <br></code></pre></td></tr></table></figure>



<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">nextGreaterElements</span>(<span class="hljs-params">nums: <span class="hljs-built_in">number</span>[]</span>): <span class="hljs-built_in">number</span>[] &#123;<br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">stack</span>: <span class="hljs-built_in">number</span>[] = [];<br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">res</span>: <span class="hljs-built_in">number</span>[] = [];<br>  <span class="hljs-keyword">let</span> n = nums.<span class="hljs-property">length</span>;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">2</span> * n - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) &#123;<br>    <span class="hljs-keyword">let</span> position = i % n;<br>    <span class="hljs-keyword">while</span> (stack.<span class="hljs-property">length</span> &amp;&amp; stack[stack.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>] &lt;= nums[position]) &#123;<br>      stack.<span class="hljs-title function_">pop</span>();<br>    &#125;<br>    <span class="hljs-keyword">if</span> (i &lt; n) &#123;<br>      res[i] = stack.<span class="hljs-property">length</span> ? stack[stack.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>] : -<span class="hljs-number">1</span>;<br>    &#125;<br>    stack.<span class="hljs-title function_">push</span>(nums[position]);<br>  &#125;<br>  <span class="hljs-keyword">return</span> res;<br>&#125;<br><br></code></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode516</title>
    <url>/posts/3098a9bd.html</url>
    <content><![CDATA[<h3 id="516-æœ€é•¿å›æ–‡å­åºåˆ—"><a href="#516-æœ€é•¿å›æ–‡å­åºåˆ—" class="headerlink" title="516. æœ€é•¿å›æ–‡å­åºåˆ—"></a><a href="https://leetcode.cn/problems/longest-palindromic-subsequence/">516. æœ€é•¿å›æ–‡å­åºåˆ—</a></h3><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² s ï¼Œæ‰¾å‡ºå…¶ä¸­æœ€é•¿çš„å›æ–‡å­åºåˆ—ï¼Œå¹¶è¿”å›è¯¥åºåˆ—çš„é•¿åº¦ã€‚</p>
<p>å­åºåˆ—å®šä¹‰ä¸ºï¼šä¸æ”¹å˜å‰©ä½™å­—ç¬¦é¡ºåºçš„æƒ…å†µä¸‹ï¼Œåˆ é™¤æŸäº›å­—ç¬¦æˆ–è€…ä¸åˆ é™¤ä»»ä½•å­—ç¬¦å½¢æˆçš„ä¸€ä¸ªåºåˆ—ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><code class="hljs abnf">è¾“å…¥ï¼šs <span class="hljs-operator">=</span> <span class="hljs-string">&quot;bbbab&quot;</span><br>è¾“å‡ºï¼š<span class="hljs-number">4</span><br>è§£é‡Šï¼šä¸€ä¸ªå¯èƒ½çš„æœ€é•¿å›æ–‡å­åºåˆ—ä¸º <span class="hljs-string">&quot;bbbb&quot;</span> ã€‚<br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 2ï¼š</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><code class="hljs abnf">è¾“å…¥ï¼šs <span class="hljs-operator">=</span> <span class="hljs-string">&quot;cbbd&quot;</span><br>è¾“å‡ºï¼š<span class="hljs-number">2</span><br>è§£é‡Šï¼šä¸€ä¸ªå¯èƒ½çš„æœ€é•¿å›æ–‡å­åºåˆ—ä¸º <span class="hljs-string">&quot;bb&quot;</span> ã€‚<br></code></pre></td></tr></table></figure>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/longest-palindromic-subsequence">https://leetcode.cn/problems/longest-palindromic-subsequence</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><figure class="highlight stylus"><table><tr><td class="code"><pre><code class="hljs stylus">dp<span class="hljs-selector-attr">[l]</span><span class="hljs-selector-attr">[r]</span> è¡¨ç¤ºä»låˆ°rçš„å­—ç¬¦ä¸²ï¼Œæœ€é•¿å›æ–‡å­åºåˆ—<br><br>l rå­—ç¬¦å›æ–‡ï¼Œåˆ†ç±»è®¨è®º<br>å¦‚æœs<span class="hljs-selector-attr">[l]</span>===s<span class="hljs-selector-attr">[r]</span>, dp<span class="hljs-selector-attr">[l+1]</span><span class="hljs-selector-attr">[r-1]</span>+<span class="hljs-number">2</span><br>å¦‚æœs<span class="hljs-selector-attr">[l]</span>!==s<span class="hljs-selector-attr">[r]</span>, <span class="hljs-built_in">max</span>(dp<span class="hljs-selector-attr">[l+1]</span><span class="hljs-selector-attr">[r]</span>, dp<span class="hljs-selector-attr">[l]</span><span class="hljs-selector-attr">[r-1]</span>)<br>    <br>åˆå§‹åŒ–<br>dp<span class="hljs-selector-attr">[i]</span><span class="hljs-selector-attr">[i]</span>=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>



<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">longestPalindromeSubseq</span>(<span class="hljs-params">s: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">number</span> &#123;<br>  <span class="hljs-keyword">let</span> n = s.<span class="hljs-property">length</span>;<br>  <span class="hljs-keyword">let</span> dp = <span class="hljs-title class_">Array</span>(n)<br>    .<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>)<br>    .<span class="hljs-title function_">map</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Array</span>(n).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>));<br><br>  <span class="hljs-comment">// æšä¸¾å­—ç¬¦ä¸²é•¿åº¦</span><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j + i &lt; n; j++) &#123;<br>      <span class="hljs-keyword">let</span> l = j,<br>        r = j + i;<br>      <span class="hljs-keyword">if</span> (i === <span class="hljs-number">0</span>) &#123;<br>        dp[l][r] = <span class="hljs-number">1</span>;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">if</span> (s[l] === s[r]) &#123;<br>          dp[l][r] = dp[l + <span class="hljs-number">1</span>][r - <span class="hljs-number">1</span>] + <span class="hljs-number">2</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          dp[l][r] = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(dp[l + <span class="hljs-number">1</span>][r], dp[l][r - <span class="hljs-number">1</span>]);<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> dp[<span class="hljs-number">0</span>][n - <span class="hljs-number">1</span>];<br>&#125;<br><br></code></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode518</title>
    <url>/posts/d72084ba.html</url>
    <content><![CDATA[<h3 id="518-é›¶é’±å…‘æ¢-II"><a href="#518-é›¶é’±å…‘æ¢-II" class="headerlink" title="518. é›¶é’±å…‘æ¢ II"></a><a href="https://leetcode.cn/problems/coin-change-ii/">518. é›¶é’±å…‘æ¢ II</a></h3><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ coins è¡¨ç¤ºä¸åŒé¢é¢çš„ç¡¬å¸ï¼Œå¦ç»™ä¸€ä¸ªæ•´æ•° amount è¡¨ç¤ºæ€»é‡‘é¢ã€‚</p>
<p>è¯·ä½ è®¡ç®—å¹¶è¿”å›å¯ä»¥å‡‘æˆæ€»é‡‘é¢çš„ç¡¬å¸ç»„åˆæ•°ã€‚å¦‚æœä»»ä½•ç¡¬å¸ç»„åˆéƒ½æ— æ³•å‡‘å‡ºæ€»é‡‘é¢ï¼Œè¿”å› 0 ã€‚</p>
<p>å‡è®¾æ¯ä¸€ç§é¢é¢çš„ç¡¬å¸æœ‰æ— é™ä¸ªã€‚ </p>
<p>é¢˜ç›®æ•°æ®ä¿è¯ç»“æœç¬¦åˆ 32 ä½å¸¦ç¬¦å·æ•´æ•°ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><code class="hljs subunit"><br>è¾“å…¥ï¼šamount = 5, coins = [1, 2, 5]<br>è¾“å‡ºï¼š4<br>è§£é‡Šï¼šæœ‰å››ç§æ–¹å¼å¯ä»¥å‡‘æˆæ€»é‡‘é¢ï¼š<br>5=5<br>5=2<span class="hljs-string">+2</span><span class="hljs-string">+1</span><br>5=2<span class="hljs-string">+1</span><span class="hljs-string">+1</span><span class="hljs-string">+1</span><br>5=1<span class="hljs-string">+1</span><span class="hljs-string">+1</span><span class="hljs-string">+1</span><span class="hljs-string">+1</span><br></code></pre></td></tr></table></figure>


<p>ç¤ºä¾‹ 2ï¼š</p>
<figure class="highlight tap"><table><tr><td class="code"><pre><code class="hljs tap"><br>è¾“å…¥ï¼šamount = 3, coins = [2]<br>è¾“å‡ºï¼š0<br>è§£é‡Šï¼šåªç”¨é¢é¢<span class="hljs-number"> 2 </span>çš„ç¡¬å¸ä¸èƒ½å‡‘æˆæ€»é‡‘é¢<span class="hljs-number"> 3 </span>ã€‚<br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 3ï¼š</p>
<figure class="highlight fix"><table><tr><td class="code"><pre><code class="hljs fix"><span class="hljs-attr">è¾“å…¥ï¼šamount </span>=<span class="hljs-string"> 10, coins = [10] </span><br><span class="hljs-string">è¾“å‡ºï¼š1</span><br></code></pre></td></tr></table></figure>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/coin-change-ii">https://leetcode.cn/problems/coin-change-ii</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><figure class="highlight inform7"><table><tr><td class="code"><pre><code class="hljs inform7">dp<span class="hljs-comment">[i]</span><span class="hljs-comment">[j]</span> è¡¨ç¤ºç»™çœ‹å‰iä¸ªç¡¬å¸ï¼Œç»„æˆæ•°ç›®jçš„æ–¹æ¡ˆæ•°é‡<br><br>åˆ†ç±»è®¨è®º<br>ä¸ºäº†ä¸åŒ…å«é‡å¤è§£ï¼Œåˆ†2ç§æƒ…å†µï¼Œä¸€å®šåŒ…å«ç¬¬iä¸ªç¡¬å¸ï¼Œä¸€å®šä¸åŒ…å«ç¬¬iä¸ªç¡¬å¸ 2ç§æƒ…å†µä¸‹éƒ½åŒ…å«éƒ¨åˆ†è§£<br>dp<span class="hljs-comment">[i]</span><span class="hljs-comment">[j]</span>=<br>+dp<span class="hljs-comment">[i]</span><span class="hljs-comment">[j-coin]</span> ç»™çœ‹å‰iä¸ªç¡¬å¸ï¼Œç»„æˆæ•°ç›®j-coin çš„æ–¹æ¡ˆæ•°é‡ iä¸åŠ¨è¿˜å¯ä»¥ç»§ç»­é€‰<br>+dp<span class="hljs-comment">[i-1]</span><span class="hljs-comment">[j]</span> ç»™çœ‹å‰i-1ä¸ªç¡¬å¸ï¼Œç»„æˆæ•°ç›®jçš„æ–¹æ¡ˆæ•°é‡<br><br>dp<span class="hljs-comment">[0]</span><span class="hljs-comment">[0]</span>=1 ç»™çœ‹å‰0ä¸ªé“¶å¸ï¼Œç»„æˆæ•°ç›®0æ–¹æ¡ˆæ•°é‡1<br>dp<span class="hljs-comment">[0]</span><span class="hljs-comment">[i]</span>=0 ç»™çœ‹å‰0ä¸ªé“¶å¸ï¼Œç»„æˆæ•°ç›®iä¸æ˜¯0çš„æ–¹æ¡ˆæ•°é‡0<br></code></pre></td></tr></table></figure>



<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">change</span>(<span class="hljs-params">amount: <span class="hljs-built_in">number</span>, coins: <span class="hljs-built_in">number</span>[]</span>): <span class="hljs-built_in">number</span> &#123;<br>  <span class="hljs-keyword">let</span> n = coins.<span class="hljs-property">length</span>,<br>    m = amount;<br>  <span class="hljs-keyword">let</span> dp = <span class="hljs-title class_">Array</span>(n + <span class="hljs-number">1</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Array</span>(m + <span class="hljs-number">1</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>));<br>  dp[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt;= m; j++) &#123;<br>      dp[i][j] += dp[i - <span class="hljs-number">1</span>][j];<br>      <span class="hljs-keyword">if</span> (j &gt;= coins[i - <span class="hljs-number">1</span>]) dp[i][j] += dp[i][j - coins[i - <span class="hljs-number">1</span>]];<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> dp[n][m];<br>&#125;<br><br></code></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">change</span>(<span class="hljs-params">amount: <span class="hljs-built_in">number</span>, coins: <span class="hljs-built_in">number</span>[]</span>): <span class="hljs-built_in">number</span> &#123;<br>  <span class="hljs-keyword">let</span> n = coins.<span class="hljs-property">length</span>,<br>    m = amount;<br>  <span class="hljs-keyword">let</span> dp = <span class="hljs-title class_">Array</span>(m + <span class="hljs-number">1</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>);<br>  dp[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = coins[i - <span class="hljs-number">1</span>]; j &lt;= m; j++) &#123;<br>      dp[j] += dp[j - coins[i - <span class="hljs-number">1</span>]];<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> dp[m];<br>&#125;<br><br></code></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode560</title>
    <url>/posts/96ba9a4f.html</url>
    <content><![CDATA[<h3 id="560-å’Œä¸º-K-çš„å­æ•°ç»„"><a href="#560-å’Œä¸º-K-çš„å­æ•°ç»„" class="headerlink" title="560. å’Œä¸º K çš„å­æ•°ç»„"></a><a href="https://leetcode.cn/problems/subarray-sum-equals-k/">560. å’Œä¸º K çš„å­æ•°ç»„</a></h3><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•° k ï¼Œè¯·ä½ ç»Ÿè®¡å¹¶è¿”å› è¯¥æ•°ç»„ä¸­å’Œä¸º k çš„è¿ç»­å­æ•°ç»„çš„ä¸ªæ•° ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<figure class="highlight fix"><table><tr><td class="code"><pre><code class="hljs fix"><span class="hljs-attr">è¾“å…¥ï¼šnums </span>=<span class="hljs-string"> [1,1,1], k = 2</span><br><span class="hljs-string">è¾“å‡ºï¼š2</span><br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 2ï¼š</p>
<figure class="highlight fix"><table><tr><td class="code"><pre><code class="hljs fix"><span class="hljs-attr">è¾“å…¥ï¼šnums </span>=<span class="hljs-string"> [1,2,3], k = 3</span><br><span class="hljs-string">è¾“å‡ºï¼š2</span><br></code></pre></td></tr></table></figure>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/subarray-sum-equals-k">https://leetcode.cn/problems/subarray-sum-equals-k</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><figure class="highlight abnf"><table><tr><td class="code"><pre><code class="hljs abnf">é¢„å¤„ç†å‰ç¼€å’Œæ•°ç»„<br>ä»å·¦å¾€å³éå†å‰ç¼€å’Œæ•°ç»„ï¼Œå½“å‰ä½ç½®çš„è§£<span class="hljs-operator">=</span>å·¦ä¾§ä½ç½®ä¸­ å‰ç¼€å’Œä¸ºå½“å‰å€¼-kçš„æ•°é‡<br><br>åªç”¨è€ƒè™‘æ¯”å½“å‰å‰ç¼€å’Œå°kçš„ï¼Œæ¯”å½“å‰å‰ç¼€å’Œå¤§kçš„æƒ…å†µï¼Œå­˜åœ¨äºåé¢ä½ç½®çš„éƒ¨åˆ†è§£<br></code></pre></td></tr></table></figure>



<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">subarraySum</span>(<span class="hljs-params">nums: <span class="hljs-built_in">number</span>[], k: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> &#123;<br>  <span class="hljs-keyword">let</span> n = nums.<span class="hljs-property">length</span>;<br><br>  <span class="hljs-keyword">let</span> sum = [<span class="hljs-number">0</span>]; <span class="hljs-comment">// paddingä¸€ä¸ª0</span><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;<br>    sum[i] = sum[i - <span class="hljs-number">1</span>] + nums[i - <span class="hljs-number">1</span>];<br>  &#125;<br><br>  <span class="hljs-keyword">let</span> hash = &#123;&#125;;<br>  <span class="hljs-keyword">let</span> res = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= n; i++) &#123;<br>    res += (hash[sum[i] - k] || <span class="hljs-number">0</span>);<br>    hash[sum[i]] = (hash[sum[i]] || <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> res;<br>&#125;<br><br></code></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode523</title>
    <url>/posts/6bdf0ef1.html</url>
    <content><![CDATA[<h3 id="523-è¿ç»­çš„å­æ•°ç»„å’Œ"><a href="#523-è¿ç»­çš„å­æ•°ç»„å’Œ" class="headerlink" title="523. è¿ç»­çš„å­æ•°ç»„å’Œ"></a><a href="https://leetcode.cn/problems/continuous-subarray-sum/">523. è¿ç»­çš„å­æ•°ç»„å’Œ</a></h3><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•° k ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥åˆ¤æ–­è¯¥æ•°ç»„æ˜¯å¦å«æœ‰åŒæ—¶æ»¡è¶³ä¸‹è¿°æ¡ä»¶çš„è¿ç»­å­æ•°ç»„ï¼š</p>
<p>å­æ•°ç»„å¤§å° è‡³å°‘ä¸º 2 ï¼Œä¸”<br>å­æ•°ç»„å…ƒç´ æ€»å’Œä¸º k çš„å€æ•°ã€‚<br>å¦‚æœå­˜åœ¨ï¼Œè¿”å› true ï¼›å¦åˆ™ï¼Œè¿”å› false ã€‚</p>
<p>å¦‚æœå­˜åœ¨ä¸€ä¸ªæ•´æ•° n ï¼Œä»¤æ•´æ•° x ç¬¦åˆ x &#x3D; n * k ï¼Œåˆ™ç§° x æ˜¯ k çš„ä¸€ä¸ªå€æ•°ã€‚0 å§‹ç»ˆè§†ä¸º k çš„ä¸€ä¸ªå€æ•°ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<figure class="highlight inform7"><table><tr><td class="code"><pre><code class="hljs inform7">è¾“å…¥ï¼šnums = <span class="hljs-comment">[23,2,4,6,7]</span>, k = 6<br>è¾“å‡ºï¼štrue<br>è§£é‡Šï¼š<span class="hljs-comment">[2,4]</span> æ˜¯ä¸€ä¸ªå¤§å°ä¸º 2 çš„å­æ•°ç»„ï¼Œå¹¶ä¸”å’Œä¸º 6 ã€‚<br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 2ï¼š</p>
<figure class="highlight tap"><table><tr><td class="code"><pre><code class="hljs tap">è¾“å…¥ï¼šnums = [23,2,6,4,7], k = 6<br>è¾“å‡ºï¼štrue<br>è§£é‡Šï¼š[23, 2, 6, 4, 7] æ˜¯å¤§å°ä¸º<span class="hljs-number"> 5 </span>çš„å­æ•°ç»„ï¼Œå¹¶ä¸”å’Œä¸º<span class="hljs-number"> 42 </span>ã€‚ <br>42 æ˜¯<span class="hljs-number"> 6 </span>çš„å€æ•°ï¼Œå› ä¸º<span class="hljs-number"> 42 </span>=<span class="hljs-number"> 7 </span>*<span class="hljs-number"> 6 </span>ä¸”<span class="hljs-number"> 7 </span>æ˜¯ä¸€ä¸ªæ•´æ•°ã€‚<br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 3ï¼š</p>
<figure class="highlight nix"><table><tr><td class="code"><pre><code class="hljs nix">è¾“å…¥ï¼š<span class="hljs-attr">nums</span> = [<span class="hljs-number">23</span>,<span class="hljs-number">2</span>,<span class="hljs-number">6</span>,<span class="hljs-number">4</span>,<span class="hljs-number">7</span>], <span class="hljs-attr">k</span> = <span class="hljs-number">13</span><br>è¾“å‡ºï¼š<span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/continuous-subarray-sum">https://leetcode.cn/problems/continuous-subarray-sum</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><figure class="highlight excel"><table><tr><td class="code"><pre><code class="hljs excel">é¢„å¤„ç†ä¸€ä¸ªå‰ç¼€å’Œæ•°ç»„ï¼Œ<span class="hljs-built_in">sum</span>[i]è¡¨ç¤ºå‰iä¸ªå…ƒç´ çš„å’Œ<br><span class="hljs-built_in">sum</span>[j]-<span class="hljs-built_in">sum</span>[i] = <span class="hljs-built_in">n</span> * k<br>(a + <span class="hljs-built_in">n</span> * k) - a = <span class="hljs-built_in">n</span> * k<br>åªè¦<span class="hljs-built_in">sum</span>[j]%kåœ¨ä¹‹å‰å‡ºç°è¿‡ï¼Œå¹¶ä¸”æ•°ç»„é•¿åº¦å¤§äº<span class="hljs-number">1</span> =&gt; å‰jä¸ª-å‰iä¸ª&gt;<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>



<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkSubarraySum</span>(<span class="hljs-params">nums: <span class="hljs-built_in">number</span>[], k: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">boolean</span> &#123;<br>  <span class="hljs-keyword">let</span> n = nums.<span class="hljs-property">length</span>;<br><br>  <span class="hljs-keyword">let</span> sum = [<span class="hljs-number">0</span>]; <span class="hljs-comment">// paddingä¸€ä¸ª0</span><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;<br>    sum[i] = sum[i - <span class="hljs-number">1</span>] + nums[i - <span class="hljs-number">1</span>];<br>  &#125;<br><br>  <span class="hljs-keyword">let</span> hash = &#123;&#125;;<br>  hash[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;<br><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;<br>    <span class="hljs-keyword">let</span> leftSum = sum[i] % k;<br>    <span class="hljs-keyword">if</span> (leftSum <span class="hljs-keyword">in</span> hash &amp;&amp; i - hash[leftSum] &gt; <span class="hljs-number">1</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (hash[leftSum] === <span class="hljs-literal">undefined</span>) &#123;<br>      hash[leftSum] = i; <span class="hljs-comment">// ä¿ç•™æœ€è¿œçš„</span><br>    &#125;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode583</title>
    <url>/posts/9130e67b.html</url>
    <content><![CDATA[<h3 id="583-ä¸¤ä¸ªå­—ç¬¦ä¸²çš„åˆ é™¤æ“ä½œ"><a href="#583-ä¸¤ä¸ªå­—ç¬¦ä¸²çš„åˆ é™¤æ“ä½œ" class="headerlink" title="583. ä¸¤ä¸ªå­—ç¬¦ä¸²çš„åˆ é™¤æ“ä½œ"></a><a href="https://leetcode.cn/problems/delete-operation-for-two-strings/">583. ä¸¤ä¸ªå­—ç¬¦ä¸²çš„åˆ é™¤æ“ä½œ</a></h3><p>ç»™å®šä¸¤ä¸ªå•è¯ word1 å’Œ word2 ï¼Œè¿”å›ä½¿å¾— word1 å’Œ  word2 ç›¸åŒæ‰€éœ€çš„æœ€å°æ­¥æ•°ã€‚</p>
<p>æ¯æ­¥ å¯ä»¥åˆ é™¤ä»»æ„ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­çš„ä¸€ä¸ªå­—ç¬¦ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<figure class="highlight nix"><table><tr><td class="code"><pre><code class="hljs nix">è¾“å…¥: <span class="hljs-attr">word1</span> = <span class="hljs-string">&quot;sea&quot;</span>, <span class="hljs-attr">word2</span> = <span class="hljs-string">&quot;eat&quot;</span><br>è¾“å‡º: <span class="hljs-number">2</span><br>è§£é‡Š: ç¬¬ä¸€æ­¥å°† <span class="hljs-string">&quot;sea&quot;</span> å˜ä¸º <span class="hljs-string">&quot;ea&quot;</span> ï¼Œç¬¬äºŒæ­¥å°† <span class="hljs-string">&quot;eat &quot;</span>å˜ä¸º <span class="hljs-string">&quot;ea&quot;</span><br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹  2:</p>
<figure class="highlight nix"><table><tr><td class="code"><pre><code class="hljs nix">è¾“å…¥ï¼š<span class="hljs-attr">word1</span> = <span class="hljs-string">&quot;leetcode&quot;</span>, <span class="hljs-attr">word2</span> = <span class="hljs-string">&quot;etco&quot;</span><br>è¾“å‡ºï¼š<span class="hljs-number">4</span><br></code></pre></td></tr></table></figure>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/delete-operation-for-two-strings">https://leetcode.cn/problems/delete-operation-for-two-strings</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><figure class="highlight stylus"><table><tr><td class="code"><pre><code class="hljs stylus">dp<span class="hljs-selector-attr">[i]</span><span class="hljs-selector-attr">[j]</span> è¡¨ç¤ºç»™çœ‹word1å‰iä¸ªï¼Œword2å‰jä¸ªï¼Œæœ€å°‘åˆ é™¤å¤šå°‘å¯ä»¥ç›¸åŒ<br><br><span class="hljs-selector-tag">i</span>,jç»“å°¾å€¼åˆ†ç±»è®¨è®º<br>å¦‚æœword1<span class="hljs-selector-attr">[i]</span>===word2<span class="hljs-selector-attr">[j]</span>  dp<span class="hljs-selector-attr">[i]</span><span class="hljs-selector-attr">[j]</span>=dp<span class="hljs-selector-attr">[i-1]</span><span class="hljs-selector-attr">[j-1]</span>  ä¸åˆ <br>å¦‚æœword1<span class="hljs-selector-attr">[i]</span>!==word2<span class="hljs-selector-attr">[j]</span>  <span class="hljs-built_in">min</span>(dp<span class="hljs-selector-attr">[i-1]</span><span class="hljs-selector-attr">[j]</span>+<span class="hljs-number">1</span>, dp<span class="hljs-selector-attr">[i]</span><span class="hljs-selector-attr">[j-1]</span>+<span class="hljs-number">1</span>) åˆ <span class="hljs-number">1</span>ä¸ª<br><br>åˆå§‹åŒ–<br>dp<span class="hljs-selector-attr">[i]</span><span class="hljs-selector-attr">[0]</span>=<span class="hljs-selector-tag">i</span>, dp<span class="hljs-selector-attr">[0]</span><span class="hljs-selector-attr">[i]</span>=<span class="hljs-selector-tag">i</span><br><br>æ»šåŠ¨æ•°ç»„ç©ºé—´ä¼˜åŒ–<br></code></pre></td></tr></table></figure>



<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">minDistance</span>(<span class="hljs-params">word1: <span class="hljs-built_in">string</span>, word2: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">number</span> &#123;<br>  <span class="hljs-keyword">let</span> n = word1.<span class="hljs-property">length</span>,<br>    m = word2.<span class="hljs-property">length</span>;<br>  <span class="hljs-keyword">let</span> dp = <span class="hljs-title class_">Array</span>(n + <span class="hljs-number">1</span>)<br>    .<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>)<br>    .<span class="hljs-title function_">map</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Array</span>(m + <span class="hljs-number">1</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>));<br><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= n; i++) dp[i][<span class="hljs-number">0</span>] = i;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt;= m; j++) dp[<span class="hljs-number">0</span>][j] = j;<br><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">1</span>; j &lt;= m; j++) &#123;<br>      <span class="hljs-keyword">if</span> (word1[i - <span class="hljs-number">1</span>] === word2[j - <span class="hljs-number">1</span>]) &#123;<br>        dp[i][j] = dp[i - <span class="hljs-number">1</span>][j - <span class="hljs-number">1</span>];<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        dp[i][j] = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(dp[i - <span class="hljs-number">1</span>][j], dp[i][j - <span class="hljs-number">1</span>]) + <span class="hljs-number">1</span>;<br>      &#125;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> dp[n][m];<br>&#125;<br><br></code></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">minDistance</span>(<span class="hljs-params">word1: <span class="hljs-built_in">string</span>, word2: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">number</span> &#123;<br>  <span class="hljs-keyword">let</span> n = word1.<span class="hljs-property">length</span>,<br>    m = word2.<span class="hljs-property">length</span>;<br>  <span class="hljs-comment">// ç©ºé—´ä¼˜åŒ–</span><br>  <span class="hljs-keyword">let</span> dp = <span class="hljs-title class_">Array</span>(<span class="hljs-number">2</span>)<br>    .<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>)<br>    .<span class="hljs-title function_">map</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Array</span>(m + <span class="hljs-number">1</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>));<br><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= n; i++) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt;= m; j++) &#123;<br>      <span class="hljs-keyword">if</span> (i === <span class="hljs-number">0</span> || j === <span class="hljs-number">0</span>) &#123;<br>        dp[i % <span class="hljs-number">2</span>][j] = i + j;<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (word1[i - <span class="hljs-number">1</span>] === word2[j - <span class="hljs-number">1</span>]) &#123;<br>        dp[i % <span class="hljs-number">2</span>][j] = dp[(i - <span class="hljs-number">1</span>) % <span class="hljs-number">2</span>][j - <span class="hljs-number">1</span>];<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        dp[i % <span class="hljs-number">2</span>][j] = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(dp[(i - <span class="hljs-number">1</span>) % <span class="hljs-number">2</span>][j], dp[i % <span class="hljs-number">2</span>][j - <span class="hljs-number">1</span>]) + <span class="hljs-number">1</span>;<br>      &#125;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> dp[n % <span class="hljs-number">2</span>][m];<br>&#125;<br><br></code></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode61</title>
    <url>/posts/911773c.html</url>
    <content><![CDATA[<h3 id="61-æ—‹è½¬é“¾è¡¨"><a href="#61-æ—‹è½¬é“¾è¡¨" class="headerlink" title="61. æ—‹è½¬é“¾è¡¨"></a><a href="https://leetcode.cn/problems/rotate-list/description/">61. æ—‹è½¬é“¾è¡¨</a></h3><p>ç»™ä½ ä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ head ï¼Œæ—‹è½¬é“¾è¡¨ï¼Œå°†é“¾è¡¨æ¯ä¸ªèŠ‚ç‚¹å‘å³ç§»åŠ¨ k ä¸ªä½ç½®ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥ï¼šhead &#x3D; [1,2,3,4,5], k &#x3D; 2<br>è¾“å‡ºï¼š[4,5,1,2,3]</p>
<p>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥ï¼šhead &#x3D; [0,1,2], k &#x3D; 4<br>è¾“å‡ºï¼š[2,0,1]</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Definition for singly-linked list.</span><br><span class="hljs-comment"> * function ListNode(val, next) &#123;</span><br><span class="hljs-comment"> *     this.val = (val===undefined ? 0 : val)</span><br><span class="hljs-comment"> *     this.next = (next===undefined ? null : next)</span><br><span class="hljs-comment"> * &#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">ListNode</span>&#125; <span class="hljs-variable">head</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">number</span>&#125; <span class="hljs-variable">k</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> &#123;<span class="hljs-type">ListNode</span>&#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">var</span> rotateRight = <span class="hljs-keyword">function</span> (<span class="hljs-params">head, k</span>) &#123;<br>    <span class="hljs-comment">// æ³¨æ„kå¯èƒ½æ¯”æ€»é•¿åº¦è¿˜å¤§</span><br>    <span class="hljs-keyword">let</span> total = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">let</span> p = head<br>    <span class="hljs-keyword">while</span> (p) &#123;<br>        total++<br>        p = p.<span class="hljs-property">next</span><br>    &#125;<br><br>    k = k % total<br>    <span class="hljs-keyword">if</span> (k === <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">return</span> head<br>    &#125;<br><br>    <span class="hljs-comment">// å¿«æ…¢æŒ‡é’ˆï¼Œæ‰¾åˆ°å€’æ•°kå…ƒç´ å‰ä¸€ä¸ªä½ç½®</span><br>    <span class="hljs-keyword">let</span> dummyHead = &#123; <span class="hljs-attr">next</span>: head &#125;<br>    <span class="hljs-keyword">let</span> fast = dummyHead<br>    <span class="hljs-keyword">while</span> (k--) &#123;<br>        fast = fast.<span class="hljs-property">next</span><br>    &#125;<br><br>    <span class="hljs-keyword">let</span> slow = dummyHead<br>    <span class="hljs-keyword">while</span> (fast?.<span class="hljs-property">next</span>) &#123;<br>        slow = slow.<span class="hljs-property">next</span><br>        fast = fast.<span class="hljs-property">next</span><br>    &#125;<br><br>    <span class="hljs-comment">// å°†ååŠéƒ¨ç§»åŠ¨åˆ°æœ€å¼€å¤´</span><br>    dummyHead.<span class="hljs-property">next</span> = slow.<span class="hljs-property">next</span><br>    fast.<span class="hljs-property">next</span> = head<br>    slow.<span class="hljs-property">next</span> = <span class="hljs-literal">null</span><br><br>    <span class="hljs-keyword">return</span> dummyHead.<span class="hljs-property">next</span><br>&#125;;<br></code></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode75</title>
    <url>/posts/17678264.html</url>
    <content><![CDATA[<h3 id="75-é¢œè‰²åˆ†ç±»"><a href="#75-é¢œè‰²åˆ†ç±»" class="headerlink" title="75. é¢œè‰²åˆ†ç±»"></a><a href="https://leetcode.cn/problems/sort-colors/">75. é¢œè‰²åˆ†ç±»</a></h3><p>ç»™å®šä¸€ä¸ªåŒ…å«çº¢è‰²ã€ç™½è‰²å’Œè“è‰²ã€å…± n ä¸ªå…ƒç´ çš„æ•°ç»„ nums ï¼ŒåŸåœ°å¯¹å®ƒä»¬è¿›è¡Œæ’åºï¼Œä½¿å¾—ç›¸åŒé¢œè‰²çš„å…ƒç´ ç›¸é‚»ï¼Œå¹¶æŒ‰ç…§çº¢è‰²ã€ç™½è‰²ã€è“è‰²é¡ºåºæ’åˆ—ã€‚</p>
<p>æˆ‘ä»¬ä½¿ç”¨æ•´æ•° 0ã€ 1 å’Œ 2 åˆ†åˆ«è¡¨ç¤ºçº¢è‰²ã€ç™½è‰²å’Œè“è‰²ã€‚</p>
<p>å¿…é¡»åœ¨ä¸ä½¿ç”¨åº“å†…ç½®çš„ sort å‡½æ•°çš„æƒ…å†µä¸‹è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><code class="hljs accesslog">è¾“å…¥ï¼šnums = <span class="hljs-string">[2,0,2,1,1,0]</span><br>è¾“å‡ºï¼š<span class="hljs-string">[0,0,1,1,2,2]</span><br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 2ï¼š</p>
<figure class="highlight inform7"><table><tr><td class="code"><pre><code class="hljs inform7">è¾“å…¥ï¼šnums = <span class="hljs-comment">[2,0,1]</span><br>è¾“å‡ºï¼š<span class="hljs-comment">[0,1,2]</span><br></code></pre></td></tr></table></figure>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/sort-colors">https://leetcode.cn/problems/sort-colors</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><figure class="highlight css"><table><tr><td class="code"><pre><code class="hljs css">ç»´æŠ¤<span class="hljs-selector-tag">i</span>çš„å·¦è¾¹ä¸åŒ…æ‹¬<span class="hljs-selector-tag">i</span>ä½ç½®å…ƒç´ ï¼Œéƒ½æ˜¯<span class="hljs-number">0</span><br>ç»´æŠ¤kçš„å³è¾¹ä¸åŒ…æ‹¬kä½ç½®å…ƒç´ ï¼Œéƒ½æ˜¯<span class="hljs-number">1</span><br>éš”æ¿<br><br></code></pre></td></tr></table></figure>



<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">sortColors</span>(<span class="hljs-params">nums: <span class="hljs-built_in">number</span>[]</span>): <span class="hljs-built_in">void</span> &#123;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">swap</span>(<span class="hljs-params">i: <span class="hljs-built_in">number</span>, j: <span class="hljs-built_in">number</span></span>) &#123;<br>    <span class="hljs-keyword">let</span> t = nums[i];<br>    nums[i] = nums[j];<br>    nums[j] = t;<br>  &#125;<br><br>  <span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>,<br>    j = <span class="hljs-number">0</span>,<br>    k = nums.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">while</span> (j &lt;= k) &#123;<br>    <span class="hljs-keyword">let</span> current = nums[j];<br>    <span class="hljs-keyword">if</span> (current === <span class="hljs-number">0</span>) &#123;<br>      <span class="hljs-title function_">swap</span>(i, j);<br>      i++;<br>      j++;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (current === <span class="hljs-number">1</span>) &#123;<br>      j++;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title function_">swap</span>(j, k);<br>      k--;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode77</title>
    <url>/posts/f969e348.html</url>
    <content><![CDATA[<h3 id="77-ç»„åˆ"><a href="#77-ç»„åˆ" class="headerlink" title="77. ç»„åˆ"></a><a href="https://leetcode.cn/problems/combinations/">77. ç»„åˆ</a></h3><p>ç»™å®šä¸¤ä¸ªæ•´æ•° n å’Œ kï¼Œè¿”å›èŒƒå›´ [1, n] ä¸­æ‰€æœ‰å¯èƒ½çš„ k ä¸ªæ•°çš„ç»„åˆã€‚</p>
<p>ä½ å¯ä»¥æŒ‰ ä»»ä½•é¡ºåº è¿”å›ç­”æ¡ˆã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<figure class="highlight inform7"><table><tr><td class="code"><pre><code class="hljs inform7">è¾“å…¥ï¼šn = 4, k = 2<br>è¾“å‡ºï¼š<br><span class="hljs-comment">[</span><br><span class="hljs-comment">  <span class="hljs-comment">[2,4]</span>,</span><br><span class="hljs-comment">  <span class="hljs-comment">[3,4]</span>,</span><br><span class="hljs-comment">  <span class="hljs-comment">[2,3]</span>,</span><br><span class="hljs-comment">  <span class="hljs-comment">[1,2]</span>,</span><br><span class="hljs-comment">  <span class="hljs-comment">[1,3]</span>,</span><br><span class="hljs-comment">  <span class="hljs-comment">[1,4]</span>,</span><br><span class="hljs-comment">]</span><br></code></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 2ï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><code class="hljs lua">è¾“å…¥ï¼šn = <span class="hljs-number">1</span>, k = <span class="hljs-number">1</span><br>è¾“å‡ºï¼š<span class="hljs-string">[[1]]</span><br></code></pre></td></tr></table></figure>

<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/combinations">https://leetcode.cn/problems/combinations</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><img src="/pic/select.png" />

<figure class="highlight"><table><tr><td class="code"><pre><code class="hljs">ç¬¬ä¸€å±‚è¡¨ç¤ºç¬¬ä¸€ä¸ªä½ç½®èƒ½é€‰æ‹©1,2ï¼Œ3<br>é€‰è¿‡1åçš„ç¬¬äºŒå±‚ï¼Œè¡¨ç¤ºç¬¬äºŒä¸ªä½ç½®èƒ½é€‰æ‹©2,3<br><br>ç¬¬ä¸€ä¸ªä½ç½®é€‰æ‹©äº†2ï¼Œç¬¬äºŒä¸ªä½ç½®åªèƒ½é€‰æ‹©3, 1çš„ç»„åˆå·²ç»å½•å…¥å®Œäº†<br>ç»„åˆå°±æ˜¯  æ‰€æœ‰æ¯”å®ƒä½ç½®å¤§çš„åˆ†å‰å‡ºæ¥<br></code></pre></td></tr></table></figure>



<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">combine</span>(<span class="hljs-params">n: <span class="hljs-built_in">number</span>, k: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span>[][] &#123;<br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">res</span>: <span class="hljs-built_in">number</span>[][] = [];<br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">path</span>: <span class="hljs-built_in">number</span>[] = [];<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">start: <span class="hljs-built_in">number</span>, len: <span class="hljs-built_in">number</span></span>) &#123;<br>    <span class="hljs-keyword">if</span> (len === k) &#123;<br>      res.<span class="hljs-title function_">push</span>([...path]);<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = start; i &lt;= n; i++) &#123;<br>      path.<span class="hljs-title function_">push</span>(i);<br>      <span class="hljs-title function_">dfs</span>(i + <span class="hljs-number">1</span>, len + <span class="hljs-number">1</span>);<br>      path.<span class="hljs-title function_">pop</span>();<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-title function_">dfs</span>(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">return</span> res;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode82</title>
    <url>/posts/e9b0b08.html</url>
    <content><![CDATA[<h3 id="82-åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ -II"><a href="#82-åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ -II" class="headerlink" title="82. åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´  II"></a><a href="https://leetcode.cn/problems/remove-duplicates-from-sorted-list-ii/description/">82. åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´  II</a></h3><p>ç»™å®šä¸€ä¸ªå·²æ’åºçš„é“¾è¡¨çš„å¤´ head ï¼Œ åˆ é™¤åŸå§‹é“¾è¡¨ä¸­æ‰€æœ‰é‡å¤æ•°å­—çš„èŠ‚ç‚¹ï¼Œåªç•™ä¸‹ä¸åŒçš„æ•°å­— ã€‚è¿”å› å·²æ’åºçš„é“¾è¡¨ ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥ï¼šhead &#x3D; [1,2,3,3,4,4,5]<br>è¾“å‡ºï¼š[1,2,5]</p>
<p>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥ï¼šhead &#x3D; [1,1,1,2,3]<br>è¾“å‡ºï¼š[2,3]</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Definition for singly-linked list.</span><br><span class="hljs-comment"> * function ListNode(val, next) &#123;</span><br><span class="hljs-comment"> *     this.val = (val===undefined ? 0 : val)</span><br><span class="hljs-comment"> *     this.next = (next===undefined ? null : next)</span><br><span class="hljs-comment"> * &#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">ListNode</span>&#125; <span class="hljs-variable">head</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> &#123;<span class="hljs-type">ListNode</span>&#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">var</span> deleteDuplicates = <span class="hljs-keyword">function</span> (<span class="hljs-params">head</span>) &#123;<br>    <span class="hljs-keyword">let</span> dummyHead = &#123; <span class="hljs-attr">next</span>: head &#125;<br>    <span class="hljs-keyword">let</span> p = dummyHead <span class="hljs-comment">// å·²å¤„ç†å®Œçš„é“¾è¡¨çš„å°¾éƒ¨</span><br>    <span class="hljs-keyword">while</span> (p) &#123;<br>        <span class="hljs-keyword">let</span> count = <span class="hljs-number">1</span> <span class="hljs-comment">// nullä¹Ÿæ˜¯1ä¸ªèŠ‚ç‚¹ï¼Œcountç®—1</span><br>        <span class="hljs-keyword">let</span> cur = p.<span class="hljs-property">next</span>;<br>        <span class="hljs-keyword">while</span> (cur &amp;&amp; cur.<span class="hljs-property">next</span>?.<span class="hljs-property">val</span> === cur.<span class="hljs-property">val</span>) &#123;<br>            count++<br>            cur = cur.<span class="hljs-property">next</span><br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">1</span>) &#123;<br>            p.<span class="hljs-property">next</span> = cur.<span class="hljs-property">next</span><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            p = cur<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> dummyHead.<span class="hljs-property">next</span><br>&#125;;<br></code></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>ä¸­é—´ä»¶æ¨¡å¼</title>
    <url>/posts/ee084ea8.html</url>
    <content><![CDATA[<h2 id="ã€è¯‘ã€‘ä¸­é—´ä»¶æ¨¡å¼Mediator-Middleware-Pattern"><a href="#ã€è¯‘ã€‘ä¸­é—´ä»¶æ¨¡å¼Mediator-Middleware-Pattern" class="headerlink" title="ã€è¯‘ã€‘ä¸­é—´ä»¶æ¨¡å¼Mediator&#x2F;Middleware Pattern"></a>ã€è¯‘ã€‘ä¸­é—´ä»¶æ¨¡å¼<a href="https://www.patterns.dev/vanilla/mediator-pattern">Mediator&#x2F;Middleware Pattern</a></h2><p><img src="/pic/mul-com.png" alt="many-part"> <img src="/pic/single-store.png" alt="single-mediator"></p>
<p>ä¸­ä»‹è€…æ¨¡å¼ä½¿ç»„ä»¶èƒ½å¤Ÿé€šè¿‡ä¸€ä¸ªä¸­å¿ƒç‚¹ï¼ˆä¸­ä»‹è€…ï¼‰ç›¸äº’äº¤äº’ã€‚ç»„ä»¶ä¸ç›´æ¥ç›¸äº’é€šä¿¡ï¼Œè€Œæ˜¯å°†è¯·æ±‚å‘é€ç»™ä¸­ä»‹è€…ï¼Œç”±ä¸­ä»‹è€…è¿›è¡Œè½¬å‘ï¼åœ¨JavaScriptä¸­ï¼Œä¸­ä»‹è€…é€šå¸¸åªæ˜¯ä¸€ä¸ªå¯¹è±¡å­—é¢é‡æˆ–ä¸€ä¸ªå‡½æ•°ã€‚</p>
<p>æ‚¨å¯ä»¥å°†è¿™ç§æ¨¡å¼ä¸ç©ºä¸­äº¤é€šç®¡åˆ¶å‘˜å’Œé£è¡Œå‘˜ä¹‹é—´çš„å…³ç³»è¿›è¡Œæ¯”è¾ƒã€‚é£è¡Œå‘˜ä¸ç›´æ¥ç›¸äº’äº¤æµï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ··ä¹±ï¼Œè€Œæ˜¯ä¸ç©ºä¸­äº¤é€šç®¡åˆ¶å‘˜äº¤æµã€‚ç©ºä¸­äº¤é€šç®¡åˆ¶å‘˜ç¡®ä¿æ‰€æœ‰é£æœºéƒ½è·å¾—å®ƒä»¬éœ€è¦çš„ä¿¡æ¯ï¼Œä»¥ç¡®ä¿å®‰å…¨é£è¡Œï¼Œé¿å…ä¸å…¶ä»–é£æœºç›¸æ’ã€‚</p>
<p>è™½ç„¶æˆ‘ä»¬å¸Œæœ›ä¸ä¼šåœ¨JavaScriptä¸­æ§åˆ¶é£æœºï¼Œä½†æˆ‘ä»¬ç»å¸¸éœ€è¦å¤„ç†å¯¹è±¡ä¹‹é—´çš„å¤šå‘æ•°æ®ã€‚å¦‚æœç»„ä»¶æ•°é‡å¾ˆå¤§ï¼Œç»„ä»¶ä¹‹é—´çš„é€šä¿¡å¯èƒ½ä¼šå˜å¾—ç›¸å½“æ··ä¹±ã€‚</p>
<p>ä¸è®©æ¯ä¸ªå¯¹è±¡ç›´æ¥ç›¸äº’é€šä¿¡ï¼Œå¯¼è‡´å¤šå¯¹å¤šçš„å…³ç³»ä¸åŒï¼Œå¯¹è±¡çš„è¯·æ±‚ç”±ä¸­ä»‹è€…å¤„ç†ã€‚ä¸­ä»‹è€…å¤„ç†è¿™ä¸ªè¯·æ±‚ï¼Œå¹¶å°†å…¶å‘é€åˆ°éœ€è¦çš„ä½ç½®ã€‚</p>
<p>ä¸­ä»‹è€…æ¨¡å¼çš„ä¸€ä¸ªå¾ˆå¥½çš„åº”ç”¨æ¡ˆä¾‹æ˜¯èŠå¤©å®¤ï¼èŠå¤©å®¤ä¸­çš„ç”¨æˆ·ä¸ä¼šç›´æ¥ç›¸äº’äº¤æµã€‚ç›¸åï¼ŒèŠå¤©å®¤å……å½“ç”¨æˆ·ä¹‹é—´çš„ä¸­ä»‹è€…ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åˆ›å»ºè¿æ¥åˆ°èŠå¤©å®¤çš„æ–°ç”¨æˆ·ã€‚æ¯ä¸ªç”¨æˆ·å®ä¾‹éƒ½æœ‰ä¸€ä¸ªsendæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥å‘é€æ¶ˆæ¯ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ChatRoom</span> &#123;<br>  <span class="hljs-title function_">logMessage</span>(<span class="hljs-params">user, message</span>) &#123;<br>    <span class="hljs-keyword">const</span> sender = user.<span class="hljs-title function_">getName</span>();<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toLocaleString()&#125;</span> [<span class="hljs-subst">$&#123;sender&#125;</span>]: <span class="hljs-subst">$&#123;message&#125;</span>`</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name, chatroom</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">chatroom</span> = chatroom;<br>  &#125;<br><br>  <span class="hljs-title function_">getName</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>;<br>  &#125;<br><br>  <span class="hljs-title function_">send</span>(<span class="hljs-params">message</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">chatroom</span>.<span class="hljs-title function_">logMessage</span>(<span class="hljs-variable language_">this</span>, message);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> chatroom = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatRoom</span>();<br><br><span class="hljs-keyword">const</span> user1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;John Doe&quot;</span>, chatroom);<br><span class="hljs-keyword">const</span> user2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;Jane Doe&quot;</span>, chatroom);<br><br>user1.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;Hi there!&quot;</span>);<br>user2.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;Hey!&quot;</span>);<br><br></code></pre></td></tr></table></figure>

<h3 id="æ¡ˆä¾‹ç ”ç©¶"><a href="#æ¡ˆä¾‹ç ”ç©¶" class="headerlink" title="æ¡ˆä¾‹ç ”ç©¶"></a>æ¡ˆä¾‹ç ”ç©¶</h3><p>Express.jsæ˜¯ä¸€ä¸ªæµè¡Œçš„Webåº”ç”¨ç¨‹åºæœåŠ¡å™¨æ¡†æ¶ã€‚æˆ‘ä»¬å¯ä»¥ä¸ºç”¨æˆ·è®¿é—®çš„ç‰¹å®šè·¯ç”±æ·»åŠ å›è°ƒå‡½æ•°ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æƒ³åœ¨ç”¨æˆ·è®¿é—®æ ¹è·¯å¾„â€™&#x2F;â€˜æ—¶å‘è¯·æ±‚æ·»åŠ ä¸€ä¸ªå¤´éƒ¨ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªä¸­é—´ä»¶å›è°ƒå‡½æ•°ä¸­æ·»åŠ è¿™ä¸ªå¤´éƒ¨ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> app = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>)();<br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> &#123;<br>  req.<span class="hljs-property">headers</span>[<span class="hljs-string">&quot;test-header&quot;</span>] = <span class="hljs-number">1234</span>;<br>  <span class="hljs-title function_">next</span>();<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>nextæ–¹æ³•è°ƒç”¨è¯·æ±‚-å“åº”å‘¨æœŸä¸­çš„ä¸‹ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚æˆ‘ä»¬å®é™…ä¸Šæ­£åœ¨åˆ›å»ºä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°é“¾ï¼Œå®ƒä½äºè¯·æ±‚å’Œå“åº”ä¹‹é—´.</p>
<p>è®©æˆ‘ä»¬æ·»åŠ å¦ä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°ï¼Œæ£€æŸ¥æ˜¯å¦æ­£ç¡®æ·»åŠ äº†test-headerã€‚å‰ä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°æ·»åŠ çš„æ›´æ”¹å°†åœ¨æ•´ä¸ªé“¾ä¸­å¯è§ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> app = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>)();<br><br>app.<span class="hljs-title function_">use</span>(<br>  <span class="hljs-string">&quot;/&quot;</span>,<br>  <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> &#123;<br>    req.<span class="hljs-property">headers</span>[<span class="hljs-string">&quot;test-header&quot;</span>] = <span class="hljs-number">1234</span>;<br>    <span class="hljs-title function_">next</span>();<br>  &#125;,<br>  <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Request has test header: <span class="hljs-subst">$&#123;!!req.headers[<span class="hljs-string">&quot;test-header&quot;</span>]&#125;</span>`</span>);<br>    <span class="hljs-title function_">next</span>();<br>  &#125;<br>);<br></code></pre></td></tr></table></figure>

<p>å®Œç¾ï¼æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªæˆ–å¤šä¸ªä¸­é—´ä»¶å‡½æ•°è·Ÿè¸ªå’Œä¿®æ”¹è¯·æ±‚å¯¹è±¡ï¼Œç›´åˆ°å“åº”ä¸ºæ­¢ã€‚</p>
<p>æ¯å½“ç”¨æˆ·è®¿é—®æ ¹ç«¯ç‚¹â€™&#x2F;â€˜æ—¶ï¼Œè¿™ä¸¤ä¸ªä¸­é—´ä»¶å›è°ƒå‡½æ•°å°†è¢«è°ƒç”¨ã€‚</p>
<h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><p>ä¸­é—´ä»¶æ¨¡å¼ä½¿æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡è®©æ‰€æœ‰é€šä¿¡æµç»ä¸€ä¸ªä¸­å¿ƒç‚¹æ¥ç®€åŒ–å¯¹è±¡ä¹‹é—´çš„å¤šå¯¹å¤šå…³ç³»ã€‚</p>
]]></content>
      <categories>
        <category>Patterns</category>
      </categories>
  </entry>
  <entry>
    <title>nodejså†…å­˜é—®é¢˜æ’æŸ¥</title>
    <url>/posts/c1f90a33.html</url>
    <content><![CDATA[<h3 id="ç›‘æ§é‡‡é›†"><a href="#ç›‘æ§é‡‡é›†" class="headerlink" title="ç›‘æ§é‡‡é›†"></a>ç›‘æ§é‡‡é›†</h3><h4 id="event-loop-delay"><a href="#event-loop-delay" class="headerlink" title="event loop delay"></a>event loop delay</h4><p>åœ¨ Node.js ä¸­ï¼Œäº‹ä»¶å¾ªç¯æ˜¯ä¸€ä¸ªæ— é™å¾ªç¯ï¼Œå®ƒä¼šä¸æ–­åœ°æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„äº‹ä»¶éœ€è¦å¤„ç†ã€‚å¦‚æœæœ‰ï¼Œå®ƒå°±ä¼šå–å‡ºäº‹ä»¶å¹¶æ‰§è¡Œç›¸åº”çš„å›è°ƒå‡½æ•°ã€‚ç„¶åï¼Œå®ƒä¼šå†æ¬¡æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„äº‹ä»¶éœ€è¦å¤„ç†ã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šä¸€ç›´é‡å¤ï¼Œç›´åˆ°æ²¡æœ‰æ–°çš„äº‹ä»¶éœ€è¦å¤„ç†ã€‚</p>
<p>Node.js çš„ Event Loop Delay æ˜¯æŒ‡äº‹ä»¶å¾ªç¯åœ¨å¤„ç†å’Œæ‰§è¡Œä»»åŠ¡æ—¶çš„å»¶è¿Ÿæ—¶é—´ã€‚è¿™ä¸ªå»¶è¿Ÿæ—¶é—´æ˜¯ç”±äºäº‹ä»¶å¾ªç¯åœ¨å¤„ç†ä¸€äº›é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡æ—¶ï¼Œæ— æ³•ç«‹å³å¤„ç†æ–°çš„äº‹ä»¶æˆ–ä»»åŠ¡ï¼Œä»è€Œå¯¼è‡´çš„å»¶è¿Ÿã€‚</p>
<blockquote>
<p>åŒæ­¥ä»£ç æ‰§è¡Œæ—¶é—´å¾ˆé•¿ï¼ŒCPU å¯†é›†å‹ä»»åŠ¡ï¼Œå¯ä»¥é€šè¿‡å­è¿›ç¨‹(child_process)æˆ–è€…å¤šè¿›ç¨‹(cluster)è¿›è¡Œä¼˜åŒ–</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>);<br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<br><span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span>;<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/api/hello&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;Hello, World!&quot;</span> &#125;);<br>&#125;);<br><br>app.<span class="hljs-title function_">listen</span>(port, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Server is running on port <span class="hljs-subst">$&#123;port&#125;</span>`</span>);<br>&#125;);<br><br><span class="hljs-keyword">let</span> stashDelays = [];<br><br><span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> maxDelay = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...stashDelays);<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`max event loop delay per second: <span class="hljs-subst">$&#123;maxDelay&#125;</span>ms`</span>);<br>  stashDelays = [];<br>&#125;, <span class="hljs-number">1000</span>);<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">now</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> ts = process.<span class="hljs-title function_">hrtime</span>();<br>  <span class="hljs-keyword">return</span> ts[<span class="hljs-number">0</span>] * <span class="hljs-number">1e3</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(ts[<span class="hljs-number">1</span>] / <span class="hljs-number">1e6</span>); <span class="hljs-comment">// ms</span><br>&#125;<br><br><span class="hljs-keyword">let</span> prev = <span class="hljs-title function_">now</span>();<br><br><span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> current = <span class="hljs-title function_">now</span>();<br>  <span class="hljs-keyword">const</span> delay = current - prev - <span class="hljs-number">10</span>;<br>  prev = current;<br>  stashDelays.<span class="hljs-title function_">push</span>(delay);<br>&#125;, <span class="hljs-number">10</span>);<br><br><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// æ¨¡æ‹Ÿé˜»å¡æ—¶é—´å¾ªç¯</span><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">isPrime</span>(<span class="hljs-params">num</span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">2</span>, sqrt = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(num); i &lt;= sqrt; i++) &#123;<br>      <span class="hljs-keyword">if</span> (num % i === <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>      &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> num &gt; <span class="hljs-number">1</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">generatePrimeNumbers</span>(<span class="hljs-params">limit</span>) &#123;<br>    <span class="hljs-keyword">const</span> primes = [];<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> num = <span class="hljs-number">2</span>; primes.<span class="hljs-property">length</span> &lt; limit; num++) &#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isPrime</span>(num)) &#123;<br>        primes.<span class="hljs-title function_">push</span>(num);<br>      &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> primes;<br>  &#125;<br><br>  <span class="hljs-title function_">generatePrimeNumbers</span>(<span class="hljs-number">100000</span>);<br>&#125;, <span class="hljs-number">1000</span>);<br></code></pre></td></tr></table></figure>

<h4 id="active-handles"><a href="#active-handles" class="headerlink" title="active handles"></a>active handles</h4><p>active handlesï¼ˆæ´»åŠ¨å¥æŸ„ï¼‰æ˜¯ Node.js äº‹ä»¶å¾ªç¯ä¸­çš„ä¸€ç§æ¦‚å¿µï¼Œç”¨äºè¡¨ç¤ºå½“å‰æ­£åœ¨æ´»åŠ¨ä¸­çš„å¼‚æ­¥æ“ä½œã€‚å®ƒä»¬å¯ä»¥æ˜¯ç½‘ç»œå¥—æ¥å­—ã€æ–‡ä»¶æè¿°ç¬¦ã€å®šæ—¶å™¨æˆ–å…¶ä»–ç±»å‹çš„å¼‚æ­¥æ“ä½œã€‚</p>
<p>åœ¨ Node.js çš„äº‹ä»¶å¾ªç¯ä¸­ï¼Œå½“ä¸€ä¸ªå¼‚æ­¥æ“ä½œè¢«è§¦å‘æ—¶ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªæ´»åŠ¨å¥æŸ„ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°äº‹ä»¶å¾ªç¯ä¸­ã€‚æ´»åŠ¨å¥æŸ„ä¼šç›‘å¬å¼‚æ­¥æ“ä½œçš„å®ŒæˆçŠ¶æ€ï¼Œå¹¶åœ¨æ“ä½œå®Œæˆåè§¦å‘ç›¸åº”çš„å›è°ƒå‡½æ•°ã€‚</p>
<p>æ´»åŠ¨å¥æŸ„çš„å­˜åœ¨ä½¿å¾— Node.js èƒ½å¤ŸåŒæ—¶å¤„ç†å¤šä¸ªå¼‚æ­¥æ“ä½œï¼Œè€Œä¸éœ€è¦é˜»å¡æˆ–ç­‰å¾…æ¯ä¸ªæ“ä½œçš„å®Œæˆã€‚å®ƒä»¬å…è®¸ Node.js åœ¨ç­‰å¾…æŸäº›æ“ä½œå®Œæˆçš„åŒæ—¶ï¼Œç»§ç»­å¤„ç†å…¶ä»–ä»»åŠ¡ï¼Œæé«˜äº†åº”ç”¨ç¨‹åºçš„å¹¶å‘æ€§èƒ½å’Œå“åº”èƒ½åŠ›ã€‚</p>
<p>æ´»åŠ¨å¥æŸ„çš„ç”¨é€”åŒ…æ‹¬ä½†ä¸é™äºï¼š</p>
<ul>
<li><p>ç½‘ç»œé€šä¿¡ï¼šæ´»åŠ¨å¥æŸ„å¯ä»¥ç”¨äºå¤„ç†ç½‘ç»œå¥—æ¥å­—çš„è¯»å†™æ“ä½œï¼Œå®ç°é«˜æ€§èƒ½çš„ç½‘ç»œé€šä¿¡ã€‚</p>
</li>
<li><p>æ–‡ä»¶æ“ä½œï¼šæ´»åŠ¨å¥æŸ„å¯ä»¥ç”¨äºå¤„ç†æ–‡ä»¶çš„è¯»å†™æ“ä½œï¼Œå®ç°å¼‚æ­¥çš„æ–‡ä»¶æ“ä½œã€‚</p>
</li>
<li><p>å®šæ—¶å™¨ï¼šæ´»åŠ¨å¥æŸ„å¯ä»¥ç”¨äºå¤„ç†å®šæ—¶å™¨çš„è§¦å‘å’Œå›è°ƒå‡½æ•°çš„æ‰§è¡Œï¼Œå®ç°å®šæ—¶ä»»åŠ¡å’Œå»¶è¿Ÿæ“ä½œã€‚</p>
</li>
<li><p>è¿›ç¨‹é—´é€šä¿¡ï¼šæ´»åŠ¨å¥æŸ„å¯ä»¥ç”¨äºå¤„ç†è¿›ç¨‹é—´é€šä¿¡çš„ç®¡é“æˆ–æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ç°å¼‚æ­¥çš„è¿›ç¨‹é—´é€šä¿¡ã€‚</p>
</li>
<li><p>å…¶ä»–å¼‚æ­¥æ“ä½œï¼šæ´»åŠ¨å¥æŸ„è¿˜å¯ä»¥ç”¨äºå¤„ç†å…¶ä»–ç±»å‹çš„å¼‚æ­¥æ“ä½œï¼Œä¾‹å¦‚æ•°æ®åº“æŸ¥è¯¢ã€HTTP è¯·æ±‚ç­‰ã€‚</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>);<br><span class="hljs-keyword">var</span> wtf = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;wtfnode&quot;</span>);<br><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<br><span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span>;<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/api/hello&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;Hello, World!&quot;</span> &#125;);<br>&#125;);<br><br>app.<span class="hljs-title function_">listen</span>(port, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Server is running on port <span class="hljs-subst">$&#123;port&#125;</span>`</span>);<br>&#125;);<br><br>wtf.<span class="hljs-title function_">init</span>();<br>wtf.<span class="hljs-title function_">setLogger</span>(<span class="hljs-string">&quot;info&quot;</span>, <span class="hljs-function">(<span class="hljs-params">message, ...optionalParams</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;info: &quot;</span>, message, ...optionalParams);<br>&#125;);<br>wtf.<span class="hljs-title function_">setLogger</span>(<span class="hljs-string">&quot;warn&quot;</span>, <span class="hljs-function">(<span class="hljs-params">message, ...optionalParams</span>) =&gt;</span><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(message, ...optionalParams)<br>);<br>wtf.<span class="hljs-title function_">setLogger</span>(<span class="hljs-string">&quot;error&quot;</span>, <span class="hljs-function">(<span class="hljs-params">message, ...optionalParams</span>) =&gt;</span><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(message, ...optionalParams)<br>);<br><br><span class="hljs-built_in">setInterval</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>  wtf.<span class="hljs-title function_">dump</span>();<br>&#125;, <span class="hljs-number">1000</span>).<span class="hljs-title function_">unref</span>();<br><br></code></pre></td></tr></table></figure>

<h4 id="memory"><a href="#memory" class="headerlink" title="memory"></a>memory</h4><p>process.memoryUsage()æ˜¯Node.jsä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºè·å–å½“å‰è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚å®ƒè¿”å›ä¸€ä¸ªåŒ…å«ä¸åŒå†…å­˜æŒ‡æ ‡çš„å¯¹è±¡ï¼Œç”¨äºç›‘è§†å’Œåˆ†æåº”ç”¨ç¨‹åºçš„å†…å­˜æ¶ˆè€—ã€‚</p>
<p>process.memoryUsage()æ–¹æ³•è¿”å›çš„å¯¹è±¡åŒ…å«ä»¥ä¸‹å±æ€§ï¼š</p>
<ul>
<li>rssï¼ˆResident Set Sizeï¼‰ï¼šè¡¨ç¤ºè¿›ç¨‹å ç”¨çš„å†…å­˜å¤§å°ã€‚</li>
<li>heapTotalï¼šè¡¨ç¤ºV8å¼•æ“åˆ†é…çš„å †å†…å­˜æ€»é‡ã€‚</li>
<li>heapUsedï¼šè¡¨ç¤ºV8å¼•æ“å½“å‰ä½¿ç”¨çš„å †å†…å­˜é‡ã€‚</li>
<li>externalï¼šè¡¨ç¤ºV8å¼•æ“ç®¡ç†çš„å¤–éƒ¨å†…å­˜é‡ï¼Œå¦‚C++ç»‘å®šå’Œç¼“å†²åŒºå¯¹è±¡ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">formatBytes</span> = (<span class="hljs-params">bytes</span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (bytes === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;0B&quot;</span>;<br>  <span class="hljs-keyword">const</span> unit = <span class="hljs-number">1024</span>;<br>  <span class="hljs-keyword">const</span> decimals = <span class="hljs-number">2</span>;<br>  <span class="hljs-keyword">const</span> sizes = [<span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;KB&quot;</span>, <span class="hljs-string">&quot;MB&quot;</span>, <span class="hljs-string">&quot;GB&quot;</span>, <span class="hljs-string">&quot;TB&quot;</span>, <span class="hljs-string">&quot;PB&quot;</span>];<br>  <span class="hljs-keyword">const</span> i = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">log</span>(bytes) / <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">log</span>(unit));<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="hljs-built_in">parseFloat</span>(<span class="hljs-title class_">String</span>(bytes / <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(unit, i))).<span class="hljs-title function_">toFixed</span>(decimals) +<br>    sizes[i] +<br>    <span class="hljs-string">&quot;&quot;</span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">logMem</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> mem = process.<span class="hljs-title function_">memoryUsage</span>();<br><br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">arrayBuffers</span>: <span class="hljs-title function_">formatBytes</span>(mem.<span class="hljs-property">arrayBuffers</span>),<br>    <span class="hljs-attr">external</span>: <span class="hljs-title function_">formatBytes</span>(mem.<span class="hljs-property">external</span>),<br>    <span class="hljs-attr">heapTotal</span>: <span class="hljs-title function_">formatBytes</span>(mem.<span class="hljs-property">heapTotal</span>),<br>    <span class="hljs-attr">heapUsed</span>: <span class="hljs-title function_">formatBytes</span>(mem.<span class="hljs-property">heapUsed</span>),<br>    <span class="hljs-attr">rss</span>: <span class="hljs-title function_">formatBytes</span>(mem.<span class="hljs-property">rss</span>),<br>  &#125;;<br>&#125;;<br></code></pre></td></tr></table></figure>

<h3 id="æ—¥å¿—é‡‡é›†"><a href="#æ—¥å¿—é‡‡é›†" class="headerlink" title="æ—¥å¿—é‡‡é›†"></a>æ—¥å¿—é‡‡é›†</h3><p>AsyncLocalStorageæ˜¯Node.jsçš„ä¸€ä¸ªæ¨¡å—ï¼Œç”¨äºåœ¨å¼‚æ­¥æ“ä½œä¸­å­˜å‚¨å’Œå…±äº«ä¸Šä¸‹æ–‡æ•°æ®ã€‚å®ƒæä¾›äº†ä¸€ç§ç®€å•çš„æ–¹å¼æ¥è·Ÿè¸ªå’Œä¼ é€’ä¸Šä¸‹æ–‡æ•°æ®ï¼Œä»¥ä¾¿åœ¨å¼‚æ­¥æ“ä½œä¸­è®¿é—®å’Œä½¿ç”¨ã€‚</p>
<p>åœ¨ä¼ ç»Ÿçš„Node.jsåº”ç”¨ç¨‹åºä¸­ï¼Œä¸Šä¸‹æ–‡æ•°æ®é€šå¸¸æ˜¯é€šè¿‡å›è°ƒå‡½æ•°å‚æ•°æˆ–å…¨å±€å˜é‡æ¥ä¼ é€’çš„ã€‚ç„¶è€Œï¼Œè¿™ç§æ–¹å¼åœ¨å¤æ‚çš„å¼‚æ­¥æ“ä½œé“¾ä¸­ä¼šå˜å¾—éå¸¸ç¹çå’Œå®¹æ˜“å‡ºé”™ã€‚</p>
<p>AsyncLocalStorageæ¨¡å—é€šè¿‡ä½¿ç”¨async_hooksæ¨¡å—æ¥å®ç°ä¸Šä¸‹æ–‡æ•°æ®çš„è·Ÿè¸ªå’Œä¼ é€’ã€‚å®ƒæä¾›äº†ä»¥ä¸‹ä¸»è¦åŠŸèƒ½ï¼š</p>
<ol>
<li><p>å­˜å‚¨ä¸Šä¸‹æ–‡æ•°æ®ï¼šä½¿ç”¨AsyncLocalStorageçš„runæ–¹æ³•ï¼Œå¯ä»¥å°†ä¸Šä¸‹æ–‡æ•°æ®å­˜å‚¨åœ¨å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ã€‚è¿™æ ·ï¼Œæ— è®ºåœ¨å“ªä¸ªå¼‚æ­¥æ“ä½œä¸­ï¼Œéƒ½å¯ä»¥é€šè¿‡AsyncLocalStorageæ¥è®¿é—®å’Œä½¿ç”¨è¿™äº›æ•°æ®ã€‚</p>
</li>
<li><p>å…±äº«ä¸Šä¸‹æ–‡æ•°æ®ï¼šAsyncLocalStorageçš„ä¸Šä¸‹æ–‡æ•°æ®æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥åœ¨å¼‚æ­¥æ“ä½œé“¾ä¸­å…±äº«ã€‚è¿™æ„å‘³ç€åœ¨å¼‚æ­¥æ“ä½œä¸­åˆ›å»ºçš„æ–°çš„ä¸Šä¸‹æ–‡æ•°æ®å¯ä»¥åœ¨åç»­çš„å¼‚æ­¥æ“ä½œä¸­è®¿é—®å’Œä½¿ç”¨ã€‚</p>
</li>
<li><p>å¼‚æ­¥æ“ä½œé“¾ä¸­çš„ä¸Šä¸‹æ–‡ä¼ é€’ï¼šåœ¨å¼‚æ­¥æ“ä½œé“¾ä¸­ï¼ŒAsyncLocalStorageä¼šè‡ªåŠ¨å°†ä¸Šä¸‹æ–‡æ•°æ®ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¼‚æ­¥æ“ä½œã€‚è¿™æ ·ï¼Œä½ æ— éœ€æ‰‹åŠ¨ä¼ é€’ä¸Šä¸‹æ–‡æ•°æ®ï¼Œè€Œæ˜¯å¯ä»¥åœ¨ä»»ä½•å¼‚æ­¥æ“ä½œä¸­ç›´æ¥è®¿é—®å®ƒä»¬ã€‚</p>
</li>
</ol>
<p>AsyncLocalStorageæ¨¡å—åœ¨å¤„ç†å¼‚æ­¥æ“ä½œæ—¶éå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†è¯·æ±‚-å“åº”å‘¨æœŸä¸­çš„ä¸Šä¸‹æ–‡æ•°æ®æ—¶ï¼Œé€‚åˆè¿½è¸ªå¼‚æ­¥è¿‡ç¨‹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">AsyncLocalStorage</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;async_hooks&#x27;</span>;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> storage = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncLocalStorage</span>&lt;any&gt;();<br><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Injectable</span>, <span class="hljs-title class_">NestMiddleware</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/common&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Request</span>, <span class="hljs-title class_">Response</span>, <span class="hljs-title class_">NextFunction</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;express&#x27;</span>;<br><br>@<span class="hljs-title class_">Injectable</span>()<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggerMiddleware</span> implements <span class="hljs-title class_">NestMiddleware</span> &#123;<br>  <span class="hljs-title function_">use</span>(<span class="hljs-params">req: Request, res: Response, next: NextFunction</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Request: <span class="hljs-subst">$&#123;req.method&#125;</span> <span class="hljs-subst">$&#123;req.url&#125;</span>`</span>);<br>    storage.<span class="hljs-title function_">run</span>(<br>        &#123;<br>          <span class="hljs-attr">traceId</span>: <span class="hljs-title function_">uuidv4</span>(),<br>        &#125;,<br>        <span class="hljs-function">() =&gt;</span> &#123;<br>          <span class="hljs-title function_">next</span>()<br>        &#125;<br>    )<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h3 id="å‹æµ‹"><a href="#å‹æµ‹" class="headerlink" title="å‹æµ‹"></a>å‹æµ‹</h3><ol>
<li>å®‰è£… Autocannonï¼šåœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å…¨å±€å®‰è£… Autocannonï¼š</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">npm install -g autocannon<br></code></pre></td></tr></table></figure>

<ol start="2">
<li><p>è¿è¡Œ Autocannonï¼šåœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥ä½¿ç”¨ Autocannon è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼š<br><code>autocannon -c &lt;connections&gt; -d &lt;duration&gt; -m &lt;method&gt; &lt;url&gt;</code><br>å…¶ä¸­ï¼Œ<code>&lt;connections&gt;</code>æ˜¯å¹¶å‘è¿æ¥æ•°ï¼Œ<code>&lt;duration&gt;</code>æ˜¯æµ‹è¯•æŒç»­æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ï¼Œ<code>&lt;method&gt;</code>æ˜¯è¯·æ±‚æ–¹æ³• GETã€POSTã€PUTã€DELETEï¼Œ<code>&lt;url&gt;</code>æ˜¯è¦æµ‹è¯•çš„ URLã€‚</p>
</li>
<li><p>æŸ¥çœ‹æµ‹è¯•ç»“æœï¼šAutocannon ä¼šåœ¨æµ‹è¯•ç»“æŸåæä¾›æœ‰å…³è¯·æ±‚å“åº”æ—¶é—´(Latency)ã€ååé‡ QPS(Req&#x2F;Sec)å’Œæ¯ç§’ä¼ è¾“é‡ BPS(Bytes&#x2F;Sec)ç­‰æŒ‡æ ‡çš„å®æ—¶æŠ¥å‘Šã€‚æ‚¨å¯ä»¥æŸ¥çœ‹æŠ¥å‘Šä¸­çš„ Latencyã€Req&#x2F;Sec å’Œ Bytes&#x2F;Sec ç­‰å­—æ®µæ¥è¯„ä¼°æœåŠ¡å™¨çš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚</p>
</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">autocannon -p &#x27;&#123;&quot;name&quot;: &quot;John&quot;, &quot;age&quot;: 30&#125;&#x27; -H &quot;Content-Type: application/json&quot; -m POST http://localhost:3000/api/users<br></code></pre></td></tr></table></figure>

<p><img src="/pic/autocannon.png" alt="autocannon"></p>
<h3 id="ç¼“æ…¢çš„å†…å­˜æ³„éœ²"><a href="#ç¼“æ…¢çš„å†…å­˜æ³„éœ²" class="headerlink" title="ç¼“æ…¢çš„å†…å­˜æ³„éœ²"></a>ç¼“æ…¢çš„å†…å­˜æ³„éœ²</h3><p>è§‚å¯Ÿå†…å­˜å›¾è¡¨ï¼Œå¦‚æœå‘ç°å†…å­˜é€æ­¥ä¸Šå‡æ²¡æœ‰ä¸‹é™ï¼Œå¾ˆå¯èƒ½å­˜åœ¨å†…å­˜æ³„éœ²ã€‚</p>
<p>é¦–å…ˆè¦ç¡®å®šæ˜¯åº”ç”¨nodejsè¿›ç¨‹å ç”¨çš„å†…å­˜è¿‡å¤šï¼Œè¿˜æ˜¯åº”ç”¨é‡Œå¯åŠ¨äº†ç¬¬ä¸‰æ–¹åº“çš„æœåŠ¡å ç”¨äº†å¤§é‡å†…å­˜ã€‚ä¸Šé¢æ”¶é›†å½“å‰è¿›ç¨‹çš„memoryæŒ‡æ ‡å°±æ´¾ä¸Šäº†ç”¨åœºã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>);<br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<br><span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span>;<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/api/hello&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Client</span>(); <span class="hljs-comment">// client start a server</span><br>  res.<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;Hello, World!&quot;</span> &#125;);<br>&#125;);<br><br>app.<span class="hljs-title function_">listen</span>(port, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Server is running on port <span class="hljs-subst">$&#123;port&#125;</span>`</span>);<br>&#125;);<br><br></code></pre></td></tr></table></figure>

<p>ç”±äºæ¯æ¬¡è¯·æ±‚å°±newä¸€ä¸ªclientå®ä¾‹ï¼Œå®ä¾‹çš„èƒŒåä¼šå¯åŠ¨ä¸€ä¸ªæœ¬åœ°serverï¼Œserverä¹Ÿè®¸è¿˜ä¼šæŒç»­å‘é€å¿ƒè·³ä¸ŠæŠ¥ã€‚è¿™ç§å†…å­˜æ³„éœ²å¾€å¾€ä¼´éšç€ç½‘ç»œIOå±…é«˜ä¸ä¸‹ã€‚</p>
<p>å¤§éƒ¨åˆ†çš„å†…å­˜æ³„éœ²å‘ç”Ÿåœ¨è‡ªèº«åº”ç”¨ç¨‹åºè¿›ç¨‹ã€‚å¯ä»¥æå–heapdumpè¿›è¡Œåˆ†æã€‚</p>
<ul>
<li>æå–heapdump</li>
<li>chrome devtoolsåˆ†æ</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">const</span> heapdump = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;heapdump&#x27;</span>);<br><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/extract-heapdump&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> filename = <span class="hljs-string">`heapdump-<span class="hljs-subst">$&#123;<span class="hljs-built_in">Date</span>.now()&#125;</span>.heapsnapshot`</span>;<br>  <br>  <span class="hljs-comment">// æå–heapdumpæ–‡ä»¶</span><br>  heapdump.<span class="hljs-title function_">writeSnapshot</span>(filename, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (err) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Failed to extract heapdump:&#x27;</span>, err);<br>      res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;Failed to extract heapdump&#x27;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Heapdump extracted:&#x27;</span>, filename);<br>      res.<span class="hljs-title function_">download</span>(filename, <span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-comment">// åˆ é™¤ä¸´æ—¶çš„heapdumpæ–‡ä»¶</span><br>        fs.<span class="hljs-title function_">unlink</span>(filename, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>          <span class="hljs-keyword">if</span> (err) &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Failed to delete heapdump file:&#x27;</span>, err);<br>          &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Heapdump file deleted:&#x27;</span>, filename);<br>          &#125;<br>        &#125;);<br>      &#125;);<br>    &#125;<br>  &#125;);<br>&#125;);<br><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Server started on port 3000&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="å†…å­˜æº¢å‡º"><a href="#å†…å­˜æº¢å‡º" class="headerlink" title="å†…å­˜æº¢å‡º"></a>å†…å­˜æº¢å‡º</h3><p>ä½¿ç”¨<code>node-oom-heapdump</code>åº“ï¼Œåœ¨oomæ—¶è‡ªåŠ¨heap dump, ç„¶åä½¿ç”¨chrome devtoolsåˆ†æã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// ç¬é—´oom</span><br><span class="hljs-keyword">let</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);<br><br><span class="hljs-keyword">let</span> oom = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;node-oom-heapdump&quot;</span>)(&#123;<br>    <span class="hljs-attr">heapdumpOnOOM</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-comment">//OOMImplementation: &quot;GC_MONITORING&quot;, // use the old implementation</span><br>    <span class="hljs-attr">addTimestamp</span>: <span class="hljs-literal">false</span><br>&#125;);<br><br><span class="hljs-comment">// è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼Œåœ¨ä¸€å®šæ—¶é—´é—´éš”åè§¦å‘OOM</span><br><span class="hljs-keyword">const</span> intervalId = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// æ¨¡æ‹Ÿå†…å­˜æ³„æ¼ï¼Œä¾‹å¦‚åˆ›å»ºä¸€ä¸ªå¤§æ•°ç»„</span><br>  <span class="hljs-keyword">const</span> largeArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">1000000</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-string">&quot;a&quot;</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">1000</span>));<br>&#125;, <span class="hljs-number">1000</span>);<br><br><br><span class="hljs-comment">// node --max_old_space_size=40 --optimize_for_size a.js</span><br><br></code></pre></td></tr></table></figure>
<p><img src="/pic/chrome-dev.png" alt="chrome devtools"></p>
<h3 id="è¢«æ“ä½œç³»ç»Ÿ-kill"><a href="#è¢«æ“ä½œç³»ç»Ÿ-kill" class="headerlink" title="è¢«æ“ä½œç³»ç»Ÿ kill"></a>è¢«æ“ä½œç³»ç»Ÿ kill</h3><p>externalçš„åˆ†é…è¶…å‡ºç‰©ç†å†…å­˜ä¸Šé™ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†nodejsè¿›ç¨‹killæ‰ã€‚</p>
<blockquote>
<p>ä¾‹å¦‚ï¼šç”±äºè®¡ç®—bugï¼Œä¼ ç»™typeormçš„æŸ¥è¯¢æ¡ä»¶ä¸ºç©ºï¼Œå¯¼è‡´æŸ¥è¯¢äº†æ•´å¼ æ•°æ®è¡¨å›æ¥ã€‚</p>
</blockquote>
<p>è¿™ç§æƒ…å†µä¸‹ï¼Œæ²¡æœ‰æœºä¼šå¯¼å‡ºheap dump, core dumpã€‚æ—¥å¿—ä¹Ÿå°±æ˜¯æœ€æœ‰æ•ˆçš„æ‰‹æ®µäº†ã€‚æ—¥å¿—åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½èƒ½å¤Ÿæä¾›çº¿ç´¢ã€‚</p>
<p>åœ¨åº”ç”¨ç¨‹åºAOPç»Ÿä¸€åŠ æ‹¦æˆªå™¨ï¼Œæ‰“å°æ—¥å¿—ï¼Œæ‰“å°å¼€å§‹å’Œç»“æŸã€‚å¦‚æœå‡ºç°äº†å¼€å§‹ï¼Œæ²¡æœ‰ç»“æŸï¼Œè¯´æ˜è¿™éƒ¨åˆ†æ¥å£é‡Œå­˜åœ¨å¼•å‘é—®é¢˜çš„æ¥å£ã€‚</p>
<p>è¿›ä¸€æ­¥ç»†åˆ†ç­›æŸ¥ï¼Œè¿‡æ»¤ä¸€å°æœºå™¨çš„æ—¥å¿—ï¼Œå°†not endçš„æ¥å£æœ€åä¸€æ¡æ—¥å¿—è¿‡æ»¤å‡ºæ¥ã€‚</p>
<p>æ ¹æ®æ—¥å¿—æœ€ååœé¡¿çš„ä½ç½®ï¼Œæ’æŸ¥é™„è¿‘ä»£ç ï¼Œä¸€èˆ¬æ˜¯åœåœ¨ä¸€ä¸ªè¯»IOæ“ä½œ(æŸ¥è¯¢æ•°æ®åº“ï¼Œä¸‹è½½æ–‡ä»¶ç­‰)å‰ä¸€æ­¥ï¼Œcode reviewå¯ä»¥åŸºæœ¬æ‰¾åˆ°é—®é¢˜ã€‚</p>
]]></content>
      <categories>
        <category>Nodejs</category>
      </categories>
  </entry>
  <entry>
    <title>å¯è§†åŒ–V8å¼•æ“ä¸­çš„å†…å­˜ç®¡ç†</title>
    <url>/posts/695a0b8f.html</url>
    <content><![CDATA[<h2 id="ã€è¯‘ã€‘å¯è§†åŒ–V8å¼•æ“ä¸­çš„å†…å­˜ç®¡ç†Visualizing-memory-management-in-V8-Engine-JavaScript-NodeJS-Deno-WebAssembly"><a href="#ã€è¯‘ã€‘å¯è§†åŒ–V8å¼•æ“ä¸­çš„å†…å­˜ç®¡ç†Visualizing-memory-management-in-V8-Engine-JavaScript-NodeJS-Deno-WebAssembly" class="headerlink" title="ã€è¯‘ã€‘å¯è§†åŒ–V8å¼•æ“ä¸­çš„å†…å­˜ç®¡ç†Visualizing memory management in V8 Engine (JavaScript, NodeJS, Deno, WebAssembly)"></a>ã€è¯‘ã€‘å¯è§†åŒ–V8å¼•æ“ä¸­çš„å†…å­˜ç®¡ç†<a href="https://deepu.tech/memory-management-in-v8/">Visualizing memory management in V8 Engine (JavaScript, NodeJS, Deno, WebAssembly)</a></h2><h2 id="V8å†…å­˜ç»“æ„"><a href="#V8å†…å­˜ç»“æ„" class="headerlink" title="V8å†…å­˜ç»“æ„"></a>V8å†…å­˜ç»“æ„</h2><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹V8å¼•æ“çš„å†…å­˜ç»“æ„æ˜¯ä»€ä¹ˆã€‚ç”±äºJavaScriptæ˜¯å•çº¿ç¨‹çš„ï¼ŒV8ä¹Ÿä¸ºæ¯ä¸ªJavaScriptä¸Šä¸‹æ–‡ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹ï¼Œå› æ­¤å¦‚æœä½ ä½¿ç”¨æœåŠ¡å·¥ä½œçº¿ç¨‹ï¼Œå®ƒå°†ä¸ºæ¯ä¸ªå·¥ä½œçº¿ç¨‹å¯åŠ¨ä¸€ä¸ªæ–°çš„V8è¿›ç¨‹ã€‚è¿è¡Œä¸­çš„ç¨‹åºæ€»æ˜¯ç”±V8è¿›ç¨‹ä¸­åˆ†é…çš„æŸäº›å†…å­˜æ¥è¡¨ç¤ºï¼Œè¿™è¢«ç§°ä¸ºå¸¸é©»é›†ï¼ˆResident Setï¼‰ã€‚è¿™è¿›ä¸€æ­¥è¢«åˆ’åˆ†ä¸ºä»¥ä¸‹ä¸åŒçš„æ®µï¼š<br><img src="/pic/v8-mem.png" alt="v8-mem"></p>
<p>è¿™ä¸æˆ‘ä»¬åœ¨å‰ä¸€ç« ä¸­çœ‹åˆ°çš„JVMå†…å­˜ç»“æ„æœ‰äº›ç›¸ä¼¼ã€‚è®©æˆ‘ä»¬çœ‹çœ‹è¿™äº›ä¸åŒæ®µçš„ç”¨é€”æ˜¯ä»€ä¹ˆï¼š</p>
<h2 id="å †å†…å­˜"><a href="#å †å†…å­˜" class="headerlink" title="å †å†…å­˜"></a>å †å†…å­˜</h2><p>Heapæ˜¯ V8å­˜å‚¨å¯¹è±¡å’ŒåŠ¨æ€æ•°æ®çš„åœ°æ–¹ã€‚å®ƒæ˜¯æœ‰ä¸€å¤§å—å†…å­˜ç©ºé—´ç»„æˆï¼Œå®ƒä¹Ÿæ˜¯Garbage Collectionå·¥ä½œçš„åœ°æ–¹ã€‚</p>
<ul>
<li><p>New Space(æ–°ç”Ÿä»£): å®ƒæ˜¯ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡å­˜å‚¨çš„åœ°æ–¹ã€‚å®ƒæ˜¯é€šè¿‡Scavenger(Minor GC)ç®—æ³•è¿›è¡Œç®¡ç†ã€‚</p>
</li>
<li><p>Old Space(è€ç”Ÿä»£): å½“åœ¨ New Spaceä¿å­˜çš„æ•°æ®ç»è¿‡ä¸¤æ¬¡Scavenger(Minor GC)å¾ªç¯åè¿˜åœ¨æœªè¢«æ¸…é™¤ï¼Œåˆ™ä¼šè¢«ç§»åˆ°æ­¤å¤„ã€‚è¿™é‡Œçš„ç®¡ç†å†…å­˜ç®—æ³•æ˜¯ Major GC(Mark-Sweep &amp; Mark-Compact)ã€‚</p>
<ul>
<li>Old pointer space - åŒ…å«å…·æœ‰æŒ‡å‘å…¶ä»–å¯¹è±¡çš„æŒ‡é’ˆçš„å¹¸å­˜å¯¹è±¡ã€‚</li>
<li>Old data space - åŒ…å«ä»…åŒ…å«æ•°æ®çš„å¯¹è±¡ï¼ˆæ²¡æœ‰æŒ‡å‘å…¶ä»–å¯¹è±¡çš„æŒ‡é’ˆï¼‰ã€‚</li>
</ul>
</li>
<li><p>Large object space(è€ç”Ÿä»£): è¿™é‡Œæ˜¯é‚£äº›å¤§äºå…¶ä»–ç©ºé—´å¤§å°é™åˆ¶çš„å¯¹è±¡æ‰€å­˜åœ¨çš„åœ°æ–¹ã€‚æ¯ä¸ªå¯¹è±¡éƒ½ä¼šè·å¾—è‡ªå·±çš„mmapå†…å­˜åŒºåŸŸã€‚Large Object Space å±äºè€ç”Ÿä»£ï¼Œç®¡ç†å†…å­˜ç®—æ³•æ˜¯ Major GC(Mark-Sweep &amp; Mark-Compact)ã€‚</p>
</li>
<li><p>Code space(è€ç”Ÿä»£): å­˜å‚¨ç€ Just In Time(JIT)ç¼–è¯‘åçš„ä»£ç å—ã€‚è¿™æ˜¯å”¯ä¸€å…·æœ‰å¯æ‰§è¡Œå†…å­˜çš„ç©ºé—´ã€‚</p>
</li>
<li><p>Cell space, property cell space, and map spaceï¼š è¿™äº›åŒºåŸŸå­˜æ”¾Cellã€å±æ€§Cellå’ŒMapï¼Œæ¯ä¸ªåŒºåŸŸå› ä¸ºéƒ½æ˜¯å­˜æ”¾ç›¸åŒå¤§å°çš„å…ƒç´ ï¼Œå› æ­¤å†…å­˜ç»“æ„å¾ˆç®€å•ã€‚</p>
</li>
</ul>
<p>è¿™äº›ç©ºé—´ä¸­çš„æ¯ä¸€ä¸ªéƒ½æ˜¯ç”±ä¸€ç»„é¡µé¢ï¼ˆpagesï¼‰ç»„æˆçš„ã€‚é¡µé¢æ˜¯ä»æ“ä½œç³»ç»Ÿé€šè¿‡mmapåˆ†é…çš„è¿ç»­å†…å­˜å—ã€‚é™¤äº†å¤§å¯¹è±¡ç©ºé—´ï¼ˆLarge object spaceï¼‰ä¹‹å¤–ï¼Œæ¯ä¸ªé¡µé¢çš„å¤§å°éƒ½æ˜¯1MBã€‚</p>
<h3 id="æ ˆ"><a href="#æ ˆ" class="headerlink" title="æ ˆ"></a>æ ˆ</h3><p>è¿™æ˜¯æ ˆå†…å­˜åŒºåŸŸï¼Œæ¯ä¸ªV8è¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªæ ˆã€‚è¿™é‡Œæ˜¯å­˜å‚¨é™æ€æ•°æ®çš„åœ°æ–¹ï¼ŒåŒ…æ‹¬æ–¹æ³•&#x2F;å‡½æ•°å¸§ã€åŸå§‹å€¼å’ŒæŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆã€‚æ ˆå†…å­˜é™åˆ¶å¯ä»¥ä½¿ç”¨V8çš„<code>--stack_size</code>æ ‡å¿—æ¥è®¾ç½®ã€‚</p>
<h3 id="å †å¤–å†…å­˜"><a href="#å †å¤–å†…å­˜" class="headerlink" title="å †å¤–å†…å­˜"></a>å †å¤–å†…å­˜</h3><p>Node.js å †å¤–å†…å­˜ï¼ˆExternal Memoryï¼‰æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå…è®¸JavaScriptä»£ç ç›´æ¥ä¸éV8ç®¡ç†çš„å†…å­˜ç©ºé—´äº¤äº’ï¼Œè¿™é€šå¸¸ç”¨äºå¤„ç†å¤§å‹äºŒè¿›åˆ¶æ•°æ®ï¼Œå¦‚å›¾åƒã€éŸ³é¢‘ã€è§†é¢‘æˆ–å…¶ä»–å¤§å‹æ•°æ®é›†ã€‚ä½¿ç”¨å †å¤–å†…å­˜å¯ä»¥æé«˜æ€§èƒ½ï¼ŒåŸå› å¦‚ä¸‹ï¼š</p>
<ul>
<li><p>é¿å…V8åƒåœ¾å›æ”¶çš„å½±å“ï¼šV8çš„åƒåœ¾å›æ”¶æœºåˆ¶ä¸»è¦é’ˆå¯¹å †å†…å­˜è¿›è¡Œç®¡ç†ï¼Œå½“å†…å­˜ä½¿ç”¨é‡è¾¾åˆ°ä¸€å®šé˜ˆå€¼æ—¶ï¼Œä¼šè§¦å‘åƒåœ¾å›æ”¶è¿‡ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºçš„æš‚åœæˆ–æ€§èƒ½ä¸‹é™ã€‚è€Œå †å¤–å†…å­˜ä¸å—V8åƒåœ¾å›æ”¶çš„ç›´æ¥å½±å“ï¼Œå¯ä»¥å‡å°‘å› åƒåœ¾å›æ”¶å¼•èµ·çš„æ€§èƒ½æ³¢åŠ¨ã€‚</p>
</li>
<li><p>å‡å°‘å†…å­˜å¤åˆ¶ï¼šåœ¨å¤„ç†å¤§å‹æ•°æ®æ—¶ï¼Œå¦‚æœä½¿ç”¨V8å †å†…å­˜ï¼Œé‚£ä¹ˆåœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­å¯èƒ½ä¼šæ¶‰åŠåˆ°å¤šæ¬¡å†…å­˜å¤åˆ¶æ“ä½œï¼Œè¿™ä¼šå¢åŠ CPUçš„ä½¿ç”¨ç‡å¹¶é™ä½æ€§èƒ½ã€‚è€Œå †å¤–å†…å­˜å…è®¸æ•°æ®ç›´æ¥åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´ä¼ è¾“ï¼Œå‡å°‘äº†å†…å­˜å¤åˆ¶çš„å¼€é”€ï¼Œä»è€Œæé«˜æ•°æ®å¤„ç†æ•ˆç‡ã€‚</p>
</li>
<li><p>æé«˜ç¼“å­˜æ•ˆç‡ï¼šå¯¹äºéœ€è¦é¢‘ç¹è®¿é—®çš„å¤§é‡æ•°æ®ï¼Œä½¿ç”¨å †å¤–å†…å­˜å¯ä»¥æé«˜ç¼“å­˜çš„æ•ˆç‡ã€‚å› ä¸ºå †å¤–å†…å­˜ä¸å—V8å †å†…å­˜å¤§å°é™åˆ¶çš„çº¦æŸï¼Œå¯ä»¥åˆ†é…æ›´å¤§çš„è¿ç»­å†…å­˜ç©ºé—´ï¼Œè¿™å¯¹äºç¼“å­˜å¤§å‹æ•°æ®é›†ç‰¹åˆ«æœ‰ç”¨ã€‚</p>
</li>
<li><p>é¿å…å†…å­˜ç¢ç‰‡åŒ–ï¼šV8å †å†…å­˜åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å¯èƒ½ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œè¿™ä¼šå½±å“å†…å­˜åˆ†é…çš„æ•ˆç‡ã€‚è€Œå †å¤–å†…å­˜å¯ä»¥é€šè¿‡æ“ä½œç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜ç³»ç»Ÿæ¥ç®¡ç†ï¼Œå¯ä»¥æ›´å¥½åœ°å¤„ç†å†…å­˜ç¢ç‰‡åŒ–é—®é¢˜ã€‚</p>
</li>
<li><p>è·¨è¿›ç¨‹å…±äº«å†…å­˜ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå †å¤–å†…å­˜å¯ä»¥åœ¨ä¸åŒçš„è¿›ç¨‹ä¹‹é—´å…±äº«ï¼Œè¿™å¯¹äºéœ€è¦è·¨è¿›ç¨‹é€šä¿¡çš„åº”ç”¨ç¨‹åºæ¥è¯´æ˜¯ä¸€ä¸ªä¼˜åŠ¿ï¼Œå› ä¸ºå®ƒå‡å°‘äº†æ•°æ®åœ¨è¿›ç¨‹é—´ä¼ è¾“çš„å¼€é”€ã€‚</p>
</li>
</ul>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨Bufferæ¥å¤„ç†å¤§å‹äºŒè¿›åˆ¶æ•°æ®ï¼Œè¿™ç§æ–¹å¼é€šå¸¸æ¯”ä½¿ç”¨JavaScriptå­—ç¬¦ä¸²æ›´é«˜æ•ˆï¼Œå› ä¸ºå­—ç¬¦ä¸²åœ¨V8å †å†…åˆ†é…ï¼Œå¹¶ä¸”å¯èƒ½ä¼šå› ä¸ºå­—ç¬¦ç¼–ç è½¬æ¢è€Œæ¶ˆè€—æ›´å¤šèµ„æºã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><span class="hljs-keyword">const</span> v8 = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;v8&quot;</span>);<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">formatBytes</span> = (<span class="hljs-params">bytes</span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (bytes === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;0B&quot;</span>;<br>  <span class="hljs-keyword">const</span> unit = <span class="hljs-number">1024</span>;<br>  <span class="hljs-keyword">const</span> decimals = <span class="hljs-number">2</span>;<br>  <span class="hljs-keyword">const</span> sizes = [<span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;KB&quot;</span>, <span class="hljs-string">&quot;MB&quot;</span>, <span class="hljs-string">&quot;GB&quot;</span>, <span class="hljs-string">&quot;TB&quot;</span>, <span class="hljs-string">&quot;PB&quot;</span>];<br>  <span class="hljs-keyword">const</span> i = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">log</span>(bytes) / <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">log</span>(unit));<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="hljs-built_in">parseFloat</span>(<span class="hljs-title class_">String</span>(bytes / <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(unit, i))).<span class="hljs-title function_">toFixed</span>(decimals) +<br>    sizes[i] +<br>    <span class="hljs-string">&quot;&quot;</span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">logMem</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> mem = process.<span class="hljs-title function_">memoryUsage</span>();<br>  <span class="hljs-keyword">const</span> heap = v8.<span class="hljs-title function_">getHeapStatistics</span>();<br>  <span class="hljs-comment">// const heapSpace = v8.getHeapSpaceStatistics();</span><br><br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">mem</span>: &#123;<br>      <span class="hljs-attr">arrayBuffers</span>: <span class="hljs-title function_">formatBytes</span>(mem.<span class="hljs-property">arrayBuffers</span>),<br>      <span class="hljs-attr">external</span>: <span class="hljs-title function_">formatBytes</span>(mem.<span class="hljs-property">external</span>),<br>      <span class="hljs-attr">heapTotal</span>: <span class="hljs-title function_">formatBytes</span>(mem.<span class="hljs-property">heapTotal</span>),<br>      <span class="hljs-attr">heapUsed</span>: <span class="hljs-title function_">formatBytes</span>(mem.<span class="hljs-property">heapUsed</span>),<br>      <span class="hljs-attr">rss</span>: <span class="hljs-title function_">formatBytes</span>(mem.<span class="hljs-property">rss</span>),<br>    &#125;,<br>    <span class="hljs-attr">heap</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">fromEntries</span>(<br>      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(heap).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">[k, v]</span>) =&gt;</span> [k, <span class="hljs-title function_">formatBytes</span>(v)])<br>    ),<br>  &#125;;<br>&#125;;<br><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">doTask</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-keyword">const</span> content = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&quot;./large-file.json&quot;</span>);<br>  <span class="hljs-keyword">return</span> content.<span class="hljs-title function_">toString</span>()<br>&#125;<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// è·å–å †å†…å­˜ç»Ÿè®¡ä¿¡æ¯</span><br>  <span class="hljs-keyword">let</span> memStatistics = <span class="hljs-title function_">logMem</span>();<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;before reading file:&quot;</span>, memStatistics);<br><br>  <span class="hljs-keyword">const</span> str = <span class="hljs-title function_">doTask</span>()<br>  <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> memStatistics = <span class="hljs-title function_">logMem</span>();<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;after reading file:&quot;</span>, str.<span class="hljs-property">length</span>, memStatistics);<br>  &#125;, <span class="hljs-number">1000</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="ä¸ºä»€ä¹ˆ40Mæ–‡ä»¶è¯»å–ä¸ºå­—ç¬¦ä¸²åå ç”¨80Må†…å­˜ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ40Mæ–‡ä»¶è¯»å–ä¸ºå­—ç¬¦ä¸²åå ç”¨80Må†…å­˜ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ40Mæ–‡ä»¶è¯»å–ä¸ºå­—ç¬¦ä¸²åå ç”¨80Må†…å­˜ï¼Ÿ"></a>ä¸ºä»€ä¹ˆ40Mæ–‡ä»¶è¯»å–ä¸ºå­—ç¬¦ä¸²åå ç”¨80Må†…å­˜ï¼Ÿ</h4><p>bufferå ç”¨äº†40M, å­—ç¬¦ä¸²å ç”¨äº†40Mã€‚heap é‡Šæ”¾ï¼Œä¼šç«‹å³é‡Šæ”¾å›æ“ä½œç³»ç»Ÿã€‚externalé‡Šæ”¾ï¼Œä½†ä¸ä¼šå½’è¿˜æ“ä½œç³»ç»Ÿï¼Œrssä¸ä¼šå¾ˆå¿«é‡Šæ”¾ï¼Œå®é™…ä¸Šæ˜¯å¯ä»¥é‡ç”¨çš„ã€‚</p>
<p>rss &#x3D;&gt; +40Mï¼ˆbufferï¼‰+40Mï¼ˆstringï¼‰ &#x3D;&gt;  -40Mï¼ˆstringï¼‰&#x3D;&gt; â€¦long time &#x3D;&gt; -40Mï¼ˆbufferï¼‰<br>heapUsedå’ŒexternalæŒ‡æ ‡ï¼Œåœ¨GCåä¼šç«‹å³ç¼©å°ã€‚rssæŒ‡æ ‡ï¼Œexternalå·²åˆ†é…çš„éƒ¨åˆ†ä¼šä¿ç•™ä¸€æ®µæ—¶é—´ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆbufferé‡Šæ”¾äº†ï¼Œä½†æ˜¯rssçœ‹èµ·æ¥æ²¡æœ‰é‡Šæ”¾ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆbufferé‡Šæ”¾äº†ï¼Œä½†æ˜¯rssçœ‹èµ·æ¥æ²¡æœ‰é‡Šæ”¾ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆbufferé‡Šæ”¾äº†ï¼Œä½†æ˜¯rssçœ‹èµ·æ¥æ²¡æœ‰é‡Šæ”¾ï¼Ÿ"></a>ä¸ºä»€ä¹ˆbufferé‡Šæ”¾äº†ï¼Œä½†æ˜¯rssçœ‹èµ·æ¥æ²¡æœ‰é‡Šæ”¾ï¼Ÿ</h4><p>å½“ä¸€ä¸ªBufferå¯¹è±¡è¢«å›æ”¶åï¼ŒNode.jsçš„å†…å­˜ç®¡ç†æœºåˆ¶å¹¶ä¸ä¼šç«‹å³å°†å…¶å ç”¨çš„å†…å­˜é‡Šæ”¾å›æ“ä½œç³»ç»Ÿã€‚è¿™æ˜¯å› ä¸ºNode.jsä½¿ç”¨äº†ä¸€ç§ç§°ä¸ºâ€slab allocatorâ€çš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œå®ƒä¼šå°†å†…å­˜åˆ†é…ç»™Bufferå¯¹è±¡å¹¶ä¿ç•™ä¸€æ®µæ—¶é—´ï¼Œä»¥ä¾¿åœ¨æœªæ¥çš„å†…å­˜åˆ†é…ä¸­èƒ½å¤Ÿæ›´é«˜æ•ˆåœ°ä½¿ç”¨ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼Œå½“ä¸€ä¸ªBufferå¯¹è±¡è¢«å›æ”¶åï¼Œå®ƒçš„å†…å­˜ä¼šè¢«æ ‡è®°ä¸ºå¯é‡ç”¨ï¼Œè€Œä¸æ˜¯ç«‹å³è¿”å›ç»™æ“ä½œç³»ç»Ÿã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†é¿å…é¢‘ç¹çš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾æ“ä½œï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚å½“ä¸‹æ¬¡éœ€è¦åˆ†é…Bufferå¯¹è±¡æ—¶ï¼ŒNode.jsä¼šå°è¯•é‡ç”¨ä¹‹å‰å·²ç»åˆ†é…çš„å†…å­˜ï¼Œè€Œä¸æ˜¯å†æ¬¡å‘æ“ä½œç³»ç»Ÿè¯·æ±‚æ–°çš„å†…å­˜ã€‚</p>
<p>å› æ­¤ï¼Œå³ä½¿ä¸€ä¸ªBufferå¯¹è±¡è¢«å›æ”¶ï¼ŒRSSï¼ˆResident Set Sizeï¼Œè¿›ç¨‹åœ¨ç‰©ç†å†…å­˜ä¸­çš„å ç”¨ï¼‰å¯èƒ½ä¸ä¼šç«‹å³ç¼©å°ã€‚åªæœ‰å½“Node.jsè®¤ä¸ºæœ‰å¿…è¦é‡æ–°åˆ†é…å†…å­˜æ—¶ï¼Œæ‰ä¼šå°†ä¹‹å‰å›æ”¶çš„å†…å­˜è¿”å›ç»™æ“ä½œç³»ç»Ÿã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// è·å–å †å†…å­˜ç»Ÿè®¡ä¿¡æ¯</span><br>  <span class="hljs-keyword">const</span> memStatistics = <span class="hljs-title function_">logMem</span>();<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;before reading file:&quot;</span>, memStatistics);<br><br>  <span class="hljs-comment">// è¯»å–æ–‡ä»¶</span><br>  <span class="hljs-keyword">let</span> content1 = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&quot;./large-file.json&quot;</span>);<br>  <span class="hljs-keyword">let</span> content2 = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&quot;./large-file.json&quot;</span>);<br>  <span class="hljs-keyword">let</span> content3 = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&quot;./large-file.json&quot;</span>);<br>  <span class="hljs-keyword">let</span> content4 = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&quot;./large-file.json&quot;</span>);<br><br>  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">()=&gt;</span> &#123;<br>    <span class="hljs-keyword">let</span> content5 = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&quot;./large-file.json&quot;</span>); <span class="hljs-comment">// rssæ²¡æœ‰å†å¢é•¿ï¼Œå¤ç”¨äº†buffer</span><br>  &#125;, <span class="hljs-number">60000</span>)<br>  <span class="hljs-variable language_">global</span>.<span class="hljs-title function_">gc</span>();<br>&#125;<br><br><span class="hljs-title function_">main</span>();<br><br><span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> memStatistics = <span class="hljs-title function_">logMem</span>();<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;after reading file:&quot;</span>, memStatistics);<br>&#125;, <span class="hljs-number">1000</span>);<br></code></pre></td></tr></table></figure>

<hr>
<h3 id="V8å†…å­˜ç®¡ç†ï¼šåƒåœ¾å›æ”¶"><a href="#V8å†…å­˜ç®¡ç†ï¼šåƒåœ¾å›æ”¶" class="headerlink" title="V8å†…å­˜ç®¡ç†ï¼šåƒåœ¾å›æ”¶"></a>V8å†…å­˜ç®¡ç†ï¼šåƒåœ¾å›æ”¶</h3><p>ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†V8æ˜¯å¦‚ä½•åˆ†é…å†…å­˜çš„ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å®ƒå¦‚ä½•è‡ªåŠ¨ç®¡ç†å¯¹åº”ç”¨ç¨‹åºæ€§èƒ½è‡³å…³é‡è¦çš„å †å†…å­˜ã€‚å½“ç¨‹åºå°è¯•åœ¨å †ä¸Šåˆ†é…çš„å†…å­˜è¶…è¿‡å¯ç”¨çš„è‡ªç”±å†…å­˜æ—¶ï¼ˆè¿™å–å†³äºè®¾ç½®çš„V8æ ‡å¿—ï¼‰ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°å†…å­˜ä¸è¶³çš„é”™è¯¯ã€‚å¦‚æœç®¡ç†ä¸å½“ï¼Œå †è¿˜å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ã€‚</p>
<p>V8é€šè¿‡åƒåœ¾å›æ”¶æ¥ç®¡ç†å †å†…å­˜ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒé‡Šæ”¾å­¤ç«‹å¯¹è±¡ä½¿ç”¨çš„å†…å­˜ï¼Œå³ä¸å†ç›´æ¥æˆ–é—´æ¥ï¼ˆé€šè¿‡å¦ä¸€ä¸ªå¯¹è±¡ä¸­çš„å¼•ç”¨ï¼‰ä»æ ˆå¼•ç”¨çš„å¯¹è±¡ï¼Œä»¥ä¾¿ä¸ºæ–°å¯¹è±¡çš„åˆ›å»ºè…¾å‡ºç©ºé—´ã€‚</p>
<blockquote>
<p>å¥¥é‡Œè¯ºç§‘ï¼ˆOrinocoï¼‰æ˜¯V8åƒåœ¾å›æ”¶é¡¹ç›®çš„ä»£å·ï¼Œè¯¥é¡¹ç›®æ—¨åœ¨åˆ©ç”¨å¹¶è¡Œã€å¢é‡å’Œå¹¶å‘æŠ€æœ¯è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œä»¥é‡Šæ”¾ä¸»çº¿ç¨‹ã€‚</p>
</blockquote>
<p>V8ä¸­çš„åƒåœ¾å›æ”¶å™¨è´Ÿè´£å›æ”¶æœªä½¿ç”¨çš„å†…å­˜ï¼Œä»¥ä¾¿V8è¿›ç¨‹é‡ç”¨ã€‚</p>
<p>V8çš„åƒåœ¾å›æ”¶å™¨æ˜¯åˆ†ä»£çš„ï¼ˆæ ¹æ®å¯¹è±¡åœ¨å †ä¸­çš„å¹´é¾„å°†å¯¹è±¡åˆ†ç»„ï¼Œå¹¶åœ¨ä¸åŒçš„é˜¶æ®µè¿›è¡Œæ¸…ç†ï¼‰ã€‚V8ä½¿ç”¨ä¸¤ä¸ªé˜¶æ®µå’Œä¸‰ç§ä¸åŒçš„ç®—æ³•è¿›è¡Œåƒåœ¾å›æ”¶ï¼š</p>
<h3 id="Minor-GC-Scavenger"><a href="#Minor-GC-Scavenger" class="headerlink" title="Minor GC (Scavenger)"></a>Minor GC (Scavenger)</h3><p>è¿™ç§ç±»å‹çš„åƒåœ¾å›æ”¶ä¿æŒå¹´è½»ä»£æˆ–æ–°ç”Ÿä»£ç©ºé—´ç´§å‡‘ä¸”å¹²å‡€ã€‚å¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­åˆ†é…ï¼Œè¿™ä¸ªç©ºé—´ç›¸å½“å°ï¼ˆæ ¹æ®è¡Œä¸ºå¯å‘å¼ç®—æ³•åœ¨1åˆ°8MBä¹‹é—´ï¼‰ã€‚åœ¨â€œæ–°ç”Ÿä»£â€ä¸­åˆ†é…å†…å­˜éå¸¸ä¾¿å®œï¼šæœ‰ä¸€ä¸ªåˆ†é…æŒ‡é’ˆï¼Œæˆ‘ä»¬åœ¨æƒ³è¦ä¸ºæ–°å¯¹è±¡ä¿ç•™ç©ºé—´æ—¶å°±ä¼šé€’å¢å®ƒã€‚å½“åˆ†é…æŒ‡é’ˆåˆ°è¾¾æ–°ç”Ÿä»£çš„æœ«å°¾æ—¶ï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡å°å‹åƒåœ¾å›æ”¶ï¼ˆminor GCï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹ä¹Ÿç§°ä¸ºScanvengerï¼Œå®ƒå®ç°äº†Cheneyç®—æ³•ã€‚å®ƒé¢‘ç¹å‘ç”Ÿï¼Œå¹¶ä½¿ç”¨å¹¶è¡Œè¾…åŠ©çº¿ç¨‹ï¼Œé€Ÿåº¦éå¸¸å¿«ã€‚</p>
<p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å°å‹åƒåœ¾å›æ”¶è¿‡ç¨‹ï¼š</p>
<p>æ–°ç”Ÿä»£è¢«åˆ’åˆ†ä¸ºä¸¤ä¸ªå¤§å°ç›¸ç­‰çš„åŠç©ºé—´ï¼što-spaceå’Œfrom-spaceã€‚å¤§å¤šæ•°åˆ†é…éƒ½åœ¨from-spaceè¿›è¡Œï¼ˆé™¤äº†æŸäº›ç±»å‹çš„å¯¹è±¡ï¼Œä¾‹å¦‚å¯æ‰§è¡Œä»£ç ï¼Œå®ƒä»¬æ€»æ˜¯åœ¨è€ç”Ÿä»£ä¸­åˆ†é…ï¼‰ã€‚å½“from-spaceå¡«æ»¡æ—¶ï¼Œè§¦å‘å°å‹åƒåœ¾å›æ”¶ã€‚</p>
<ul>
<li><p>æ ‡è®°ï¼šä»æ ¹å¯¹è±¡å¼€å§‹ï¼Œé€’å½’æ‰«ææ‰€æœ‰å¯è¾¾å¯¹è±¡ã€‚æ‰€æœ‰å¯è¾¾çš„å¯¹è±¡éƒ½è¢«æ ‡è®°ä¸ºæ´»è·ƒçš„ã€‚</p>
</li>
<li><p>å¤åˆ¶ï¼šå°†æ‰€æœ‰æ´»è·ƒå¯¹è±¡ä»From-Spaceå¤åˆ¶åˆ°To-Spaceï¼ŒåŒæ—¶æ›´æ–°æ‰€æœ‰æŒ‡å‘è¿™äº›å¯¹è±¡çš„å¼•ç”¨ã€‚</p>
</li>
<li><p>æ¸…ç†ï¼šå®Œæˆå¤åˆ¶åï¼ŒFrom-Spaceä¸­å‰©ä¸‹çš„éƒ½æ˜¯ä¸å¯è¾¾çš„å¯¹è±¡ï¼Œå³åƒåœ¾ï¼Œè¿™äº›åƒåœ¾å°†è¢«æ¸…é™¤ã€‚</p>
</li>
<li><p>è§’è‰²äº’æ¢ï¼šå¤åˆ¶å’Œæ¸…ç†å®Œæˆåï¼ŒFrom-Spaceå’ŒTo-Spaceçš„è§’è‰²äº’æ¢ï¼Œæ–°çš„From-Spaceç”¨äºå­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œè€ŒåŸæ¥çš„From-Spaceï¼ˆç°åœ¨çš„To-Spaceï¼‰ç”¨äºä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶å­˜æ”¾å¤åˆ¶çš„å¯¹è±¡ã€‚</p>
</li>
</ul>
<p><img src="/pic/minor-gc.svg" alt="minor-gc æ¥æº: https://v8.dev/blog/trash-talk"></p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å°å‹åƒåœ¾å›æ”¶ï¼ˆMinor GCï¼‰æ˜¯å¦‚ä½•ä»å¹´è½»ä»£ï¼ˆyoung generationï¼‰å›æ”¶ç©ºé—´å¹¶ä¿æŒå…¶ç´§å‡‘çš„ã€‚è¿™æ˜¯ä¸€ä¸ªåœæ­¢ä¸–ç•Œï¼ˆstop-the-worldï¼‰çš„è¿‡ç¨‹ï¼Œä½†å®ƒéå¸¸å¿«é€Ÿå’Œé«˜æ•ˆï¼Œä»¥è‡³äºå¤§å¤šæ•°æ—¶é—´é‡Œå¯ä»¥å¿½ç•¥ä¸è®¡ã€‚ç”±äºè¿™ä¸ªè¿‡ç¨‹ä¸ä¼šæ‰«æâ€œè€ç©ºé—´â€ï¼ˆold spaceï¼‰ä¸­çš„å¯¹è±¡ä»¥æŸ¥æ‰¾å¯¹â€œæ–°ç©ºé—´â€ï¼ˆnew spaceï¼‰çš„ä»»ä½•å¼•ç”¨ï¼Œå› æ­¤å®ƒä½¿ç”¨äº†ä¸€ä¸ªè®°å½•æ‰€æœ‰ä»è€ç©ºé—´æŒ‡å‘æ–°ç©ºé—´çš„æŒ‡é’ˆçš„å¯„å­˜å™¨ã€‚è¿™æ˜¯é€šè¿‡ä¸€ç§ç§°ä¸ºå†™å±éšœï¼ˆwrite barriersï¼‰çš„è¿‡ç¨‹è®°å½•åˆ°å­˜å‚¨ç¼“å†²åŒºï¼ˆstore bufferï¼‰ä¸­çš„ã€‚</p>
<h3 id="Major-GC"><a href="#Major-GC" class="headerlink" title="Major GC"></a>Major GC</h3><p>è¿™ç§åƒåœ¾å›æ”¶ï¼ˆGCï¼‰æ–¹å¼èƒ½å¤Ÿä¿æŒè€å¹´ä»£ï¼ˆold generationï¼‰ç©ºé—´çš„ç´§å‡‘å’Œæ¸…æ´ã€‚å½“V8å¼•æ“æ ¹æ®åŠ¨æ€è®¡ç®—çš„é™åˆ¶åˆ¤æ–­è€ç©ºé—´ä¸è¶³æ—¶ï¼Œä¼šåœ¨å°å‹åƒåœ¾å›æ”¶ï¼ˆminor GCï¼‰å‘¨æœŸä¸­å¡«æ»¡åè§¦å‘ã€‚</p>
<p>Scavengerç®—æ³•éå¸¸é€‚åˆå°æ•°æ®é‡çš„åƒåœ¾å›æ”¶ï¼Œä½†å¯¹äºå¤§å‹å †ï¼ˆheapï¼‰æ¥è¯´å´ä¸åˆ‡å®é™…ï¼Œå› ä¸ºè€ç©ºé—´å­˜åœ¨å†…å­˜å¼€é”€ï¼Œå› æ­¤ä¸»è¦çš„åƒåœ¾å›æ”¶ï¼ˆmajor GCï¼‰é‡‡ç”¨çš„æ˜¯æ ‡è®°-æ¸…é™¤-å‹ç¼©ï¼ˆMark-Sweep-Compactï¼‰ç®—æ³•ã€‚è¯¥ç®—æ³•ä½¿ç”¨ä¸‰è‰²ï¼ˆç™½è‰²-ç°è‰²-é»‘è‰²ï¼‰æ ‡è®°ç³»ç»Ÿã€‚å› æ­¤ï¼Œä¸»è¦çš„åƒåœ¾å›æ”¶æ˜¯ä¸€ä¸ªä¸‰æ­¥éª¤çš„è¿‡ç¨‹ï¼Œè€Œç¬¬ä¸‰æ­¥éª¤çš„æ‰§è¡Œåˆ™å–å†³äºä¸€ä¸ªç¢ç‰‡åŒ–å¯å‘å¼ç®—æ³•ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼Œæ ‡è®°-æ¸…é™¤-å‹ç¼©ç®—æ³•çš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li><p>æ ‡è®°ï¼ˆMarkingï¼‰ï¼šè¿™æ˜¯ä¸¤ç§ç®—æ³•å…±æœ‰çš„ç¬¬ä¸€æ­¥ï¼Œåƒåœ¾å›æ”¶å™¨åœ¨è¿™ä¸€é˜¶æ®µè¯†åˆ«å‡ºå“ªäº›å¯¹è±¡æ­£åœ¨è¢«ä½¿ç”¨ï¼Œä»¥åŠå“ªäº›å¯¹è±¡æ²¡æœ‰è¢«ä½¿ç”¨ã€‚ä»åƒåœ¾å›æ”¶ï¼ˆGCï¼‰æ ¹ï¼ˆå¦‚æ ˆæŒ‡é’ˆï¼‰å¼€å§‹ï¼Œé€’å½’åœ°æ ‡è®°æ‰€æœ‰å¯è¾¾çš„å¯¹è±¡ä¸ºå­˜æ´»çŠ¶æ€ã€‚ä»æŠ€æœ¯è§’åº¦æ¥çœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯¹å †è¿›è¡Œçš„æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆdepth-first-searchï¼‰ï¼Œå †å¯ä»¥è¢«è§†ä¸ºä¸€ä¸ªæœ‰å‘å›¾ã€‚</p>
</li>
<li><p>æ¸…é™¤ï¼ˆSweepingï¼‰ï¼šåƒåœ¾å›æ”¶å™¨éå†å †ï¼Œå¹¶è®°å½•æ‰€æœ‰æœªè¢«æ ‡è®°ä¸ºå­˜æ´»çš„å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚è¿™äº›ç©ºé—´ç°åœ¨åœ¨ç©ºé—²åˆ—è¡¨ï¼ˆfree listï¼‰ä¸­è¢«æ ‡è®°ä¸ºç©ºé—²ï¼Œå¹¶ä¸”å¯ä»¥ç”¨æ¥å­˜å‚¨å…¶ä»–å¯¹è±¡ã€‚</p>
</li>
<li><p>å‹ç¼©ï¼ˆCompactingï¼‰ï¼šåœ¨æ¸…é™¤ä¹‹åï¼Œå¦‚æœéœ€è¦ï¼Œæ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å°†è¢«ç§»åŠ¨åˆ°ä¸€èµ·ã€‚è¿™å°†å‡å°‘å†…å­˜ç¢ç‰‡åŒ–ï¼Œå¹¶æé«˜å°†å†…å­˜åˆ†é…ç»™æ–°å¯¹è±¡çš„æ€§èƒ½ã€‚</p>
</li>
</ul>
<p><img src="/pic/major-gc.gif" alt="major gc"></p>
<p>è¿™ç§åƒåœ¾å›æ”¶ï¼ˆGCï¼‰ä¹Ÿè¢«ç§°ä¸ºâ€œåœæ­¢ä¸–ç•Œâ€ï¼ˆstop-the-worldï¼‰åƒåœ¾å›æ”¶ï¼Œå› ä¸ºåœ¨æ‰§è¡Œåƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­å®ƒä»¬ä¼šå¼•å…¥æš‚åœæ—¶é—´ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼ŒV8å¼•æ“é‡‡ç”¨äº†ä¸€äº›æŠ€æœ¯ï¼Œä¾‹å¦‚ï¼š</p>
<p><img src="/pic/concurrent-gc.svg" alt="concurrent-gc"></p>
<ul>
<li><p>å¢é‡åƒåœ¾å›æ”¶ï¼ˆIncremental GCï¼‰ï¼šåƒåœ¾å›æ”¶ä¸æ˜¯ä¸€æ¬¡æ€§å®Œæˆï¼Œè€Œæ˜¯åˆ†å¤šä¸ªå¢é‡æ­¥éª¤è¿›è¡Œã€‚</p>
</li>
<li><p>å¹¶å‘æ ‡è®°ï¼ˆConcurrent markingï¼‰ï¼šä½¿ç”¨å¤šä¸ªè¾…åŠ©çº¿ç¨‹å¹¶å‘åœ°è¿›è¡Œæ ‡è®°ï¼Œè¿™æ ·åšä¸ä¼šå½±å“ä¸»JavaScriptçº¿ç¨‹ã€‚åŒæ—¶ï¼Œä½¿ç”¨å†™å±éšœæ¥è·Ÿè¸ªJavaScriptåœ¨è¾…åŠ©çº¿ç¨‹å¹¶å‘æ ‡è®°æ—¶åˆ›å»ºçš„å¯¹è±¡ä¹‹é—´çš„æ–°å¼•ç”¨ã€‚</p>
</li>
<li><p>å¹¶å‘æ¸…é™¤&#x2F;å‹ç¼©ï¼ˆConcurrent sweeping&#x2F;compactingï¼‰ï¼šæ¸…é™¤å’Œå‹ç¼©å·¥ä½œä¹Ÿæ˜¯åœ¨è¾…åŠ©çº¿ç¨‹ä¸­å¹¶å‘è¿›è¡Œçš„ï¼Œè¿™æ ·åšä¸ä¼šå½±å“ä¸»JavaScriptçº¿ç¨‹ã€‚</p>
</li>
<li><p>å»¶è¿Ÿæ¸…é™¤ï¼ˆLazy sweepingï¼‰ï¼šå»¶è¿Ÿæ¸…é™¤æ¶‰åŠå°†åƒåœ¾é¡µé¢çš„åˆ é™¤å·¥ä½œæ¨è¿Ÿåˆ°å†…å­˜éœ€è¦æ—¶æ‰è¿›è¡Œã€‚</p>
</li>
</ul>
<p>è®©æˆ‘ä»¬æ¥å®¡è§†ä¸€ä¸‹ä¸»è¦çš„åƒåœ¾å›æ”¶ï¼ˆMajor GCï¼‰è¿‡ç¨‹ï¼š</p>
<ol>
<li><p>å‡è®¾å·²ç»ç»å†äº†è®¸å¤šæ¬¡å°å‹åƒåœ¾å›æ”¶ï¼ˆminor GCï¼‰å‘¨æœŸï¼Œè€å¹´ä»£ï¼ˆold spaceï¼‰å‡ ä¹å·²æ»¡ï¼ŒV8å†³å®šè§¦å‘ä¸€æ¬¡â€œä¸»è¦åƒåœ¾å›æ”¶â€ï¼ˆMajor GCï¼‰ã€‚</p>
</li>
<li><p>ä¸»è¦åƒåœ¾å›æ”¶ä»æ ˆæŒ‡é’ˆå¼€å§‹ï¼Œé€’å½’éå†å¯¹è±¡å›¾ï¼Œæ ‡è®°é‚£äº›è¢«ä½¿ç”¨çš„å­˜æ´»å¯¹è±¡ï¼ˆUsed memoryï¼‰ï¼Œä»¥åŠåœ¨è€å¹´ä»£ä¸­å‰©ä½™çš„å¯¹è±¡ä½œä¸ºåƒåœ¾ï¼ˆOrphansï¼‰ã€‚è¿™ä¸€è¿‡ç¨‹ä½¿ç”¨å¤šä¸ªå¹¶å‘çš„è¾…åŠ©çº¿ç¨‹æ¥å®Œæˆï¼Œæ¯ä¸ªè¾…åŠ©çº¿ç¨‹éƒ½è·Ÿéšä¸€ä¸ªæŒ‡é’ˆè¿›è¡Œæ ‡è®°ã€‚è¿™ä¸ä¼šå¯¹ä¸»JavaScriptçº¿ç¨‹äº§ç”Ÿå½±å“ã€‚</p>
</li>
<li><p>å½“å¹¶å‘æ ‡è®°å®Œæˆï¼Œæˆ–è€…è¾¾åˆ°å†…å­˜é™åˆ¶æ—¶ï¼Œåƒåœ¾å›æ”¶ä¼šä½¿ç”¨ä¸»çº¿ç¨‹è¿›è¡Œæ ‡è®°çš„æœ€ç»ˆæ­¥éª¤ï¼ˆmark finalizationï¼‰ã€‚è¿™ä¼šå¯¼è‡´ä¸€ä¸ªçŸ­æš‚çš„æš‚åœæ—¶é—´ã€‚</p>
</li>
<li><p>ä¸»è¦åƒåœ¾å›æ”¶ç°åœ¨ä½¿ç”¨å¹¶å‘æ¸…é™¤çº¿ç¨‹æ ‡è®°æ‰€æœ‰å­¤ç«‹å¯¹è±¡çš„å†…å­˜ä¸ºç©ºé—²ã€‚åŒæ—¶ä¹Ÿä¼šè§¦å‘å¹¶è¡Œå‹ç¼©ä»»åŠ¡ï¼Œå°†ç›¸å…³çš„è®°å¿†å—ç§»åŠ¨åˆ°åŒä¸€é¡µä»¥é¿å…ç¢ç‰‡åŒ–ã€‚åœ¨è¿™äº›æ­¥éª¤ä¸­ï¼ŒæŒ‡é’ˆä¼šè¢«æ›´æ–°ã€‚</p>
</li>
</ol>
<hr>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æœ¬æ–‡åº”è¯¥ä¸ºæ‚¨æä¾›äº†V8å†…å­˜ç»“æ„å’Œå†…å­˜ç®¡ç†çš„æ¦‚è§ˆã€‚è¿™ä¸æ˜¯è¯¦å°½æ— é—çš„ï¼Œè¿˜æœ‰è®¸å¤šæ›´é«˜çº§çš„æ¦‚å¿µï¼Œæ‚¨å¯ä»¥ä»v8.devç½‘ç«™ä¸Šå­¦ä¹ åˆ°å®ƒä»¬ã€‚ä½†å¯¹äºå¤§å¤šæ•°JavaScript&#x2F; WebAssemblyå¼€å‘è€…æ¥è¯´ï¼Œè¿™ä¸€å±‚æ¬¡çš„ä¿¡æ¯å·²ç»è¶³å¤Ÿäº†ï¼Œæˆ‘å¸Œæœ›è¿™èƒ½å¸®åŠ©æ‚¨ç¼–å†™æ›´å¥½çš„ä»£ç ï¼Œè€ƒè™‘åˆ°è¿™äº›å› ç´ ï¼Œä»¥å®ç°æ›´é«˜æ•ˆçš„åº”ç”¨ç¨‹åºï¼ŒåŒæ—¶ç‰¢è®°è¿™äº›çŸ¥è¯†å°†æœ‰åŠ©äºæ‚¨é¿å…å¯èƒ½é‡åˆ°çš„ä¸‹ä¸€ä¸ªå†…å­˜æ³„æ¼é—®é¢˜ã€‚</p>
<p>å¸Œæœ›æ‚¨åœ¨äº†è§£V8å†…éƒ¨æœºåˆ¶çš„è¿‡ç¨‹ä¸­æœ‰æ‰€æ”¶è·ï¼Œæ•¬è¯·æœŸå¾…æœ¬ç³»åˆ—çš„ä¸‹ä¸€ç¯‡æ–‡ç« ã€‚</p>
<h3 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h3><p><a href="https://developer.aliyun.com/article/592880">è§£è¯» V8 GC Logï¼ˆäºŒï¼‰: å †å†…å¤–å†…å­˜çš„åˆ’åˆ†ä¸ GC ç®—æ³•</a></p>
<p><a href="https://deepu.tech/memory-management-in-v8/">Visualizing memory management in V8 Engine (JavaScript, NodeJS, Deno, WebAssembly)</a></p>
]]></content>
      <categories>
        <category>Nodejs</category>
      </categories>
  </entry>
  <entry>
    <title>æä¾›è€…æ¨¡å¼</title>
    <url>/posts/bd91c8c4.html</url>
    <content><![CDATA[<h2 id="ã€è¯‘ã€‘æä¾›è€…æ¨¡å¼Provider-Pattern"><a href="#ã€è¯‘ã€‘æä¾›è€…æ¨¡å¼Provider-Pattern" class="headerlink" title="ã€è¯‘ã€‘æä¾›è€…æ¨¡å¼Provider Pattern"></a>ã€è¯‘ã€‘æä¾›è€…æ¨¡å¼<a href="https://www.patterns.dev/vanilla/provider-pattern">Provider Pattern</a></h2><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›å°†æ•°æ®æä¾›ç»™åº”ç”¨ç¨‹åºä¸­çš„è®¸å¤šï¼ˆä¹Ÿè®¸æ˜¯å…¨éƒ¨ï¼‰ç»„ä»¶ã€‚è™½ç„¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨propså°†æ•°æ®ä¼ é€’ç»™ç»„ä»¶ï¼Œä½†å¦‚æœå‡ ä¹æ‰€æœ‰ç»„ä»¶éƒ½éœ€è¦è®¿é—®propsçš„å€¼ï¼Œè¿™å¯èƒ½å¾ˆéš¾åšåˆ°ã€‚</p>
<p>æˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¸€ç§å«åšprop drillingçš„æƒ…å†µï¼Œå³å°†propsä¼ é€’åˆ°ç»„ä»¶æ ‘çš„æ·±å¤„ã€‚é‡æ„ä¾èµ–äºpropsçš„ä»£ç å‡ ä¹å˜å¾—ä¸å¯èƒ½ï¼Œè€Œä¸”å¾ˆéš¾çŸ¥é“æŸäº›æ•°æ®æ¥è‡ªå“ªé‡Œã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªAppç»„ä»¶ï¼Œå…¶ä¸­åŒ…å«æŸäº›æ•°æ®ã€‚åœ¨ç»„ä»¶æ ‘çš„æ·±å¤„ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªListItemã€Headerå’ŒTextç»„ä»¶ï¼Œå®ƒä»¬éƒ½éœ€è¦è¿™äº›æ•°æ®ã€‚ä¸ºäº†å°†è¿™äº›æ•°æ®ä¼ é€’ç»™è¿™äº›ç»„ä»¶ï¼Œæˆ‘ä»¬å¿…é¡»é€šè¿‡å¤šä¸ªå±‚æ¬¡çš„ç»„ä»¶ä¼ é€’å®ƒã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„ä»£ç åº“ä¸­ï¼Œè¿™å°†ç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> data = &#123; ... &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">SideBar</span> <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;data&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Content</span> <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;data&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  )<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">SideBar</span> = (<span class="hljs-params">&#123; data &#125;</span>) =&gt; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">List</span> <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;data&#125;</span> /&gt;</span></span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">List</span> = (<span class="hljs-params">&#123; data &#125;</span>) =&gt; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ListItem</span> <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;data&#125;</span> /&gt;</span></span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">ListItem</span> = (<span class="hljs-params">&#123; data &#125;</span>) =&gt; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;data.listItem&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Content</span> = (<span class="hljs-params">&#123; data &#125;</span>) =&gt; (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;data&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Block</span> <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;data&#125;</span> /&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>)<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Header</span> = (<span class="hljs-params">&#123; data &#125;</span>) =&gt; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;data.title&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Block</span> = (<span class="hljs-params">&#123; data &#125;</span>) =&gt; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;data&#125;</span> /&gt;</span></span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Text</span> = (<span class="hljs-params">&#123; data &#125;</span>) =&gt; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;data.text&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br></code></pre></td></tr></table></figure>
<p>é€šè¿‡è¿™ç§æ–¹å¼ä¼ é€’propså¯èƒ½ä¼šå˜å¾—éå¸¸æ··ä¹±ã€‚å¦‚æœæˆ‘ä»¬å°†æ¥æƒ³è¦é‡å‘½åæ•°æ®propï¼Œå°±å¿…é¡»åœ¨æ‰€æœ‰ç»„ä»¶ä¸­è¿›è¡Œé‡å‘½åã€‚éšç€åº”ç”¨ç¨‹åºå˜å¾—è¶Šæ¥è¶Šå¤§ï¼Œprop drillingå°±ä¼šå˜å¾—è¶Šæ¥è¶Šæ£˜æ‰‹ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿè·³è¿‡ä¸éœ€è¦ä½¿ç”¨è¿™äº›æ•°æ®çš„æ‰€æœ‰ç»„ä»¶å±‚çº§ï¼Œé‚£å°†æ˜¯æœ€ç†æƒ³çš„ã€‚æˆ‘ä»¬éœ€è¦æœ‰ä¸€ç§æ–¹æ³•ï¼Œè®©éœ€è¦è®¿é—®æ•°æ®å€¼çš„ç»„ä»¶ç›´æ¥è®¿é—®å®ƒï¼Œè€Œä¸ä¾èµ–äºprop drillingã€‚</p>
<p>è¿™å°±æ˜¯Provideræ¨¡å¼å¯ä»¥å¸®åŠ©æˆ‘ä»¬çš„åœ°æ–¹ï¼ä½¿ç”¨Provideræ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®æä¾›ç»™å¤šä¸ªç»„ä»¶ã€‚è€Œä¸æ˜¯é€šè¿‡propså°†æ•°æ®ä¼ é€’ç»™æ¯ä¸ªå±‚çº§ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰ç»„ä»¶åŒ…è£…åœ¨Providerä¸­ã€‚Provideræ˜¯ç”±Contextå¯¹è±¡æä¾›ç»™æˆ‘ä»¬çš„é«˜é˜¶ç»„ä»¶ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Reactä¸ºæˆ‘ä»¬æä¾›çš„createContextæ–¹æ³•åˆ›å»ºä¸€ä¸ªContextå¯¹è±¡ã€‚</p>
<p>Provideræ¥æ”¶ä¸€ä¸ªvalue propï¼Œå…¶ä¸­åŒ…å«æˆ‘ä»¬è¦ä¼ é€’çš„æ•°æ®ã€‚æ‰€æœ‰åŒ…è£…åœ¨æ­¤providerä¸­çš„ç»„ä»¶éƒ½å¯ä»¥è®¿é—®value propçš„å€¼ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">DataContext</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createContext</span>()<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> data = &#123; ... &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">DataContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;data&#125;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">SideBar</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Content</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">DataContext.Provider</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  )<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¸å†éœ€è¦æ‰‹åŠ¨å°†æ•°æ®ä¼ é€’ç»™æ¯ä¸ªç»„ä»¶ï¼é‚£ä¹ˆï¼ŒListItemã€Headerå’ŒTextç»„ä»¶å¦‚ä½•è®¿é—®æ•°æ®çš„å€¼å‘¢ï¼Ÿ</p>
<p>æ¯ä¸ªç»„ä»¶éƒ½å¯ä»¥é€šè¿‡ä½¿ç”¨useContexté’©å­æ¥è®¿é—®æ•°æ®ã€‚è¿™ä¸ªé’©å­æ¥æ”¶ä¸æ•°æ®ç›¸å…³è”çš„ä¸Šä¸‹æ–‡ï¼Œæœ¬ä¾‹ä¸­æ˜¯DataContextã€‚useContexté’©å­å…è®¸æˆ‘ä»¬è¯»å–å’Œå†™å…¥ä¸Šä¸‹æ–‡å¯¹è±¡ä¸­çš„æ•°æ®ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">DataContext</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createContext</span>();<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> data = &#123; ... &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">SideBar</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Content</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  )<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">SideBar</span> = (<span class="hljs-params"></span>) =&gt; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">List</span> /&gt;</span></span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">List</span> = (<span class="hljs-params"></span>) =&gt; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ListItem</span> /&gt;</span></span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Content</span> = (<span class="hljs-params"></span>) =&gt; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Block</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ListItem</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; data &#125; = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">DataContext</span>);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;data.listItem&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span>;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Text</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; data &#125; = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">DataContext</span>);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;data.text&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Header</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; data &#125; = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">DataContext</span>);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;data.title&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>é‚£äº›ä¸ä½¿ç”¨æ•°æ®å€¼çš„ç»„ä»¶å°†ä¸å¿…å¤„ç†æ•°æ®ã€‚æˆ‘ä»¬ä¸å†éœ€è¦æ‹…å¿ƒå°†propsé€šè¿‡ä¸éœ€è¦è¿™äº›propså€¼çš„ç»„ä»¶ä¼ é€’å¤šå±‚çº§ï¼Œè¿™æ ·é‡æ„å˜å¾—æ›´åŠ å®¹æ˜“ã€‚</p>
<hr>
<h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><p>æä¾›è€…æ¨¡å¼ä½¿å¾—å¯ä»¥å°†æ•°æ®ä¼ é€’ç»™è®¸å¤šç»„ä»¶ï¼Œè€Œæ— éœ€æ‰‹åŠ¨é€šè¿‡æ¯ä¸ªç»„ä»¶å±‚ä¼ é€’æ•°æ®ã€‚</p>
<p>åœ¨é‡æ„ä»£ç æ—¶ï¼Œå‡å°‘äº†æ„å¤–å¼•å…¥é”™è¯¯çš„é£é™©ã€‚ä»¥å‰ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦é‡å‘½åä¸€ä¸ªå±æ€§ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨ä½¿ç”¨è¯¥å€¼çš„æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­é‡å‘½åè¯¥å±æ€§ã€‚</p>
<p>æˆ‘ä»¬ä¸å†éœ€è¦å¤„ç†å±æ€§ä¼ é€’çš„é—®é¢˜ã€‚ä»¥å‰ï¼Œå¾ˆéš¾ç†è§£åº”ç”¨ç¨‹åºçš„æ•°æ®æµï¼Œå› ä¸ºå¹¶ä¸æ€»æ˜¯æ¸…æ¥šæŸäº›å±æ€§å€¼çš„æ¥æºã€‚ä½¿ç”¨æä¾›è€…æ¨¡å¼ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦å°†å±æ€§ä¸å¿…è¦åœ°ä¼ é€’ç»™ä¸å…³å¿ƒè¿™äº›æ•°æ®çš„ç»„ä»¶ã€‚</p>
<p>ä½¿ç”¨æä¾›è€…æ¨¡å¼å¯ä»¥è½»æ¾åœ°ä¿æŒæŸç§å…¨å±€çŠ¶æ€ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥è®©ç»„ä»¶è®¿é—®è¿™ä¸ªå…¨å±€çŠ¶æ€ã€‚</p>
<h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿‡åº¦ä½¿ç”¨æä¾›è€…æ¨¡å¼å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚æ‰€æœ‰ä½¿ç”¨ä¸Šä¸‹æ–‡çš„ç»„ä»¶åœ¨æ¯æ¬¡çŠ¶æ€æ›´æ”¹æ—¶éƒ½ä¼šé‡æ–°æ¸²æŸ“ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„è®¡æ•°å™¨ï¼Œæ¯æ¬¡æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®ç»„ä»¶ä¸­çš„å¢åŠ æŒ‰é’®æ—¶ï¼Œå€¼éƒ½ä¼šå¢åŠ ã€‚æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªé‡ç½®æŒ‰é’®ï¼Œåœ¨é‡ç½®ç»„ä»¶ä¸­ï¼Œå®ƒå°†è®¡æ•°é‡ç½®ä¸º0ã€‚</p>
<p>ç„¶è€Œï¼Œå½“ä½ ç‚¹å‡»å¢åŠ æ—¶ï¼Œä½ ä¼šå‘ç°ä¸ä»…è®¡æ•°ä¼šé‡æ–°æ¸²æŸ“ï¼Œé‡ç½®ç»„ä»¶ä¸­çš„æ—¥æœŸä¹Ÿä¼šé‡æ–°æ¸²æŸ“ï¼</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; useState, createContext, useContext, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-dom&quot;</span>;<br><span class="hljs-keyword">import</span> moment <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;moment&quot;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;./styles.css&quot;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">CountContext</span> = <span class="hljs-title function_">createContext</span>(<span class="hljs-literal">null</span>);<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Reset</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; setCount &#125; = <span class="hljs-title function_">useCountContext</span>();<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;app-col&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setCount(0)&#125;&gt;Reset count<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Last reset: &#123;moment().format(&quot;h:mm:ss a&quot;)&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Button</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; count, setCount &#125; = <span class="hljs-title function_">useCountContext</span>();<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;app-col&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;Increment<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Current count: &#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">useCountContext</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> context = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">CountContext</span>);<br>  <span class="hljs-keyword">if</span> (!context)<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<br>      <span class="hljs-string">&quot;useCountContext has to be used within CountContextProvider&quot;</span><br>    );<br>  <span class="hljs-keyword">return</span> context;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">CountContextProvider</span>(<span class="hljs-params">&#123; children &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">CountContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">count</span>, <span class="hljs-attr">setCount</span> &#125;&#125;&gt;</span></span><br><span class="language-xml">      &#123;children&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">CountContext.Provider</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;App&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">CountContextProvider</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Reset</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">CountContextProvider</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">render</span>(<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>, <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;root&quot;</span>));<br><br></code></pre></td></tr></table></figure>
<p>Resetç»„ä»¶ä¹Ÿé‡æ–°æ¸²æŸ“äº†ï¼Œå› ä¸ºå®ƒä½¿ç”¨äº†useCountContextã€‚åœ¨è¾ƒå°çš„åº”ç”¨ç¨‹åºä¸­ï¼Œè¿™ä¸ä¼šå¤ªé‡è¦ã€‚ä½†åœ¨è¾ƒå¤§çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå°†é¢‘ç¹æ›´æ–°çš„å€¼ä¼ é€’ç»™è®¸å¤šç»„ä»¶å¯èƒ½ä¼šå¯¹æ€§èƒ½äº§ç”Ÿè´Ÿé¢å½±å“ã€‚</p>
<p>ä¸ºäº†ç¡®ä¿ç»„ä»¶ä¸ä¼šæ¶ˆè€—åŒ…å«å¯èƒ½æ›´æ–°çš„ä¸å¿…è¦å€¼çš„æä¾›è€…ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªå•ç‹¬çš„ç”¨ä¾‹åˆ›å»ºå¤šä¸ªæä¾›è€…ã€‚æˆ–è€…ä½¿ç”¨useRef, æ¯”å¯¹å˜åŒ–å±æ€§, å½“å…³å¿ƒçš„å±æ€§å˜åŒ–æ—¶æ‰è¿›è¡Œæ›´æ–°ã€‚</p>
]]></content>
      <categories>
        <category>Patterns</category>
      </categories>
  </entry>
  <entry>
    <title>è§‚å¯Ÿè€…æ¨¡å¼</title>
    <url>/posts/5fa45d82.html</url>
    <content><![CDATA[<h2 id="ã€è¯‘ã€‘è§‚å¯Ÿè€…æ¨¡å¼Observer-Pattern"><a href="#ã€è¯‘ã€‘è§‚å¯Ÿè€…æ¨¡å¼Observer-Pattern" class="headerlink" title="ã€è¯‘ã€‘è§‚å¯Ÿè€…æ¨¡å¼Observer Pattern"></a>ã€è¯‘ã€‘è§‚å¯Ÿè€…æ¨¡å¼<a href="https://www.patterns.dev/vanilla/observer-pattern">Observer Pattern</a></h2><p>è§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†æŸäº›å¯¹è±¡ï¼ˆè§‚å¯Ÿè€…ï¼‰æ³¨å†Œåˆ°å¦ä¸€ä¸ªå¯¹è±¡ï¼ˆè¢«è§‚å¯Ÿè€…ï¼‰ä¸Šã€‚æ¯å½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œè¢«è§‚å¯Ÿè€…ä¼šé€šçŸ¥æ‰€æœ‰çš„è§‚å¯Ÿè€…ï¼</p>
<hr>
<p>ä¸€ä¸ªå¯è§‚å¯Ÿå¯¹è±¡é€šå¸¸åŒ…å«ä¸‰ä¸ªé‡è¦éƒ¨åˆ†ï¼š</p>
<ul>
<li>observersï¼šä¸€ä¸ªè§‚å¯Ÿè€…æ•°ç»„ï¼Œå½“ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶ä¼šé€šçŸ¥è¿™äº›è§‚å¯Ÿè€…ã€‚</li>
<li>subscribe()ï¼šç”¨äºå°†è§‚å¯Ÿè€…æ·»åŠ åˆ°è§‚å¯Ÿè€…åˆ—è¡¨çš„æ–¹æ³•ã€‚</li>
<li>unsubscribe()ï¼šç”¨äºä»è§‚å¯Ÿè€…åˆ—è¡¨ä¸­ç§»é™¤è§‚å¯Ÿè€…çš„æ–¹æ³•ã€‚</li>
<li>notify()ï¼šå½“ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…çš„æ–¹æ³•ã€‚</li>
</ul>
<p>å¤ªå¥½äº†ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¯è§‚å¯Ÿå¯¹è±¡ï¼åˆ›å»ºä¸€ä¸ªå¯è§‚å¯Ÿå¯¹è±¡çš„ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨ES6ç±»ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Observable</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span> = [];<br>  &#125;<br><br>  <span class="hljs-title function_">subscribe</span>(<span class="hljs-params">func</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span>.<span class="hljs-title function_">push</span>(func);<br>  &#125;<br><br>  <span class="hljs-title function_">unsubscribe</span>(<span class="hljs-params">func</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">observer</span>) =&gt;</span> observer !== func);<br>  &#125;<br><br>  <span class="hljs-title function_">notify</span>(<span class="hljs-params">data</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">observer</span>) =&gt;</span> <span class="hljs-title function_">observer</span>(data));<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>å¤ªæ£’äº†ï¼ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨subscribeæ–¹æ³•å°†è§‚å¯Ÿè€…æ·»åŠ åˆ°è§‚å¯Ÿè€…åˆ—è¡¨ä¸­ï¼Œä½¿ç”¨unsubscribeæ–¹æ³•ç§»é™¤è§‚å¯Ÿè€…ï¼Œå¹¶ä½¿ç”¨notifyæ–¹æ³•é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…ã€‚</p>
<p>è®©æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªå¯è§‚å¯Ÿå¯¹è±¡æ„å»ºä¸€äº›ä¸œè¥¿ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªéå¸¸åŸºæœ¬çš„åº”ç”¨ç¨‹åºï¼ŒåªåŒ…å«ä¸¤ä¸ªç»„ä»¶ï¼šä¸€ä¸ªæŒ‰é’®å’Œä¸€ä¸ªå¼€å…³ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;App&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>&gt;</span>Click me!<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">FormControlLabel</span> <span class="hljs-attr">control</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">Switch</span> /&gt;</span>&#125; /&gt;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æƒ³è¦è·Ÿè¸ªç”¨æˆ·ä¸åº”ç”¨ç¨‹åºçš„äº¤äº’ã€‚æ¯å½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æˆ–åˆ‡æ¢å¼€å…³æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›è®°å½•æ­¤äº‹ä»¶çš„æ—¶é—´æˆ³ã€‚é™¤äº†è®°å½•å®ƒï¼Œæˆ‘ä»¬è¿˜å¸Œæœ›åˆ›å»ºä¸€ä¸ªå¼¹å‡ºé€šçŸ¥ï¼Œæ¯å½“äº‹ä»¶å‘ç”Ÿæ—¶æ˜¾ç¤ºå‡ºæ¥ï¼</p>
<p>åŸºæœ¬ä¸Šï¼Œæˆ‘ä»¬æƒ³è¦åšçš„æ˜¯ä»¥ä¸‹å†…å®¹ï¼š</p>
<p>æ¯å½“ç”¨æˆ·è°ƒç”¨handleClickæˆ–handleToggleå‡½æ•°æ—¶ï¼Œè¿™äº›å‡½æ•°ä¼šåœ¨è§‚å¯Ÿè€…ä¸Šè°ƒç”¨notifyæ–¹æ³•ã€‚notifyæ–¹æ³•ä½¿ç”¨handleClickæˆ–handleToggleå‡½æ•°ä¼ é€’çš„æ•°æ®é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…ï¼</p>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ›å»ºloggerå’Œtoastifyå‡½æ•°ã€‚è¿™äº›å‡½æ•°æœ€ç»ˆå°†ä»notifyæ–¹æ³•æ¥æ”¶æ•°æ®ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ToastContainer</span>, toast &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-toastify&quot;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">logger</span>(<span class="hljs-params">data</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-built_in">Date</span>.now()&#125;</span> <span class="hljs-subst">$&#123;data&#125;</span>`</span>);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">toastify</span>(<span class="hljs-params">data</span>) &#123;<br>  <span class="hljs-title function_">toast</span>(data);<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;App&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>&gt;</span>Click me!<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">FormControlLabel</span> <span class="hljs-attr">control</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">Switch</span> /&gt;</span>&#125; /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ToastContainer</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>
<p>ç›®å‰ï¼Œloggerå’Œtoastifyå‡½æ•°è¿˜ä¸çŸ¥é“observableï¼šobservableè¿˜ä¸èƒ½é€šçŸ¥å®ƒä»¬ï¼ä¸ºäº†ä½¿å®ƒä»¬æˆä¸ºè§‚å¯Ÿè€…ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨observableä¸Šçš„subscribeæ–¹æ³•è®¢é˜…å®ƒä»¬ï¼</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ToastContainer</span>, toast &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-toastify&quot;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">logger</span>(<span class="hljs-params">data</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-built_in">Date</span>.now()&#125;</span> <span class="hljs-subst">$&#123;data&#125;</span>`</span>);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">toastify</span>(<span class="hljs-params">data</span>) &#123;<br>  <span class="hljs-title function_">toast</span>(data);<br>&#125;<br><br>observable.<span class="hljs-title function_">subscribe</span>(logger);<br>observable.<span class="hljs-title function_">subscribe</span>(toastify);<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;App&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>&gt;</span>Click me!<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">FormControlLabel</span> <span class="hljs-attr">control</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">Switch</span> /&gt;</span>&#125; /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ToastContainer</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>
<p>æ¯å½“å‘ç”Ÿäº‹ä»¶æ—¶ï¼Œloggerå’Œtoastifyå‡½æ•°å°†æ”¶åˆ°é€šçŸ¥ã€‚ç°åœ¨æˆ‘ä»¬åªéœ€è¦å®ç°å®é™…é€šçŸ¥observableçš„å‡½æ•°ï¼šhandleClickå’ŒhandleToggleå‡½æ•°ï¼è¿™äº›å‡½æ•°åº”è¯¥åœ¨observableä¸Šè°ƒç”¨notifyæ–¹æ³•ï¼Œå¹¶ä¼ é€’è§‚å¯Ÿè€…åº”è¯¥æ¥æ”¶çš„æ•°æ®ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ToastContainer</span>, toast &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-toastify&quot;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">logger</span>(<span class="hljs-params">data</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-built_in">Date</span>.now()&#125;</span> <span class="hljs-subst">$&#123;data&#125;</span>`</span>);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">toastify</span>(<span class="hljs-params">data</span>) &#123;<br>  <span class="hljs-title function_">toast</span>(data);<br>&#125;<br><br>observable.<span class="hljs-title function_">subscribe</span>(logger);<br>observable.<span class="hljs-title function_">subscribe</span>(toastify);<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>    observable.<span class="hljs-title function_">notify</span>(<span class="hljs-string">&quot;User clicked button!&quot;</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleToggle</span>(<span class="hljs-params"></span>) &#123;<br>    observable.<span class="hljs-title function_">notify</span>(<span class="hljs-string">&quot;User toggled switch!&quot;</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;App&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>&gt;</span>Click me!<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">FormControlLabel</span> <span class="hljs-attr">control</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">Switch</span> /&gt;</span>&#125; /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ToastContainer</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å¤ªæ£’äº†ï¼æˆ‘ä»¬åˆšåˆšå®Œæˆäº†æ•´ä¸ªæµç¨‹ï¼šhandleClickå’ŒhandleToggleè°ƒç”¨è§‚å¯Ÿè€…ä¸Šçš„notifyæ–¹æ³•, ä¼ é€’æ•°æ®ï¼Œç„¶åè§‚å¯Ÿè€…é€šçŸ¥è®¢é˜…è€…ï¼šåœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯loggerå’Œtoastifyå‡½æ•°ã€‚</p>
<p>è™½ç„¶æˆ‘ä»¬å¯ä»¥ä»¥è®¸å¤šæ–¹å¼ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼ï¼Œä½†åœ¨å¤„ç†å¼‚æ­¥ã€åŸºäºäº‹ä»¶çš„æ•°æ®æ—¶ï¼Œå®ƒéå¸¸æœ‰ç”¨ã€‚ä¹Ÿè®¸æ‚¨å¸Œæœ›åœ¨æŸäº›æ•°æ®ä¸‹è½½å®Œæˆæ—¶é€šçŸ¥ç‰¹å®šç»„ä»¶ï¼Œæˆ–è€…åœ¨ç”¨æˆ·å‘ç•™è¨€æ¿å‘é€æ–°æ¶ˆæ¯æ—¶é€šçŸ¥æ‰€æœ‰å…¶ä»–æˆå‘˜ã€‚è§‚å¯Ÿè€…æ¨¡å¼å…è®¸ä¸»é¢˜ï¼ˆå¯è§‚å¯Ÿå¯¹è±¡ï¼‰å’Œè§‚å¯Ÿè€…ä¹‹é—´çš„æ¾è€¦åˆã€‚è¿™æ„å‘³ç€ä¸»é¢˜ä¸éœ€è¦ç›´æ¥äº†è§£è§‚å¯Ÿè€…ï¼Œè§‚å¯Ÿè€…å¯ä»¥è½»æ¾æ·»åŠ æˆ–åˆ é™¤è€Œä¸å½±å“ä¸»é¢˜ã€‚</p>
<hr>
<h3 id="æ¡ˆä¾‹ç ”ç©¶"><a href="#æ¡ˆä¾‹ç ”ç©¶" class="headerlink" title="æ¡ˆä¾‹ç ”ç©¶"></a>æ¡ˆä¾‹ç ”ç©¶</h3><p>ä¸€ä¸ªä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼çš„æµè¡Œåº“æ˜¯RxJSã€‚</p>
<blockquote>
<p>ReactiveXå°†è§‚å¯Ÿè€…æ¨¡å¼ä¸è¿­ä»£å™¨æ¨¡å¼å’Œå‡½æ•°å¼ç¼–ç¨‹ä¸é›†åˆç›¸ç»“åˆï¼Œä»¥æ»¡è¶³ç®¡ç†äº‹ä»¶åºåˆ—çš„ç†æƒ³æ–¹å¼çš„éœ€æ±‚ã€‚- RxJS</p>
</blockquote>
<p>ä½¿ç”¨RxJSï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºå¯è§‚å¯Ÿå¯¹è±¡å¹¶è®¢é˜…ç‰¹å®šçš„äº‹ä»¶ï¼è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªåœ¨ä»–ä»¬çš„æ–‡æ¡£ä¸­æ¶µç›–çš„ä¾‹å­ï¼Œå®ƒè®°å½•ç”¨æˆ·æ˜¯å¦åœ¨æ–‡æ¡£ä¸­æ‹–åŠ¨ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-dom&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; fromEvent, merge &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;rxjs&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; sample, mapTo &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;rxjs/operators&quot;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;./styles.css&quot;</span>;<br><br><span class="hljs-title function_">merge</span>(<br>  <span class="hljs-title function_">fromEvent</span>(<span class="hljs-variable language_">document</span>, <span class="hljs-string">&quot;mousedown&quot;</span>).<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">mapTo</span>(<span class="hljs-literal">false</span>)),<br>  <span class="hljs-title function_">fromEvent</span>(<span class="hljs-variable language_">document</span>, <span class="hljs-string">&quot;mousemove&quot;</span>).<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">mapTo</span>(<span class="hljs-literal">true</span>))<br>)<br>  .<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">sample</span>(<span class="hljs-title function_">fromEvent</span>(<span class="hljs-variable language_">document</span>, <span class="hljs-string">&quot;mouseup&quot;</span>)))<br>  .<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">isDragging</span> =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Were you dragging?&quot;</span>, isDragging);<br>  &#125;);<br><br><span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">render</span>(<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;App&quot;</span>&gt;</span>Click or drag anywhere and check the console!<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>,<br>  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;root&quot;</span>)<br>);<br><br></code></pre></td></tr></table></figure>

<hr>
<h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><p>ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼æ˜¯å®ç°å…³æ³¨ç‚¹åˆ†ç¦»å’Œå•ä¸€èŒè´£åŸåˆ™çš„å¥½æ–¹æ³•ã€‚è§‚å¯Ÿè€…å¯¹è±¡ä¸è¢«è§‚å¯Ÿå¯¹è±¡æ²¡æœ‰ç´§å¯†è€¦åˆï¼Œå¯ä»¥åœ¨ä»»ä½•æ—¶å€™è¿›è¡Œè§£è€¦ã€‚è¢«è§‚å¯Ÿå¯¹è±¡è´Ÿè´£ç›‘æ§äº‹ä»¶ï¼Œè€Œè§‚å¯Ÿè€…åªéœ€å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®ã€‚</p>
<h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><p>å¦‚æœè§‚å¯Ÿè€…å˜å¾—è¿‡äºå¤æ‚ï¼Œå½“é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…æ—¶å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚</p>
]]></content>
      <categories>
        <category>Patterns</category>
      </categories>
  </entry>
  <entry>
    <title>reactæºç å­¦ä¹ -beginWork-dom-diff</title>
    <url>/posts/cd6ab115.html</url>
    <content><![CDATA[<h3 id="ç†è®º"><a href="#ç†è®º" class="headerlink" title="ç†è®º"></a>ç†è®º</h3><p>mountæ—¶ï¼Œç”±äºæ²¡æœ‰æ—§èŠ‚ç‚¹ï¼Œdom-diffç›´æ¥æ ¹æ®jsx element åˆ›å»ºæ–°fiberçš„ç›´è¿å­é“¾è¡¨ child<br>æ›´æ–°æ—¶ï¼Œdom-diffæ‰“æ ‡ç­¾</p>
<p>reconcileChildrenArrayæ˜¯å…³é”®ï¼Œdom-diff ä¼šäº§ç”Ÿæ’å…¥tag, ç»™çˆ¶fiberåˆ é™¤tagï¼Œæ²¡æœ‰æ›´æ–°ã€‚</p>
<ol>
<li>åˆ é™¤å°±æ˜¯ï¼Œç»™çˆ¶fiberä¸€ä¸ªåˆ é™¤æ ‡è®°ï¼Œæ—§fiberåœ¨æ—§fiberæ ‘é‡Œä¸ç”¨åŠ¨ï¼Œæ ‡è®°å°±è¡Œï¼Œcommité˜¶æ®µåˆ çœŸå®dom</li>
<li>æ’å…¥å°±æ˜¯ï¼Œåˆ›å»ºä¸€ä¸ªfiberï¼Œæ”¾åˆ°æ–°fiberæ ‘é‡Œï¼Œæ ‡è®°å½“å‰fiberæ’å…¥</li>
<li>ç§»åŠ¨å°±æ˜¯ï¼Œåˆ›å»ºä¸€ä¸ªfiberï¼Œæ”¾åˆ°æ–°fiberæ ‘é‡Œï¼Œæ ‡è®°å½“å‰fiberæ’å…¥<br>ç§»åŠ¨å°±æ˜¯æ’å…¥<br>å¤ç”¨è¿™ä¸ªè€fiberæ”¾å…¥æ–°fiberæ ‘é‡Œï¼Œæ•°ç»„ä½ç½®å˜äº†ï¼Œå…³è”æ–°fiberæ ‘ï¼Œä¸Šä¸ªfiberçš„sibling</li>
</ol>
<h3 id="å•èŠ‚ç‚¹dom-diff"><a href="#å•èŠ‚ç‚¹dom-diff" class="headerlink" title="å•èŠ‚ç‚¹dom-diff"></a>å•èŠ‚ç‚¹dom-diff</h3><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * å•èŠ‚ç‚¹dom-diff</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * æ–°fiberæ˜¯å•èŠ‚ç‚¹ï¼Œè€fiberå¯èƒ½æ˜¯æ•°ç»„</span><br><span class="hljs-comment">  * old fibers [1, 2, 3]  new fiber [2]</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * 1. å¦‚æœkey, typeç›¸åŒï¼Œåˆ™å¤ç”¨ï¼Œåˆ é™¤æ—§fiberæ•°ç»„å‰©ä¸‹çš„fiber</span><br><span class="hljs-comment">  * 2. å¦‚æœkeyä¸åŒï¼Œåˆ é™¤è¿™ä¸ªè€fiber(commité˜¶æ®µé€’å½’åˆ é™¤æ•´ä¸ªå­æ ‘)ï¼Œç»§ç»­éå†æ—§çš„fiberæ•°ç»„</span><br><span class="hljs-comment">  * 3. å¦‚æœkeyç›¸åŒï¼Œtypeä¸åŒï¼Œåˆ é™¤fiberæ•°ç»„å‰©ä¸‹çš„fiberï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ã€‚åˆ é™¤æ“ä½œéƒ½æ˜¯ç›´æ¥åˆ é™¤å½“å‰ä¸ºæ ¹çš„å­æ ‘</span><br><span class="hljs-comment">  * 4. æ²¡æœ‰è€fiber, mountæ—¶ï¼Œæ ¹æ®elementåˆ›å»ºfiberæŒ‚è½½åˆ°returnFiber</span><br><span class="hljs-comment">  * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; returnFiber çˆ¶fiber</span><br><span class="hljs-comment">  * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; currentFirstChild å­fiberé“¾è¡¨ç¬¬ä¸€ä¸ªfiber è€fiberé“¾è¡¨</span><br><span class="hljs-comment">  * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; element çˆ¶fiberçš„domçš„child</span><br><span class="hljs-comment">  * <span class="hljs-doctag">@returns</span></span><br><span class="hljs-comment">  */</span><br> <span class="hljs-keyword">function</span> <span class="hljs-title function_">reconcileSingleElement</span>(<span class="hljs-params">returnFiber, currentFirstChild, element</span>) &#123;<br>   <span class="hljs-comment">// å•èŠ‚ç‚¹dom diff</span><br>   <span class="hljs-comment">// æ–°fiberçš„key</span><br>   <span class="hljs-keyword">const</span> key = element.<span class="hljs-property">key</span>;<br>   <span class="hljs-comment">// æ–°fiberçš„type</span><br>   <span class="hljs-keyword">const</span> type = element.<span class="hljs-property">type</span>;<br>   <span class="hljs-comment">// è€fiber</span><br>   <span class="hljs-keyword">let</span> child = currentFirstChild;<br>   <span class="hljs-keyword">while</span> (child !== <span class="hljs-literal">null</span>) &#123;<br>     <span class="hljs-keyword">if</span> (child.<span class="hljs-property">key</span> === key) &#123;<br>       <span class="hljs-keyword">if</span> (child.<span class="hljs-property">type</span> === type) &#123;<br>         <span class="hljs-comment">// åˆ é™¤è€fiberä¹‹åçš„æ‰€æœ‰siblingèŠ‚ç‚¹</span><br>         <span class="hljs-title function_">deleteRemainingChildren</span>(returnFiber, child.<span class="hljs-property">sibling</span>);<br>         <span class="hljs-comment">// å¦‚æœkeyå’Œç±»å‹ä¸€æ ·ï¼Œåˆ™å¤ç”¨</span><br>         <span class="hljs-keyword">const</span> existing = <span class="hljs-title function_">useFiber</span>(child, element.<span class="hljs-property">props</span>);<br>         existing.<span class="hljs-property">ref</span> = element.<span class="hljs-property">ref</span>;<br>         existing.<span class="hljs-property">return</span> = returnFiber;<br>         <span class="hljs-keyword">return</span> existing;<br>       &#125; <span class="hljs-keyword">else</span> &#123;<br>         <span class="hljs-comment">// å¦‚æœkeyç›¸åŒï¼Œtypeä¸åŒï¼Œè¿™ä¸ªè€fiberè¦åˆ é™¤ï¼Œæ¢æ–°ç±»å‹çš„fiber</span><br>         <span class="hljs-comment">// æ‰¾åˆ°äº†ä¸€ä¸ªä¹‹åçš„è€fiberéƒ½ä¸ç”¨çœ‹äº†ï¼Œç›´æ¥æ¸…ç©ºè·³å‡ºå¾ªç¯ï¼Œèµ°åˆ›å»ºfiberçš„é€»è¾‘</span><br>         <span class="hljs-comment">// go to createFiberFromElement</span><br>         <span class="hljs-title function_">deleteRemainingChildren</span>(returnFiber, child);<br>       &#125;<br>     &#125; <span class="hljs-keyword">else</span> &#123;<br>       <span class="hljs-title function_">deleteChild</span>(returnFiber, child);<br>     &#125;<br>     child = child.<span class="hljs-property">sibling</span>;<br>   &#125;<br><br>   <span class="hljs-keyword">const</span> created = <span class="hljs-title function_">createFiberFromElement</span>(element);<br>   created.<span class="hljs-property">ref</span> = element.<span class="hljs-property">ref</span>;<br>   created.<span class="hljs-property">return</span> = returnFiber;<br>   <span class="hljs-keyword">return</span> created;<br> &#125;<br></code></pre></td></tr></table></figure>

<h3 id="å¤šèŠ‚ç‚¹dom-diff"><a href="#å¤šèŠ‚ç‚¹dom-diff" class="headerlink" title="å¤šèŠ‚ç‚¹dom-diff"></a>å¤šèŠ‚ç‚¹dom-diff</h3><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * DOM DIFFçš„ä¸‰ä¸ªè§„åˆ™</span><br><span class="hljs-comment">  * åªå¯¹åŒçº§å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œä¸åŒå±‚çº§ä¸å¯¹æ¯”</span><br><span class="hljs-comment">  * ä¸åŒçš„ç±»å‹å¯¹åº”ä¸åŒçš„å…ƒç´ ï¼Œç›´æ¥æ•´ä¸ªå­æ ‘åˆ é™¤</span><br><span class="hljs-comment">  * å¯ä»¥é€šè¿‡keyæ¥æ ‡è¯†åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œé€šè¿‡mapæ¥ç§»åŠ¨å¤ç”¨</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * ç¬¬1è½®éå†</span><br><span class="hljs-comment">  * keyä¸åŒï¼Œç›´æ¥ç»“æŸæœ¬è½®å¾ªç¯ï¼Œç¬¬2è½®å¾ªç¯ (*)</span><br><span class="hljs-comment">  * keyç›¸åŒï¼Œtypeä¸åŒï¼Œæ ‡è®°è€fiberåˆ é™¤, åˆ›å»ºæ–°çš„fiberï¼Œç»§ç»­å¾ªç¯</span><br><span class="hljs-comment">  * keyç›¸åŒï¼Œtypeä¹Ÿç›¸åŒï¼Œå¤ç”¨è€fiber, ç»§ç»­å¾ªç¯</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * ç¬¬2è½®éå†</span><br><span class="hljs-comment">  * å¦‚æœæœ‰1ä¸ªç»“æŸäº†</span><br><span class="hljs-comment">  *   newChildrenéå†å®Œï¼ŒoldFiberè¿˜æœ‰ï¼Œå°†å‰©ä¸‹oldFiberæ ‡è®°åˆ é™¤ï¼Œdiffç»“æŸ</span><br><span class="hljs-comment">  *   oldFiberéå†å®Œäº†ï¼ŒnewChildrenè¿˜æœ‰ï¼Œå°†å‰©ä¸‹newChildrenæ ‡è®°æ’å…¥ï¼Œdiffç»“æŸ</span><br><span class="hljs-comment">  * newChildrenå’ŒoldFiberéƒ½éå†å®Œæˆï¼Œdiffç»“æŸ</span><br><span class="hljs-comment">  * newChildrenå’ŒoldFiberéƒ½è¿˜æœ‰èŠ‚ç‚¹ï¼Œç¬¬3è½®å¾ªç¯ï¼ŒèŠ‚ç‚¹ç§»åŠ¨(*)</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * ç¬¬3è½®éå†</span><br><span class="hljs-comment">  * keyä¸åŒè·³å‡ºç¬¬1ä¸ªå¾ªç¯ï¼Œå¹¶ä¸”æ–°æ—§2ä¸ªé“¾è¡¨éƒ½æœ‰å‰©ä½™</span><br><span class="hljs-comment">  * ç”¨mapè®°å½•ï¼Œkey:oldFiberè®°å½•åˆ°map</span><br><span class="hljs-comment">  * ä»å‰å¾€åéå†ï¼Œå¦‚æœè¿™ä¸ªèŠ‚ç‚¹åœ¨å‰é¢ä½ç½®ï¼Œåˆ™å¤ç”¨ç§»åŠ¨è¿‡æ¥</span><br><span class="hljs-comment">  * å¦‚æœæ²¡æœ‰èƒ½å¤ç”¨çš„ï¼Œåˆ™åˆ›å»º</span><br><span class="hljs-comment">  * å¦‚æœå¤šä½™äº†ï¼Œåˆ™åˆ é™¤</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * mounté˜¶æ®µï¼ŒolderFiberä¸€ä¸ªæ²¡æœ‰ï¼Œåœ¨ç¬¬äºŒè½®å¾ªç¯ç›´æ¥å…¨éƒ¨åˆ›å»ºæ–°fiber</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; returnFiber çˆ¶fiber</span><br><span class="hljs-comment">  * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; currentFirstChild newChildrenå¯¹äºçš„æ—§fiber</span><br><span class="hljs-comment">  * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; newChildren çˆ¶fiberç¬¬ä¸€ä¸ªchild</span><br><span class="hljs-comment">  * <span class="hljs-doctag">@returns</span></span><br><span class="hljs-comment">  */</span><br> <span class="hljs-keyword">function</span> <span class="hljs-title function_">reconcileChildrenArray</span>(<span class="hljs-params">returnFiber, currentFirstChild, newChildren</span>) &#123;<br>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<br>     <span class="hljs-string">&quot;reconcileChildrenArray returnFiber&quot;</span>,<br>     returnFiber,<br>     currentFirstChild,<br>     newChildren<br>   );<br>   <span class="hljs-keyword">let</span> resultingFirstChild = <span class="hljs-literal">null</span>; <span class="hljs-comment">// æ–°fiberé“¾è¡¨çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span><br>   <span class="hljs-keyword">let</span> previousNewFiber = <span class="hljs-literal">null</span>; <span class="hljs-comment">// æ–°fiberé“¾è¡¨çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹</span><br><br>   <span class="hljs-keyword">let</span> newIdx = <span class="hljs-number">0</span>; <span class="hljs-comment">// éå†æ–°childæ•°ç»„çš„æŒ‡é’ˆ</span><br><br>   <span class="hljs-keyword">let</span> oldFiber = currentFirstChild; <span class="hljs-comment">//  éå†è€fiberé“¾è¡¨çš„æŒ‡é’ˆ åˆå§‹ç¬¬ä¸€ä¸ªè€fiber</span><br>   <span class="hljs-keyword">let</span> nextOldFiber = <span class="hljs-literal">null</span>; <span class="hljs-comment">// éå†è€fiberé“¾è¡¨çš„ä¸‹ä¸€ä¸ªæŒ‡é’ˆ</span><br><br>   <span class="hljs-keyword">let</span> lastPlacedIndex = <span class="hljs-number">0</span>; <span class="hljs-comment">// ä¸Šä¸€ä¸ªä¸éœ€è¦ç§»åŠ¨çš„èŠ‚ç‚¹çš„ç´¢å¼•</span><br><br>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;first loop. try to reuse.&quot;</span>);<br>   <span class="hljs-keyword">for</span> (; oldFiber !== <span class="hljs-literal">null</span> &amp;&amp; newIdx &lt; newChildren.<span class="hljs-property">length</span>; newIdx++) &#123;<br>     nextOldFiber = oldFiber.<span class="hljs-property">sibling</span>;<br><br>     <span class="hljs-comment">// è¯•å›¾æ›´æ–°æˆ–è€…å¤ç”¨è€fiber</span><br>     <span class="hljs-keyword">const</span> newFiber = <span class="hljs-title function_">updateSlot</span>(returnFiber, oldFiber, newChildren[newIdx]);<br>     <span class="hljs-keyword">if</span> (newFiber === <span class="hljs-literal">null</span>) &#123;<br>       <span class="hljs-keyword">break</span>;<br>     &#125;<br>     <span class="hljs-keyword">if</span> (shouldTrackSideEffects) &#123;<br>       <span class="hljs-comment">// å¦‚æœæœ‰è€fiber, ä½†æ˜¯æ–°çš„fiberå¹¶æ²¡æœ‰æˆåŠŸå¤ç”¨ï¼Œå°±æ ‡è®°åˆ é™¤è€fiber samekeydifferenttype 1</span><br>       <span class="hljs-keyword">if</span> (oldFiber &amp;&amp; newFiber.<span class="hljs-property">alternate</span> === <span class="hljs-literal">null</span>) &#123;<br>         <span class="hljs-title function_">deleteChild</span>(returnFiber, oldFiber);<br>       &#125;<br>     &#125;<br>     <span class="hljs-comment">// æŒ‡å®šfiberçš„ä½ç½®, å¹¶æ ‡è®°æ’å…¥</span><br>     lastPlacedIndex = <span class="hljs-title function_">placeChild</span>(newFiber, lastPlacedIndex, newIdx);<br>     <span class="hljs-keyword">if</span> (previousNewFiber === <span class="hljs-literal">null</span>) &#123;<br>       resultingFirstChild = newFiber;<br>     &#125; <span class="hljs-keyword">else</span> &#123;<br>       previousNewFiber.<span class="hljs-property">sibling</span> = newFiber;<br>     &#125;<br>     previousNewFiber = newFiber;<br>     oldFiber = nextOldFiber;<br>   &#125;<br><br>   <span class="hljs-comment">// å¦‚æœæ–°fiberå·²ç»æ²¡æœ‰äº†ï¼Œæ—§fiberé“¾è¡¨è¿˜æœ‰ï¼Œå°†oldé“¾è¡¨å‰©ä¸‹çš„å…¨åˆ æ‰</span><br>   <span class="hljs-keyword">if</span> (newIdx === newChildren.<span class="hljs-property">length</span>) &#123;<br>     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;new fibers is done. delete remaining old fiber&quot;</span>, oldFiber);<br>     <span class="hljs-title function_">deleteRemainingChildren</span>(returnFiber, oldFiber);<br>     <span class="hljs-keyword">return</span> resultingFirstChild;<br>   &#125;<br><br>   <span class="hljs-keyword">if</span> (oldFiber === <span class="hljs-literal">null</span>) &#123;<br>     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;no old fiber. create remaining fibers&quot;</span>);<br>     <span class="hljs-comment">// å¦‚æœè€fiberå·²ç»æ²¡æœ‰äº†ï¼Œæ–°è™šæ‹Ÿdomè¿˜æœ‰ï¼Œæ’å…¥å‰©ä¸‹çš„æ–°èŠ‚ç‚¹</span><br>     <span class="hljs-keyword">for</span> (; newIdx &lt; newChildren.<span class="hljs-property">length</span>; newIdx++) &#123;<br>       <span class="hljs-keyword">const</span> newFiber = <span class="hljs-title function_">createChild</span>(returnFiber, newChildren[newIdx]);<br>       <span class="hljs-keyword">if</span> (newFiber === <span class="hljs-literal">null</span>) <span class="hljs-keyword">continue</span>;<br>       <span class="hljs-comment">// åŠ index å’Œ flags</span><br>       lastPlacedIndex = <span class="hljs-title function_">placeChild</span>(newFiber, lastPlacedIndex, newIdx);<br><br>       <span class="hljs-comment">// child fiberé“¾è¡¨</span><br>       <span class="hljs-keyword">if</span> (previousNewFiber === <span class="hljs-literal">null</span>) &#123;<br>         resultingFirstChild = newFiber;<br>       &#125; <span class="hljs-keyword">else</span> &#123;<br>         previousNewFiber.<span class="hljs-property">sibling</span> = newFiber;<br>       &#125;<br>       previousNewFiber = newFiber;<br>     &#125;<br>   &#125;<br><br>   <span class="hljs-comment">// å¼€å§‹å¤„ç†ç§»åŠ¨çš„æƒ…å†µ</span><br>   <span class="hljs-keyword">const</span> existingChildren = <span class="hljs-title function_">mapRemainingChildren</span>(returnFiber, oldFiber);<br>   <span class="hljs-comment">// å¼€å§‹éå†å‰©ä¸‹çš„è™šæ‹Ÿdomå­èŠ‚ç‚¹</span><br>   <span class="hljs-keyword">for</span> (; newIdx &lt; newChildren.<span class="hljs-property">length</span>; newIdx++) &#123;<br>     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;move reuse.&quot;</span>);<br>     <span class="hljs-comment">// ç§»åŠ¨å¤ç”¨æˆ–åˆ›å»ºæ–°èŠ‚ç‚¹</span><br>     <span class="hljs-keyword">const</span> newFiber = <span class="hljs-title function_">updateFromMap</span>(<br>       existingChildren,<br>       returnFiber,<br>       newIdx,<br>       newChildren[newIdx]<br>     );<br>     <span class="hljs-keyword">if</span> (newFiber !== <span class="hljs-literal">null</span>) &#123;<br>       <span class="hljs-keyword">if</span> (shouldTrackSideEffects) &#123;<br>         <span class="hljs-comment">// ç§»åŠ¨å¤ç”¨äº†çš„è€fiber ä»fiberåˆ é™¤</span><br>         <span class="hljs-keyword">if</span> (newFiber.<span class="hljs-property">alternate</span> !== <span class="hljs-literal">null</span>) &#123;<br>           existingChildren.<span class="hljs-title function_">delete</span>(<br>             newFiber.<span class="hljs-property">key</span> === <span class="hljs-literal">null</span> ? newIdx : newFiber.<span class="hljs-property">key</span><br>           );<br>         &#125;<br>       &#125;<br>       <span class="hljs-comment">// æ ‡è®°æ’å…¥ï¼Œä¹Ÿå°±æ˜¯ç§»åŠ¨ï¼Œå°†åŸdomæ’å…¥åˆ°å¦ä¸€ä¸ªä½ç½®å°±æ˜¯ç§»åŠ¨</span><br>       lastPlacedIndex = <span class="hljs-title function_">placeChild</span>(newFiber, lastPlacedIndex, newIdx);<br>       <span class="hljs-comment">// newFiberæŒ‚åˆ°é“¾è¡¨é‡Œ</span><br>       <span class="hljs-keyword">if</span> (previousNewFiber === <span class="hljs-literal">null</span>) &#123;<br>         resultingFirstChild = newFiber;<br>       &#125; <span class="hljs-keyword">else</span> &#123;<br>         previousNewFiber.<span class="hljs-property">sibling</span> = newFiber;<br>       &#125;<br>       previousNewFiber = newFiber;<br>     &#125;<br>   &#125;<br><br>   <span class="hljs-keyword">if</span> (shouldTrackSideEffects) &#123;<br>     <span class="hljs-comment">// mapå‰©ä¸‹çš„å…¨éƒ¨åˆ é™¤</span><br>     existingChildren.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">child</span>) =&gt;</span> <span class="hljs-title function_">deleteChild</span>(returnFiber, child));<br>   &#125;<br><br>   <span class="hljs-keyword">return</span> resultingFirstChild;<br> &#125;<br></code></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>React</category>
      </categories>
  </entry>
  <entry>
    <title>ä»£ç†æ¨¡å¼</title>
    <url>/posts/5be0a306.html</url>
    <content><![CDATA[<h2 id="ã€è¯‘ã€‘ä»£ç†æ¨¡å¼Proxy-Pattern"><a href="#ã€è¯‘ã€‘ä»£ç†æ¨¡å¼Proxy-Pattern" class="headerlink" title="ã€è¯‘ã€‘ä»£ç†æ¨¡å¼Proxy Pattern"></a>ã€è¯‘ã€‘ä»£ç†æ¨¡å¼<a href="https://www.patterns.dev/vanilla/proxy-pattern">Proxy Pattern</a></h2><p>é€šè¿‡ä»£ç†å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥æ›´å¥½åœ°æ§åˆ¶ä¸æŸäº›å¯¹è±¡çš„äº¤äº’ã€‚ä»£ç†å¯¹è±¡å¯ä»¥ç¡®å®šæˆ‘ä»¬ä¸å¯¹è±¡äº¤äº’æ—¶çš„è¡Œä¸ºï¼Œä¾‹å¦‚è·å–å€¼æˆ–è®¾ç½®å€¼æ—¶ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œä»£ç†æ„å‘³ç€æ›¿èº«ã€‚ä¸ç›´æ¥ä¸æŸäººäº¤è°ˆä¸åŒï¼Œä½ å°†ä¸ä»£ç†äººäº¤è°ˆï¼Œä»£ç†äººå°†ä»£è¡¨ä½ è¯•å›¾è”ç³»çš„äººã€‚åœ¨JavaScriptä¸­ä¹Ÿæ˜¯å¦‚æ­¤ï¼šæˆ‘ä»¬ä¸ç›´æ¥ä¸ç›®æ ‡å¯¹è±¡äº¤äº’ï¼Œè€Œæ˜¯ä¸ä»£ç†å¯¹è±¡äº¤äº’ã€‚</p>
<hr>
<p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè¡¨ç¤ºJohn Doeçš„Personå¯¹è±¡ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> person = &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;John Doe&quot;</span>,<br>  <span class="hljs-attr">age</span>: <span class="hljs-number">42</span>,<br>  <span class="hljs-attr">nationality</span>: <span class="hljs-string">&quot;American&quot;</span>,<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>ä¸ç›´æ¥ä¸è¿™ä¸ªå¯¹è±¡äº¤äº’ä¸åŒï¼Œæˆ‘ä»¬å¸Œæœ›ä¸ä¸€ä¸ªä»£ç†å¯¹è±¡äº¤äº’ã€‚åœ¨JavaScriptä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºProxyçš„æ–°å®ä¾‹æ¥è½»æ¾åˆ›å»ºä¸€ä¸ªæ–°çš„ä»£ç†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> person = &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;John Doe&quot;</span>,<br>  <span class="hljs-attr">age</span>: <span class="hljs-number">42</span>,<br>  <span class="hljs-attr">nationality</span>: <span class="hljs-string">&quot;American&quot;</span>,<br>&#125;;<br><br><span class="hljs-keyword">const</span> personProxy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(person, &#123;&#125;);<br></code></pre></td></tr></table></figure>
<p>Proxyçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªè¡¨ç¤ºå¤„ç†ç¨‹åºçš„å¯¹è±¡ã€‚åœ¨å¤„ç†ç¨‹åºå¯¹è±¡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®äº¤äº’ç±»å‹å®šä¹‰ç‰¹å®šçš„è¡Œä¸ºã€‚è™½ç„¶ä½ å¯ä»¥åœ¨Proxyå¤„ç†ç¨‹åºä¸­æ·»åŠ è®¸å¤šæ–¹æ³•ï¼Œä½†æœ€å¸¸è§çš„ä¸¤ä¸ªæ–¹æ³•æ˜¯getå’Œsetï¼š</p>
<ul>
<li>getï¼šåœ¨å°è¯•è®¿é—®å±æ€§æ—¶è°ƒç”¨</li>
<li>setï¼šåœ¨å°è¯•ä¿®æ”¹å±æ€§æ—¶è°ƒç”¨</li>
</ul>
<p>å®é™…ä¸Šï¼Œæœ€ç»ˆä¼šå‘ç”Ÿä»¥ä¸‹æƒ…å†µï¼š</p>
<p><img src="/pic/proxy-set.png" alt="proxy-set"></p>
<p>ä¸ç›´æ¥ä¸personå¯¹è±¡äº¤äº’ä¸åŒï¼Œæˆ‘ä»¬å°†ä¸personProxyä»£ç†å¯¹è±¡äº¤äº’ã€‚</p>
<p>è®©æˆ‘ä»¬ä¸ºpersonProxyä»£ç†å¯¹è±¡æ·»åŠ å¤„ç†ç¨‹åºã€‚å½“å°è¯•ä¿®æ”¹å±æ€§æ—¶ï¼Œå³è°ƒç”¨Proxyçš„setæ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›ä»£ç†è®°å½•å±æ€§çš„å…ˆå‰å€¼å’Œæ–°å€¼ã€‚å½“å°è¯•è®¿é—®å±æ€§æ—¶ï¼Œå³è°ƒç”¨Proxyçš„getæ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›ä»£ç†è®°å½•ä¸€ä¸ªæ›´å¯è¯»çš„å¥å­ï¼Œå…¶ä¸­åŒ…å«å±æ€§çš„é”®å’Œå€¼ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> personProxy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(person, &#123;<br>  <span class="hljs-attr">get</span>: <span class="hljs-function">(<span class="hljs-params">obj, prop</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`The value of <span class="hljs-subst">$&#123;prop&#125;</span> is <span class="hljs-subst">$&#123;obj[prop]&#125;</span>`</span>);<br>  &#125;,<br>  <span class="hljs-attr">set</span>: <span class="hljs-function">(<span class="hljs-params">obj, prop, value</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Changed <span class="hljs-subst">$&#123;prop&#125;</span> from <span class="hljs-subst">$&#123;obj[prop]&#125;</span> to <span class="hljs-subst">$&#123;value&#125;</span>`</span>);<br>    obj[prop] = value;<br>  &#125;,<br>&#125;);<br><br>personProxy.<span class="hljs-property">name</span>;<br><br>personProxy.<span class="hljs-property">age</span> = <span class="hljs-number">43</span>;<br><br><span class="hljs-comment">// The value of name is John Doe</span><br><span class="hljs-comment">// Changed age from 42 to 43</span><br></code></pre></td></tr></table></figure>

<p>å®Œç¾ï¼è®©æˆ‘ä»¬çœ‹çœ‹å½“æˆ‘ä»¬å°è¯•ä¿®æ”¹æˆ–æ£€ç´¢å±æ€§æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p>
<p>å½“è®¿é—®nameå±æ€§æ—¶ï¼Œä»£ç†è¿”å›äº†ä¸€ä¸ªæ›´å¥½å¬çš„å¥å­ï¼šnameçš„å€¼æ˜¯John Doeã€‚</p>
<p>å½“ä¿®æ”¹ageå±æ€§æ—¶ï¼Œä»£ç†è¿”å›äº†è¯¥å±æ€§çš„å…ˆå‰å€¼å’Œæ–°å€¼ï¼šå°†ageä»42æ›´æ”¹ä¸º43ã€‚</p>
<hr>
<p>ä»£ç†å¯ä»¥ç”¨äºæ·»åŠ éªŒè¯ã€‚ç”¨æˆ·ä¸åº”è¯¥èƒ½å¤Ÿå°†personçš„å¹´é¾„æ›´æ”¹ä¸ºå­—ç¬¦ä¸²å€¼ï¼Œæˆ–è€…ç»™ä»–ä»¬ä¸€ä¸ªç©ºçš„åå­—ã€‚æˆ–è€…å¦‚æœç”¨æˆ·å°è¯•è®¿é—®å¯¹è±¡ä¸Šä¸å­˜åœ¨çš„å±æ€§ï¼Œæˆ‘ä»¬åº”è¯¥è®©ç”¨æˆ·çŸ¥é“ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> person = &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;John Doe&quot;</span>,<br>  <span class="hljs-attr">age</span>: <span class="hljs-number">42</span>,<br>  <span class="hljs-attr">nationality</span>: <span class="hljs-string">&quot;American&quot;</span><br>&#125;;<br><br><span class="hljs-keyword">const</span> personProxy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(person, &#123;<br>  <span class="hljs-attr">get</span>: <span class="hljs-function">(<span class="hljs-params">obj, prop</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (!obj[prop]) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hmm.. this property doesn&#x27;t seem to exist`</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`The value of <span class="hljs-subst">$&#123;prop&#125;</span> is <span class="hljs-subst">$&#123;obj[prop]&#125;</span>`</span>);<br>    &#125;<br>  &#125;,<br>  <span class="hljs-attr">set</span>: <span class="hljs-function">(<span class="hljs-params">obj, prop, value</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">&quot;age&quot;</span> &amp;&amp; <span class="hljs-keyword">typeof</span> value !== <span class="hljs-string">&quot;number&quot;</span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Sorry, you can only pass numeric values for age.`</span>);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">&quot;name&quot;</span> &amp;&amp; value.<span class="hljs-property">length</span> &lt; <span class="hljs-number">2</span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`You need to provide a valid name.`</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Changed <span class="hljs-subst">$&#123;prop&#125;</span> from <span class="hljs-subst">$&#123;obj[prop]&#125;</span> to <span class="hljs-subst">$&#123;value&#125;</span>.`</span>);<br>      obj[prop] = value;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>  &#125;<br>&#125;);<br><br>personProxy.<span class="hljs-property">nonExistentProperty</span>;<br>personProxy.<span class="hljs-property">age</span> = <span class="hljs-string">&quot;44&quot;</span>;<br>personProxy.<span class="hljs-property">name</span> = <span class="hljs-string">&quot;&quot;</span>;<br><br><span class="hljs-comment">// Hmm.. this property doesn&#x27;t seem to exist </span><br><span class="hljs-comment">// Sorry, you can only pass numeric values for age. </span><br><span class="hljs-comment">// You need to provide a valid name. </span><br><br></code></pre></td></tr></table></figure>

<h3 id="Reflect"><a href="#Reflect" class="headerlink" title="Reflect"></a>Reflect</h3><p>JavaScriptæä¾›äº†ä¸€ä¸ªå†…ç½®å¯¹è±¡å«åšReflectï¼Œå®ƒä½¿æˆ‘ä»¬åœ¨ä½¿ç”¨ä»£ç†æ—¶æ›´å®¹æ˜“æ“ä½œç›®æ ‡å¯¹è±¡ã€‚</p>
<p>ä¹‹å‰ï¼Œæˆ‘ä»¬å°è¯•é€šè¿‡ç›´æ¥ä½¿ç”¨æ–¹æ‹¬å·è¡¨ç¤ºæ³•æ¥ä¿®æ”¹å’Œè®¿é—®ä»£ç†ä¸­çš„ç›®æ ‡å¯¹è±¡ä¸Šçš„å±æ€§ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Reflectå¯¹è±¡ã€‚Reflectå¯¹è±¡ä¸Šçš„æ–¹æ³•ä¸å¤„ç†ç¨‹åºå¯¹è±¡ä¸Šçš„æ–¹æ³•åŒåã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡Reflect.get()å’ŒReflect.set()æ¥è®¿é—®æˆ–ä¿®æ”¹ç›®æ ‡å¯¹è±¡ä¸Šçš„å±æ€§ï¼Œè€Œä¸æ˜¯é€šè¿‡obj[prop]æ¥è®¿é—®å±æ€§æˆ–é€šè¿‡obj[prop] &#x3D; valueæ¥è®¾ç½®å±æ€§ã€‚è¿™äº›æ–¹æ³•æ¥æ”¶ä¸å¤„ç†ç¨‹åºå¯¹è±¡ä¸Šçš„æ–¹æ³•ç›¸åŒçš„å‚æ•°ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> personProxy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(person, &#123;<br>  <span class="hljs-attr">get</span>: <span class="hljs-function">(<span class="hljs-params">obj, prop</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`The value of <span class="hljs-subst">$&#123;prop&#125;</span> is <span class="hljs-subst">$&#123;<span class="hljs-built_in">Reflect</span>.get(obj, prop)&#125;</span>`</span>);<br>  &#125;,<br>  <span class="hljs-attr">set</span>: <span class="hljs-function">(<span class="hljs-params">obj, prop, value</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Changed <span class="hljs-subst">$&#123;prop&#125;</span> from <span class="hljs-subst">$&#123;obj[prop]&#125;</span> to <span class="hljs-subst">$&#123;value&#125;</span>`</span>);<br>    <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(obj, prop, value);<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>å®Œç¾ï¼æˆ‘ä»¬å¯ä»¥é€šè¿‡Reflectå¯¹è±¡è½»æ¾åœ°è®¿é—®å’Œä¿®æ”¹ç›®æ ‡å¯¹è±¡ä¸Šçš„å±æ€§ã€‚</p>
<h3 id="æƒè¡¡åˆ©å¼Š"><a href="#æƒè¡¡åˆ©å¼Š" class="headerlink" title="æƒè¡¡åˆ©å¼Š"></a>æƒè¡¡åˆ©å¼Š</h3><p>ä»£ç†æ˜¯ä¸€ç§å¼ºå¤§çš„æ–¹å¼ï¼Œå¯ä»¥å¯¹å¯¹è±¡çš„è¡Œä¸ºè¿›è¡Œæ§åˆ¶ã€‚ä»£ç†å¯ä»¥æœ‰å„ç§ç”¨é€”ï¼šå®ƒå¯ä»¥å¸®åŠ©è¿›è¡ŒéªŒè¯ã€æ ¼å¼åŒ–ã€é€šçŸ¥æˆ–è°ƒè¯•ã€‚</p>
<p>è¿‡åº¦ä½¿ç”¨ä»£ç†å¯¹è±¡æˆ–åœ¨æ¯ä¸ªå¤„ç†ç¨‹åºæ–¹æ³•è°ƒç”¨ä¸Šæ‰§è¡Œç¹é‡æ“ä½œå¯èƒ½ä¼šå¯¹åº”ç”¨ç¨‹åºçš„æ€§èƒ½äº§ç”Ÿè´Ÿé¢å½±å“ã€‚æœ€å¥½ä¸è¦åœ¨æ€§èƒ½å…³é”®çš„ä»£ç ä¸­ä½¿ç”¨ä»£ç†ã€‚</p>
]]></content>
      <categories>
        <category>Patterns</category>
      </categories>
  </entry>
  <entry>
    <title>reactæºç å­¦ä¹ -commitRoot</title>
    <url>/posts/83169b38.html</url>
    <content><![CDATA[<h3 id="ç†è®º"><a href="#ç†è®º" class="headerlink" title="ç†è®º"></a>ç†è®º</h3><p>commité˜¶æ®µå¿…é¡»åŒæ­¥æ‰§è¡Œï¼Œä¸€æŠŠä¿®æ”¹å®Œdom, ç­‰ä¸‹æ¬¡æµè§ˆå™¨æ¸²æŸ“æ‰§è¡ŒDom-Style-Layout-Layer-Paint-Raster-GPUï¼Œæ˜¾å¡è¯»å–</p>
<ol>
<li>useEffectçš„effectæ”¾åˆ°scheduleé˜Ÿåˆ—ä¸­ï¼Œå®ä»»åŠ¡æ‰§è¡Œ</li>
<li>é€’å½’æ‰§è¡Œæ ‡è®°çš„domä¿®æ”¹ ï¼ˆåˆ é™¤å’Œæ’å…¥æ“ä½œï¼‰,æ­¤æ—¶é¡ºä¾¿æŠŠuseLayoutEffect destoryé€’å½’æ‰§è¡Œäº†</li>
<li>é€’å½’æ‰§è¡Œæ‰€æœ‰fiberçš„layout effecté“¾è¡¨çš„createï¼ŒuseLayoutæ‰§è¡Œä¼šé˜»å¡æœ¬æ¬¡domä¿®æ”¹ç»“æœçš„æ¸²æŸ“</li>
</ol>
<p>layout effect å’Œ passive effecté€šè¿‡effectçš„tagå­—æ®µåŒºåˆ«</p>
<p>finishedWork.updateQueue.lastEffect æŒ‡å‘effectå¾ªç¯é“¾è¡¨æœ€åä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯effecté“¾è¡¨å­˜å‚¨åœ¨fiberä¸Š</p>
<h3 id="useEffectè°ƒåº¦æ‰§è¡Œ"><a href="#useEffectè°ƒåº¦æ‰§è¡Œ" class="headerlink" title="useEffectè°ƒåº¦æ‰§è¡Œ"></a>useEffectè°ƒåº¦æ‰§è¡Œ</h3><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// æ”¾åˆ°ä¸‹ä¸€ä¸ªå®ä»»åŠ¡æ‰§è¡Œ</span><br> <span class="hljs-title class_">Scheduler</span>_scheduleCallback(<span class="hljs-title class_">NormalSchedulerPriority</span>, flushPassiveEffect);<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">flushPassiveEffect</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">if</span> (rootWithPendingPassiveEffects !== <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-comment">// ç¼“å­˜ä¸­å–root</span><br>    <span class="hljs-keyword">const</span> root = rootWithPendingPassiveEffects;<br>    <span class="hljs-comment">// æ‰§è¡Œå¸è½½å‰¯ä½œç”¨ï¼ŒuseEffectçš„destroy</span><br>    <span class="hljs-title function_">commitPassiveUnmountEffects</span>(root.<span class="hljs-property">current</span>);<br>    <span class="hljs-comment">// æ‰§è¡ŒæŒ‚è½½å‰¯ä½œç”¨ï¼ŒuseEffectçš„create</span><br>    <span class="hljs-title function_">commitPassiveMountEffects</span>(root, root.<span class="hljs-property">current</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// é€’å½’æ‰§è¡Œfiberæ ‘çš„æ‰€æœ‰fiberçš„effecté“¾è¡¨çš„destroy</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">commitPassiveUnmountEffects</span>(<span class="hljs-params">finishedWork</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;recursive run effect destroy&quot;</span>);<br>  <span class="hljs-title function_">commitPassiveUnmountOnFiber</span>(finishedWork);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">commitPassiveUnmountOnFiber</span>(<span class="hljs-params">finishedWork</span>) &#123;<br>  <span class="hljs-keyword">const</span> flags = finishedWork.<span class="hljs-property">flags</span>;<br>  <span class="hljs-keyword">switch</span> (finishedWork.<span class="hljs-property">tag</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-title class_">HostRoot</span>: &#123;<br>      <span class="hljs-title function_">recursivelyTraversePassiveUnmountEffects</span>(finishedWork);<br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-keyword">case</span> <span class="hljs-title class_">FunctionComponent</span>: &#123;<br>      <span class="hljs-title function_">recursivelyTraversePassiveUnmountEffects</span>(finishedWork);<br>      <span class="hljs-keyword">if</span> (flags &amp; <span class="hljs-title class_">Passive</span>) &#123;<br>        <span class="hljs-title function_">commitHookPassiveUnmountEffects</span>(<br>          finishedWork,<br>          <span class="hljs-title class_">HookHasEffect</span> | <span class="hljs-title class_">HookPassive</span><br>        );<br>      &#125;<br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// é€’å½’æ‰§è¡Œfiberæ ‘çš„æ‰€æœ‰fiberçš„effecté“¾è¡¨çš„create</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">commitPassiveMountEffects</span>(<span class="hljs-params">root, finishedWork</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;recursive run effect create&quot;</span>);<br>  <span class="hljs-title function_">commitPassiveMountOnFiber</span>(root, finishedWork);<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * é€’å½’æ‰§è¡Œfiberæ ‘çš„æ‰€æœ‰fiberçš„effecté“¾è¡¨çš„create</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; finishedRoot root FiberRootNode</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; finishedWork root.current HostRootFiber</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">commitPassiveMountOnFiber</span>(<span class="hljs-params">finishedRoot, finishedWork</span>) &#123;<br>  <span class="hljs-keyword">const</span> flags = finishedWork.<span class="hljs-property">flags</span>;<br>  <span class="hljs-keyword">switch</span> (finishedWork.<span class="hljs-property">tag</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-title class_">HostRoot</span>: &#123;<br>      <span class="hljs-title function_">recursivelyTraversePassiveMountEffects</span>(finishedRoot, finishedWork);<br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-keyword">case</span> <span class="hljs-title class_">FunctionComponent</span>: &#123;<br>      <span class="hljs-title function_">recursivelyTraversePassiveMountEffects</span>(finishedRoot, finishedWork);<br>      <span class="hljs-keyword">if</span> (flags &amp; <span class="hljs-title class_">Passive</span>) &#123;<br>        <span class="hljs-comment">// Passive 1024  å¤šä¸€æ­¥æ‰§è¡Œeffecté“¾è¡¨</span><br>        <span class="hljs-title function_">commitHookPassiveMountEffects</span>(<br>          finishedWork,<br>          <span class="hljs-title class_">HookPassive</span> | <span class="hljs-title class_">HookHasEffect</span><br>        );<br>      &#125;<br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="æ‰§è¡Œdomä¿®æ”¹"><a href="#æ‰§è¡Œdomä¿®æ”¹" class="headerlink" title="æ‰§è¡Œdomä¿®æ”¹"></a>æ‰§è¡Œdomä¿®æ”¹</h3><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"> <span class="hljs-comment">// domå˜æ›´å åªæ˜¯æ”¹äº†dom, æµè§ˆå™¨åé¢æ‰§è¡Œæ¸²æŸ“</span><br> <span class="hljs-title function_">commitMutationEffectsOnFiber</span>(finishedWork, root);<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * commitMutationEffectsOnFiber + recursivelyTraverseMutationEffects 2ä¸ªå‡½æ•°è¿›è¡Œé€’å½’</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * å¤„ç†å­èŠ‚ç‚¹æ‰“çš„effect tag</span><br><span class="hljs-comment"> * 1. åˆ é™¤å­èŠ‚ç‚¹</span><br><span class="hljs-comment"> * 2. é€’å½’å¤„ç†å­èŠ‚ç‚¹</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; root å®¹å™¨æ ¹èŠ‚ç‚¹</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; parentFiber å½“å‰è¦å¤„ç†å‰¯ä½œç”¨çš„fiber</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">recursivelyTraverseMutationEffects</span>(<span class="hljs-params">root, parentFiber</span>) &#123;<br>  <span class="hljs-keyword">const</span> deletions = parentFiber.<span class="hljs-property">deletions</span>;<br>  <span class="hljs-comment">// å¦‚æœå­èŠ‚ç‚¹æœ‰åˆ é™¤ï¼Œå¤„ç†åˆ é™¤ï¼Œåœ¨çˆ¶èŠ‚ç‚¹åˆ å­èŠ‚ç‚¹</span><br>  <span class="hljs-keyword">if</span> (deletions !== <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; deletions.<span class="hljs-property">length</span>; i++) &#123;<br>      <span class="hljs-keyword">const</span> childToDelete = deletions[i];<br>      <span class="hljs-title function_">commitDeletionEffects</span>(root, parentFiber, childToDelete);<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-comment">// é€’å½’å¤„ç†effect</span><br>  <span class="hljs-keyword">if</span> (parentFiber.<span class="hljs-property">subtreeFlags</span> &amp; <span class="hljs-title class_">MutationMask</span>) &#123;<br>    <span class="hljs-keyword">let</span> &#123; child &#125; = parentFiber;<br>    <span class="hljs-keyword">while</span> (child !== <span class="hljs-literal">null</span>) &#123;<br>      <span class="hljs-title function_">commitMutationEffectsOnFiber</span>(child, root);<br>      child = child.<span class="hljs-property">sibling</span>;<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * éå†fiberæ ‘ï¼Œæ‰§è¡Œfiberä¸Šçš„å‰¯ä½œç”¨</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; finishedWork fiberèŠ‚ç‚¹</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; root æ ¹èŠ‚ç‚¹</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">commitMutationEffectsOnFiber</span>(<span class="hljs-params">finishedWork, root</span>) &#123;<br>  <span class="hljs-comment">// è€fiber</span><br>  <span class="hljs-keyword">const</span> current = finishedWork.<span class="hljs-property">alternate</span>;<br>  <span class="hljs-comment">// æ›´æ–°tag</span><br>  <span class="hljs-keyword">const</span> flags = finishedWork.<span class="hljs-property">flags</span>;<br><br>  <span class="hljs-keyword">switch</span> (finishedWork.<span class="hljs-property">tag</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-title class_">FunctionComponent</span>: &#123;<br>      <span class="hljs-comment">// å…ˆå¤„ç†å­èŠ‚ç‚¹å‰¯ä½œç”¨ é€’å½’</span><br>      <span class="hljs-title function_">recursivelyTraverseMutationEffects</span>(root, finishedWork);<br>      <span class="hljs-comment">// å¤„ç†è‡ªèº«çš„å‰¯ä½œç”¨</span><br>      <span class="hljs-title function_">commitReconciliationEffects</span>(finishedWork);<br>      <span class="hljs-comment">// æ‰§è¡ŒuseLayoutEffect çš„destroy</span><br>      <span class="hljs-keyword">if</span> (flags &amp; <span class="hljs-title class_">Update</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;recursive run layout effect destroy&quot;</span>);<br>        <span class="hljs-title function_">commitHookEffectListUnmount</span>(<span class="hljs-title class_">HookHasEffect</span> | <span class="hljs-title class_">HookLayout</span>, finishedWork);<br>      &#125;<br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br><br>    ...<br><br>    <span class="hljs-attr">default</span>:<br>      <span class="hljs-keyword">break</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">commitReconciliationEffects</span>(<span class="hljs-params">finishedWork</span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; flags &#125; = finishedWork;<br>  <span class="hljs-keyword">if</span> (flags &amp; <span class="hljs-title class_">Placement</span>) &#123;<br>    <span class="hljs-comment">// æ‰§è¡Œæ’å…¥æ“ä½œï¼Œï¼ˆç§»åŠ¨å’Œæ–°å»ºï¼‰</span><br>    <span class="hljs-title function_">commitPlacement</span>(finishedWork);<br>    <span class="hljs-comment">// æ¸…é™¤effect</span><br>    finishedWork.<span class="hljs-property">flags</span> = finishedWork.<span class="hljs-property">flags</span> &amp; ~<span class="hljs-title class_">Placement</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="useLayoutæ‰§è¡Œ"><a href="#useLayoutæ‰§è¡Œ" class="headerlink" title="useLayoutæ‰§è¡Œ"></a>useLayoutæ‰§è¡Œ</h3><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js">  <span class="hljs-comment">// æ‰§è¡Œlayout effect create</span><br>  <span class="hljs-title function_">commitLayoutEffects</span>(finishedWork, root);<br><br><span class="hljs-comment">// é€’å½’æ‰§è¡Œæ‰€æœ‰fiberçš„layout effecté“¾è¡¨</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">commitLayoutEffectOnFiber</span>(<span class="hljs-params">finishedRoot, current, finishedWork</span>) &#123;<br>  <span class="hljs-keyword">const</span> flags = finishedWork.<span class="hljs-property">flags</span>;<br>  <span class="hljs-keyword">switch</span> (finishedWork.<span class="hljs-property">tag</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-title class_">HostRoot</span>: &#123;<br>      <span class="hljs-title function_">recursivelyTraverseLayoutEffects</span>(finishedRoot, finishedWork);<br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-keyword">case</span> <span class="hljs-title class_">FunctionComponent</span>: &#123;<br>      <span class="hljs-title function_">recursivelyTraverseLayoutEffects</span>(finishedRoot, finishedWork);<br>      <span class="hljs-keyword">if</span> (flags &amp; <span class="hljs-title class_">LayoutMask</span>) &#123;<br>        <span class="hljs-comment">// Passive 1024  å¤šä¸€æ­¥æ‰§è¡Œeffecté“¾è¡¨</span><br>        <span class="hljs-title function_">commitHookLayoutEffects</span>(finishedWork, <span class="hljs-title class_">HookHasEffect</span> | <span class="hljs-title class_">HookLayout</span>);<br>      &#125;<br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">recursivelyTraverseLayoutEffects</span>(<span class="hljs-params">root, parentFiber</span>) &#123;<br>  <span class="hljs-keyword">if</span> (parentFiber.<span class="hljs-property">subtreeFlags</span> &amp; <span class="hljs-title class_">LayoutMask</span>) &#123;<br>    <span class="hljs-keyword">let</span> child = parentFiber.<span class="hljs-property">child</span>;<br>    <span class="hljs-keyword">while</span> (child !== <span class="hljs-literal">null</span>) &#123;<br>      <span class="hljs-keyword">const</span> current = child.<span class="hljs-property">alternate</span>;<br>      <span class="hljs-title function_">commitLayoutEffectOnFiber</span>(root, current, child);<br>      child = child.<span class="hljs-property">sibling</span>;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>React</category>
      </categories>
  </entry>
  <entry>
    <title>reactæºç å­¦ä¹ -completeWork</title>
    <url>/posts/9c9d9a17.html</url>
    <content><![CDATA[<h3 id="ç†è®º"><a href="#ç†è®º" class="headerlink" title="ç†è®º"></a>ç†è®º</h3><p>mounté˜¶æ®µï¼ŒbeginWorkåˆ›å»ºäº†fiberï¼Œåšäº†ä¸€ä¸ªä¼˜åŒ–ï¼Œç¦»çº¿å¥½æ„å»ºdomæ ‘ï¼Œæœ€åæ’å…¥å®¹å™¨dom, commité˜¶æ®µåªéœ€æ‰§è¡Œä¸€æ¬¡æ’å…¥ï¼Œä¸ç”¨å†æ¬¡éå†æ•´ä¸ªæ ‘</p>
<p>æ›´æ–°é˜¶æ®µï¼ŒbeginWorkè¿›è¡Œdom-diffæ›´æ–°äº†fiberï¼Œè¿˜æœ‰props style éœ€è¦æ›´æ–°åˆ°domä¸Šï¼Œæ‰€ä»¥è¿˜éœ€è¦æ ‡è®°å“ªäº›å±æ€§è¦æ›´æ–°ï¼Œå°†æ›´æ–°æ”¾åˆ°fiber.updateQueueï¼Œåœ¨commitRoot&#x3D;&gt;commitMutationEffectsOnFiberæ‰§è¡Œ</p>
<h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * mounté˜¶æ®µï¼Œåˆ›å»ºdom, è®¾ç½®jsx elementçš„propsåˆ°dom</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; current è€fiber</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; workInProgress æ–°fiber</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">completeWork</span>(<span class="hljs-params">current, workInProgress</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;completeWork&quot;</span>, current);<br>  <span class="hljs-keyword">const</span> newProps = workInProgress.<span class="hljs-property">pendingProps</span>;<br>  <span class="hljs-keyword">switch</span> (workInProgress.<span class="hljs-property">tag</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-title class_">HostRoot</span>:<br>      <span class="hljs-title function_">bubbleProperties</span>(workInProgress);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-title class_">HostText</span>:<br>      <span class="hljs-comment">// å¦‚æœæ˜¯æ–‡æœ¬èŠ‚ç‚¹çš„fiberï¼Œåˆ›å»ºçœŸå®æ–‡æœ¬èŠ‚ç‚¹domæ”¾åˆ°fiber.stateNode</span><br>      <span class="hljs-keyword">const</span> newText = newProps;<br>      workInProgress.<span class="hljs-property">stateNode</span> = <span class="hljs-title function_">createTextInstance</span>(newText);<br>      <span class="hljs-title function_">bubbleProperties</span>(workInProgress);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-title class_">HostComponent</span>:<br>      <span class="hljs-keyword">if</span> (current !== <span class="hljs-literal">null</span> &amp;&amp; workInProgress.<span class="hljs-property">stateNode</span> !== <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-comment">// æ›´æ–°é˜¶æ®µ</span><br>        <span class="hljs-comment">// å¦‚æœè€fiberå­˜åœ¨ï¼Œå¹¶ä¸”è€fiberä¸Šæœ‰çœŸå®dom</span><br>        <span class="hljs-keyword">const</span> &#123; type &#125; = workInProgress;<br>        <span class="hljs-title function_">updateHostComponent</span>(current, workInProgress, type, newProps);<br><br>        <span class="hljs-comment">// å‰årefå¯¹è±¡åœ°å€ä¸åŒï¼Œæ ‡è®°è¦æ›´æ–°ref</span><br>        <span class="hljs-keyword">if</span> (current.<span class="hljs-property">ref</span> !== workInProgress.<span class="hljs-property">ref</span> &amp;&amp; workInProgress.<span class="hljs-property">ref</span> !== <span class="hljs-literal">null</span>) &#123;<br>          <span class="hljs-title function_">markRef</span>(workInProgress);<br>        &#125;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// mounté˜¶æ®µ</span><br>        <span class="hljs-comment">// å¦‚æœæ˜¯åŸç”ŸèŠ‚ç‚¹çš„fiberï¼Œåˆ›å»ºdomæ”¾åˆ°fiber.stateNode</span><br>        <span class="hljs-keyword">const</span> &#123; type &#125; = workInProgress;<br>        <span class="hljs-keyword">const</span> instance = <span class="hljs-title function_">createInstance</span>(type, newProps, workInProgress);<br>        workInProgress.<span class="hljs-property">stateNode</span> = instance;<br><br>        <span class="hljs-comment">// æŠŠè‡ªå·±æ‰€æœ‰çš„å­èŠ‚ç‚¹domæ·»åŠ åˆ°è‡ªå·±çš„èº«ä¸Š</span><br>        <span class="hljs-title function_">appendAllChildren</span>(instance, workInProgress);<br><br>        <span class="hljs-comment">// å°†prop è®¾ç½®åˆ°domä¸Š</span><br>        <span class="hljs-title function_">finalizeInitialChildren</span>(instance, type, newProps);<br><br>        <span class="hljs-comment">// æ ‡è®°è¦æŒ‚è½½ref</span><br>        <span class="hljs-keyword">if</span> (workInProgress.<span class="hljs-property">ref</span> !== <span class="hljs-literal">null</span>) &#123;<br>          <span class="hljs-title function_">markRef</span>(workInProgress);<br>        &#125;<br>      &#125;<br>    <span class="hljs-keyword">case</span> <span class="hljs-title class_">FunctionComponent</span>:<br>      <span class="hljs-title function_">bubbleProperties</span>(workInProgress);<br>      <span class="hljs-keyword">break</span>;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h3 id="æ ‡è®°æ›´æ–°ï¼ˆæ”¾åˆ°fiberçš„updateQueueï¼‰"><a href="#æ ‡è®°æ›´æ–°ï¼ˆæ”¾åˆ°fiberçš„updateQueueï¼‰" class="headerlink" title="æ ‡è®°æ›´æ–°ï¼ˆæ”¾åˆ°fiberçš„updateQueueï¼‰"></a>æ ‡è®°æ›´æ–°ï¼ˆæ”¾åˆ°fiberçš„updateQueueï¼‰</h3><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 1. å¯¹æ¯”æ–°è€propsï¼Œå°†æ›´æ–°æ”¾åˆ°fiberçš„updateQueue</span><br><span class="hljs-comment"> * 2. æ‰“æ ‡ç­¾flags Update</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; current è€fiber</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; workInProgress æ–°fiber</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; type ç±»å‹</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; newProps æ–°å±æ€§</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">updateHostComponent</span>(<span class="hljs-params">current, workInProgress, type, newProps</span>) &#123;<br>  <span class="hljs-keyword">const</span> oldProps = current.<span class="hljs-property">memoizedProps</span>; <span class="hljs-comment">// è€çš„å±æ€§</span><br>  <span class="hljs-keyword">const</span> instance = workInProgress.<span class="hljs-property">stateNode</span>; <span class="hljs-comment">// è€çš„dom</span><br><br>  <span class="hljs-comment">// æ¯”è¾ƒæ–°è€å±æ€§ï¼Œäº§ç”Ÿupdate, updateæ˜¯äºŒå…ƒç»„çš„æ•°ç»„ å±æ€§ï¼Œå€¼ï¼Œå±æ€§ï¼Œå€¼</span><br>  <span class="hljs-keyword">const</span> updatePayload = <span class="hljs-title function_">prepareUpdate</span>(instance, type, oldProps, newProps);<br>  workInProgress.<span class="hljs-property">updateQueue</span> = updatePayload;<br>  <span class="hljs-keyword">if</span> (updatePayload) &#123;<br>    <span class="hljs-title function_">markUpdate</span>(workInProgress);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">prepareUpdate</span>(<span class="hljs-params">domElement, type, oldProps, newProps</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">diffProperties</span>(domElement, type, oldProps, newProps);<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; <span class="hljs-variable">domElement</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; <span class="hljs-variable">type</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; <span class="hljs-variable">oldProps</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; <span class="hljs-variable">newProps</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">diffProperties</span>(<span class="hljs-params">domElement, type, oldProps, newProps</span>) &#123;<br>  <span class="hljs-keyword">let</span> updatePayload = [];<br>  <span class="hljs-keyword">let</span> styleUpdates = <span class="hljs-literal">null</span>;<br><br>  <span class="hljs-comment">// å¤„ç†åˆ é™¤å±æ€§ã€‚å¦‚æœå±æ€§è€çš„æœ‰ï¼Œæ–°çš„æ²¡æœ‰ï¼Œè¦åˆ é™¤</span><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> propKey <span class="hljs-keyword">in</span> oldProps) &#123;<br>    <span class="hljs-keyword">if</span> (propKey === <span class="hljs-variable constant_">STYLE</span>) &#123;<br>      <span class="hljs-keyword">continue</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// æ–°çš„æœ‰ æˆ– è€çš„æ²¡æœ‰ è·³è¿‡</span><br>    <span class="hljs-keyword">if</span> (<br>      newProps.<span class="hljs-title function_">hasOwnProperty</span>(propKey) ||<br>      !oldProps.<span class="hljs-title function_">hasOwnProperty</span>(propKey) ||<br>      oldProps[propKey] === <span class="hljs-literal">null</span><br>    ) &#123;<br>      <span class="hljs-keyword">continue</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// å±æ€§ï¼Œå€¼ï¼ŒäºŒå…ƒç»„update  åˆ é™¤å±æ€§</span><br>    updatePayload.<span class="hljs-title function_">push</span>(propKey, <span class="hljs-literal">null</span>);<br>  &#125;<br><br>  <span class="hljs-comment">// å¤„ç†æ›´æ–°å±æ€§</span><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> propKey <span class="hljs-keyword">in</span> newProps) &#123;<br>    <span class="hljs-keyword">if</span> (propKey === <span class="hljs-variable constant_">STYLE</span>) &#123;<br>      <span class="hljs-keyword">continue</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">const</span> newProp = newProps[propKey];<br>    <span class="hljs-keyword">const</span> oldProp = oldProps[propKey] === <span class="hljs-literal">undefined</span> ? <span class="hljs-literal">null</span> : oldProps[propKey];<br>    <span class="hljs-keyword">if</span> (<br>      !newProps.<span class="hljs-title function_">hasOwnProperty</span>(propKey) ||<br>      newProp === <span class="hljs-literal">null</span> ||<br>      oldProp === <span class="hljs-literal">null</span> ||<br>      newProp === oldProp<br>    ) &#123;<br>      <span class="hljs-keyword">continue</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (propKey === <span class="hljs-variable constant_">CHILDERN</span>) &#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> newProp === <span class="hljs-string">&quot;string&quot;</span> || <span class="hljs-keyword">typeof</span> newProp === <span class="hljs-string">&quot;number&quot;</span>) &#123;<br>        updatePayload.<span class="hljs-title function_">push</span>(propKey, newProp);<br>      &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-comment">// æ›´æ–°</span><br>      updatePayload.<span class="hljs-title function_">push</span>(propKey, newProp);<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-keyword">const</span> oldStyle = oldProps[<span class="hljs-variable constant_">STYLE</span>];<br>  <span class="hljs-keyword">const</span> newStyle = newProps[<span class="hljs-variable constant_">STYLE</span>];<br><br>  <span class="hljs-keyword">if</span> (oldStyle || newStyle) &#123;<br>    <span class="hljs-comment">// æ ·å¼åˆ é™¤</span><br>    <span class="hljs-keyword">if</span> (oldStyle) &#123;<br>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> styleName <span class="hljs-keyword">in</span> oldStyle) &#123;<br>        <span class="hljs-keyword">if</span> (<br>          oldStyle.<span class="hljs-title function_">hasOwnProperty</span>(styleName) &amp;&amp;<br>          (!newStyle || !newStyle.<span class="hljs-title function_">hasOwnProperty</span>(styleName))<br>        ) &#123;<br>          <span class="hljs-keyword">if</span> (!styleUpdates) &#123;<br>            styleUpdates = &#123;&#125;;<br>          &#125;<br>          styleUpdates[styleName] = <span class="hljs-string">&quot;&quot;</span>;<br>        &#125;<br>      &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// æ ·å¼æ›´æ–°</span><br>    <span class="hljs-keyword">if</span> (newStyle) &#123;<br>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> styleName <span class="hljs-keyword">in</span> newStyle) &#123;<br>        <span class="hljs-keyword">if</span> (<br>          newStyle.<span class="hljs-title function_">hasOwnProperty</span>(styleName) &amp;&amp;<br>          (!oldStyle || oldStyle[styleName] !== newStyle[styleName])<br>        ) &#123;<br>          <span class="hljs-keyword">if</span> (!styleUpdates) &#123;<br>            styleUpdates = &#123;&#125;;<br>          &#125;<br>          styleUpdates[styleName] = newStyle[styleName];<br>        &#125;<br>      &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (styleUpdates) &#123;<br>      updatePayload.<span class="hljs-title function_">push</span>(<span class="hljs-variable constant_">STYLE</span>, styleUpdates);<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> updatePayload.<span class="hljs-property">length</span> === <span class="hljs-number">0</span> ? <span class="hljs-literal">null</span> : updatePayload;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>React</category>
      </categories>
  </entry>
  <entry>
    <title>reactæºç å­¦ä¹ -jsx</title>
    <url>/posts/5b77d16c.html</url>
    <content><![CDATA[<h3 id="ç†è®º"><a href="#ç†è®º" class="headerlink" title="ç†è®º"></a>ç†è®º</h3><p>babel å°†jsxè½¬åŒ–ä¸ºjsxDEVå‡½æ•°è°ƒç”¨ï¼Œè½¬æ¢åå·²ç»åŒ…å«äº†ç»„ä»¶å…ƒç´ æ‰€æœ‰å±æ€§ï¼Œå¹¶ä¸”åµŒå¥—å…ƒç´ ç»„ä»¶ä¹Ÿè½¬åŒ–ä¸ºåµŒå¥—å‡½æ•°è°ƒç”¨äº†<br>å®šä¹‰jsxDEVå‡½æ•°ï¼Œæ¥æ”¶babelè½¬åŒ–å‡ºæ¥çš„ç»„ä»¶domæ•°æ®è½¬åŒ–ä¸ºjsx element(è™šæ‹Ÿdom)</p>
<h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ReactElement</span>(<span class="hljs-params">type, key, ref, props</span>) &#123;<br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">$$typeof</span>: <span class="hljs-variable constant_">REACT_ELEMENT_TYPE</span>, <span class="hljs-comment">// jsx elementæ ‡è¯†</span><br>    type, <span class="hljs-comment">// span h1 æ ‡ç­¾</span><br>    key,<br>    ref,<br>    props,<br>  &#125;;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å°†babelç¼–è¯‘ç»“æœè½¬åŒ–ä¸ºjsx element(è™šæ‹Ÿdom)</span><br><span class="hljs-comment"> * key, ref, style, childrenç­‰åœ¨babelä¸­éƒ½è½¬å‡ºæ¥äº†, æ”¾åœ¨äº†config</span><br><span class="hljs-comment"> * jsxç¼–è¯‘åï¼Œå½¢æˆjsxDEVåµŒå¥—è°ƒç”¨çš„å‡½æ•°æ‰§è¡Œï¼Œä¼šå…ˆæ‰§è¡Œæœ€å†…éƒ¨çš„elementæ„å»º</span><br><span class="hljs-comment"> * key, ref å•ç‹¬å­˜å˜é‡ï¼Œå…¶ä»–å­˜å…¥props</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; <span class="hljs-variable">type</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; <span class="hljs-variable">config</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; maybeKey ç»„ä»¶key</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">jsxDEV</span>(<span class="hljs-params">type, config, maybeKey</span>) &#123;<br>  <span class="hljs-keyword">const</span> props = &#123;&#125;;<br>  <span class="hljs-keyword">let</span> key = <span class="hljs-literal">null</span>;<br>  <span class="hljs-keyword">let</span> ref = <span class="hljs-literal">null</span>;<br><br>  <span class="hljs-comment">// key refå­˜å‚¨</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> maybeKey !== <span class="hljs-literal">undefined</span>) &#123;<br>    key = maybeKey;<br>  &#125;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">hasValidRef</span>(config)) &#123;<br>    ref = config.<span class="hljs-property">ref</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// propså­˜å‚¨</span><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> propName <span class="hljs-keyword">in</span> config) &#123;<br>    <span class="hljs-keyword">if</span> (<br>      hasOwnProperty.<span class="hljs-title function_">call</span>(config, propName) &amp;&amp;<br>      !<span class="hljs-variable constant_">RESERVED_PROPS</span>.<span class="hljs-title function_">hasOwnProperty</span>(propName)<br>    ) &#123;<br>      props[propName] = config[propName];<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">ReactElement</span>(type, key, ref, props);<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>React</category>
      </categories>
  </entry>
  <entry>
    <title>reactæºç å­¦ä¹ -scheduler</title>
    <url>/posts/78409aac.html</url>
    <content><![CDATA[<h3 id="ç†è®º"><a href="#ç†è®º" class="headerlink" title="ç†è®º"></a>ç†è®º</h3><p>å°†performConcurrentWorkOnRootå•ä¸ªfiberçš„diffä»»åŠ¡æ”¾åˆ°æœ€å°å †é‡Œ<br>é€šè¿‡MessageChannelåœ¨ä¸‹æ¬¡å®ä»»åŠ¡æ—¶æ‰§è¡ŒworkLoopï¼ŒworkLoopå°±æ˜¯ä¸æ–­ä»æœ€å°å †å–ä»»åŠ¡æ‰§è¡Œï¼Œç›´åˆ°5msæ—¶é—´ç‰‡ä¸å¤Ÿäº†æˆ–è€…æœ€å°å †ç©ºäº†</p>
<p>useEffectçš„ä»»åŠ¡ä¹Ÿæ”¾åœ¨æœ€å°å †é‡Œï¼Œä¼˜å…ˆçº§æ˜¯NormalSchedulerPriority</p>
<ol>
<li>ImmediateSchedulerPriority<br>ImmediateSchedulerPriority è°ƒåº¦çº§åˆ«æ˜¯æœ€é«˜ä¼˜å…ˆçº§çš„è°ƒåº¦çº§åˆ«ï¼Œè¡¨ç¤ºæ›´æ–°ä»»åŠ¡åº”è¯¥ç«‹å³æ‰§è¡Œï¼Œè€Œä¸åº”è¯¥ç­‰å¾…æµè§ˆå™¨ç©ºé—²ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">commitRoot</span>(<span class="hljs-params">root</span>) &#123;<br>  <span class="hljs-keyword">const</span> previousUpdatePriority = <span class="hljs-title function_">getCurrentUpdatePriority</span>();<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-comment">// renderé˜¶æ®µå¯ä»¥åŒæ­¥æˆ–å¯æš‚åœçš„ï¼Œcommité˜¶æ®µå¿…é¡»åŒæ­¥DiscreteEventPriority</span><br>    <span class="hljs-title function_">setCurrentUpdatePriority</span>(<span class="hljs-title class_">DiscreteEventPriority</span>);<br>    <span class="hljs-title function_">commitRootImpl</span>(root);<br>  &#125; <span class="hljs-keyword">finally</span> &#123;<br>    <span class="hljs-title function_">setCurrentUpdatePriority</span>(previousUpdatePriority);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<ol start="2">
<li>UserBlockingSchedulerPriority<br>UserBlockingSchedulerPriority è°ƒåº¦çº§åˆ«è¡¨ç¤ºæ›´æ–°ä»»åŠ¡æ˜¯ç”±ç”¨æˆ·è¾“å…¥è§¦å‘çš„ï¼Œä¾‹å¦‚ç‚¹å‡»æŒ‰é’®æˆ–è¾“å…¥æ–‡æœ¬ã€‚è¿™äº›æ›´æ–°ä»»åŠ¡åº”è¯¥åœ¨æµè§ˆå™¨ç©ºé—²æ—¶å°½å¿«æ‰§è¡Œï¼Œä½†ä¸åº”è¯¥é˜»æ­¢ç”¨æˆ·è¾“å…¥å“åº”ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title function_">setState</span>(&#123; <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> &#125;);<br>&#125;<br><br><span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span>Click me<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>);<br><br></code></pre></td></tr></table></figure>
<ol start="3">
<li>NormalSchedulerPriority<br>NormalSchedulerPriority è°ƒåº¦çº§åˆ«æ˜¯é»˜è®¤çš„è°ƒåº¦çº§åˆ«ï¼Œè¡¨ç¤ºæ›´æ–°ä»»åŠ¡æ˜¯ç”± React å†…éƒ¨è§¦å‘çš„ï¼Œä¾‹å¦‚åœ¨ useEffect() é’©å­å‡½æ•°ä¸­æ›´æ–°çŠ¶æ€ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">setState</span>(&#123; <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> &#125;);<br>&#125;, []);<br><br></code></pre></td></tr></table></figure>
<ol start="4">
<li>IdleSchedulerPriority<br>IdleSchedulerPriority è°ƒåº¦çº§åˆ«æ˜¯æœ€ä½ä¼˜å…ˆçº§çš„è°ƒåº¦çº§åˆ«ï¼Œè¡¨ç¤ºæ›´æ–°ä»»åŠ¡æ˜¯ç”±æµè§ˆå™¨ç©ºé—²æ—¶è§¦å‘çš„ã€‚è¿™äº›æ›´æ–°ä»»åŠ¡åº”è¯¥åœ¨æµè§ˆå™¨ç©ºé—²æ—¶æ‰§è¡Œï¼Œä½†å¯ä»¥ç­‰å¾…æ›´é•¿çš„æ—¶é—´ï¼Œä»¥ä¾¿å°†å¤šä¸ªæ›´æ–°ä»»åŠ¡åˆå¹¶ä¸ºä¸€ä¸ªã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">requestIdleCallback</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">setState</span>(&#123; <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> &#125;);<br>  &#125;);<br>&#125;, []);<br><br></code></pre></td></tr></table></figure>

<h3 id="Scheduler"><a href="#Scheduler" class="headerlink" title="Scheduler"></a>Scheduler</h3><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// æ›¿ä»£requestIdleCallback</span><br><span class="hljs-keyword">const</span> channel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageChannel</span>();<br><span class="hljs-keyword">var</span> port2 = channel.<span class="hljs-property">port2</span>;<br><span class="hljs-keyword">var</span> port1 = channel.<span class="hljs-property">port1</span>;<br><br><span class="hljs-comment">// ä¸‹ä¸€ä¸ªå®ä»»åŠ¡æ‰§è¡Œ</span><br>port1.<span class="hljs-property">onmessage</span> = performWorkUntilDeadline;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æŒ‰ä¼˜å…ˆçº§æ‰§è¡Œä»»åŠ¡</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; <span class="hljs-variable">callback</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">scheduleCallback</span>(<span class="hljs-params">priorityLevel, callback</span>) &#123;<br>  <span class="hljs-comment">// requestIdleCallback(callback);</span><br>  <span class="hljs-comment">// è·å–å½“å‰æ—¶é—´æˆ³</span><br>  <span class="hljs-keyword">const</span> currentTime = <span class="hljs-title function_">getCurrentTime</span>();<br>  <span class="hljs-comment">// ä»»åŠ¡å¼€å§‹æ—¶é—´</span><br>  <span class="hljs-keyword">const</span> startTime = currentTime;<br>  <span class="hljs-comment">// è¶…æ—¶æ—¶é—´</span><br>  <span class="hljs-keyword">let</span> timeout;<br>  <span class="hljs-keyword">switch</span> (priorityLevel) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ImmediatePriority</span>:<br>      timeout = <span class="hljs-variable constant_">IMMEDIATE_PRIORITY_TIMEOUT</span>;<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-title class_">UserBlockingPriority</span>:<br>      timeout = <span class="hljs-variable constant_">USER_BLOCKING_PRIORITY_TIMEOUT</span>;<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-title class_">IdlePriority</span>:<br>      timeout = <span class="hljs-variable constant_">IDLE_PRIORITY_TIMEOUT</span>;<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-title class_">LowPriority</span>:<br>      timeout = <span class="hljs-variable constant_">LOW_PRIORITY_TIMEOUT</span>;<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-title class_">NormalPriority</span>:<br>    <span class="hljs-attr">default</span>:<br>      timeout = <span class="hljs-variable constant_">NORMAL_PRIORITY_TIMEOUT</span>;<br>      <span class="hljs-keyword">break</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// è®¡ç®—æ­¤ä»»åŠ¡çš„è¿‡æœŸæ—¶é—´</span><br>  <span class="hljs-keyword">const</span> expirationTime = startTime + timeout;<br>  <span class="hljs-keyword">const</span> newTask = &#123;<br>    <span class="hljs-attr">id</span>: taskIdCounter++,<br>    callback, <span class="hljs-comment">// ä»»åŠ¡çš„å›è°ƒå‡½æ•°</span><br>    priorityLevel, <span class="hljs-comment">// ä»»åŠ¡ä¼˜å…ˆçº§</span><br>    startTime, <span class="hljs-comment">// ä»»åŠ¡å¼€å§‹æ—¶é—´</span><br>    expirationTime, <span class="hljs-comment">// ä»»åŠ¡çš„è¿‡æœŸæ—¶é—´</span><br>    <span class="hljs-attr">sortIndex</span>: expirationTime, <span class="hljs-comment">// æ’åºindex</span><br>  &#125;;<br><br>  <span class="hljs-comment">// å°†ä»»åŠ¡æ”¾å…¥æœ€å°å †</span><br>  <span class="hljs-title function_">push</span>(taskQueue, newTask);<br>  <span class="hljs-comment">// æ‰§è¡Œä»»åŠ¡</span><br>  <span class="hljs-title function_">requestHostCallback</span>(flushWork);<br>  <span class="hljs-keyword">return</span> newTask;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ‰§è¡Œä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡ æœ€å°å †(ä¼˜å…ˆçº§ä»»åŠ¡é˜Ÿåˆ—)taskQueue</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; <span class="hljs-variable">startTime</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">flushWork</span>(<span class="hljs-params">startTime</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">workLoop</span>(startTime);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">workLoop</span>(<span class="hljs-params">startTime</span>) &#123;<br>  <span class="hljs-keyword">let</span> currentTime = startTime;<br>  <span class="hljs-comment">// å–å‡ºä¼˜å…ˆçº§æœ€é«˜çš„ä»»åŠ¡</span><br>  <span class="hljs-keyword">let</span> currentTask = <span class="hljs-title function_">peek</span>(taskQueue);<br><br>  <span class="hljs-keyword">while</span> (currentTask !== <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-comment">// å¦‚æœå½“å‰ä»»åŠ¡æ²¡è¿‡æœŸï¼Œè¿˜è¦æ‰§è¡Œï¼Œä½†æ˜¯æ²¡æœ‰æ—¶é—´äº†</span><br>    <span class="hljs-keyword">if</span> (currentTask.<span class="hljs-property">expirationTime</span> &gt; currentTime &amp;&amp; <span class="hljs-title function_">shouldYieldToHost</span>()) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Scheduler:: current schedule is break&quot;</span>);<br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<br>      <span class="hljs-string">&quot;Scheduler:: handle schedule task&quot;</span>,<br>      currentTask,<br>      currentTask.<span class="hljs-property">callback</span> ? currentTask.<span class="hljs-property">callback</span>.<span class="hljs-property">name</span> : <span class="hljs-literal">null</span><br>    );<br><br>    <span class="hljs-comment">// å–å‡ºå½“å‰çš„ä»»åŠ¡ä¸­çš„å›è°ƒå‡½æ•° performConcurrentWorkOnRoot</span><br>    <span class="hljs-keyword">const</span> callback = currentTask.<span class="hljs-property">callback</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> callback === <span class="hljs-string">&quot;function&quot;</span>) &#123;<br>      <span class="hljs-keyword">const</span> didUserCallbackTimeout = currentTask.<span class="hljs-property">expirationTime</span> &lt;= currentTime;<br>      currentTask.<span class="hljs-property">callback</span> = <span class="hljs-literal">null</span>;<br>      <span class="hljs-keyword">const</span> continuationCallback = <span class="hljs-title function_">callback</span>(didUserCallbackTimeout);<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Scheduler:: task time cost&quot;</span>, <span class="hljs-title function_">getCurrentTime</span>() - currentTime);<br>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> continuationCallback === <span class="hljs-string">&quot;function&quot;</span>) &#123;<br>        <span class="hljs-comment">// æ‰§è¡Œä»»åŠ¡äº§ç”Ÿäº†ä¸€ä¸ªæ–°ä»»åŠ¡</span><br>        currentTask.<span class="hljs-property">callback</span> = continuationCallback;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Scheduler:: end===========&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// è¿˜æœ‰ä»»åŠ¡æ‰§è¡Œ</span><br>      &#125;<br>      <span class="hljs-comment">// å¼¹å‡ºæœ€é«˜ä¼˜å…ˆçº§ä»»åŠ¡</span><br>      <span class="hljs-title function_">pop</span>(taskQueue);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-comment">// å¼¹å‡ºæœ€é«˜ä¼˜å…ˆçº§ä»»åŠ¡</span><br>      <span class="hljs-title function_">pop</span>(taskQueue);<br>    &#125;<br>    currentTask = <span class="hljs-title function_">peek</span>(taskQueue);<br>  &#125;<br><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Scheduler:: end===========&quot;</span>);<br>  <span class="hljs-comment">// è¿˜æœ‰ä»»åŠ¡</span><br>  <span class="hljs-keyword">if</span> (currentTask !== <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>  &#125;<br>  <span class="hljs-comment">// å¦‚æœä»»åŠ¡é˜Ÿåˆ—æ‰€æœ‰ä»»åŠ¡éƒ½æ‰§è¡Œå®Œäº†ï¼Œæ²¡æœ‰ä¸‹ä¸€ä¸ªä»»åŠ¡</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br><br><span class="hljs-comment">// æœ€å°å † è¿™ä¸€æ¬¡å¾ªç¯æ‰§è¡Œæ˜¯å¦è¶…è¿‡5ms</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">shouldYieldToHost</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> timeElapsed = <span class="hljs-title function_">getCurrentTime</span>() - startTime;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Scheduler:: timeElapsed&quot;</span>, timeElapsed);<br>  <span class="hljs-keyword">if</span> (timeElapsed &lt; frameInterval) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">requestHostCallback</span>(<span class="hljs-params">flushWork</span>) &#123;<br>  <span class="hljs-comment">// å…ˆç¼“å­˜å·¥ä½œå¾ªç¯ æ‰§è¡Œå‡½æ•°</span><br>  scheduleHostCallback = flushWork;<br>  <span class="hljs-comment">// äº§ç”Ÿä¸€ä¸ªå®ä»»åŠ¡ï¼Œæ‰§è¡Œæœ€å°å † scheduleHostCallback/flushWork/workLoop</span><br>  <span class="hljs-title function_">schedulePerformWorkUntilDeadline</span>();<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">schedulePerformWorkUntilDeadline</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// ä¸‹ä¸ªå®ä»»åŠ¡æ‰§è¡ŒperformWorkUntilDeadline</span><br>  port2.<span class="hljs-title function_">postMessage</span>(<span class="hljs-literal">null</span>);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">performWorkUntilDeadline</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<br>    <span class="hljs-string">&quot;Scheduler:: schedule start===========. min heap size&quot;</span>,<br>    taskQueue.<span class="hljs-property">length</span><br>  );<br>  <span class="hljs-keyword">if</span> (scheduleHostCallback) &#123;<br>    <span class="hljs-comment">// workLoop</span><br>    <span class="hljs-comment">// å…ˆè·å–å¼€å§‹æ‰§è¡Œä»»åŠ¡çš„æ—¶é—´</span><br>    startTime = <span class="hljs-title function_">getCurrentTime</span>();<br>    <span class="hljs-comment">// æ˜¯å¦æœ‰æ›´å¤šçš„å·¥ä½œ</span><br>    <span class="hljs-keyword">let</span> hasMoreWork = <span class="hljs-literal">true</span>;<br><br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-comment">// æ‰§è¡Œè¶…è¿‡5msï¼Œè¿˜æœ‰ä»»åŠ¡ æˆ–è€… æœ€å°å †é‡Œä»»åŠ¡æ‰§è¡Œå®Œäº†</span><br>      hasMoreWork = <span class="hljs-title function_">scheduleHostCallback</span>(startTime);<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>      <span class="hljs-comment">// å¦‚æœæ—¶é—´è¶…è¿‡5ms, è¿˜æœ‰ä»»åŠ¡ï¼Œäº§ç”Ÿä¸€ä¸ªå®ä»»åŠ¡ï¼Œä¸‹æ¬¡ç»§ç»­ï¼Œæ­¤æ—¶æµè§ˆå™¨å¯ä»¥æ¥æ‰‹æ‰§è¡Œæ¸²æŸ“dom æˆ–è€… ä¸æ‰§è¡Œ</span><br>      <span class="hljs-keyword">if</span> (hasMoreWork) &#123;<br>        <span class="hljs-title function_">schedulePerformWorkUntilDeadline</span>();<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// æ¸…ç©ºä»»åŠ¡é˜Ÿåˆ—æ‰§è¡Œå‡½æ•°</span><br>        scheduleHostCallback = <span class="hljs-literal">null</span>;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="render-ä¼˜å…ˆçº§è½¬æ¢"><a href="#render-ä¼˜å…ˆçº§è½¬æ¢" class="headerlink" title="render ä¼˜å…ˆçº§è½¬æ¢"></a>render ä¼˜å…ˆçº§è½¬æ¢</h3><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * laneä¼˜å…ˆçº§è½¬äº‹ä»¶ä¼˜å…ˆçº§</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * å°†laneä¼˜å…ˆçº§è½¬eventPriority</span><br><span class="hljs-comment"> * å°†31æ”¶æ•›åˆ°4ä¸ª</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * è½å…¥eventPriorityæ•°è½´åŒºé—´é‡Œï¼Œåˆ™è¿”å›å³ä¾§eventPriority</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * eventPriority æ•°è½´  lane 1 lane 4  lane 16 lane 536870912</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; <span class="hljs-variable">lanes</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">lanesToEventPriority</span>(<span class="hljs-params">lanes</span>) &#123;<br>  <span class="hljs-comment">// è·å–æœ€é«˜ä¼˜å…ˆçº§çš„lane</span><br>  <span class="hljs-keyword">let</span> lane = <span class="hljs-title function_">getHeighestPriorityLane</span>(lanes);<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isHeigherEventPriority</span>(<span class="hljs-title class_">DiscreteEventPriority</span>, lane)) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">DiscreteEventPriority</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isHeigherEventPriority</span>(<span class="hljs-title class_">ContinuousEventPriority</span>, lane)) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">ContinuousEventPriority</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">includesNonIdleWork</span>(lane)) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">DefaultEventPriority</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">IdleEventPriority</span>;<br>&#125;<br><span class="hljs-comment">// äº‹ä»¶ä¼˜å…ˆçº§è½¬5ä¸ªè°ƒåº¦ä¼˜å…ˆçº§</span><br> <span class="hljs-keyword">switch</span> (<span class="hljs-title function_">lanesToEventPriority</span>(nextLanes)) &#123;<br>      <span class="hljs-comment">// laneè½¬eventPriority, eventPriorityè½¬schedulerPriorityLevel</span><br>      <span class="hljs-keyword">case</span> <span class="hljs-title class_">DiscreteEventPriority</span>:<br>        schedulerPriorityLevel = <span class="hljs-title class_">ImmediateSchedulerPriority</span>;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-title class_">ContinuousEventPriority</span>:<br>        schedulerPriorityLevel = <span class="hljs-title class_">UserBlockingSchedulerPriority</span>;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-title class_">DefaultEventPriority</span>:<br>        schedulerPriorityLevel = <span class="hljs-title class_">NormalSchedulerPriority</span>;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-title class_">IdleEventPriority</span>:<br>        schedulerPriorityLevel = <span class="hljs-title class_">IdleSchedulerPriority</span>;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-attr">default</span>:<br>        schedulerPriorityLevel = <span class="hljs-title class_">NormalSchedulerPriority</span>;<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br></code></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>React</category>
      </categories>
  </entry>
  <entry>
    <title>reactæºç å­¦ä¹ -useState</title>
    <url>/posts/b25a71c7.html</url>
    <content><![CDATA[<h3 id="ç†è®º"><a href="#ç†è®º" class="headerlink" title="ç†è®º"></a>ç†è®º</h3><p>fiber.memoizedState ä¿å­˜çš„æ˜¯hooké“¾è¡¨<br>hook.queue.pending ä¿å­˜çš„æ˜¯è¿™ä¸ªhookçš„æ›´æ–°é“¾è¡¨ï¼Œæ›´æ–°å°±æ˜¯reducerçš„å…¥å‚action, ä¾‹å¦‚ï¼š{type: â€˜addâ€™, payload: 1}</p>
<p>setState</p>
<ol>
<li>æ‰§è¡Œ dispatchReducerAction &#x3D;&gt; å°†updateæš‚å­˜åˆ°concurrentQueues</li>
<li>scheduleUpdateOnFiber rootä¸Šæ‰§è¡Œæ›´æ–°&#x3D;&gt; performConcurrentWorkOnRoot &#x3D;&gt; renderRootConCurrent<br>a) &#x3D;&gt; prepareFreshStack å°†concurrentQueuesupdate é‡Œçš„updateæŒ‚è½½åˆ°å¯¹åº”hookçš„queue<br>b) &#x3D;&gt; workLoopConcurrent &#x3D;&gt; performUnitOfWork &#x3D;&gt; beginWork beginWorké‡Œçš„è¿‡ç¨‹ï¼ŒrenderWithHooks &#x3D;&gt; æ‰§è¡ŒComponentç»„ä»¶å‡½æ•° &#x3D;&gt; æ‰§è¡ŒuseState &#x3D;&gt; æ‰§è¡ŒupdateReducer(æ‰§è¡Œhook.queue, æ‰§è¡Œstateæ›´æ–°ï¼Œå½±å“äº†æ¸²æŸ“æ•°æ®jsx element) &#x3D;&gt; dom-diffæ‰“æ ‡è®°</li>
</ol>
<h3 id="setState-æ‰§è¡Œ"><a href="#setState-æ‰§è¡Œ" class="headerlink" title="setState æ‰§è¡Œ"></a>setState æ‰§è¡Œ</h3><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * setState å‡½æ•°</span><br><span class="hljs-comment"> * å°†updateä¸‰å…ƒç»„ç¼“å­˜ä¸‹æ¥ã€‚renderRootSyncæ—¶ï¼Œå°†updateæ”¾åˆ°hookçš„æ›´æ–°é˜Ÿåˆ—queue</span><br><span class="hljs-comment"> * è°ƒåº¦é‡æ–°æ¸²æŸ“</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; <span class="hljs-variable">fiber</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; <span class="hljs-variable">queue</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; <span class="hljs-variable">action</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">dispatchReducerAction</span>(<span class="hljs-params">fiber, queue, action</span>) &#123;<br>  <span class="hljs-comment">// è·å–å½“å‰çš„æ›´æ–°èµ›é“</span><br>  <span class="hljs-keyword">const</span> lane = <span class="hljs-title function_">requestUpdateLane</span>();<br>  <span class="hljs-keyword">const</span> update = &#123;<br>    action, <span class="hljs-comment">// &#123;type: &#x27;add&#x27;, payload: 1&#125;</span><br>    <span class="hljs-attr">next</span>: <span class="hljs-literal">null</span>,<br>  &#125;;<br>  <span class="hljs-comment">// æŠŠå½“å‰æ›´æ–°æ”¾åˆ°æ›´æ–°é˜Ÿåˆ—é‡Œï¼Œå¹¶è¿”å›æ ¹fiber</span><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;set State reducer&quot;</span>);<br>  <span class="hljs-keyword">const</span> root = <span class="hljs-title function_">enqueueConcurrentHookUpdate</span>(fiber, queue, update, lane);<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;scheduleUpdateOnFiber&quot;</span>);<br>  <span class="hljs-keyword">const</span> eventTime = <span class="hljs-title function_">requestEventTime</span>();<br>  <span class="hljs-comment">// rootä¸Šæ‰§è¡Œæ›´æ–°  renderé˜¶æ®µ+commité˜¶æ®µ</span><br>  <span class="hljs-title function_">scheduleUpdateOnFiber</span>(root, fiber, lane, eventTime);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="useStateæ‰§è¡Œï¼ˆupdateReduceræ‰§è¡Œï¼‰"><a href="#useStateæ‰§è¡Œï¼ˆupdateReduceræ‰§è¡Œï¼‰" class="headerlink" title="useStateæ‰§è¡Œï¼ˆupdateReduceræ‰§è¡Œï¼‰"></a>useStateæ‰§è¡Œï¼ˆupdateReduceræ‰§è¡Œï¼‰</h3><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// useStateå…¶å®å°±æ˜¯å†…ç½®äº†reducerçš„useReducer</span><br><span class="hljs-comment">// action å°±æ˜¯setStateçš„å…¥å‚ï¼Œ(oldState)=&gt; newState æˆ–è€…state</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">baseStateReducer</span>(<span class="hljs-params">state, action</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> action === <span class="hljs-string">&quot;function&quot;</span> ? <span class="hljs-title function_">action</span>(state) : action;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">updateState</span>(<span class="hljs-params">initialState</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">updateReducer</span>(baseStateReducer);<br>&#125;<br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç»„ä»¶useReducerçš„åº•å±‚å‡½æ•°</span><br><span class="hljs-comment"> * 1. å¤åˆ¶è€hook åˆ°æ–°hook (æ‰€ä»¥æ²¡æœ‰æ‰§è¡ŒsetState, stateå¯¹è±¡è¿åœ°å€éƒ½ä¸å˜)</span><br><span class="hljs-comment"> * 2. æ‰§è¡Œreducer, æ›´æ–°state</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; <span class="hljs-variable">reducer</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> [æ–°state, setState]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">updateReducer</span>(<span class="hljs-params">reducer</span>) &#123;<br>  <span class="hljs-comment">// æ–°hook</span><br>  <span class="hljs-keyword">const</span> hook = <span class="hljs-title function_">updateWorkInProgressHook</span>();<br>  <span class="hljs-comment">// æ–°çš„æ›´æ–°é˜Ÿåˆ—</span><br>  <span class="hljs-keyword">const</span> queue = hook.<span class="hljs-property">queue</span>;<br>  <span class="hljs-comment">// è€çš„hook</span><br>  <span class="hljs-keyword">const</span> current = currentHook;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;æ‰§è¡Œhookæ›´æ–°é˜Ÿåˆ—hook.queueï¼Œæ›´æ–°state&quot;</span>, queue);<br><br>  queue.<span class="hljs-property">lastRenderedReducer</span> = reducer;<br>  <span class="hljs-keyword">let</span> baseQueue = current.<span class="hljs-property">baseQueue</span>;<br>  <span class="hljs-comment">// åŸºäºè€state, æ‰§è¡Œreducerï¼Œè®¡ç®—newState</span><br><br>  <span class="hljs-comment">// åˆå¹¶æ–°æ—§updateé“¾è¡¨ï¼Œ pendingQueue baseQueueéƒ½æ˜¯å¾ªç¯é“¾è¡¨ï¼ŒæŒ‡å‘é“¾è¡¨æœ«å°¾</span><br>  <span class="hljs-keyword">const</span> pendingQueue = queue.<span class="hljs-property">pending</span>;<br>  <span class="hljs-keyword">if</span> (pendingQueue !== <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-keyword">if</span> (baseQueue !== <span class="hljs-literal">null</span>) &#123;<br>      <span class="hljs-keyword">const</span> baseFirst = baseQueue.<span class="hljs-property">next</span>;<br>      <span class="hljs-keyword">const</span> pendingFirst = pendingQueue.<span class="hljs-property">next</span>;<br>      baseQueue.<span class="hljs-property">next</span> = pendingFirst;<br>      pendingQueue.<span class="hljs-property">next</span> = baseFirst;<br>    &#125;<br>    current.<span class="hljs-property">baseQueue</span> = baseQueue = pendingQueue;<br>    queue.<span class="hljs-property">pending</span> = <span class="hljs-literal">null</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// æ‰§è¡Œupdateé“¾è¡¨</span><br>  <span class="hljs-keyword">if</span> (baseQueue !== <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-keyword">const</span> first = baseQueue.<span class="hljs-property">next</span>;<br>    <span class="hljs-keyword">let</span> newState = current.<span class="hljs-property">baseState</span>;<br>    <span class="hljs-keyword">let</span> newBaseState = <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">let</span> newBaseQueueFirst = <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">let</span> newBaseQueueLast = <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">let</span> update = first;<br>    <span class="hljs-keyword">do</span> &#123;<br>      <span class="hljs-keyword">const</span> updateLane = update.<span class="hljs-property">lane</span>;<br>      <span class="hljs-keyword">const</span> shouldSkipUpdate = !<span class="hljs-title function_">isSubsetOfLanes</span>(renderLanes, updateLane);<br>      <span class="hljs-keyword">if</span> (shouldSkipUpdate) &#123;<br>        <span class="hljs-comment">// å¦‚æœä¼˜å…ˆçº§ä¸å¤Ÿè·³è¿‡æ›´æ–°</span><br>        <span class="hljs-keyword">const</span> clone = &#123;<br>          <span class="hljs-attr">lane</span>: updateLane,<br>          <span class="hljs-attr">action</span>: update.<span class="hljs-property">action</span>,<br>          <span class="hljs-attr">next</span>: <span class="hljs-literal">null</span>,<br>        &#125;;<br>        <span class="hljs-comment">// å°†updateå¤åˆ¶åˆ°baseQueueé‡Œ</span><br>        <span class="hljs-keyword">if</span> (newBaseQueueLast === <span class="hljs-literal">null</span>) &#123;<br>          newBaseQueueFirst = newBaseQueueLast = clone;<br>          newBaseState = newState;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          newBaseQueueLast = newBaseQueueLast.<span class="hljs-property">next</span> = clone;<br>        &#125;<br>        <span class="hljs-comment">// laneä¹Ÿå¤åˆ¶åˆ°fiberé‡Œ</span><br>        currentlyRenderingFiber.<span class="hljs-property">lanes</span> = <span class="hljs-title function_">mergeLanes</span>(<br>          currentlyRenderingFiber.<span class="hljs-property">lanes</span>,<br>          updateLane<br>        );<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// ä¼˜å…ˆçº§å¤Ÿï¼Œæ‰§è¡Œupdate</span><br>        <span class="hljs-comment">// å¦‚æœåœ¨è·³è¿‡updateä¹‹åçš„update, ç”±äºstateé¡ºåºæ‰§è¡Œï¼Œæ‰€æœ‰ä¸‹æ¬¡è¿˜è¦æ‰§è¡Œï¼Œå¤åˆ¶åˆ°æ–°baseQueue</span><br>        <span class="hljs-keyword">if</span> (newBaseQueueLast !== <span class="hljs-literal">null</span>) &#123;<br>          <span class="hljs-keyword">const</span> clone = &#123;<br>            <span class="hljs-attr">lane</span>: <span class="hljs-title class_">NoLane</span>,<br>            <span class="hljs-attr">action</span>: update.<span class="hljs-property">action</span>,<br>            <span class="hljs-attr">next</span>: <span class="hljs-literal">null</span>,<br>          &#125;;<br>          newBaseQueueLast = newBaseQueueLast.<span class="hljs-property">next</span> = clone;<br>        &#125;<br>        <span class="hljs-keyword">const</span> action = update.<span class="hljs-property">action</span>;<br>        <span class="hljs-comment">// æ‰§è¡Œæ›´æ–°</span><br>        newState = <span class="hljs-title function_">reducer</span>(newState, action);<br>      &#125;<br>      update = update.<span class="hljs-property">next</span>;<br>    &#125; <span class="hljs-keyword">while</span> (update !== <span class="hljs-literal">null</span> &amp;&amp; update !== first);<br><br>    <span class="hljs-keyword">if</span> (newBaseQueueLast === <span class="hljs-literal">null</span>) &#123;<br>      newBaseState = newState;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      newBaseQueueLast.<span class="hljs-property">next</span> = newBaseQueueFirst;<br>    &#125;<br>    hook.<span class="hljs-property">memoizedState</span> = newState;<br>    hook.<span class="hljs-property">baseState</span> = newBaseState;<br>    hook.<span class="hljs-property">baseQueue</span> = newBaseQueueLast;<br>    queue.<span class="hljs-property">lastRenderedState</span> = newState;<br>  &#125;<br><br>  <span class="hljs-keyword">if</span> (baseQueue === <span class="hljs-literal">null</span>) &#123;<br>    queue.<span class="hljs-property">lanes</span> = <span class="hljs-title class_">NoLanes</span>;<br>  &#125;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(hook.<span class="hljs-property">memoizedState</span>, <span class="hljs-string">&quot;====-----------------&quot;</span>);<br><br>  <span class="hljs-keyword">return</span> [hook.<span class="hljs-property">memoizedState</span>, queue.<span class="hljs-property">dispatch</span>];<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>reactæºç å­¦ä¹ -åˆæˆäº‹ä»¶</title>
    <url>/posts/25bfce3c.html</url>
    <content><![CDATA[<h3 id="ç†è®º"><a href="#ç†è®º" class="headerlink" title="ç†è®º"></a>ç†è®º</h3><p>äº‹ä»¶å§”æ‰˜åœ¨å®¹å™¨dom</p>
<p>è§¦å‘å®¹å™¨domäº‹ä»¶æ—¶ï¼Œ</p>
<ol>
<li>å…ˆä»eä¸­è·å–äº‹ä»¶æºdom, å†ä»ç¼“å­˜ä¸­æ‹¿domçš„fiberï¼Œå†ä»è¯¥fiberåˆ°æ ¹fiberæ‹‰ä¸€éå›è°ƒå‡½æ•°</li>
<li>åˆ›å»ºåˆæˆäº‹ä»¶å¯¹è±¡ï¼š{click: å›è°ƒæ•°ç»„}</li>
<li>ä»åˆæˆäº‹ä»¶é‡Œæ‹¿å›è°ƒå‡½æ•°æ‰§è¡Œ</li>
</ol>
<h3 id="äº‹ä»¶å§”æ‰˜æ‰§è¡Œçš„å‡½æ•°"><a href="#äº‹ä»¶å§”æ‰˜æ‰§è¡Œçš„å‡½æ•°" class="headerlink" title="äº‹ä»¶å§”æ‰˜æ‰§è¡Œçš„å‡½æ•°"></a>äº‹ä»¶å§”æ‰˜æ‰§è¡Œçš„å‡½æ•°</h3><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// è¿™ä¸ªå‡½æ•°å°±æ˜¯å§”æ‰˜å‡½æ•°ï¼ŒaddEventListner click</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">dispatchEventForPlugins</span>(<span class="hljs-params"></span><br><span class="hljs-params">  domEventName, <span class="hljs-comment">// click</span></span><br><span class="hljs-params">  eventSystemFlags, <span class="hljs-comment">// é˜¶æ®µ å†’æ³¡0 æ•è·4</span></span><br><span class="hljs-params">  nativeEvent, <span class="hljs-comment">// äº‹ä»¶e</span></span><br><span class="hljs-params">  targetInst, <span class="hljs-comment">//  äº‹ä»¶æºdomå¯¹åº”fiber</span></span><br><span class="hljs-params">  targetContainer <span class="hljs-comment">// å®¹å™¨dom</span></span><br><span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> nativeEventTarget = <span class="hljs-title function_">getEventTarget</span>(nativeEvent);<br>  <span class="hljs-keyword">const</span> dispatchQueue = [];<br><br>  <span class="hljs-comment">// å°†åˆæˆäº‹ä»¶å’Œæ‰§è¡Œå‡½æ•° zipç»„åˆ æ”¾å…¥dispatchQueue</span><br>  <span class="hljs-title function_">extractEvents</span>(<br>    dispatchQueue,<br>    domEventName,<br>    targetInst,<br>    nativeEvent,<br>    nativeEventTarget,<br>    eventSystemFlags,<br>    targetContainer<br>  );<br>  <span class="hljs-comment">// æ‰§è¡Œæ‰€æœ‰dispatchQueue, æ‰€æœ‰clickçš„reactäº‹ä»¶å›è°ƒ</span><br>  <span class="hljs-title function_">processDispatchQueue</span>(dispatchQueue, eventSystemFlags);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="ä»ç›®æ ‡fiberåˆ°æ ¹fiberç´¯ç§¯è§¦å‘çš„åˆæˆäº‹ä»¶å›è°ƒ"><a href="#ä»ç›®æ ‡fiberåˆ°æ ¹fiberç´¯ç§¯è§¦å‘çš„åˆæˆäº‹ä»¶å›è°ƒ" class="headerlink" title="ä»ç›®æ ‡fiberåˆ°æ ¹fiberç´¯ç§¯è§¦å‘çš„åˆæˆäº‹ä»¶å›è°ƒ"></a>ä»ç›®æ ‡fiberåˆ°æ ¹fiberç´¯ç§¯è§¦å‘çš„åˆæˆäº‹ä»¶å›è°ƒ</h3><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æŠŠè¦æ‰§è¡Œçš„å›è°ƒå‡½æ•°æ·»åŠ åˆ°dispatchQueue</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; dispatchQueue äº‹ä»¶å‡½æ•°é˜Ÿåˆ—</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; domEventName domäº‹ä»¶å click</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; targetInst  äº‹ä»¶æºdomå¯¹åº”fiber</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; nativeEvent åŸç”Ÿäº‹ä»¶ e</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; nativeEventTarget äº‹ä»¶æºdom</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; eventSystemFlags å†’æ³¡0ï¼Œæ•è·4</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; targetContainer å®¹å™¨dom div#root</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">extractEvents</span>(<span class="hljs-params"></span><br><span class="hljs-params">  dispatchQueue,</span><br><span class="hljs-params">  domEventName,</span><br><span class="hljs-params">  targetInst,</span><br><span class="hljs-params">  nativeEvent,</span><br><span class="hljs-params">  nativeEventTarget,</span><br><span class="hljs-params">  eventSystemFlags,</span><br><span class="hljs-params">  targetContainer</span><br><span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">let</span> <span class="hljs-title class_">SyntheticEventCtor</span>; <span class="hljs-comment">// åˆæˆäº‹ä»¶çš„æ„å»ºå‡½æ•°</span><br>  <span class="hljs-keyword">switch</span> (domEventName) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;click&quot;</span>:<br>      <span class="hljs-title class_">SyntheticEventCtor</span> = <span class="hljs-title class_">SyntheticMouseEvent</span>;<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-attr">default</span>:<br>      <span class="hljs-keyword">break</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">const</span> reactName = topLevelEventsToReactNames.<span class="hljs-title function_">get</span>(domEventName); <span class="hljs-comment">// click=&gt; onClick</span><br>  <span class="hljs-keyword">const</span> isCapturePhase = (eventSystemFlags &amp; <span class="hljs-variable constant_">IS_CAPTURE_PHASE</span>) !== <span class="hljs-number">0</span>; <span class="hljs-comment">// æ˜¯å¦æ•è·é˜¶æ®µ</span><br><br>  <span class="hljs-comment">// ä»fiberåˆ°æ ¹fiber ç´¯è®¡reactäº‹ä»¶å‡½æ•°</span><br>  <span class="hljs-keyword">const</span> listeners = <span class="hljs-title function_">accumulateSinglePhaseListeners</span>(<br>    targetInst,<br>    reactName,<br>    nativeEvent.<span class="hljs-property">type</span>,<br>    isCapturePhase<br>  );<br><br>  <span class="hljs-keyword">if</span> (listeners.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-keyword">const</span> event = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SyntheticEventCtor</span>(<br>      reactName,<br>      domEventName,<br>      <span class="hljs-literal">null</span>,<br>      nativeEvent,<br>      nativeEventTarget<br>    );<br><br>    dispatchQueue.<span class="hljs-title function_">push</span>(&#123;<br>      event, <span class="hljs-comment">// åˆæˆäº‹ä»¶å®ä¾‹</span><br>      listeners, <span class="hljs-comment">// æ‰§è¡Œå‡½æ•°ç»„</span><br>    &#125;);<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ä»fiberåˆ°æ ¹fiber ç´¯è®¡reactäº‹ä»¶å‡½æ•°</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; targetFiber fiber</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; reactName reactäº‹ä»¶å</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; <span class="hljs-variable">nativeEventType</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; isCapturePhase æ˜¯ä¸æ˜¯æ•è·é˜¶æ®µ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">accumulateSinglePhaseListeners</span>(<span class="hljs-params"></span><br><span class="hljs-params">  targetFiber,</span><br><span class="hljs-params">  reactName,</span><br><span class="hljs-params">  nativeEventType,</span><br><span class="hljs-params">  isCapturePhase</span><br><span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> captureName = reactName + <span class="hljs-string">&quot;Capture&quot;</span>;<br>  <span class="hljs-keyword">const</span> reactEventName = isCapturePhase ? captureName : reactName;<br>  <span class="hljs-keyword">const</span> listeners = [];<br>  <span class="hljs-keyword">let</span> instance = targetFiber;<br>  <span class="hljs-keyword">while</span> (instance !== <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-keyword">const</span> &#123; stateNode, tag &#125; = instance;<br>    <span class="hljs-keyword">if</span> (tag === <span class="hljs-title class_">HostComponent</span> &amp;&amp; stateNode !== <span class="hljs-literal">null</span>) &#123;<br>      <span class="hljs-keyword">const</span> listener = <span class="hljs-title function_">getListener</span>(instance, reactEventName);<br>      <span class="hljs-keyword">if</span> (listener) &#123;<br>        listeners.<span class="hljs-title function_">push</span>(<span class="hljs-title function_">createDispatchListener</span>(instance, listener, stateNode));<br>      &#125;<br>    &#125;<br>    instance = instance.<span class="hljs-property">return</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> listeners;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="æ‰§è¡Œåˆæˆäº‹ä»¶"><a href="#æ‰§è¡Œåˆæˆäº‹ä»¶" class="headerlink" title="æ‰§è¡Œåˆæˆäº‹ä»¶"></a>æ‰§è¡Œåˆæˆäº‹ä»¶</h3><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ‰§è¡Œåˆæˆäº‹ä»¶ dispatchQueue</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; dispatchQueue &#123;event åˆæˆäº‹ä»¶, listeners reactäº‹ä»¶å‡½æ•°&#125; æ•°ç»„</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; eventSystemFlags æ˜¯å¦æ•è·é˜¶æ®µ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">processDispatchQueue</span>(<span class="hljs-params">dispatchQueue, eventSystemFlags</span>) &#123;<br>  <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦åœ¨æ•è·é˜¶æ®µ</span><br>  <span class="hljs-keyword">const</span> isCapturePhase = (eventSystemFlags &amp; <span class="hljs-variable constant_">IS_CAPTURE_PHASE</span>) !== <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; dispatchQueue.<span class="hljs-property">length</span>; i++) &#123;<br>    <span class="hljs-keyword">const</span> &#123; event, listeners &#125; = dispatchQueue[i];<br>    <span class="hljs-title function_">processDispatchQueueItemsInOrder</span>(event, listeners, isCapturePhase);<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ‰§è¡Œreactäº‹ä»¶å‡½æ•°</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; event åˆæˆäº‹ä»¶</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; dispatchListeners åˆæˆäº‹ä»¶å‡½æ•° å’Œé™„å¸¦çš„fiberå’Œdom</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; isCapturePhase æ˜¯å¦æ•è·é˜¶æ®µ</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">processDispatchQueueItemsInOrder</span>(<span class="hljs-params"></span><br><span class="hljs-params">  event,</span><br><span class="hljs-params">  dispatchListeners,</span><br><span class="hljs-params">  isCapturePhase</span><br><span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">if</span> (isCapturePhase) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = dispatchListeners.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) &#123;<br>      <span class="hljs-keyword">const</span> &#123; listener, currentTarget &#125; = dispatchListeners[i]; <span class="hljs-comment">// listener onClick, currentTarget dom, instance fiber</span><br>      <span class="hljs-keyword">if</span> (event.<span class="hljs-title function_">isPropagationStopped</span>()) &#123;<br>        <span class="hljs-keyword">return</span>;<br>      &#125;<br>      <span class="hljs-title function_">executeDispatch</span>(event, listener, currentTarget);<br>    &#125;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; dispatchListeners.<span class="hljs-property">length</span>; i++) &#123;<br>      <span class="hljs-keyword">const</span> &#123; listener, currentTarget &#125; = dispatchListeners[i]; <span class="hljs-comment">// reactçš„onClickå‡½æ•°</span><br>      <span class="hljs-keyword">if</span> (event.<span class="hljs-title function_">isPropagationStopped</span>()) &#123;<br>        <span class="hljs-keyword">return</span>;<br>      &#125;<br>      <span class="hljs-title function_">executeDispatch</span>(event, listener, currentTarget);<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>React</category>
      </categories>
  </entry>
  <entry>
    <title>reactæºç å­¦ä¹ -æ ¹fiber</title>
    <url>/posts/f57ca763.html</url>
    <content><![CDATA[<h3 id="ç†è®º"><a href="#ç†è®º" class="headerlink" title="ç†è®º"></a>ç†è®º</h3><p>fiber åŒç¼“å­˜æ¶æ„ï¼Œæ ¹fiber(HostRootFiber)æœ‰2ä¸ªï¼Œäº’ä¸ºä¸»å¤‡<br>å®¹å™¨rootèŠ‚ç‚¹(FiberRootNode)çš„currentæŒ‡å‘æ—§çš„æ ¹fiberï¼Œä¹Ÿå°±æ˜¯æ˜¾ç¤ºåœ¨ç•Œé¢ä¸Šçš„fiberæ ‘å¯¹åº”çš„æ ¹fiber</p>
<p>FiberRootNode.currentæŒ‡å‘HostRootFiber<br>HostRootFiber.stateNodeæŒ‡å‘FiberRootNode<br>FiberRootNode.containerInfoæ˜¯å®¹å™¨dom</p>
<h3 id="åˆ›å»ºFiberRootNode"><a href="#åˆ›å»ºFiberRootNode" class="headerlink" title="åˆ›å»ºFiberRootNode"></a>åˆ›å»ºFiberRootNode</h3><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">FiberRootNode</span>(<span class="hljs-params">containerInfo</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">containerInfo</span> = containerInfo;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * åˆ›å»ºä¸€ä¸ªæ ¹fiber, å¹¶ä¸”ç»‘å®šçœŸå®dom</span><br><span class="hljs-comment"> * æ ¹fiberæœ‰2ä¸ªï¼ŒåŒç¼“å­˜</span><br><span class="hljs-comment"> * å®¹å™¨domåªæœ‰ä¸€ä¸ªï¼Œç»‘å®šåœ¨æ—§fiberæ ‘çš„æ ¹fiber</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; containerInfo idä¸ºrootçš„çœŸå®dom</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> FiberRootNode&#123;containerInfo: root dom&#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createFiberRoot</span>(<span class="hljs-params">containerInfo</span>) &#123;<br>  <span class="hljs-comment">// æ ¹fiberçš„çœŸå®dom å®¹å™¨dom</span><br>  <span class="hljs-keyword">const</span> root = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FiberRootNode</span>(containerInfo);<br>  <span class="hljs-comment">// æ ¹fiber</span><br>  <span class="hljs-keyword">const</span> uninitializedFiber = <span class="hljs-title function_">createHostRootFiber</span>();<br>  <span class="hljs-comment">// äº’ç›¸å…³è”</span><br>  root.<span class="hljs-property">current</span> = uninitializedFiber;<br>  uninitializedFiber.<span class="hljs-property">stateNode</span> = root;<br>  <span class="hljs-keyword">return</span> root;<br>&#125;<br><br></code></pre></td></tr></table></figure>


<h3 id="åˆ›å»ºHostRootFiber"><a href="#åˆ›å»ºHostRootFiber" class="headerlink" title="åˆ›å»ºHostRootFiber"></a>åˆ›å»ºHostRootFiber</h3><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * fiberæ•°æ®ç»“æ„</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; tag fiberç±»å‹ å‡½æ•°ç»„ä»¶0ï¼Œç±»ç»„ä»¶1ï¼ŒåŸç”Ÿç»„ä»¶5ï¼Œæ ¹fiber3</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; pendingProps ç­‰å¾…å¤„ç†çš„å±æ€§</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; key å”¯ä¸€æ ‡è¯†</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">FiberNode</span>(<span class="hljs-params">tag, pendingProps, key</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">tag</span> = tag; <span class="hljs-comment">// å‡½æ•°ç»„ä»¶0ï¼Œç±»ç»„ä»¶1ï¼ŒåŸç”Ÿç»„ä»¶5ï¼Œæ ¹fiber3</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">key</span> = key;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">type</span> = <span class="hljs-literal">null</span>; <span class="hljs-comment">// jsx element(è™šæ‹Ÿdom)çš„type, ä¾‹å¦‚ span div p func(ç±»ç»„ä»¶ï¼Œå‡½æ•°ç»„ä»¶)</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">stateNode</span> = <span class="hljs-literal">null</span>; <span class="hljs-comment">// fiberå¯¹åº”çœŸå®domçš„å¼•ç”¨</span><br><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">return</span> = <span class="hljs-literal">null</span>; <span class="hljs-comment">// æŒ‡å‘çˆ¶fiber</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">child</span> = <span class="hljs-literal">null</span>; <span class="hljs-comment">// æŒ‡å‘ç¬¬ä¸€ä¸ªå­fiber</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">sibling</span> = <span class="hljs-literal">null</span>; <span class="hljs-comment">//æŒ‡å‘ä¸‹ä¸€ä¸ªå…„å¼Ÿfiber</span><br><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">pendingProps</span> = pendingProps; <span class="hljs-comment">// ç­‰å¾…ç”Ÿæ•ˆçš„å±æ€§</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoizedProps</span> = <span class="hljs-literal">null</span>; <span class="hljs-comment">// å·²ç»ç”Ÿæ•ˆçš„å±æ€§</span><br><br>  <span class="hljs-comment">// å­˜å‚¨çš„æ•°æ®</span><br>  <span class="hljs-comment">// ç±»ç»„ä»¶ ç±»state</span><br>  <span class="hljs-comment">// å‡½æ•°ç»„ä»¶ hooks</span><br>  <span class="hljs-comment">// æ ¹fiber è¦æ¸²æŸ“çš„å…ƒç´ </span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoizedState</span> = <span class="hljs-literal">null</span>;<br>  <span class="hljs-comment">// æ›´æ–°æ“ä½œé˜Ÿåˆ—</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">updateQueue</span> = <span class="hljs-literal">null</span>;<br><br>  <span class="hljs-comment">// å‰¯ä½œç”¨æ ‡è®°ï¼Œæ ‡è¯†è¿™ä¸ªfiberè¦è¿›è¡Œä»€ä¹ˆæ“ä½œ</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">flags</span> = <span class="hljs-title class_">NoFlags</span>;<br>  <span class="hljs-comment">// å­èŠ‚ç‚¹æœ‰æ²¡æœ‰å‰¯ä½œç”¨çš„æ ‡è®°ï¼Œå†’æ³¡ç»Ÿè®¡ï¼Œç”¨äºæ€§èƒ½ä¼˜åŒ–</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">subtreeFlags</span> = <span class="hljs-title class_">NoFlags</span>;<br>  <span class="hljs-comment">// æ–°æ—§fiberäº’ç›¸å¼•ç”¨</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">alternate</span> = <span class="hljs-literal">null</span>;<br>  <span class="hljs-comment">// dom-diff ç§»åŠ¨</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span> = <span class="hljs-number">0</span>;<br>  <span class="hljs-comment">// å­fiberåˆ é™¤æ•°ç»„</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">deletions</span> = <span class="hljs-literal">null</span>;<br>  <span class="hljs-comment">// ä¼˜å…ˆçº§</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">lanes</span> = <span class="hljs-title class_">NoLanes</span>;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">ref</span> = <span class="hljs-literal">null</span>;<br><br>  <span class="hljs-comment">//å­fiberçš„æ±‡æ€»lane</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">childLanes</span> = <span class="hljs-title class_">NoLanes</span>;<br>&#125;<br><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createFiber</span>(<span class="hljs-params">tag, pendingProps, key</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FiberNode</span>(tag, pendingProps, key);<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createHostRootFiber</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">createFiber</span>(<span class="hljs-title class_">HostRoot</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>React</category>
      </categories>
  </entry>
  <entry>
    <title>reactæºç å­¦ä¹ -éå†fiberæ ‘</title>
    <url>/posts/a73b9890.html</url>
    <content><![CDATA[<h3 id="ç†è®º"><a href="#ç†è®º" class="headerlink" title="ç†è®º"></a>ç†è®º</h3><p>fiberæ¶æ„renderé˜¶æ®µå¯ä»¥ä¸­æ–­ï¼Œä»¥fiberä¸ºå•å…ƒï¼Œä¸€æ¬¡è®¡ç®—ä¸€ä¸ªfiberã€‚<br>ä½¿ç”¨æ·±åº¦éå†fiberæ ‘ï¼Œå…ˆdfsæ‰€æœ‰childé“¾è¡¨ï¼Œå†èµ°å›çˆ¶èŠ‚ç‚¹ï¼ˆå·¦å³ä¸­ï¼‰ã€‚<br>è¿›å…¥ä¸€ä¸ªèŠ‚ç‚¹æ‰§è¡ŒbeginWorkï¼Œæ²¡æœ‰å­èŠ‚ç‚¹æ—¶å®Œæˆè¿™ä¸ªå¶å­èŠ‚ç‚¹ï¼Œæˆ–è€…å­èŠ‚ç‚¹éƒ½å®Œæˆèµ°å›çˆ¶èŠ‚ç‚¹æŠŠçˆ¶èŠ‚ç‚¹å®Œæˆï¼Œæ‰§è¡ŒcompleteWorkã€‚</p>
<h3 id="æ·±åº¦ä¼˜å…ˆéå†"><a href="#æ·±åº¦ä¼˜å…ˆéå†" class="headerlink" title="æ·±åº¦ä¼˜å…ˆéå†"></a>æ·±åº¦ä¼˜å…ˆéå†</h3><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">performUnitOfWork</span>(<span class="hljs-params">unitOfWork</span>) &#123;<br>  <span class="hljs-keyword">const</span> current = unitOfWork.<span class="hljs-property">alternate</span>;<br>  <span class="hljs-keyword">const</span> next = <span class="hljs-title function_">beginWork</span>(current, unitOfWork, workInProgressRootRenderLanes);<br>  unitOfWork.<span class="hljs-property">memoizedProps</span> = unitOfWork.<span class="hljs-property">pendingProps</span>;<br><br>  <span class="hljs-keyword">if</span> (next === <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-comment">// å¦‚æœdfsåˆ°äº†å¶å­èŠ‚ç‚¹ï¼Œæ²¡æœ‰child, æ‰§è¡Œcomplete</span><br>    <span class="hljs-title function_">completeUnitOfWork</span>(unitOfWork);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    workInProgress = next;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">completeUnitOfWork</span>(<span class="hljs-params">unitOfWork</span>) &#123;<br>  <span class="hljs-keyword">let</span> completedWork = unitOfWork;<br>  <span class="hljs-keyword">do</span> &#123;<br>    <span class="hljs-keyword">const</span> current = completedWork.<span class="hljs-property">alternate</span>;<br>    <span class="hljs-keyword">const</span> returnFiber = completedWork.<span class="hljs-property">return</span>;<br>    <span class="hljs-title function_">completeWork</span>(current, completedWork);<br><br>    <span class="hljs-keyword">const</span> siblingFiber = completedWork.<span class="hljs-property">sibling</span>;<br>    <span class="hljs-comment">// å…ˆdfså…„å¼ŸèŠ‚ç‚¹</span><br>    <span class="hljs-keyword">if</span> (siblingFiber !== <span class="hljs-literal">null</span>) &#123;<br>      workInProgress = siblingFiber;<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// å½“å‰èŠ‚ç‚¹æ˜¯childé“¾è¡¨çš„æœ€åä¸€ä¸ªï¼Œä¸‹ä¸€ä¸ªæ˜¯çˆ¶èŠ‚ç‚¹</span><br>    completedWork = returnFiber;<br>    workInProgress = completedWork;<br>  &#125; <span class="hljs-keyword">while</span> (completedWork !== <span class="hljs-literal">null</span>);<br><br>  <span class="hljs-comment">// å¦‚æœèµ°åˆ°äº†è¿™é‡Œï¼Œè¯´æ˜æ•´ä¸ªfiberæ ‘æ„å»ºå®Œæˆï¼Œrenderé˜¶æ®µå®Œæˆ</span><br>  <span class="hljs-keyword">if</span> (workInProgressRootExitStatus === <span class="hljs-title class_">RootInProgress</span>) &#123;<br>    workInProgressRootExitStatus = <span class="hljs-title class_">RootCompleted</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>React</category>
      </categories>
  </entry>
  <entry>
    <title>å•ä¾‹æ¨¡å¼</title>
    <url>/posts/de0b971c.html</url>
    <content><![CDATA[<h2 id="ã€è¯‘ã€‘å•ä¾‹æ¨¡å¼singleton-pattern"><a href="#ã€è¯‘ã€‘å•ä¾‹æ¨¡å¼singleton-pattern" class="headerlink" title="ã€è¯‘ã€‘å•ä¾‹æ¨¡å¼singleton-pattern"></a>ã€è¯‘ã€‘å•ä¾‹æ¨¡å¼<a href="https://www.patterns.dev/vanilla/singleton-pattern">singleton-pattern</a></h2><p>å•ä¾‹æ˜¯åªèƒ½å®ä¾‹åŒ–ä¸€æ¬¡å¹¶å¯ä»¥å…¨å±€è®¿é—®çš„ç±»ã€‚è¿™ä¸ªå•ä¸€å®ä¾‹å¯ä»¥åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å…±äº«ï¼Œä½¿å¾—å•ä¾‹åœ¨ç®¡ç†åº”ç”¨ç¨‹åºçš„å…¨å±€çŠ¶æ€æ–¹é¢éå¸¸æœ‰ç”¨ã€‚</p>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä½¿ç”¨ES2015ç±»çš„å•ä¾‹æ¨¡å¼çš„ç¤ºä¾‹ã€‚å¯¹äºè¿™ä¸ªç¤ºä¾‹ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªCounterç±»ï¼Œå…¶ä¸­åŒ…å«ï¼š</p>
<ul>
<li>ä¸€ä¸ªgetInstanceæ–¹æ³•ï¼Œè¿”å›å®ä¾‹çš„å€¼</li>
<li>ä¸€ä¸ªgetCountæ–¹æ³•ï¼Œè¿”å›è®¡æ•°å™¨å˜é‡çš„å½“å‰å€¼</li>
<li>ä¸€ä¸ªincrementæ–¹æ³•ï¼Œå°†è®¡æ•°å™¨çš„å€¼å¢åŠ 1</li>
<li>ä¸€ä¸ªdecrementæ–¹æ³•ï¼Œå°†è®¡æ•°å™¨çš„å€¼å‡å°‘1</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> counter = <span class="hljs-number">0</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> &#123;<br>  <span class="hljs-title function_">getInstance</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;<br>  &#125;<br><br>  <span class="hljs-title function_">getCount</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> counter;<br>  &#125;<br><br>  <span class="hljs-title function_">increment</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> ++counter;<br>  &#125;<br><br>  <span class="hljs-title function_">decrement</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> --counter;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ç„¶è€Œï¼Œè¿™ä¸ªç±»ä¸ç¬¦åˆå•ä¾‹çš„æ ‡å‡†ï¼ä¸€ä¸ªå•ä¾‹åº”è¯¥åªèƒ½è¢«å®ä¾‹åŒ–ä¸€æ¬¡ã€‚ç›®å‰ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºå¤šä¸ªCounterç±»çš„å®ä¾‹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> counter1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Counter</span>();<br><span class="hljs-keyword">const</span> counter2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Counter</span>();<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(counter1.<span class="hljs-title function_">getInstance</span>() === counter2.<span class="hljs-title function_">getInstance</span>()); <span class="hljs-comment">// false</span><br></code></pre></td></tr></table></figure>

<p>é€šè¿‡è°ƒç”¨newæ–¹æ³•ä¸¤æ¬¡ï¼Œæˆ‘ä»¬åªæ˜¯å°†counter1å’Œcounter2è®¾ç½®ä¸ºä¸åŒçš„å®ä¾‹ã€‚åœ¨counter1å’Œcounter2ä¸Šè°ƒç”¨getInstanceæ–¹æ³•è¿”å›çš„å€¼å®é™…ä¸Šæ˜¯å¯¹ä¸åŒå®ä¾‹çš„å¼•ç”¨ï¼šå®ƒä»¬å¹¶ä¸ä¸¥æ ¼ç›¸ç­‰ï¼</p>
<p>è®©æˆ‘ä»¬ç¡®ä¿åªèƒ½åˆ›å»ºä¸€ä¸ªCounterç±»çš„å®ä¾‹ã€‚</p>
<p>ç¡®ä¿åªèƒ½åˆ›å»ºä¸€ä¸ªå®ä¾‹çš„ä¸€ç§æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªåä¸ºinstanceçš„å˜é‡ã€‚åœ¨Counterçš„æ„é€ å‡½æ•°ä¸­ï¼Œå½“åˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†instanceè®¾ç½®ä¸ºå¯¹è¯¥å®ä¾‹çš„å¼•ç”¨ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ£€æŸ¥instanceå˜é‡æ˜¯å¦å·²ç»æœ‰å€¼æ¥é˜»æ­¢æ–°çš„å®ä¾‹åŒ–ã€‚å¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œè¡¨ç¤ºå·²ç»å­˜åœ¨ä¸€ä¸ªå®ä¾‹ã€‚è¿™æ˜¯ä¸åº”è¯¥å‘ç”Ÿçš„ï¼šåº”è¯¥æŠ›å‡ºé”™è¯¯æ¥é€šçŸ¥ç”¨æˆ·</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> instance;<br><span class="hljs-keyword">let</span> counter = <span class="hljs-number">0</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">if</span> (instance) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;You can only create one instance!&quot;</span>);<br>    &#125;<br>    instance = <span class="hljs-variable language_">this</span>;<br>  &#125;<br><br>  <span class="hljs-title function_">getInstance</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;<br>  &#125;<br><br>  <span class="hljs-title function_">getCount</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> counter;<br>  &#125;<br><br>  <span class="hljs-title function_">increment</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> ++counter;<br>  &#125;<br><br>  <span class="hljs-title function_">decrement</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> --counter;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> counter1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Counter</span>();<br><span class="hljs-keyword">const</span> counter2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Counter</span>();<br><span class="hljs-comment">// Error: You can only create one instance!</span><br></code></pre></td></tr></table></figure>

<p>å®Œç¾ï¼æˆ‘ä»¬ä¸èƒ½å†åˆ›å»ºå¤šä¸ªå®ä¾‹äº†ã€‚Reflectä¹Ÿä¸è¡Œã€‚</p>
<p>è®©æˆ‘ä»¬ä»counter.jsæ–‡ä»¶ä¸­å¯¼å‡ºCounterå®ä¾‹ã€‚ä½†åœ¨è¿™æ ·åšä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜åº”è¯¥å†»ç»“å®ä¾‹ã€‚Object.freezeæ–¹æ³•ç¡®ä¿ä½¿ç”¨ä»£ç æ— æ³•ä¿®æ”¹å•ä¾‹ã€‚å†»ç»“å®ä¾‹ä¸Šçš„å±æ€§ä¸èƒ½æ·»åŠ æˆ–ä¿®æ”¹ï¼Œè¿™å‡å°‘äº†æ„å¤–è¦†ç›–å•ä¾‹å€¼çš„é£é™©ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> instance;<br><span class="hljs-keyword">let</span> counter = <span class="hljs-number">0</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">if</span> (instance) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;You can only create one instance!&quot;</span>);<br>    &#125;<br>    instance = <span class="hljs-variable language_">this</span>;<br>  &#125;<br><br>  <span class="hljs-title function_">getInstance</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;<br>  &#125;<br><br>  <span class="hljs-title function_">getCount</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> counter;<br>  &#125;<br><br>  <span class="hljs-title function_">increment</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> ++counter;<br>  &#125;<br><br>  <span class="hljs-title function_">decrement</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> --counter;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> singletonCounter = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">freeze</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Counter</span>());<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> singletonCounter;<br></code></pre></td></tr></table></figure>

<h3 id="æƒè¡¡åˆ©å¼Š"><a href="#æƒè¡¡åˆ©å¼Š" class="headerlink" title="æƒè¡¡åˆ©å¼Š"></a>æƒè¡¡åˆ©å¼Š</h3><p>å°†å®ä¾‹åŒ–é™åˆ¶ä¸ºåªæœ‰ä¸€ä¸ªå®ä¾‹å¯èƒ½ä¼šèŠ‚çœå¤§é‡çš„å†…å­˜ç©ºé—´ã€‚ä¸å¿…æ¯æ¬¡éƒ½ä¸ºæ–°å®ä¾‹è®¾ç½®å†…å­˜ï¼Œåªéœ€ä¸ºé‚£ä¸ªåœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å¼•ç”¨çš„å®ä¾‹è®¾ç½®å†…å­˜ã€‚ç„¶è€Œï¼Œå•ä¾‹å®é™…ä¸Šè¢«è®¤ä¸ºæ˜¯ä¸€ç§åæ¨¡å¼ï¼Œåœ¨JavaScriptä¸­åº”è¯¥å°½é‡é¿å…ä½¿ç”¨ã€‚</p>
<p>ä¼˜ç‚¹ï¼šå½“newä¸€ä¸ªå¯¹è±¡ä»£ä»·å¾ˆå¤§æ—¶ï¼Œå•ä¾‹å¯ä»¥å‡å°‘å†…å­˜å ç”¨ï¼Œç½‘ç»œIOç­‰</p>
<p>ç¼ºç‚¹ï¼šå…¨å±€çŠ¶æ€ï¼Œä¿®æ”¹æ¥æºéš¾ä»¥ç¡®å®šï¼Œå®¹æ˜“å¯¼è‡´æ„å¤–çš„æ›´æ–°</p>
<p>ç„¶è€Œï¼Œä¸Šé¢ç¤ºä¾‹ä¸­çš„ç±»å®ç°å®é™…ä¸Šæ˜¯è¿‡åº¦çš„ã€‚ç”±äºæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨JavaScriptä¸­åˆ›å»ºå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°ä½¿ç”¨æ™®é€šå¯¹è±¡æ¥å®ç°å®Œå…¨ç›¸åŒçš„ç»“æœã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä½¿ç”¨å•ä¾‹çš„ä¸€äº›ç¼ºç‚¹ï¼</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><br><span class="hljs-comment">// counter.js</span><br><span class="hljs-keyword">let</span> instance;<br><span class="hljs-keyword">let</span> counter = <span class="hljs-number">0</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">if</span> (instance) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Only one instance is allowed!&quot;</span>);<br>    &#125;<br>    instance = <span class="hljs-variable language_">this</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">counter</span> = counter;<br>  &#125;<br><br>  <span class="hljs-title function_">getInstance</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;<br>  &#125;<br><br>  <span class="hljs-title function_">getCount</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> counter;<br>  &#125;<br><br>  <span class="hljs-title function_">increment</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> ++counter;<br>  &#125;<br><br>  <span class="hljs-title function_">decrement</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> --counter;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> singletonCounter = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">freeze</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Counter</span>());<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> singletonCounter;<br><br><span class="hljs-comment">// superCounter.js</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Counter</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./counter&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SuperCounter</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = <span class="hljs-number">0</span>;<br>  &#125;<br><br>  <span class="hljs-title function_">increment</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Counter</span>.<span class="hljs-title function_">increment</span>();<br>    <span class="hljs-keyword">return</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> += <span class="hljs-number">100</span>);<br>  &#125;<br><br>  <span class="hljs-title function_">decrement</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Counter</span>.<span class="hljs-title function_">decrement</span>();<br>    <span class="hljs-keyword">return</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> -= <span class="hljs-number">100</span>);<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment">// index.js</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-dom&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;./styles.css&quot;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Counter</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./counter&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">SuperCounter</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./superCounter&quot;</span>;<br><span class="hljs-keyword">const</span> counter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SuperCounter</span>();<br><br>counter.<span class="hljs-title function_">increment</span>();<br>counter.<span class="hljs-title function_">increment</span>();<br>counter.<span class="hljs-title function_">increment</span>();<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Counter in counter.js: &quot;</span>, <span class="hljs-title class_">Counter</span>.<span class="hljs-title function_">getCount</span>());<br><br><span class="hljs-keyword">const</span> rootElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;root&quot;</span>);<br><span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">render</span>(<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;App&quot;</span>&gt;</span>Check the console!<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>, rootElement);<br><br><br></code></pre></td></tr></table></figure>

<h3 id="éšè—ä¾èµ–å…³ç³»"><a href="#éšè—ä¾èµ–å…³ç³»" class="headerlink" title="éšè—ä¾èµ–å…³ç³»"></a>éšè—ä¾èµ–å…³ç³»</h3><p>åœ¨å¯¼å…¥å¦ä¸€ä¸ªæ¨¡å—æ—¶ï¼Œæ¯”å¦‚superCounter.jsï¼Œåœ¨å¯¼å…¥è¯¥æ¨¡å—æ—¶å¯èƒ½ä¸æ˜æ˜¾è¯¥æ¨¡å—æ­£åœ¨å¯¼å…¥ä¸€ä¸ªå•ä¾‹ã€‚åœ¨å…¶ä»–æ–‡ä»¶ä¸­ï¼Œæ¯”å¦‚index.jsï¼Œåœ¨å¯¼å…¥è¯¥æ¨¡å—å¹¶è°ƒç”¨å…¶æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæ„å¤–åœ°ä¿®æ”¹å•ä¾‹ä¸­çš„å€¼ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´æ„å¤–è¡Œä¸ºï¼Œå› ä¸ºå¤šä¸ªå®ä¾‹çš„å•ä¾‹å¯ä»¥åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å…±äº«ï¼Œå¹¶ä¸”ä¹Ÿä¼šè¢«ä¿®æ”¹ã€‚</p>
<h3 id="å…¨å±€è¡Œä¸º"><a href="#å…¨å±€è¡Œä¸º" class="headerlink" title="å…¨å±€è¡Œä¸º"></a>å…¨å±€è¡Œä¸º</h3><p>å•ä¾‹å®ä¾‹åº”è¯¥èƒ½å¤Ÿåœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­è¢«å¼•ç”¨ã€‚å…¨å±€å˜é‡æœ¬è´¨ä¸Šæ˜¾ç¤ºç›¸åŒçš„è¡Œä¸ºï¼šç”±äºå…¨å±€å˜é‡åœ¨å…¨å±€èŒƒå›´å†…å¯ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­è®¿é—®è¿™äº›å˜é‡ã€‚</p>
<p>æ‹¥æœ‰å…¨å±€å˜é‡é€šå¸¸è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªç³Ÿç³•çš„è®¾è®¡å†³ç­–ã€‚å…¨å±€ä½œç”¨åŸŸæ±¡æŸ“å¯èƒ½ä¼šå¯¼è‡´æ„å¤–è¦†ç›–å…¨å±€å˜é‡çš„å€¼ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´è®¸å¤šæ„å¤–è¡Œä¸ºã€‚</p>
<p>åœ¨ES2015ä¸­ï¼Œåˆ›å»ºå…¨å±€å˜é‡ç›¸å½“ä¸å¸¸è§ã€‚æ–°çš„letå’Œconstå…³é”®å­—é€šè¿‡å°†ä½¿ç”¨è¿™ä¸¤ä¸ªå…³é”®å­—å£°æ˜çš„å˜é‡é™å®šåœ¨å—çº§ä½œç”¨åŸŸä¸­ï¼Œé˜²æ­¢å¼€å‘äººå‘˜æ„å¤–åœ°æ±¡æŸ“å…¨å±€ä½œç”¨åŸŸã€‚JavaScriptä¸­çš„æ–°æ¨¡å—ç³»ç»Ÿä½¿å¾—åˆ›å»ºå…¨å±€å¯è®¿é—®çš„å€¼æ›´åŠ å®¹æ˜“ï¼Œè€Œä¸ä¼šæ±¡æŸ“å…¨å±€ä½œç”¨åŸŸï¼Œé€šè¿‡èƒ½å¤Ÿä»æ¨¡å—ä¸­å¯¼å‡ºå€¼ï¼Œå¹¶åœ¨å…¶ä»–æ–‡ä»¶ä¸­å¯¼å…¥è¿™äº›å€¼ã€‚</p>
<p>ç„¶è€Œï¼Œå•ä¾‹çš„å¸¸è§ç”¨ä¾‹æ˜¯åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å…·æœ‰æŸç§å…¨å±€çŠ¶æ€ã€‚è®©ä»£ç åº“çš„å¤šä¸ªéƒ¨åˆ†ä¾èµ–äºåŒä¸€ä¸ªå¯å˜å¯¹è±¡å¯èƒ½ä¼šå¯¼è‡´æ„å¤–è¡Œä¸ºã€‚</p>
<p>é€šå¸¸ï¼Œä»£ç åº“çš„æŸäº›éƒ¨åˆ†ä¿®æ”¹å…¨å±€çŠ¶æ€ä¸­çš„å€¼ï¼Œè€Œå…¶ä»–éƒ¨åˆ†æ¶ˆè´¹è¯¥æ•°æ®ã€‚æ‰§è¡Œé¡ºåºå¾ˆé‡è¦ï¼šå½“è¿˜æ²¡æœ‰æ•°æ®å¯ä¾›æ¶ˆè´¹æ—¶ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›æ„å¤–åœ°å…ˆæ¶ˆè´¹æ•°æ®ï¼å½“ä½¿ç”¨å…¨å±€çŠ¶æ€æ—¶ï¼Œç†è§£æ•°æ®æµç¨‹å¯èƒ½ä¼šå˜å¾—éå¸¸æ£˜æ‰‹ï¼Œç‰¹åˆ«æ˜¯å½“åº”ç”¨ç¨‹åºä¸æ–­å¢é•¿ï¼Œæ•°åä¸ªç»„ä»¶ç›¸äº’ä¾èµ–æ—¶ã€‚</p>
<h3 id="reactå…¨å±€çŠ¶æ€ç®¡ç†"><a href="#reactå…¨å±€çŠ¶æ€ç®¡ç†" class="headerlink" title="reactå…¨å±€çŠ¶æ€ç®¡ç†"></a>reactå…¨å±€çŠ¶æ€ç®¡ç†</h3><p>åœ¨Reactä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¾èµ–äºçŠ¶æ€ç®¡ç†å·¥å…·ï¼ˆå¦‚Reduxæˆ–React Contextï¼‰æ¥å®ç°å…¨å±€çŠ¶æ€ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å•ä¾‹ã€‚å°½ç®¡å®ƒä»¬çš„å…¨å±€çŠ¶æ€è¡Œä¸ºå¯èƒ½ä¸å•ä¾‹ç±»ä¼¼ï¼Œä½†è¿™äº›å·¥å…·æä¾›çš„æ˜¯åªè¯»çŠ¶æ€ï¼Œè€Œä¸æ˜¯å¯å˜çŠ¶æ€ã€‚åœ¨ä½¿ç”¨Reduxæ—¶ï¼Œåªæœ‰çº¯å‡½æ•°reducerå¯ä»¥æ›´æ–°çŠ¶æ€ï¼Œåœ¨ç»„ä»¶é€šè¿‡è°ƒåº¦ç¨‹åºå‘é€æ“ä½œåã€‚</p>
<p>å°½ç®¡ä½¿ç”¨è¿™äº›å·¥å…·ä¸èƒ½ç¥å¥‡åœ°æ¶ˆé™¤å…¨å±€çŠ¶æ€çš„ç¼ºç‚¹ï¼Œä½†æˆ‘ä»¬è‡³å°‘å¯ä»¥ç¡®ä¿å…¨å±€çŠ¶æ€æŒ‰ç…§æˆ‘ä»¬çš„æ„å›¾è¿›è¡Œä¿®æ”¹ï¼Œå› ä¸ºç»„ä»¶æ— æ³•ç›´æ¥æ›´æ–°çŠ¶æ€ã€‚</p>
]]></content>
      <categories>
        <category>Patterns</category>
      </categories>
  </entry>
  <entry>
    <title>ç­–ç•¥æ¨¡å¼</title>
    <url>/posts/7b063943.html</url>
    <content><![CDATA[<h2 id="ã€è¯‘ã€‘ç­–ç•¥æ¨¡å¼strategy-pattern"><a href="#ã€è¯‘ã€‘ç­–ç•¥æ¨¡å¼strategy-pattern" class="headerlink" title="ã€è¯‘ã€‘ç­–ç•¥æ¨¡å¼strategy-pattern"></a>ã€è¯‘ã€‘ç­–ç•¥æ¨¡å¼<a href="https://carloscaballero.io/stategy-pattern-in-javascript-typescript/">strategy-pattern</a></h2><p>æœ‰23ä¸ªç»å…¸è®¾è®¡æ¨¡å¼åœ¨åŸå§‹ä¹¦ç±ã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„å…ƒç´ ã€‹ä¸­è¢«æè¿°ã€‚è¿™äº›æ¨¡å¼æä¾›äº†è§£å†³åœ¨è½¯ä»¶å¼€å‘ä¸­åå¤å‡ºç°ç‰¹å®šé—®é¢˜çš„æ–¹æ¡ˆã€‚</p>
<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†æè¿°ç­–ç•¥æ¨¡å¼çš„å·¥ä½œåŸç†ï¼Œå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä»¥åŠåº”è¯¥åœ¨ä½•æ—¶ä½•åœ°åº”ç”¨å®ƒã€‚åœ¨å…¶ä»–ä¸Šä¸‹æ–‡ä¸­ï¼Œè¿™ç§æ¨¡å¼ä¹Ÿè¢«ç§°ä¸ºç­–ç•¥æ¨¡å¼ã€‚</p>
<h3 id="ç­–ç•¥æ¨¡å¼ï¼šåŸºæœ¬æ€æƒ³"><a href="#ç­–ç•¥æ¨¡å¼ï¼šåŸºæœ¬æ€æƒ³" class="headerlink" title="ç­–ç•¥æ¨¡å¼ï¼šåŸºæœ¬æ€æƒ³"></a>ç­–ç•¥æ¨¡å¼ï¼šåŸºæœ¬æ€æƒ³</h3><p>ç­–ç•¥æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸åœ¨è¿è¡Œæ—¶é€‰æ‹©ç®—æ³•â€”â€”ç»´åŸºç™¾ç§‘ </p>
<p>å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼Œå°†æ¯ä¸ªç®—æ³•å°è£…èµ·æ¥ï¼Œå¹¶ä½¿å®ƒä»¬å¯ä»¥äº’æ¢ã€‚ ç­–ç•¥æ¨¡å¼è®©ç®—æ³•èƒ½å¤Ÿç‹¬ç«‹äºä½¿ç”¨å®ƒçš„å®¢æˆ·ç«¯è€Œå˜åŒ–ã€‚â€”â€”ã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„å…ƒç´ ã€‹</p>
<p>è¿™ç§æ¨¡å¼çš„ä¸»è¦ç‰¹ç‚¹æ˜¯ï¼Œå®¢æˆ·ç«¯æœ‰ä¸€ç»„ç®—æ³•ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶é€‰æ‹©ç‰¹å®šçš„ç®—æ³•æ¥ä½¿ç”¨ã€‚è¿™äº›ç®—æ³•ä¹‹é—´æ˜¯å¯ä»¥äº’æ¢çš„ã€‚</p>
<p>ä»¥ä¸‹ä»£ç å±•ç¤ºäº†ä¸€ä¸ªç»å…¸é—®é¢˜ï¼Œå³ä½ éœ€è¦åœ¨åº”ç”¨ç¨‹åºä¸­é€‰æ‹©ä¸€ä¸ªå…·ä½“çš„ç®—æ³•ã€‚åœ¨è¿™ä¸ªä»£ç ä¸­ï¼Œä½ ä½¿ç”¨äº†ä»»ä½•ç¼–ç¨‹è¯­è¨€ä¸­çš„<code>switch</code>æ§åˆ¶ç»“æ„ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">myMethod</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">switch</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_strategySelected</span>) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-title class_">SimpleStrategy</span>:<br>            <span class="hljs-title class_">ComposeWithSimpleStrategy</span>();<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-title class_">TeXStrategy</span>:<br>            <span class="hljs-title class_">ComposeWithTeXStrategy</span>();<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-comment">//...</span><br>    &#125;<br><span class="hljs-comment">// merge results with existing composition, if necessary</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>ç„¶è€Œï¼Œä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥æ›´åŠ çµæ´»ï¼Œå®ƒå°†å…·æœ‰ä»¥ä¸‹ç»“æ„ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">myMethod</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">_strategySelected</span>-&gt;<span class="hljs-title class_">Compose</span>();<br>  <span class="hljs-comment">// merge results with existing composition, if necessary</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>è¿™ç§æ¨¡å¼çš„UMLå›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="/pic/strategy-pattern.png" alt="strategy-pattern-uml"></p>
<p>æ¯ç§ç­–ç•¥éƒ½é€šè¿‡ä¸€ä¸ªå…·ä½“çš„å¯¹è±¡æ¥è¡¨ç¤ºã€‚å› æ­¤ï¼ŒcontextåŒ…å«ä¸€ä¸ªç­–ç•¥å¯¹è±¡ï¼ˆå…·ä½“ç­–ç•¥Aã€å…·ä½“ç­–ç•¥Bç­‰ï¼‰ï¼Œè¯¥å¯¹è±¡å®ç°äº†ç­–ç•¥æ¥å£ã€‚ç­–ç•¥ä¹‹é—´äº’æ¢çš„å…³é”®åœ¨äºåœ¨contextå®ç°ä¸€ä¸ªæ–¹æ³•æ¥æ›´æ”¹ç­–ç•¥ï¼Œä¾‹å¦‚ï¼ŒsetStrategyæ–¹æ³•ã€‚</p>
<h3 id="ç­–ç•¥æ¨¡å¼ï¼šä½•æ—¶ä½¿ç”¨"><a href="#ç­–ç•¥æ¨¡å¼ï¼šä½•æ—¶ä½¿ç”¨" class="headerlink" title="ç­–ç•¥æ¨¡å¼ï¼šä½•æ—¶ä½¿ç”¨"></a>ç­–ç•¥æ¨¡å¼ï¼šä½•æ—¶ä½¿ç”¨</h3><ul>
<li><p>ç­–ç•¥æ¨¡å¼è§£å†³çš„é—®é¢˜æ˜¯å½“ä½ éœ€è¦ä½¿ç”¨å‡ ç§æœ‰ä¸åŒå˜ä½“çš„ç®—æ³•æ—¶ã€‚åœ¨é‚£ä¸ªæ—¶å€™ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªå…·ä½“ç±»æ¥å®ç°ä½ çš„ç®—æ³•ï¼ˆè¿™å¯èƒ½åŒ…å«ä¸€ä¸ªæˆ–ä¸€äº›å‡½æ•°ï¼‰ã€‚</p>
</li>
<li><p>å¦ä¸€ä¸ªä½ å‘ç°éœ€è¦è¿™ç§æ¨¡å¼çš„æœ‰è¶£æ—¶åˆ»æ˜¯å½“å­˜åœ¨å›´ç»•å‡ ä¸ªç›¸äº’å…³è”ç®—æ³•çš„æ¡ä»¶è¯­å¥æ—¶ã€‚</p>
</li>
<li><p>æœ€åï¼Œå½“ä½ çš„å¤§å¤šæ•°ç±»å…·æœ‰ç›¸å…³çš„è¡Œä¸ºæ—¶ï¼Œä½ å¿…é¡»ä½¿ç”¨è¿™ç§æ¨¡å¼ã€‚</p>
</li>
</ul>
<h3 id="ç­–ç•¥æ¨¡å¼ï¼šä¼˜åŠ¿"><a href="#ç­–ç•¥æ¨¡å¼ï¼šä¼˜åŠ¿" class="headerlink" title="ç­–ç•¥æ¨¡å¼ï¼šä¼˜åŠ¿"></a>ç­–ç•¥æ¨¡å¼ï¼šä¼˜åŠ¿</h3><p>ç­–ç•¥æ¨¡å¼å…·æœ‰å¤šä¸ªä¼˜åŠ¿ï¼Œå¯ä»¥æ€»ç»“ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>ä½¿ç”¨äº†æ¥å£çš„å¤šæ€æ€§ï¼Œå› æ­¤åœ¨è¿è¡Œæ—¶è½»æ¾åˆ‡æ¢ä¸åŒçš„ç®—æ³•ï¼ˆç­–ç•¥ï¼‰å˜å¾—å®¹æ˜“ã€‚ </li>
<li>ä»£ç æ¸…æ™°ï¼Œå› ä¸ºä½ é¿å…äº†æ¡ä»¶è¯­å¥è¿‡å¤šçš„ä»£ç ï¼ˆä¸å¤æ‚ï¼‰ã€‚ </li>
<li>ä»£ç æ›´åŠ æ¸…æ™°ï¼Œå› ä¸ºä½ å°†å…³æ³¨ç‚¹åˆ†ç¦»åˆ°ä¸åŒçš„ç±»ä¸­ï¼ˆæ¯ä¸ªç­–ç•¥ä¸€ä¸ªç±»ï¼‰ã€‚</li>
</ul>
<h3 id="ç­–ç•¥æ¨¡å¼ï¼šç¼ºç‚¹"><a href="#ç­–ç•¥æ¨¡å¼ï¼šç¼ºç‚¹" class="headerlink" title="ç­–ç•¥æ¨¡å¼ï¼šç¼ºç‚¹"></a>ç­–ç•¥æ¨¡å¼ï¼šç¼ºç‚¹</h3><ul>
<li>å¦‚æœä½ çš„ç®—æ³•æå°‘å‘ç”Ÿæ”¹å˜ï¼Œ é‚£ä¹ˆæ²¡æœ‰ä»»ä½•ç†ç”±å¼•å…¥æ–°çš„ç±»å’Œæ¥å£ã€‚ ä½¿ç”¨è¯¥æ¨¡å¼åªä¼šè®©ç¨‹åºè¿‡äºå¤æ‚ã€‚</li>
</ul>
<h3 id="ç­–ç•¥æ¨¡å¼ï¼šä½¿ç”¨JavaScriptçš„åŸºæœ¬å®ç°"><a href="#ç­–ç•¥æ¨¡å¼ï¼šä½¿ç”¨JavaScriptçš„åŸºæœ¬å®ç°" class="headerlink" title="ç­–ç•¥æ¨¡å¼ï¼šä½¿ç”¨JavaScriptçš„åŸºæœ¬å®ç°"></a>ç­–ç•¥æ¨¡å¼ï¼šä½¿ç”¨JavaScriptçš„åŸºæœ¬å®ç°</h3><p>ç°åœ¨ï¼Œæˆ‘å°†å‘ä½ å±•ç¤ºå¦‚ä½•ä½¿ç”¨JavaScriptå®ç°è¿™ä¸ªæ¨¡å¼ï¼Œä½ éœ€è¦è®°ä½JavaScriptæ²¡æœ‰æ¥å£ã€‚å› æ­¤ï¼Œä½ éœ€è¦ç¼–å†™ä¸€ä¸ªåä¸ºStrategyManagerçš„ç±»ï¼Œå®ƒè¢«ç”¨ä½œæ¥å£ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">StrategyManager</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_strategy</span> = <span class="hljs-literal">null</span>;<br>  &#125;<br>  <span class="hljs-keyword">set</span> <span class="hljs-title function_">strategy</span>(<span class="hljs-params">strategy</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_strategy</span> = strategy;<br>  &#125;<br>  <span class="hljs-keyword">get</span> <span class="hljs-title function_">strategy</span>() &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_strategy</span>;<br>  &#125;<br>  <span class="hljs-title function_">doAction</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_strategy</span>.<span class="hljs-title function_">doAction</span>();<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>è¿™ä¸ªç±»åŒ…å«ä¸€ä¸ªåä¸º_strategyçš„ç§æœ‰å±æ€§ï¼Œå®ƒä»£è¡¨äº†å½“å‰å°†è¦ä½¿ç”¨çš„ç­–ç•¥ã€‚doActionæ–¹æ³•æ˜¯å°†åœ¨æ¯ä¸ªå…·ä½“ç­–ç•¥ä¸­å®ç°çš„æ–¹æ³•ã€‚ç”±äºJavaScriptè¯­è¨€ç¼ºä¹é¢å‘å¯¹è±¡çš„ç‰¹æ€§ï¼Œç­–ç•¥æ¨¡å¼åœ¨JavaScriptä¸­çš„å®ç°ä¸UMLæœ‰æ‰€ä¸åŒã€‚</p>
<p>æ¯ä¸ªå…·ä½“ç­–ç•¥çš„å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Strategy1</span> &#123;<br>  <span class="hljs-title function_">doAction</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Strategy1&#x27;</span>);<br>  &#125;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Strategy2</span> &#123;<br>  <span class="hljs-title function_">doAction</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Strategy2&#x27;</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è¯·æ³¨æ„ï¼Œå…·ä½“æ–¹æ³•doActionåœ¨æ¯ä¸ªå…·ä½“ç­–ç•¥ä¸­éƒ½å¾—åˆ°äº†å®ç°ã€‚</p>
<p>æœ€åï¼Œcontextå¿…é¡»åŒ…å«StrategyManagerï¼ˆæˆ–è€…åœ¨é¢å‘å¯¹è±¡çš„è¯­è¨€ä¸­æ˜¯ç­–ç•¥æ¥å£ï¼‰ä»¥ä½¿ç”¨å…·ä½“ç­–ç•¥ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> strategyManager = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StrategyManager</span>();<br><span class="hljs-keyword">const</span> strategy1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Strategy1</span>();<br><span class="hljs-keyword">const</span> strategy2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Strategy2</span>();<br><br>strategyManager.<span class="hljs-property">strategy</span> = strategy1; <span class="hljs-comment">//Assign Strategy1;</span><br>strategyManager.<span class="hljs-title function_">doAction</span>();<br><br>strategyManager.<span class="hljs-property">strategy</span> = strategy2; <span class="hljs-comment">// Assign Strategy2;</span><br>strategyManager.<span class="hljs-title function_">doAction</span>();<br></code></pre></td></tr></table></figure>



<h3 id="ç­–ç•¥æ¨¡å¼ï¼šä¸€ç»„ç­–ç•¥"><a href="#ç­–ç•¥æ¨¡å¼ï¼šä¸€ç»„ç­–ç•¥" class="headerlink" title="ç­–ç•¥æ¨¡å¼ï¼šä¸€ç»„ç­–ç•¥"></a>ç­–ç•¥æ¨¡å¼ï¼šä¸€ç»„ç­–ç•¥</h3><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">StrategyManager</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_strategies</span> = [];<br>  &#125;<br>  <span class="hljs-title function_">addStrategy</span>(<span class="hljs-params">strategy</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_strategies</span> = [...<span class="hljs-variable language_">this</span>.<span class="hljs-property">_strategies</span>, strategy];<br>  &#125;<br>  <span class="hljs-title function_">getStrategy</span>(<span class="hljs-params">name</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_strategies</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">strategy</span> =&gt;</span> strategy.<span class="hljs-property">_name</span> === name);<br>  &#125;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Strategy</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name, handler</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_name</span> = name;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_handler</span> = handler;<br>  &#125;<br>  <span class="hljs-title function_">doAction</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_handler</span>();<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// Client-Context</span><br><span class="hljs-keyword">const</span> strategyManager = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StrategyManager</span>();<br><span class="hljs-keyword">const</span> strategy1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Strategy</span>(<span class="hljs-string">&#x27;strategy1&#x27;</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Strategy1&#x27;</span>));<br><span class="hljs-keyword">const</span> strategy2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Strategy</span>(<span class="hljs-string">&#x27;strategy2&#x27;</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Strategy2&#x27;</span>));<br><br>strategyManager.<span class="hljs-title function_">addStrategy</span>(strategy1);<br>strategyManager.<span class="hljs-title function_">addStrategy</span>(strategy2);<br><br><span class="hljs-comment">// Choose first strategy.</span><br><span class="hljs-keyword">const</span> strategyA = strategyManager.<span class="hljs-title function_">getStrategy</span>(<span class="hljs-string">&#x27;strategy1&#x27;</span>);<br>strategyA.<span class="hljs-title function_">doAction</span>();<br><br><span class="hljs-comment">// Choose second strategy.</span><br><span class="hljs-keyword">const</span> strategyB = strategyManager.<span class="hljs-title function_">getStrategy</span>(<span class="hljs-string">&#x27;strategy2&#x27;</span>);<br>strategyB.<span class="hljs-title function_">doAction</span>();<br><br><span class="hljs-comment">// Choose unsupported strategy.</span><br><span class="hljs-keyword">const</span> strategyC = strategyManager.<span class="hljs-title function_">getStrategy</span>(<span class="hljs-string">&#x27;strategy3&#x27;</span>);<br><br><span class="hljs-keyword">try</span> &#123;<br>  strategyC.<span class="hljs-title function_">doAction</span>();<br>&#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Caught Error&#x27;</span>);<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><p>ç­–ç•¥æ¨¡å¼æ˜¯ä¸€ç§å¯ä»¥åœ¨éœ€è¦é€‰æ‹©å…·ä½“ç®—æ³•æ—¶é¿å…ä»£ç å¤æ‚æ€§çš„æ¨¡å¼ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°ä½¿ç”¨JavaScriptè¯­è¨€çš„ä¸€ä¸ªç®€å•å®ç°ï¼Œå°½ç®¡JavaScriptç¼ºä¹æ¥å£ã€‚åœ¨ä½ ä½¿ç”¨å…·æœ‰æ¥å£çš„ç¼–ç¨‹è¯­è¨€çš„æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥éµå¾ªæ¨¡å¼çš„UMLã€‚</p>
<p>æœ€é‡è¦çš„æ˜¯ï¼Œä¸æ˜¯æŒ‰ç…§æˆ‘å‘ä½ å±•ç¤ºçš„æ–¹å¼å®ç°æ¨¡å¼ï¼Œè€Œæ˜¯ä½ éœ€è¦çŸ¥é“æ¨¡å¼è§£å†³çš„é—®é¢˜æ˜¯ä»€ä¹ˆï¼Œä»¥åŠä¸ºä»€ä¹ˆä½ å¿…é¡»ä½¿ç”¨å®ƒï¼Œå› ä¸ºå®ç°å°†æ ¹æ®ç¼–ç¨‹è¯­è¨€çš„ä¸åŒè€Œæœ‰æ‰€ä¸åŒã€‚</p>
]]></content>
      <categories>
        <category>Patterns</category>
      </categories>
  </entry>
  <entry>
    <title>answer</title>
    <url>/posts/78a19d7.html</url>
    <content><![CDATA[<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-property">retry</span> = <span class="hljs-function">(<span class="hljs-params">fn, times = <span class="hljs-number">0</span></span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">fn</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> times &gt; <span class="hljs-number">0</span> ? <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">retry</span>(fn, times - <span class="hljs-number">1</span>) : <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>())<br>&#125;<br></code></pre></td></tr></table></figure>
]]></content>
  </entry>
</search>
